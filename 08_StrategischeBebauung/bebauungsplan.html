<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>EA Bebauungsplan</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: { extend: { colors: {
        primary: { 50:'#eff6ff',100:'#dbeafe',200:'#bfdbfe',300:'#93c5fd',400:'#60a5fa',500:'#3b82f6',600:'#2563eb',700:'#1d4ed8',800:'#1e40af',900:'#1e3a8a' },
        surface: { 50:'#f8fafc',100:'#f1f5f9',200:'#e2e8f0',300:'#cbd5e1',700:'#334155',800:'#1e293b',900:'#0f172a',950:'#020617' },
      }}}
    }
  </script>

  <script src="https://cdn.jsdelivr.net/npm/chart.js@4"></script>
  <script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>

  <style>
    [v-cloak] { display: none !important; }
    ::-webkit-scrollbar { width: 6px; height: 6px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: #94a3b8; border-radius: 3px; }
    ::-webkit-scrollbar-thumb:hover { background: #64748b; }
    .fade-enter-active, .fade-leave-active { transition: opacity .2s ease; }
    .fade-enter-from, .fade-leave-to { opacity: 0; }
    .domain-swatch { width: 12px; height: 12px; border-radius: 3px; display: inline-block; }
    .maturity-bar { height: 8px; border-radius: 4px; transition: width .5s ease; }
    .time-grid-line { stroke: #e2e8f0; stroke-width: 1; stroke-dasharray: 4,4; }
    .matrix-cell:hover { transform: scale(1.15); z-index: 10; }
    .matrix-cell { transition: transform .15s ease; }
    .dep-link { fill: none; stroke-opacity: 0.6; }
    .dep-node text { font-size: 11px; pointer-events: none; }
    .nav-item { transition: background-color .15s ease, color .15s ease; }
    .nav-item:hover { background-color: #e2e8f0; }
    .nav-item.active { background-color: #dbeafe; color: #1d4ed8; font-weight: 600; }
    @media (max-width: 1024px) { .sidebar-collapsed { transform: translateX(-100%); } }
    @media print { .no-print { display: none !important; } .sidebar { display: none !important; } }
  </style>
</head>
<body class="h-full bg-surface-50 text-gray-800 antialiased">
  <div id="app" v-cloak>
    <app-layout></app-layout>
  </div>

  <script>
// EA Bebauungsplan - Metallwerk Vorarlberg GmbH
// Single-File Build - works as file:// without server

// ‚îÄ‚îÄ Vue API destructuring (global build) ‚îÄ‚îÄ
const { reactive, watch } = Vue;

// ‚îÄ‚îÄ SEED DATA ‚îÄ‚îÄ
const SEED_DATA = {
  "meta": {
    "version": "1.0",
    "lastUpdated": "2026-02-07",
    "owner": "Enterprise Architecture",
    "company": "Metallwerk Vorarlberg GmbH",
    "description": "Strategischer Bebauungsplan ‚Äî Datenmodell f√ºr ein mittelst√§ndisches Industrieunternehmen"
  },
  "enums": {
    "criticality": [
      "Mission-Critical",
      "Business-Critical",
      "Business-Operational",
      "Administrative"
    ],
    "timeQuadrant": [
      "Tolerate",
      "Invest",
      "Migrate",
      "Eliminate"
    ],
    "appType": [
      "SaaS",
      "On-Prem",
      "Custom",
      "PaaS"
    ],
    "capabilityMaturity": [
      {
        "value": 1,
        "label": "Initial",
        "description": "Kaum vorhanden oder rein manuell (Excel, Papier)"
      },
      {
        "value": 2,
        "label": "Managed",
        "description": "Grundfunktionalit√§t vorhanden, aber fragmentiert"
      },
      {
        "value": 3,
        "label": "Defined",
        "description": "Strukturiert umgesetzt, definierte Prozesse"
      },
      {
        "value": 4,
        "label": "Measured",
        "description": "Automatisiert, integriert, KPI-gesteuert"
      },
      {
        "value": 5,
        "label": "Optimized",
        "description": "Best-in-Class, kontinuierlich optimiert"
      }
    ],
    "capabilityCriticality": [
      "High",
      "Medium",
      "Low"
    ],
    "mappingRole": [
      "Primary",
      "Secondary"
    ],
    "projectCategory": [
      "Run / Pflicht",
      "Modernisierung",
      "Optimierung",
      "Innovation / Grow",
      "Infrastruktur"
    ],
    "projectStatus": [
      "green",
      "yellow",
      "red"
    ],
    "conformity": [
      "Konform",
      "Teilkonform",
      "Widerspricht"
    ],
    "dependencyType": [
      {
        "value": "T",
        "label": "Technische Abh√§ngigkeit",
        "symbol": "‚ÜíT"
      },
      {
        "value": "D",
        "label": "Datenabh√§ngigkeit",
        "symbol": "‚ÜíD"
      },
      {
        "value": "P",
        "label": "Plattformabh√§ngigkeit",
        "symbol": "‚ÜíP"
      },
      {
        "value": "R",
        "label": "Ressourcenkonflikt",
        "symbol": "‚ÜíR"
      },
      {
        "value": "F",
        "label": "Fachliche Abh√§ngigkeit",
        "symbol": "‚ÜíF"
      },
      {
        "value": "Z",
        "label": "Zeitliche Abh√§ngigkeit",
        "symbol": "‚ÜíZ"
      }
    ],
    "appAction": [
      "einf√ºhren",
      "ver√§ndern",
      "abl√∂sen"
    ],
    "kpiTrend": [
      "improving",
      "stable",
      "declining"
    ],
    "processStatus": [
      "active",
      "optimization",
      "transformation"
    ],
    "vendorStatus": [
      "Active",
      "Under Review",
      "Phase-Out",
      "New"
    ],
    "vendorCriticality": [
      "Strategic",
      "Important",
      "Standard",
      "Commodity"
    ],
    "demandCategory": [
      "Idee",
      "Bereichsvorhaben (< 50k)",
      "Projekt (> 50k)"
    ],
    "demandStatus": [
      "Eingereicht",
      "In Bewertung",
      "Genehmigt",
      "Abgelehnt",
      "In Umsetzung",
      "Abgeschlossen"
    ],
    "demandPriority": [
      "Hoch",
      "Mittel",
      "Niedrig"
    ],
    "aiRiskCategory": [
      "Kein AI-Usecase",
      "Minimales Risiko",
      "Begrenztes Risiko",
      "Hohes Risiko",
      "Unannehmbares Risiko"
    ],
    "budgetType": [
      "Run / Pflicht",
      "Change / Grow"
    ],
    "interfaceType": [
      {
        "value": "API",
        "label": "REST / SOAP API",
        "symbol": "‚áÑ"
      },
      {
        "value": "File",
        "label": "Datei-Transfer",
        "symbol": "üìÅ"
      },
      {
        "value": "DB-Link",
        "label": "Datenbank-Link",
        "symbol": "üîó"
      },
      {
        "value": "Event",
        "label": "Event / Message",
        "symbol": "‚ö°"
      },
      {
        "value": "ETL",
        "label": "ETL / Batch",
        "symbol": "‚ü≥"
      },
      {
        "value": "Manual",
        "label": "Manuell / Export",
        "symbol": "‚úã"
      }
    ]
  },
  "domains": [
    {
      "id": 1,
      "name": "IT Infrastructure & Operations",
      "color": "#3B82F6",
      "icon": "server",
      "description": "Fundament der gesamten IT ‚Äî Datacenter, Cloud, Netzwerk, Security, ITSM",
      "domainOwner": "CIO",
      "strategicFocus": "Stabilit√§t, Hybrid Cloud, Kosteneffizienz",
      "vision": "Hybrid Cloud First ‚Äî alle non-critical Workloads in Azure bis 2028, Zero-Trust Security Baseline",
      "kpis": [
        {
          "id": "KPI-D1-1",
          "name": "Cloud Workload %",
          "target": "60",
          "current": "25",
          "unit": "%",
          "trend": "improving"
        },
        {
          "id": "KPI-D1-2",
          "name": "Infrastructure Availability",
          "target": "99.9",
          "current": "99.5",
          "unit": "%",
          "trend": "stable"
        },
        {
          "id": "KPI-D1-3",
          "name": "Mean Time to Recovery",
          "target": "2",
          "current": "4.5",
          "unit": "h",
          "trend": "improving"
        }
      ],
      "capabilities": [
        {
          "id": "1.1",
          "name": "Datacenter Management",
          "maturity": 3,
          "targetMaturity": 3,
          "criticality": "High",
          "subCapabilities": [
            {
              "id": "1.1.1",
              "name": "Server & Compute Management"
            },
            {
              "id": "1.1.2",
              "name": "Storage Management"
            },
            {
              "id": "1.1.3",
              "name": "Netzwerk & Konnektivit√§t"
            },
            {
              "id": "1.1.4",
              "name": "Physical Security & Facility"
            }
          ]
        },
        {
          "id": "1.2",
          "name": "Cloud Platform Management",
          "maturity": 2,
          "targetMaturity": 4,
          "criticality": "High",
          "subCapabilities": [
            {
              "id": "1.2.1",
              "name": "Cloud Governance & Landing Zones"
            },
            {
              "id": "1.2.2",
              "name": "Cloud Compute & Container Services"
            },
            {
              "id": "1.2.3",
              "name": "Cloud Networking & Connectivity"
            },
            {
              "id": "1.2.4",
              "name": "Cloud Cost Management (FinOps)"
            }
          ]
        },
        {
          "id": "1.3",
          "name": "Hybrid Infrastructure",
          "maturity": 2,
          "targetMaturity": 4,
          "criticality": "High",
          "subCapabilities": [
            {
              "id": "1.3.1",
              "name": "Hybrid Connectivity (VPN, ExpressRoute)"
            },
            {
              "id": "1.3.2",
              "name": "Identity & Access Management (Entra ID)"
            },
            {
              "id": "1.3.3",
              "name": "Monitoring & Observability"
            }
          ]
        },
        {
          "id": "1.4",
          "name": "IT Security & Compliance",
          "maturity": 3,
          "targetMaturity": 4,
          "criticality": "High",
          "subCapabilities": [
            {
              "id": "1.4.1",
              "name": "Endpoint Security"
            },
            {
              "id": "1.4.2",
              "name": "Network Security"
            },
            {
              "id": "1.4.3",
              "name": "Security Operations (SOC/SIEM)"
            },
            {
              "id": "1.4.4",
              "name": "Backup & Disaster Recovery"
            }
          ]
        },
        {
          "id": "1.5",
          "name": "IT Service Management",
          "maturity": 3,
          "targetMaturity": 4,
          "criticality": "Medium",
          "subCapabilities": [
            {
              "id": "1.5.1",
              "name": "Incident & Problem Management"
            },
            {
              "id": "1.5.2",
              "name": "Change & Release Management"
            },
            {
              "id": "1.5.3",
              "name": "Asset & Configuration Management (CMDB)"
            }
          ]
        }
      ]
    },
    {
      "id": 2,
      "name": "Digital Workplace & Collaboration",
      "color": "#8B5CF6",
      "icon": "monitor",
      "description": "Arbeitsplatz, Zusammenarbeit, Wissensmanagement, Citizen Development",
      "domainOwner": "CIO",
      "strategicFocus": "Enablement, Adoption, Copilot-Readiness",
      "vision": "Intelligent Workplace ‚Äî M365 Copilot-Ready, Knowledge Graph als Wissensbasis, Power Platform als Citizen-Dev-Plattform",
      "kpis": [
        {
          "id": "KPI-D2-1",
          "name": "M365 Adoption Score",
          "target": "80",
          "current": "52",
          "unit": "%",
          "trend": "improving"
        },
        {
          "id": "KPI-D2-2",
          "name": "Citizen Dev Apps",
          "target": "30",
          "current": "8",
          "unit": "#",
          "trend": "improving"
        }
      ],
      "capabilities": [
        {
          "id": "2.1",
          "name": "Modern Workplace",
          "maturity": 3,
          "targetMaturity": 4,
          "criticality": "High",
          "subCapabilities": [
            {
              "id": "2.1.1",
              "name": "Workplace Provisioning & Lifecycle"
            },
            {
              "id": "2.1.2",
              "name": "Unified Communication (Teams Voice, Video)"
            },
            {
              "id": "2.1.3",
              "name": "Email & Calendar (Exchange Online)"
            },
            {
              "id": "2.1.4",
              "name": "Workplace Analytics & Adoption"
            }
          ]
        },
        {
          "id": "2.2",
          "name": "Collaboration & Content Management",
          "maturity": 2,
          "targetMaturity": 4,
          "criticality": "High",
          "subCapabilities": [
            {
              "id": "2.2.1",
              "name": "Team Collaboration"
            },
            {
              "id": "2.2.2",
              "name": "Document Management & Governance"
            },
            {
              "id": "2.2.3",
              "name": "Intranet & Internal Communication"
            },
            {
              "id": "2.2.4",
              "name": "Content Lifecycle Management"
            }
          ]
        },
        {
          "id": "2.3",
          "name": "Enterprise Knowledge & Search",
          "maturity": 1,
          "targetMaturity": 3,
          "criticality": "Medium",
          "subCapabilities": [
            {
              "id": "2.3.1",
              "name": "Knowledge Graph & Taxonomy"
            },
            {
              "id": "2.3.2",
              "name": "Enterprise Search (Microsoft Search)"
            },
            {
              "id": "2.3.3",
              "name": "AI-Assisted Knowledge Access (M365 Copilot)"
            },
            {
              "id": "2.3.4",
              "name": "Information Architecture & Metadata"
            }
          ]
        },
        {
          "id": "2.4",
          "name": "Citizen Development Platform",
          "maturity": 2,
          "targetMaturity": 4,
          "criticality": "Medium",
          "subCapabilities": [
            {
              "id": "2.4.1",
              "name": "Low-Code App Development (Power Apps)"
            },
            {
              "id": "2.4.2",
              "name": "Business Process Automation (Power Automate)"
            },
            {
              "id": "2.4.3",
              "name": "Data Visualization & Self-Service BI (Power BI)"
            },
            {
              "id": "2.4.4",
              "name": "Platform Governance & CoE"
            }
          ]
        }
      ]
    },
    {
      "id": 3,
      "name": "Vertrieb & Kundenmanagement",
      "color": "#10B981",
      "icon": "users",
      "description": "CRM, Auftrags- & Angebotswesen, Vertriebssteuerung, Pricing, After-Sales",
      "domainOwner": "Vertriebsleiter",
      "strategicFocus": "CRM-Konsolidierung, CPQ, Kundenportal",
      "vision": "360¬∞-Kundenblick ‚Äî Durchg√§ngiger Lead-to-Cash-Prozess mit Salesforce als Kern-CRM",
      "kpis": [
        {
          "id": "KPI-D3-1",
          "name": "CRM Adoption Rate",
          "target": "95",
          "current": "72",
          "unit": "%",
          "trend": "improving"
        },
        {
          "id": "KPI-D3-2",
          "name": "Forecast Accuracy",
          "target": "85",
          "current": "60",
          "unit": "%",
          "trend": "stable"
        }
      ],
      "capabilities": [
        {
          "id": "3.1",
          "name": "CRM",
          "maturity": 3,
          "targetMaturity": 4,
          "criticality": "High",
          "subCapabilities": [
            {
              "id": "3.1.1",
              "name": "Kundenstammdatenverwaltung"
            },
            {
              "id": "3.1.2",
              "name": "Kontakt- & Aktivit√§tenmanagement"
            },
            {
              "id": "3.1.3",
              "name": "Kundensegmentierung & -klassifizierung"
            },
            {
              "id": "3.1.4",
              "name": "Kundenportal & Self-Service"
            }
          ]
        },
        {
          "id": "3.2",
          "name": "Angebots- & Auftragswesen",
          "maturity": 3,
          "targetMaturity": 4,
          "criticality": "High",
          "subCapabilities": [
            {
              "id": "3.2.1",
              "name": "Angebotskalkulation & -erstellung"
            },
            {
              "id": "3.2.2",
              "name": "Auftragserfassung & -best√§tigung"
            },
            {
              "id": "3.2.3",
              "name": "Konfiguration & Variantenmanagement (CPQ)"
            },
            {
              "id": "3.2.4",
              "name": "Vertragsmanagement"
            }
          ]
        },
        {
          "id": "3.3",
          "name": "Vertriebssteuerung",
          "maturity": 2,
          "targetMaturity": 4,
          "criticality": "Medium",
          "subCapabilities": [
            {
              "id": "3.3.1",
              "name": "Pipeline- & Forecast-Management"
            },
            {
              "id": "3.3.2",
              "name": "Gebiets- & Key-Account-Management"
            },
            {
              "id": "3.3.3",
              "name": "Provisionsabrechnung"
            },
            {
              "id": "3.3.4",
              "name": "Vertriebsreporting & KPIs"
            }
          ]
        },
        {
          "id": "3.4",
          "name": "Pricing & Konditionen",
          "maturity": 2,
          "targetMaturity": 3,
          "criticality": "Medium",
          "subCapabilities": [
            {
              "id": "3.4.1",
              "name": "Preisfindung & Rabattmanagement"
            },
            {
              "id": "3.4.2",
              "name": "Konditionsvereinbarungen"
            },
            {
              "id": "3.4.3",
              "name": "Wettbewerbsanalyse (Pricing Intelligence)"
            }
          ]
        },
        {
          "id": "3.5",
          "name": "After-Sales & Service",
          "maturity": 1,
          "targetMaturity": 3,
          "criticality": "Medium",
          "subCapabilities": [
            {
              "id": "3.5.1",
              "name": "Reklamationsmanagement"
            },
            {
              "id": "3.5.2",
              "name": "Technischer Kundendienst / Field Service"
            },
            {
              "id": "3.5.3",
              "name": "Ersatzteilmanagement"
            },
            {
              "id": "3.5.4",
              "name": "Service-Level-Agreements (SLA)"
            }
          ]
        }
      ]
    },
    {
      "id": 4,
      "name": "Produktion & Fertigung",
      "color": "#F59E0B",
      "icon": "cog",
      "description": "PPS, MES, Qualit√§tsmanagement, Instandhaltung, Lean/CI",
      "domainOwner": "Werksleiter",
      "strategicFocus": "MES-ERP-Integration, Shopfloor-Digitalisierung",
      "vision": "Smart Factory ‚Äî Durchg√§ngige MES-ERP-Integration, OEE >85%, Predictive Maintenance f√ºr Kernmaschinen",
      "kpis": [
        {
          "id": "KPI-D4-1",
          "name": "OEE (Overall Equipment Effectiveness)",
          "target": "85",
          "current": "71",
          "unit": "%",
          "trend": "improving"
        },
        {
          "id": "KPI-D4-2",
          "name": "First Pass Yield",
          "target": "95",
          "current": "91",
          "unit": "%",
          "trend": "stable"
        },
        {
          "id": "KPI-D4-3",
          "name": "Schedule Adherence",
          "target": "90",
          "current": "83",
          "unit": "%",
          "trend": "improving"
        }
      ],
      "capabilities": [
        {
          "id": "4.1",
          "name": "Produktionsplanung (PPS)",
          "maturity": 4,
          "targetMaturity": 4,
          "criticality": "High",
          "subCapabilities": [
            {
              "id": "4.1.1",
              "name": "Kapazit√§tsplanung"
            },
            {
              "id": "4.1.2",
              "name": "Feinplanung & Reihenfolgeoptimierung"
            },
            {
              "id": "4.1.3",
              "name": "Schichtplanung"
            },
            {
              "id": "4.1.4",
              "name": "Material- & Bedarfsplanung (MRP)"
            }
          ]
        },
        {
          "id": "4.2",
          "name": "Fertigungssteuerung (MES)",
          "maturity": 3,
          "targetMaturity": 4,
          "criticality": "High",
          "subCapabilities": [
            {
              "id": "4.2.1",
              "name": "Fertigungsauftragsmanagement"
            },
            {
              "id": "4.2.2",
              "name": "Betriebsdatenerfassung (BDE)"
            },
            {
              "id": "4.2.3",
              "name": "Maschinendatenerfassung (MDE)"
            },
            {
              "id": "4.2.4",
              "name": "R√ºckmeldung & Fortschrittskontrolle"
            }
          ]
        },
        {
          "id": "4.3",
          "name": "Qualit√§tsmanagement",
          "maturity": 2,
          "targetMaturity": 4,
          "criticality": "High",
          "subCapabilities": [
            {
              "id": "4.3.1",
              "name": "Wareneingangspr√ºfung"
            },
            {
              "id": "4.3.2",
              "name": "In-Prozess-Qualit√§tskontrolle (SPC)"
            },
            {
              "id": "4.3.3",
              "name": "Endpr√ºfung & Freigabe"
            },
            {
              "id": "4.3.4",
              "name": "Reklamations- & CAPA-Management"
            },
            {
              "id": "4.3.5",
              "name": "Audit- & Zertifizierungsmanagement"
            }
          ]
        },
        {
          "id": "4.4",
          "name": "Instandhaltung & Maintenance",
          "maturity": 1,
          "targetMaturity": 3,
          "criticality": "High",
          "subCapabilities": [
            {
              "id": "4.4.1",
              "name": "Pr√§ventive Instandhaltung"
            },
            {
              "id": "4.4.2",
              "name": "Korrektive Instandhaltung"
            },
            {
              "id": "4.4.3",
              "name": "Predictive Maintenance (Condition Monitoring)"
            },
            {
              "id": "4.4.4",
              "name": "Ersatzteil- & Werkzeugverwaltung"
            }
          ]
        },
        {
          "id": "4.5",
          "name": "Lean & Continuous Improvement",
          "maturity": 2,
          "targetMaturity": 3,
          "criticality": "Medium",
          "subCapabilities": [
            {
              "id": "4.5.1",
              "name": "Shopfloor-Management"
            },
            {
              "id": "4.5.2",
              "name": "KVP / Kaizen-Prozess"
            },
            {
              "id": "4.5.3",
              "name": "OEE-Tracking & Verlustanalyse"
            }
          ]
        }
      ]
    },
    {
      "id": 5,
      "name": "Supply Chain & Logistik",
      "color": "#EF4444",
      "icon": "truck",
      "description": "Einkauf, Lagerverwaltung, Logistik, SC Planning, Lieferantenintegration",
      "domainOwner": "Supply Chain Manager",
      "strategicFocus": "E2E-Transparenz, Lieferantenintegration",
      "vision": "Transparente Supply Chain ‚Äî E2E-Transparenz vom Lieferanten bis zum Kunden, S&OP-Integration",
      "kpis": [
        {
          "id": "KPI-D5-1",
          "name": "P2P Cycle Time",
          "target": "30",
          "current": "48",
          "unit": "days",
          "trend": "improving"
        },
        {
          "id": "KPI-D5-2",
          "name": "Touchless Invoice Rate",
          "target": "60",
          "current": "25",
          "unit": "%",
          "trend": "stable"
        }
      ],
      "capabilities": [
        {
          "id": "5.1",
          "name": "Einkauf & Beschaffung",
          "maturity": 3,
          "targetMaturity": 4,
          "criticality": "High",
          "subCapabilities": [
            {
              "id": "5.1.1",
              "name": "Strategischer Einkauf & Sourcing"
            },
            {
              "id": "5.1.2",
              "name": "Operativer Einkauf"
            },
            {
              "id": "5.1.3",
              "name": "Lieferantenmanagement & -bewertung"
            },
            {
              "id": "5.1.4",
              "name": "Vertrags- & Konditionsmanagement"
            },
            {
              "id": "5.1.5",
              "name": "E-Procurement & Katalogmanagement"
            }
          ]
        },
        {
          "id": "5.2",
          "name": "Lagerverwaltung & Bestandsmanagement",
          "maturity": 3,
          "targetMaturity": 3,
          "criticality": "High",
          "subCapabilities": [
            {
              "id": "5.2.1",
              "name": "Warehouse Management System (WMS)"
            },
            {
              "id": "5.2.2",
              "name": "Bestandsf√ºhrung & Inventur"
            },
            {
              "id": "5.2.3",
              "name": "Lagerplatzoptimierung"
            },
            {
              "id": "5.2.4",
              "name": "Konsignationslager"
            }
          ]
        },
        {
          "id": "5.3",
          "name": "Logistik & Distribution",
          "maturity": 2,
          "targetMaturity": 3,
          "criticality": "Medium",
          "subCapabilities": [
            {
              "id": "5.3.1",
              "name": "Versandabwicklung"
            },
            {
              "id": "5.3.2",
              "name": "Transportmanagement (TMS)"
            },
            {
              "id": "5.3.3",
              "name": "Zoll & Au√üenhandel"
            },
            {
              "id": "5.3.4",
              "name": "Track & Trace"
            }
          ]
        },
        {
          "id": "5.4",
          "name": "Supply Chain Planning",
          "maturity": 2,
          "targetMaturity": 4,
          "criticality": "Medium",
          "subCapabilities": [
            {
              "id": "5.4.1",
              "name": "Demand Planning & Forecasting"
            },
            {
              "id": "5.4.2",
              "name": "Sales & Operations Planning (S&OP)"
            },
            {
              "id": "5.4.3",
              "name": "Supply Network Design"
            },
            {
              "id": "5.4.4",
              "name": "Bestandsoptimierung"
            }
          ]
        },
        {
          "id": "5.5",
          "name": "Lieferantenintegration",
          "maturity": 1,
          "targetMaturity": 3,
          "criticality": "Medium",
          "subCapabilities": [
            {
              "id": "5.5.1",
              "name": "EDI & Datenaustausch"
            },
            {
              "id": "5.5.2",
              "name": "Supplier Portal"
            },
            {
              "id": "5.5.3",
              "name": "Vendor Managed Inventory (VMI)"
            }
          ]
        }
      ]
    },
    {
      "id": 6,
      "name": "Engineering & Produktentwicklung",
      "color": "#06B6D4",
      "icon": "compass",
      "description": "CAD, PLM, Requirements, Test & Validation, Innovation",
      "domainOwner": "Entwicklungsleiter",
      "strategicFocus": "PLM-ERP-Br√ºcke, √Ñnderungsmanagement",
      "vision": "Digital Engineering ‚Äî Durchg√§ngiger digitaler Faden von Design √ºber PLM bis Fertigung",
      "kpis": [
        {
          "id": "KPI-D6-1",
          "name": "Engineering Change Lead Time",
          "target": "5",
          "current": "12",
          "unit": "days",
          "trend": "improving"
        },
        {
          "id": "KPI-D6-2",
          "name": "BOM Accuracy",
          "target": "99",
          "current": "94",
          "unit": "%",
          "trend": "stable"
        }
      ],
      "capabilities": [
        {
          "id": "6.1",
          "name": "Produktdesign & Konstruktion",
          "maturity": 3,
          "targetMaturity": 4,
          "criticality": "High",
          "subCapabilities": [
            {
              "id": "6.1.1",
              "name": "CAD / 3D-Modellierung"
            },
            {
              "id": "6.1.2",
              "name": "Simulation & FEM-Analyse"
            },
            {
              "id": "6.1.3",
              "name": "Rapid Prototyping / Additive Fertigung"
            },
            {
              "id": "6.1.4",
              "name": "Design Review & Freigabe"
            }
          ]
        },
        {
          "id": "6.2",
          "name": "Product Lifecycle Management (PLM)",
          "maturity": 3,
          "targetMaturity": 4,
          "criticality": "High",
          "subCapabilities": [
            {
              "id": "6.2.1",
              "name": "St√ºcklistenmanagement (BOM)"
            },
            {
              "id": "6.2.2",
              "name": "√Ñnderungsmanagement (ECR/ECO)"
            },
            {
              "id": "6.2.3",
              "name": "Dokumentenmanagement (technische Doku)"
            },
            {
              "id": "6.2.4",
              "name": "Konfigurationsmanagement"
            }
          ]
        },
        {
          "id": "6.3",
          "name": "Anforderungs- & Spezifikationsmanagement",
          "maturity": 2,
          "targetMaturity": 3,
          "criticality": "Medium",
          "subCapabilities": [
            {
              "id": "6.3.1",
              "name": "Requirements Engineering"
            },
            {
              "id": "6.3.2",
              "name": "Normen- & Standardverwaltung"
            },
            {
              "id": "6.3.3",
              "name": "Technische Spezifikationen"
            }
          ]
        },
        {
          "id": "6.4",
          "name": "Test & Validation",
          "maturity": 2,
          "targetMaturity": 3,
          "criticality": "Medium",
          "subCapabilities": [
            {
              "id": "6.4.1",
              "name": "Pr√ºfplanung & -durchf√ºhrung"
            },
            {
              "id": "6.4.2",
              "name": "Testergebnisdokumentation"
            },
            {
              "id": "6.4.3",
              "name": "Zulassung & Zertifizierung"
            }
          ]
        },
        {
          "id": "6.5",
          "name": "Innovation & Portfolio Management",
          "maturity": 1,
          "targetMaturity": 2,
          "criticality": "Low",
          "subCapabilities": [
            {
              "id": "6.5.1",
              "name": "Ideenmanagement / Innovation Pipeline"
            },
            {
              "id": "6.5.2",
              "name": "Technologie-Scouting"
            },
            {
              "id": "6.5.3",
              "name": "Produktportfolio-Steuerung"
            }
          ]
        }
      ]
    },
    {
      "id": 7,
      "name": "Finanzen & Controlling",
      "color": "#84CC16",
      "icon": "dollar-sign",
      "description": "Finanzbuchhaltung, Controlling, Planung, Reporting, Treasury",
      "domainOwner": "CFO",
      "strategicFocus": "Single Source of Truth, Planungsintegration",
      "vision": "Integrated Finance ‚Äî Ein konsolidiertes Finanzreporting, durchg√§ngige Planungsintegration, CSRD-Readiness",
      "kpis": [
        {
          "id": "KPI-D7-1",
          "name": "Days to Close",
          "target": "5",
          "current": "8",
          "unit": "days",
          "trend": "improving"
        },
        {
          "id": "KPI-D7-2",
          "name": "Forecast Variance",
          "target": "5",
          "current": "12",
          "unit": "%",
          "trend": "stable"
        }
      ],
      "capabilities": [
        {
          "id": "7.1",
          "name": "Finanzbuchhaltung",
          "maturity": 4,
          "targetMaturity": 4,
          "criticality": "High",
          "subCapabilities": [
            {
              "id": "7.1.1",
              "name": "Hauptbuchhaltung"
            },
            {
              "id": "7.1.2",
              "name": "Debitorenbuchhaltung"
            },
            {
              "id": "7.1.3",
              "name": "Kreditorenbuchhaltung"
            },
            {
              "id": "7.1.4",
              "name": "Anlagenbuchhaltung"
            },
            {
              "id": "7.1.5",
              "name": "Konzernkonsolidierung"
            }
          ]
        },
        {
          "id": "7.2",
          "name": "Controlling",
          "maturity": 4,
          "targetMaturity": 4,
          "criticality": "High",
          "subCapabilities": [
            {
              "id": "7.2.1",
              "name": "Kostenstellenrechnung"
            },
            {
              "id": "7.2.2",
              "name": "Kostentr√§gerrechnung / Produktkalkulation"
            },
            {
              "id": "7.2.3",
              "name": "Profit-Center-Rechnung"
            },
            {
              "id": "7.2.4",
              "name": "Deckungsbeitragsrechnung"
            }
          ]
        },
        {
          "id": "7.3",
          "name": "Planung & Budgetierung",
          "maturity": 2,
          "targetMaturity": 4,
          "criticality": "High",
          "subCapabilities": [
            {
              "id": "7.3.1",
              "name": "Budgetplanung & Forecasting"
            },
            {
              "id": "7.3.2",
              "name": "Investitionsplanung (CapEx)"
            },
            {
              "id": "7.3.3",
              "name": "Liquidit√§tsplanung"
            },
            {
              "id": "7.3.4",
              "name": "Szenarioanalysen"
            }
          ]
        },
        {
          "id": "7.4",
          "name": "Reporting & Analytics",
          "maturity": 3,
          "targetMaturity": 4,
          "criticality": "High",
          "subCapabilities": [
            {
              "id": "7.4.1",
              "name": "Management Reporting / MIS"
            },
            {
              "id": "7.4.2",
              "name": "Statutory Reporting"
            },
            {
              "id": "7.4.3",
              "name": "ESG / Nachhaltigkeitsreporting (CSRD)"
            },
            {
              "id": "7.4.4",
              "name": "Ad-hoc-Analysen & Dashboards"
            }
          ]
        },
        {
          "id": "7.5",
          "name": "Treasury & Compliance",
          "maturity": 3,
          "targetMaturity": 3,
          "criticality": "Medium",
          "subCapabilities": [
            {
              "id": "7.5.1",
              "name": "Zahlungsverkehr"
            },
            {
              "id": "7.5.2",
              "name": "Bankanbindung"
            },
            {
              "id": "7.5.3",
              "name": "Steuerliche Compliance"
            },
            {
              "id": "7.5.4",
              "name": "Internes Kontrollsystem (IKS)"
            }
          ]
        }
      ]
    },
    {
      "id": 8,
      "name": "HR & Organisation",
      "color": "#EC4899",
      "icon": "user",
      "description": "Personaladministration, Abrechnung, Recruiting, Talent Management, HR Analytics",
      "domainOwner": "HR-Leiterin",
      "strategicFocus": "Digitalisierung, integrierte HR-Suite",
      "vision": "Digital HR ‚Äî Abl√∂sung der Insell√∂sungen durch integrierte HR-Plattform (SAP SuccessFactors), Employee Self-Service",
      "kpis": [
        {
          "id": "KPI-D8-1",
          "name": "Time-to-Hire",
          "target": "45",
          "current": "68",
          "unit": "days",
          "trend": "stable"
        },
        {
          "id": "KPI-D8-2",
          "name": "Onboarding Completeness",
          "target": "90",
          "current": "55",
          "unit": "%",
          "trend": "improving"
        }
      ],
      "capabilities": [
        {
          "id": "8.1",
          "name": "Personaladministration",
          "maturity": 2,
          "targetMaturity": 3,
          "criticality": "High",
          "subCapabilities": [
            {
              "id": "8.1.1",
              "name": "Personalstammdatenverwaltung"
            },
            {
              "id": "8.1.2",
              "name": "Personalaktenf√ºhrung (digital)"
            },
            {
              "id": "8.1.3",
              "name": "Bescheinigungs- & Dokumentenwesen"
            },
            {
              "id": "8.1.4",
              "name": "Organisationsmanagement (Organigramm)"
            }
          ]
        },
        {
          "id": "8.2",
          "name": "Personalabrechnung & Zeitwirtschaft",
          "maturity": 2,
          "targetMaturity": 3,
          "criticality": "High",
          "subCapabilities": [
            {
              "id": "8.2.1",
              "name": "Lohn- & Gehaltsabrechnung"
            },
            {
              "id": "8.2.2",
              "name": "Zeiterfassung & Abwesenheitsmanagement"
            },
            {
              "id": "8.2.3",
              "name": "Schichtplanung (Produktion)"
            },
            {
              "id": "8.2.4",
              "name": "Reisekostenmanagement"
            }
          ]
        },
        {
          "id": "8.3",
          "name": "Recruiting & Onboarding",
          "maturity": 2,
          "targetMaturity": 4,
          "criticality": "Medium",
          "subCapabilities": [
            {
              "id": "8.3.1",
              "name": "Bewerbermanagement (ATS)"
            },
            {
              "id": "8.3.2",
              "name": "Stellenausschreibung & Employer Branding"
            },
            {
              "id": "8.3.3",
              "name": "Onboarding-Prozess"
            },
            {
              "id": "8.3.4",
              "name": "Assessment & Auswahlverfahren"
            }
          ]
        },
        {
          "id": "8.4",
          "name": "Personalentwicklung & Talent Management",
          "maturity": 1,
          "targetMaturity": 3,
          "criticality": "Medium",
          "subCapabilities": [
            {
              "id": "8.4.1",
              "name": "Mitarbeitergespr√§che & Zielvereinbarungen"
            },
            {
              "id": "8.4.2",
              "name": "Kompetenzmanagement"
            },
            {
              "id": "8.4.3",
              "name": "Nachfolgeplanung"
            },
            {
              "id": "8.4.4",
              "name": "Learning Management (LMS)"
            }
          ]
        },
        {
          "id": "8.5",
          "name": "HR Analytics & Strategie",
          "maturity": 1,
          "targetMaturity": 2,
          "criticality": "Low",
          "subCapabilities": [
            {
              "id": "8.5.1",
              "name": "Personalplanung & Workforce Planning"
            },
            {
              "id": "8.5.2",
              "name": "HR KPIs & Dashboards"
            },
            {
              "id": "8.5.3",
              "name": "Mitarbeiterbefragungen"
            }
          ]
        }
      ]
    },
    {
      "id": 9,
      "name": "Corporate & Querschnittsfunktionen",
      "color": "#6366F1",
      "icon": "briefcase",
      "description": "Unternehmenssteuerung, Recht, Facility, EHS, Dokumentenmanagement",
      "domainOwner": "COO",
      "strategicFocus": "Governance, EHS, PPM",
      "vision": "Integrated Governance ‚Äî Zentrale Steuerung mit PPM, Risikomanagement und EHS-Digitalisierung",
      "kpis": [
        {
          "id": "KPI-D9-1",
          "name": "EHS Incident Rate",
          "target": "0",
          "current": "3",
          "unit": "#/year",
          "trend": "improving"
        },
        {
          "id": "KPI-D9-2",
          "name": "Compliance Audit Score",
          "target": "95",
          "current": "82",
          "unit": "%",
          "trend": "stable"
        }
      ],
      "capabilities": [
        {
          "id": "9.1",
          "name": "Unternehmenssteuerung & Strategie",
          "maturity": 1,
          "targetMaturity": 3,
          "criticality": "High",
          "subCapabilities": [
            {
              "id": "9.1.1",
              "name": "Strategisches Portfolio-Management"
            },
            {
              "id": "9.1.2",
              "name": "Risikomanagement (Enterprise)"
            },
            {
              "id": "9.1.3",
              "name": "Projektportfolio-Management (PPM)"
            },
            {
              "id": "9.1.4",
              "name": "OKR / Zielmanagement"
            }
          ]
        },
        {
          "id": "9.2",
          "name": "Recht & Compliance",
          "maturity": 2,
          "targetMaturity": 3,
          "criticality": "Medium",
          "subCapabilities": [
            {
              "id": "9.2.1",
              "name": "Vertragsmanagement (CLM)"
            },
            {
              "id": "9.2.2",
              "name": "Datenschutz (DSGVO)"
            },
            {
              "id": "9.2.3",
              "name": "Regulatorik & Normenmanagement"
            },
            {
              "id": "9.2.4",
              "name": "Whistleblowing / Hinweisgebersystem"
            }
          ]
        },
        {
          "id": "9.3",
          "name": "Facility & Geb√§udemanagement",
          "maturity": 2,
          "targetMaturity": 2,
          "criticality": "Low",
          "subCapabilities": [
            {
              "id": "9.3.1",
              "name": "Geb√§udeverwaltung & Fl√§chenmanagement"
            },
            {
              "id": "9.3.2",
              "name": "Geb√§udetechnik (GLT/BMS)"
            },
            {
              "id": "9.3.3",
              "name": "Zutrittskontrolle & Sicherheit"
            },
            {
              "id": "9.3.4",
              "name": "Energiemanagement"
            }
          ]
        },
        {
          "id": "9.4",
          "name": "Environment, Health & Safety (EHS)",
          "maturity": 2,
          "targetMaturity": 4,
          "criticality": "High",
          "subCapabilities": [
            {
              "id": "9.4.1",
              "name": "Arbeitssicherheit & Gef√§hrdungsbeurteilungen"
            },
            {
              "id": "9.4.2",
              "name": "Umweltmanagement"
            },
            {
              "id": "9.4.3",
              "name": "Gefahrstoffmanagement"
            },
            {
              "id": "9.4.4",
              "name": "Incident- & Unfallmanagement"
            }
          ]
        },
        {
          "id": "9.5",
          "name": "Dokumentenmanagement & Archivierung",
          "maturity": 2,
          "targetMaturity": 3,
          "criticality": "Medium",
          "subCapabilities": [
            {
              "id": "9.5.1",
              "name": "Enterprise Content Management (ECM)"
            },
            {
              "id": "9.5.2",
              "name": "Archivierung & Aufbewahrungsfristen"
            },
            {
              "id": "9.5.3",
              "name": "Workflow & Freigabeprozesse"
            },
            {
              "id": "9.5.4",
              "name": "Formular- & Template-Management"
            }
          ]
        }
      ]
    },
    {
      "id": 10,
      "name": "Data & Analytics",
      "color": "#F97316",
      "icon": "bar-chart",
      "description": "Data Platform, BI & Reporting, Advanced Analytics & AI, Industrial IoT",
      "domainOwner": "CDO / CIO",
      "strategicFocus": "Datenstrategie, AI/ML, IoT",
      "vision": "Data-Driven Enterprise ‚Äî Zentrale Datenplattform (Azure), Self-Service Analytics, AI/ML f√ºr Predictive Use Cases",
      "kpis": [
        {
          "id": "KPI-D10-1",
          "name": "Data Quality Score",
          "target": "90",
          "current": "62",
          "unit": "%",
          "trend": "improving"
        },
        {
          "id": "KPI-D10-2",
          "name": "Self-Service BI Adoption",
          "target": "50",
          "current": "15",
          "unit": "%",
          "trend": "improving"
        },
        {
          "id": "KPI-D10-3",
          "name": "AI/ML Use Cases in Production",
          "target": "5",
          "current": "0",
          "unit": "#",
          "trend": "stable"
        }
      ],
      "capabilities": [
        {
          "id": "10.1",
          "name": "Data Platform & Integration",
          "maturity": 1,
          "targetMaturity": 4,
          "criticality": "High",
          "subCapabilities": [
            {
              "id": "10.1.1",
              "name": "Data Warehouse / Data Lakehouse"
            },
            {
              "id": "10.1.2",
              "name": "ETL / ELT / Datenintegration"
            },
            {
              "id": "10.1.3",
              "name": "Master Data Management (MDM)"
            },
            {
              "id": "10.1.4",
              "name": "Data Governance & Data Quality"
            }
          ]
        },
        {
          "id": "10.2",
          "name": "BI & Reporting",
          "maturity": 3,
          "targetMaturity": 4,
          "criticality": "High",
          "subCapabilities": [
            {
              "id": "10.2.1",
              "name": "Standard-Reporting & Dashboards"
            },
            {
              "id": "10.2.2",
              "name": "Self-Service Analytics"
            },
            {
              "id": "10.2.3",
              "name": "Embedded Analytics"
            },
            {
              "id": "10.2.4",
              "name": "Mobile BI"
            }
          ]
        },
        {
          "id": "10.3",
          "name": "Advanced Analytics & AI",
          "maturity": 1,
          "targetMaturity": 3,
          "criticality": "Medium",
          "subCapabilities": [
            {
              "id": "10.3.1",
              "name": "Predictive Analytics"
            },
            {
              "id": "10.3.2",
              "name": "Machine Learning Operations (MLOps)"
            },
            {
              "id": "10.3.3",
              "name": "NLP & Textanalyse"
            },
            {
              "id": "10.3.4",
              "name": "Computer Vision"
            }
          ]
        },
        {
          "id": "10.4",
          "name": "Industrial IoT & Datenerfassung",
          "maturity": 1,
          "targetMaturity": 3,
          "criticality": "Medium",
          "subCapabilities": [
            {
              "id": "10.4.1",
              "name": "Sensor-/Maschinendaten-Erfassung"
            },
            {
              "id": "10.4.2",
              "name": "Edge Computing & Gateway"
            },
            {
              "id": "10.4.3",
              "name": "Time-Series Data Management"
            },
            {
              "id": "10.4.4",
              "name": "Digital Twin Data Layer"
            }
          ]
        }
      ]
    }
  ],
  "applications": [
    {
      "id": "APP-001",
      "name": "SAP S/4HANA",
      "vendor": "SAP SE",
      "category": "ERP",
      "type": "On-Prem",
      "criticality": "Mission-Critical",
      "timeQuadrant": "Invest",
      "businessOwner": "CFO / Leiter Controlling",
      "itOwner": "SAP Basis Team",
      "costPerYear": 450000,
      "userCount": 320,
      "goLiveDate": "2019-04-01",
      "description": "Zentrales ERP-System f√ºr Finanzen, Controlling, Einkauf, Produktion, Lager, Vertrieb. Backbone aller Gesch√§ftsprozesse.",
      "scores": {
        "businessValue": 9,
        "technicalHealth": 7
      }
    },
    {
      "id": "APP-002",
      "name": "Salesforce Sales Cloud",
      "vendor": "Salesforce",
      "category": "CRM",
      "type": "SaaS",
      "criticality": "Business-Critical",
      "timeQuadrant": "Invest",
      "businessOwner": "Vertriebsleiter",
      "itOwner": "IT Application Management",
      "costPerYear": 120000,
      "userCount": 45,
      "goLiveDate": "2022-01-15",
      "description": "CRM-System f√ºr Vertrieb. Pipeline-Management, Kundenstamm, Angebotsverfolgung. Phase 1 ausgerollt, Phase 2 in Planung.",
      "scores": {
        "businessValue": 7,
        "technicalHealth": 9
      }
    },
    {
      "id": "APP-003",
      "name": "MPDV HYDRA X",
      "vendor": "MPDV Mikrolab",
      "category": "MES",
      "type": "On-Prem",
      "criticality": "Mission-Critical",
      "timeQuadrant": "Invest",
      "businessOwner": "Werksleiter",
      "itOwner": "IT Produktion",
      "costPerYear": 180000,
      "userCount": 150,
      "goLiveDate": "2020-06-01",
      "description": "Manufacturing Execution System. BDE/MDE, Fertigungssteuerung, R√ºckmeldung. Aktuell nur Werk 1, Erweiterung Werk 2 geplant.",
      "scores": {
        "businessValue": 8,
        "technicalHealth": 7
      }
    },
    {
      "id": "APP-004",
      "name": "Siemens Teamcenter",
      "vendor": "Siemens Digital Industries Software",
      "category": "PLM",
      "type": "On-Prem",
      "criticality": "Business-Critical",
      "timeQuadrant": "Tolerate",
      "businessOwner": "Leiter Engineering",
      "itOwner": "IT Engineering",
      "costPerYear": 200000,
      "userCount": 60,
      "goLiveDate": "2017-03-01",
      "description": "Product Lifecycle Management. St√ºcklisten (eBOM/mBOM), ECR/ECO, Dokumentenmanagement. Version veraltet, Upgrade zur√ºckgestellt.",
      "scores": {
        "businessValue": 7,
        "technicalHealth": 5
      }
    },
    {
      "id": "APP-005",
      "name": "Microsoft 365 E5",
      "vendor": "Microsoft",
      "category": "Workplace",
      "type": "SaaS",
      "criticality": "Mission-Critical",
      "timeQuadrant": "Invest",
      "businessOwner": "COO",
      "itOwner": "IT Workplace Team",
      "costPerYear": 280000,
      "userCount": 850,
      "goLiveDate": "2021-01-01",
      "description": "Digitaler Arbeitsplatz: Exchange Online, Teams, OneDrive, Office Apps. Basis f√ºr Zusammenarbeit und Kommunikation.",
      "scores": {
        "businessValue": 9,
        "technicalHealth": 9
      }
    },
    {
      "id": "APP-006",
      "name": "SharePoint Online",
      "vendor": "Microsoft",
      "category": "Collaboration",
      "type": "SaaS",
      "criticality": "Business-Critical",
      "timeQuadrant": "Invest",
      "businessOwner": "Leiter Unternehmenskommunikation",
      "itOwner": "IT Workplace Team",
      "costPerYear": 0,
      "userCount": 600,
      "goLiveDate": "2021-01-01",
      "description": "Dokumentenmanagement, Intranet, Team-Sites. Im M365-Lizenzpaket enthalten. Governance noch unzureichend ‚Äî Wildwuchs an Sites.",
      "scores": {
        "businessValue": 7,
        "technicalHealth": 8
      }
    },
    {
      "id": "APP-007",
      "name": "Power BI Premium",
      "vendor": "Microsoft",
      "category": "BI & Reporting",
      "type": "SaaS",
      "criticality": "Business-Critical",
      "timeQuadrant": "Invest",
      "businessOwner": "Leiter Controlling",
      "itOwner": "IT Data & Analytics",
      "costPerYear": 60000,
      "userCount": 200,
      "goLiveDate": "2022-06-01",
      "description": "Self-Service BI und Management-Dashboards. Wird aktuell stark ausgebaut. Datenqualit√§t aus SAP teilweise mangelhaft.",
      "scores": {
        "businessValue": 8,
        "technicalHealth": 8
      }
    },
    {
      "id": "APP-008",
      "name": "ServiceNow ITSM",
      "vendor": "ServiceNow",
      "category": "ITSM",
      "type": "SaaS",
      "criticality": "Business-Operational",
      "timeQuadrant": "Invest",
      "businessOwner": "IT-Leiter",
      "itOwner": "IT Service Management",
      "costPerYear": 95000,
      "userCount": 25,
      "goLiveDate": "2023-03-01",
      "description": "IT Service Management: Incidents, Changes, Problems, Asset Management. Erst k√ºrzlich eingef√ºhrt, noch nicht voll ausgerollt.",
      "scores": {
        "businessValue": 6,
        "technicalHealth": 9
      }
    },
    {
      "id": "APP-009",
      "name": "Personio",
      "vendor": "Personio SE",
      "category": "HR",
      "type": "SaaS",
      "criticality": "Business-Critical",
      "timeQuadrant": "Migrate",
      "businessOwner": "HR-Leiterin",
      "itOwner": "IT Application Management",
      "costPerYear": 45000,
      "userCount": 30,
      "goLiveDate": "2020-09-01",
      "description": "HR-System: Personaladmin, Recruiting, Onboarding. Funktional ok, aber keine SAP-Integration. Abl√∂sung durch SAP SuccessFactors geplant.",
      "scores": {
        "businessValue": 6,
        "technicalHealth": 7
      }
    },
    {
      "id": "APP-010",
      "name": "SolidWorks Professional",
      "vendor": "Dassault Syst√®mes",
      "category": "CAD",
      "type": "On-Prem",
      "criticality": "Business-Critical",
      "timeQuadrant": "Tolerate",
      "businessOwner": "Leiter Konstruktion",
      "itOwner": "IT Engineering",
      "costPerYear": 85000,
      "userCount": 25,
      "goLiveDate": "2015-01-01",
      "description": "3D-CAD f√ºr Produktkonstruktion. Bew√§hrt, aber Integration mit Teamcenter PLM ist manuell (Doppelerfassung St√ºcklisten).",
      "scores": {
        "businessValue": 7,
        "technicalHealth": 6
      }
    },
    {
      "id": "APP-011",
      "name": "Microsoft Azure",
      "vendor": "Microsoft",
      "category": "Cloud Platform",
      "type": "PaaS",
      "criticality": "Mission-Critical",
      "timeQuadrant": "Invest",
      "businessOwner": "CIO",
      "itOwner": "IT Infrastructure & Cloud",
      "costPerYear": 320000,
      "userCount": 15,
      "goLiveDate": "2022-01-01",
      "description": "Cloud-Plattform: Azure AD (Entra ID), Virtual Machines, Azure SQL, Storage. Cloud-Migration Wave 1 l√§uft.",
      "scores": {
        "businessValue": 8,
        "technicalHealth": 9
      }
    },
    {
      "id": "APP-012",
      "name": "Zabbix",
      "vendor": "Zabbix LLC",
      "category": "Monitoring",
      "type": "On-Prem",
      "criticality": "Business-Operational",
      "timeQuadrant": "Migrate",
      "businessOwner": "IT-Leiter",
      "itOwner": "IT Infrastructure",
      "costPerYear": 15000,
      "userCount": 8,
      "goLiveDate": "2018-06-01",
      "description": "Monitoring on-prem Infrastruktur. Deckt nicht Cloud-Workloads ab. Abl√∂sung durch Azure Monitor + Sentinel geplant.",
      "scores": {
        "businessValue": 5,
        "technicalHealth": 4
      }
    },
    {
      "id": "APP-013",
      "name": "SAGE DPW",
      "vendor": "SAGE",
      "category": "Zeitwirtschaft",
      "type": "On-Prem",
      "criticality": "Business-Operational",
      "timeQuadrant": "Eliminate",
      "businessOwner": "HR-Leiterin",
      "itOwner": "IT Application Management",
      "costPerYear": 25000,
      "userCount": 850,
      "goLiveDate": "2014-01-01",
      "description": "Zeiterfassung und Abwesenheitsmanagement. Veraltet, kein Support mehr. Abl√∂sung durch SAP SuccessFactors Employee Central Payroll.",
      "scores": {
        "businessValue": 4,
        "technicalHealth": 2
      }
    },
    {
      "id": "APP-014",
      "name": "Excel-basierte QM-L√∂sung",
      "vendor": "Eigenentwicklung",
      "category": "Quality Management",
      "type": "Custom",
      "criticality": "Business-Critical",
      "timeQuadrant": "Eliminate",
      "businessOwner": "Qualit√§tsleiter",
      "itOwner": "‚Äî",
      "costPerYear": 5000,
      "userCount": 80,
      "goLiveDate": "2012-01-01",
      "description": "Sammlung von Excel-Dateien und VBA-Makros f√ºr Pr√ºfprotokolle, CAPA-Tracking, Audit-Checklisten. Fehleranf√§llig, keine Revisionssicherheit. Abl√∂sung durch SAP QM dringend.",
      "scores": {
        "businessValue": 6,
        "technicalHealth": 1
      }
    },
    {
      "id": "APP-015",
      "name": "Veeam Backup & Replication",
      "vendor": "Veeam Software",
      "category": "Backup & DR",
      "type": "On-Prem",
      "criticality": "Business-Critical",
      "timeQuadrant": "Tolerate",
      "businessOwner": "IT-Leiter",
      "itOwner": "IT Infrastructure",
      "costPerYear": 35000,
      "userCount": 3,
      "goLiveDate": "2019-01-01",
      "description": "Backup & Disaster Recovery f√ºr on-prem VMs und Datenbanken. Erg√§nzung durch Azure Backup f√ºr Cloud-Workloads n√∂tig.",
      "scores": {
        "businessValue": 5,
        "technicalHealth": 7
      }
    },
    {
      "id": "APP-016",
      "name": "Power Platform",
      "vendor": "Microsoft",
      "category": "Low-Code / BPA",
      "type": "PaaS",
      "criticality": "Business-Operational",
      "timeQuadrant": "Invest",
      "businessOwner": "Diverse (Citizen Devs)",
      "itOwner": "IT Workplace Team",
      "costPerYear": 40000,
      "userCount": 50,
      "goLiveDate": "2023-06-01",
      "description": "Power Apps, Power Automate, Power Pages. Aktuell ~15 aktive Apps, kein CoE, keine Governance. Wildwuchs droht.",
      "scores": {
        "businessValue": 6,
        "technicalHealth": 7
      }
    },
    {
      "id": "APP-017",
      "name": "Atlassian Confluence",
      "vendor": "Atlassian",
      "category": "Knowledge Management",
      "type": "SaaS",
      "criticality": "Business-Operational",
      "timeQuadrant": "Migrate",
      "businessOwner": "IT-Leiter",
      "itOwner": "IT Application Management",
      "costPerYear": 18000,
      "userCount": 200,
      "goLiveDate": "2019-06-01",
      "description": "Wiki und Wissensbasis. Parallel zu SharePoint ‚Äî Fragmentierung der Inhalte. Konsolidierung nach SharePoint/Viva geplant.",
      "scores": {
        "businessValue": 5,
        "technicalHealth": 7
      }
    },
    {
      "id": "APP-018",
      "name": "Multicash (Banking)",
      "vendor": "Omikron Systemhaus",
      "category": "Treasury",
      "type": "On-Prem",
      "criticality": "Business-Operational",
      "timeQuadrant": "Tolerate",
      "businessOwner": "Leiter Finanzbuchhaltung",
      "itOwner": "IT Application Management",
      "costPerYear": 12000,
      "userCount": 5,
      "goLiveDate": "2016-01-01",
      "description": "Bankanbindung und Zahlungsverkehr. L√§uft stabil, geringe strategische Relevanz.",
      "scores": {
        "businessValue": 4,
        "technicalHealth": 6
      }
    }
  ],
  "capabilityMappings": [
    {
      "capabilityId": "1.1",
      "applicationId": "APP-011",
      "role": "Primary"
    },
    {
      "capabilityId": "1.2",
      "applicationId": "APP-011",
      "role": "Primary"
    },
    {
      "capabilityId": "1.3",
      "applicationId": "APP-011",
      "role": "Primary"
    },
    {
      "capabilityId": "1.3",
      "applicationId": "APP-012",
      "role": "Secondary"
    },
    {
      "capabilityId": "1.4",
      "applicationId": "APP-011",
      "role": "Primary"
    },
    {
      "capabilityId": "1.4",
      "applicationId": "APP-015",
      "role": "Secondary"
    },
    {
      "capabilityId": "1.5",
      "applicationId": "APP-008",
      "role": "Primary"
    },
    {
      "capabilityId": "2.1",
      "applicationId": "APP-005",
      "role": "Primary"
    },
    {
      "capabilityId": "2.2",
      "applicationId": "APP-006",
      "role": "Primary"
    },
    {
      "capabilityId": "2.2",
      "applicationId": "APP-005",
      "role": "Secondary"
    },
    {
      "capabilityId": "2.3",
      "applicationId": "APP-017",
      "role": "Primary"
    },
    {
      "capabilityId": "2.3",
      "applicationId": "APP-006",
      "role": "Secondary"
    },
    {
      "capabilityId": "2.4",
      "applicationId": "APP-016",
      "role": "Primary"
    },
    {
      "capabilityId": "3.1",
      "applicationId": "APP-002",
      "role": "Primary"
    },
    {
      "capabilityId": "3.2",
      "applicationId": "APP-001",
      "role": "Primary"
    },
    {
      "capabilityId": "3.2",
      "applicationId": "APP-002",
      "role": "Secondary"
    },
    {
      "capabilityId": "3.3",
      "applicationId": "APP-002",
      "role": "Primary"
    },
    {
      "capabilityId": "3.4",
      "applicationId": "APP-001",
      "role": "Primary"
    },
    {
      "capabilityId": "4.1",
      "applicationId": "APP-001",
      "role": "Primary"
    },
    {
      "capabilityId": "4.1",
      "applicationId": "APP-003",
      "role": "Secondary"
    },
    {
      "capabilityId": "4.2",
      "applicationId": "APP-003",
      "role": "Primary"
    },
    {
      "capabilityId": "4.3",
      "applicationId": "APP-014",
      "role": "Primary"
    },
    {
      "capabilityId": "4.3",
      "applicationId": "APP-001",
      "role": "Secondary"
    },
    {
      "capabilityId": "5.1",
      "applicationId": "APP-001",
      "role": "Primary"
    },
    {
      "capabilityId": "5.2",
      "applicationId": "APP-001",
      "role": "Primary"
    },
    {
      "capabilityId": "5.3",
      "applicationId": "APP-001",
      "role": "Primary"
    },
    {
      "capabilityId": "5.4",
      "applicationId": "APP-001",
      "role": "Secondary"
    },
    {
      "capabilityId": "6.1",
      "applicationId": "APP-010",
      "role": "Primary"
    },
    {
      "capabilityId": "6.2",
      "applicationId": "APP-004",
      "role": "Primary"
    },
    {
      "capabilityId": "6.2",
      "applicationId": "APP-010",
      "role": "Secondary"
    },
    {
      "capabilityId": "7.1",
      "applicationId": "APP-001",
      "role": "Primary"
    },
    {
      "capabilityId": "7.2",
      "applicationId": "APP-001",
      "role": "Primary"
    },
    {
      "capabilityId": "7.3",
      "applicationId": "APP-001",
      "role": "Secondary"
    },
    {
      "capabilityId": "7.4",
      "applicationId": "APP-007",
      "role": "Primary"
    },
    {
      "capabilityId": "7.4",
      "applicationId": "APP-001",
      "role": "Secondary"
    },
    {
      "capabilityId": "7.5",
      "applicationId": "APP-018",
      "role": "Primary"
    },
    {
      "capabilityId": "7.5",
      "applicationId": "APP-001",
      "role": "Secondary"
    },
    {
      "capabilityId": "8.1",
      "applicationId": "APP-009",
      "role": "Primary"
    },
    {
      "capabilityId": "8.2",
      "applicationId": "APP-013",
      "role": "Primary"
    },
    {
      "capabilityId": "8.2",
      "applicationId": "APP-009",
      "role": "Secondary"
    },
    {
      "capabilityId": "8.3",
      "applicationId": "APP-009",
      "role": "Primary"
    },
    {
      "capabilityId": "9.5",
      "applicationId": "APP-006",
      "role": "Primary"
    },
    {
      "capabilityId": "10.2",
      "applicationId": "APP-007",
      "role": "Primary"
    }
  ],
  "projects": [
    {
      "id": "PRJ-001",
      "name": "SAP S/4HANA Upgrade 2025",
      "primaryDomain": 7,
      "secondaryDomains": [
        4,
        5,
        3
      ],
      "capabilities": [
        "7.1",
        "7.2",
        "4.1",
        "5.1",
        "5.2",
        "3.2"
      ],
      "affectedApps": [
        {
          "appId": "APP-001",
          "action": "ver√§ndern"
        }
      ],
      "category": "Modernisierung",
      "budget": 480000,
      "start": "Q1/2026",
      "end": "Q4/2026",
      "status": "yellow",
      "statusText": "Ressourcenengpass SAP-Berater",
      "sponsor": "CFO",
      "projectLead": "Thomas Weber",
      "strategicContribution": "Basis f√ºr alle nachfolgenden SAP-Erweiterungen. Enabler-Projekt.",
      "timeReference": "Invest",
      "e2eProcesses": [
        "O2C",
        "P2P",
        "P2Prod",
        "R2R"
      ],
      "mediaBreakRefs": [],
      "conformity": "Konform"
    },
    {
      "id": "PRJ-002",
      "name": "Salesforce Phase 2 Rollout",
      "primaryDomain": 3,
      "secondaryDomains": [],
      "capabilities": [
        "3.1",
        "3.3",
        "3.4"
      ],
      "affectedApps": [
        {
          "appId": "APP-002",
          "action": "ver√§ndern"
        }
      ],
      "category": "Optimierung",
      "budget": 150000,
      "start": "Q2/2026",
      "end": "Q4/2026",
      "status": "green",
      "statusText": "In Planung",
      "sponsor": "Vertriebsleiter",
      "projectLead": "Maria Schmidt",
      "strategicContribution": "Vertriebscode-Abdeckung auf 100%, Forecast-Qualit√§t verbessern",
      "timeReference": "Invest",
      "e2eProcesses": [
        "O2C"
      ],
      "mediaBreakRefs": [],
      "conformity": "Konform"
    },
    {
      "id": "PRJ-003",
      "name": "MES Erweiterung Werk 2",
      "primaryDomain": 4,
      "secondaryDomains": [
        10
      ],
      "capabilities": [
        "4.2",
        "4.5"
      ],
      "affectedApps": [
        {
          "appId": "APP-003",
          "action": "ver√§ndern"
        }
      ],
      "category": "Innovation / Grow",
      "budget": 280000,
      "start": "Q1/2026",
      "end": "Q3/2027",
      "status": "green",
      "statusText": "Anforderungsanalyse l√§uft",
      "sponsor": "Werksleiter",
      "projectLead": "Klaus Berger",
      "strategicContribution": "Durchg√§ngige Fertigungssteuerung √ºber beide Werke, OEE-Transparenz",
      "timeReference": "Invest",
      "e2eProcesses": [
        "P2Prod"
      ],
      "mediaBreakRefs": [],
      "conformity": "Konform"
    },
    {
      "id": "PRJ-004",
      "name": "Cloud Migration Wave 1",
      "primaryDomain": 1,
      "secondaryDomains": [],
      "capabilities": [
        "1.2",
        "1.3"
      ],
      "affectedApps": [
        {
          "appId": "APP-011",
          "action": "ver√§ndern"
        }
      ],
      "category": "Infrastruktur",
      "budget": 350000,
      "start": "Q1/2026",
      "end": "Q2/2027",
      "status": "yellow",
      "statusText": "Azure Landing Zone Konzept in Abstimmung",
      "sponsor": "CIO",
      "projectLead": "Stefan Hofer",
      "strategicContribution": "Erste 15 Workloads in Azure, Basis f√ºr Hybrid Cloud Strategie",
      "timeReference": "Invest",
      "e2eProcesses": [
        "R2F"
      ],
      "mediaBreakRefs": [],
      "conformity": "Konform"
    },
    {
      "id": "PRJ-005",
      "name": "Power Platform CoE Setup",
      "primaryDomain": 2,
      "secondaryDomains": [],
      "capabilities": [
        "2.4"
      ],
      "affectedApps": [
        {
          "appId": "APP-016",
          "action": "ver√§ndern"
        }
      ],
      "category": "Optimierung",
      "budget": 80000,
      "start": "Q2/2026",
      "end": "Q4/2026",
      "status": "green",
      "statusText": "Budgetfreigabe erteilt",
      "sponsor": "CIO",
      "projectLead": "Anna Mayer",
      "strategicContribution": "Governance f√ºr Citizen Development, Shadow IT vermeiden",
      "timeReference": "Invest",
      "e2eProcesses": [
        "R2F"
      ],
      "mediaBreakRefs": [],
      "conformity": "Konform"
    },
    {
      "id": "PRJ-006",
      "name": "Identity Management (Entra ID)",
      "primaryDomain": 1,
      "secondaryDomains": [
        2
      ],
      "capabilities": [
        "1.3",
        "1.4"
      ],
      "affectedApps": [
        {
          "appId": "APP-011",
          "action": "ver√§ndern"
        }
      ],
      "category": "Infrastruktur",
      "budget": 120000,
      "start": "Q1/2026",
      "end": "Q3/2026",
      "status": "green",
      "statusText": "Implementierung l√§uft",
      "sponsor": "CIO",
      "projectLead": "Stefan Hofer",
      "strategicContribution": "Single Sign-On, Conditional Access, Zero Trust Basis",
      "timeReference": "Invest",
      "e2eProcesses": [
        "R2F",
        "H2R"
      ],
      "mediaBreakRefs": [],
      "conformity": "Konform"
    },
    {
      "id": "PRJ-007",
      "name": "Data Warehouse / BI Modernisierung",
      "primaryDomain": 10,
      "secondaryDomains": [
        7
      ],
      "capabilities": [
        "10.1",
        "10.2",
        "7.4"
      ],
      "affectedApps": [
        {
          "appId": "APP-007",
          "action": "ver√§ndern"
        },
        {
          "appId": "APP-011",
          "action": "ver√§ndern"
        }
      ],
      "category": "Innovation / Grow",
      "budget": 250000,
      "start": "Q3/2026",
      "end": "Q2/2027",
      "status": "green",
      "statusText": "Konzeptphase",
      "sponsor": "CFO",
      "projectLead": "Lisa Gruber",
      "strategicContribution": "Zentrale Datenbasis (Azure Synapse), Self-Service Analytics f√ºr Fachbereiche",
      "timeReference": "Invest",
      "e2eProcesses": [
        "R2R"
      ],
      "mediaBreakRefs": [],
      "conformity": "Konform"
    },
    {
      "id": "PRJ-008",
      "name": "QM-Digitalisierung (Excel ‚Üí SAP QM)",
      "primaryDomain": 4,
      "secondaryDomains": [],
      "capabilities": [
        "4.3"
      ],
      "affectedApps": [
        {
          "appId": "APP-001",
          "action": "ver√§ndern"
        },
        {
          "appId": "APP-014",
          "action": "abl√∂sen"
        }
      ],
      "category": "Modernisierung",
      "budget": 180000,
      "start": "Q2/2026",
      "end": "Q1/2027",
      "status": "green",
      "statusText": "Warten auf SAP Upgrade",
      "sponsor": "Qualit√§tsleiter",
      "projectLead": "Thomas Weber",
      "strategicContribution": "Excel-QM abl√∂sen, Revisionssicherheit, ISO-Audit-Readiness",
      "timeReference": "Migrate",
      "e2eProcesses": [
        "P2Prod",
        "O2C"
      ],
      "mediaBreakRefs": [],
      "conformity": "Konform"
    },
    {
      "id": "PRJ-009",
      "name": "SharePoint Governance & Migration",
      "primaryDomain": 2,
      "secondaryDomains": [
        9
      ],
      "capabilities": [
        "2.2",
        "9.5"
      ],
      "affectedApps": [
        {
          "appId": "APP-006",
          "action": "ver√§ndern"
        },
        {
          "appId": "APP-017",
          "action": "abl√∂sen"
        }
      ],
      "category": "Modernisierung",
      "budget": 90000,
      "start": "Q1/2026",
      "end": "Q3/2026",
      "status": "yellow",
      "statusText": "Informationsarchitektur-Konzept in Arbeit",
      "sponsor": "COO",
      "projectLead": "Anna Mayer",
      "strategicContribution": "Konsolidierung Confluence ‚Üí SharePoint, Governance-Framework, Copilot-Readiness",
      "timeReference": "Invest",
      "e2eProcesses": [],
      "mediaBreakRefs": [],
      "conformity": "Konform"
    },
    {
      "id": "PRJ-010",
      "name": "HR System Modernisierung (‚Üí SAP SF)",
      "primaryDomain": 8,
      "secondaryDomains": [],
      "capabilities": [
        "8.1",
        "8.2",
        "8.3",
        "8.4"
      ],
      "affectedApps": [
        {
          "appId": "APP-009",
          "action": "abl√∂sen"
        },
        {
          "appId": "APP-013",
          "action": "abl√∂sen"
        }
      ],
      "category": "Modernisierung",
      "budget": 200000,
      "start": "Q1/2027",
      "end": "Q3/2027",
      "status": "green",
      "statusText": "Vorprojekt / Evaluation",
      "sponsor": "HR-Leiterin",
      "projectLead": "Sandra Kofler",
      "strategicContribution": "Ganzheitliche HR-Plattform, SAP-Integration, End-of-Support Personio/SAGE",
      "timeReference": "Migrate",
      "e2eProcesses": [
        "H2R"
      ],
      "mediaBreakRefs": [],
      "conformity": "Konform"
    },
    {
      "id": "PRJ-011",
      "name": "Cybersecurity Enhancement",
      "primaryDomain": 1,
      "secondaryDomains": [],
      "capabilities": [
        "1.4"
      ],
      "affectedApps": [
        {
          "appId": "APP-011",
          "action": "ver√§ndern"
        },
        {
          "appId": "APP-012",
          "action": "abl√∂sen"
        }
      ],
      "category": "Run / Pflicht",
      "budget": 160000,
      "start": "Q1/2026",
      "end": "Q4/2026",
      "status": "green",
      "statusText": "NIS2-Compliance Deadline beachten",
      "sponsor": "CIO",
      "projectLead": "Stefan Hofer",
      "strategicContribution": "NIS2-Compliance, SOC/SIEM aufbauen (Azure Sentinel), Zabbix ‚Üí Azure Monitor",
      "timeReference": "Invest",
      "e2eProcesses": [
        "I2R"
      ],
      "mediaBreakRefs": [],
      "conformity": "Konform"
    },
    {
      "id": "PRJ-012",
      "name": "IoT Pilotprojekt Produktion",
      "primaryDomain": 10,
      "secondaryDomains": [
        4
      ],
      "capabilities": [
        "10.4",
        "4.4"
      ],
      "affectedApps": [
        {
          "appId": "APP-011",
          "action": "ver√§ndern"
        }
      ],
      "category": "Innovation / Grow",
      "budget": 120000,
      "start": "Q3/2026",
      "end": "Q2/2027",
      "status": "green",
      "statusText": "Business Case in Erstellung",
      "sponsor": "Werksleiter",
      "projectLead": "Klaus Berger",
      "strategicContribution": "Sensor-Daten von 5 Pilotmaschinen, Predictive Maintenance Proof-of-Concept",
      "timeReference": "Invest",
      "e2eProcesses": [
        "P2Prod"
      ],
      "mediaBreakRefs": [],
      "conformity": "Konform"
    }
  ],
  "projectDependencies": [
    {
      "sourceProjectId": "PRJ-003",
      "targetProjectId": "PRJ-001",
      "type": "T",
      "description": "MES-Integration ben√∂tigt neue SAP-Schnittstellen aus dem Upgrade"
    },
    {
      "sourceProjectId": "PRJ-007",
      "targetProjectId": "PRJ-001",
      "type": "D",
      "description": "DWH braucht saubere SAP-Extraktoren (CDS Views) aus dem neuen Release"
    },
    {
      "sourceProjectId": "PRJ-008",
      "targetProjectId": "PRJ-001",
      "type": "T",
      "description": "SAP QM Modul ben√∂tigt S/4HANA 2025 Release"
    },
    {
      "sourceProjectId": "PRJ-005",
      "targetProjectId": "PRJ-006",
      "type": "P",
      "description": "CoE ben√∂tigt Entra ID Conditional Access f√ºr Environment-Management"
    },
    {
      "sourceProjectId": "PRJ-010",
      "targetProjectId": "PRJ-001",
      "type": "T",
      "description": "SAP SuccessFactors Integration ben√∂tigt S/4HANA Upgrade"
    },
    {
      "sourceProjectId": "PRJ-009",
      "targetProjectId": "PRJ-006",
      "type": "P",
      "description": "SharePoint Governance baut auf Entra ID Gruppen auf"
    },
    {
      "sourceProjectId": "PRJ-012",
      "targetProjectId": "PRJ-003",
      "type": "D",
      "description": "IoT-Daten sollen mit MES-Daten korreliert werden"
    },
    {
      "sourceProjectId": "PRJ-012",
      "targetProjectId": "PRJ-007",
      "type": "D",
      "description": "Sensordaten flie√üen in Data Warehouse"
    },
    {
      "sourceProjectId": "PRJ-004",
      "targetProjectId": "PRJ-006",
      "type": "T",
      "description": "Cloud Landing Zone braucht Entra ID als Identity Provider"
    },
    {
      "sourceProjectId": "PRJ-011",
      "targetProjectId": "PRJ-006",
      "type": "T",
      "description": "Azure Sentinel/SOC ben√∂tigt Entra ID Integration"
    },
    {
      "sourceProjectId": "PRJ-010",
      "targetProjectId": "PRJ-006",
      "type": "P",
      "description": "SuccessFactors SSO √ºber Entra ID"
    },
    {
      "sourceProjectId": "PRJ-003",
      "targetProjectId": "PRJ-004",
      "type": "P",
      "description": "MES Cloud-Anbindung l√§uft √ºber Azure-Infrastruktur"
    }
  ],
  "managementKPIs": [
    {
      "id": "MKPI-1",
      "name": "Capability Coverage",
      "description": "% der Capabilities mit ausreichender IT-Unterst√ºtzung (Maturity ‚â•3)",
      "target": "85",
      "current": "52",
      "unit": "%",
      "trend": "improving",
      "category": "Architecture"
    },
    {
      "id": "MKPI-2",
      "name": "Redundanz-Index",
      "description": "% der Capabilities mit >1 Primary-System",
      "target": "10",
      "current": "18",
      "unit": "%",
      "trend": "stable",
      "category": "Architecture"
    },
    {
      "id": "MKPI-3",
      "name": "Architektur-Compliance",
      "description": "% der neuen Demands, die konform zum Bebauungsplan sind",
      "target": "90",
      "current": "75",
      "unit": "%",
      "trend": "improving",
      "category": "Governance"
    },
    {
      "id": "MKPI-4",
      "name": "TIME Invest Ratio",
      "description": "% des IT-Budgets, das in Invest-Quadrant flie√üt",
      "target": "35",
      "current": "42",
      "unit": "%",
      "trend": "stable",
      "category": "Budget"
    },
    {
      "id": "MKPI-5",
      "name": "Roadmap Progress",
      "description": "% der Roadmap-Items die on-track sind",
      "target": "75",
      "current": "67",
      "unit": "%",
      "trend": "improving",
      "category": "Execution"
    }
  ],
  "e2eProcesses": [
    {
      "id": "O2C",
      "name": "Order-to-Cash",
      "owner": "Vertriebsleiter",
      "description": "Vom Kundenauftrag √ºber Fertigung und Versand bis zur Rechnungsstellung und Zahlungseingang",
      "domains": [
        3,
        4,
        5,
        7
      ],
      "status": "optimization",
      "kpis": [
        {
          "id": "KPI-O2C-1",
          "name": "Order-to-Delivery Time",
          "target": "5",
          "current": "8",
          "unit": "workdays",
          "trend": "improving"
        },
        {
          "id": "KPI-O2C-2",
          "name": "Perfect Order Rate",
          "target": "95",
          "current": "88",
          "unit": "%",
          "trend": "stable"
        }
      ]
    },
    {
      "id": "P2P",
      "name": "Procure-to-Pay",
      "owner": "Supply Chain Manager",
      "description": "Von der Bedarfsanforderung √ºber Bestellung und Wareneingang bis zur Rechnungspr√ºfung und Zahlung",
      "domains": [
        5,
        7
      ],
      "status": "optimization",
      "kpis": [
        {
          "id": "KPI-P2P-1",
          "name": "P2P Cycle Time",
          "target": "30",
          "current": "48",
          "unit": "days",
          "trend": "improving"
        },
        {
          "id": "KPI-P2P-2",
          "name": "Touchless Invoice Rate",
          "target": "60",
          "current": "25",
          "unit": "%",
          "trend": "improving"
        }
      ]
    },
    {
      "id": "P2Prod",
      "name": "Plan-to-Produce",
      "owner": "Werksleiter",
      "description": "Von der Produktionsplanung √ºber Fertigungssteuerung bis zur Qualit√§tssicherung und Einlagerung",
      "domains": [
        4,
        5,
        6
      ],
      "status": "transformation",
      "kpis": [
        {
          "id": "KPI-P2P2-1",
          "name": "Schedule Adherence",
          "target": "90",
          "current": "83",
          "unit": "%",
          "trend": "improving"
        },
        {
          "id": "KPI-P2P2-2",
          "name": "First Pass Yield",
          "target": "95",
          "current": "91",
          "unit": "%",
          "trend": "stable"
        }
      ]
    },
    {
      "id": "H2R",
      "name": "Hire-to-Retire",
      "owner": "HR-Leiterin",
      "description": "Vom Recruiting √ºber Onboarding, Entwicklung bis zum Austritt",
      "domains": [
        8
      ],
      "status": "transformation",
      "kpis": [
        {
          "id": "KPI-H2R-1",
          "name": "Time-to-Hire",
          "target": "45",
          "current": "68",
          "unit": "days",
          "trend": "stable"
        },
        {
          "id": "KPI-H2R-2",
          "name": "Onboarding Completeness",
          "target": "90",
          "current": "55",
          "unit": "%",
          "trend": "improving"
        }
      ]
    },
    {
      "id": "R2R",
      "name": "Record-to-Report",
      "owner": "CFO",
      "description": "Von der Buchung √ºber Monatsabschluss bis zum Management-Reporting und Konzernkonsolidierung",
      "domains": [
        7,
        10
      ],
      "status": "optimization",
      "kpis": [
        {
          "id": "KPI-R2R-1",
          "name": "Days to Close",
          "target": "5",
          "current": "8",
          "unit": "workdays",
          "trend": "improving"
        },
        {
          "id": "KPI-R2R-2",
          "name": "Report Automation Rate",
          "target": "70",
          "current": "35",
          "unit": "%",
          "trend": "improving"
        }
      ]
    },
    {
      "id": "I2R",
      "name": "Issue-to-Resolution",
      "owner": "CIO",
      "description": "Vom IT-Incident √ºber Troubleshooting bis zur L√∂sung und Ursachenanalyse",
      "domains": [
        1
      ],
      "status": "active",
      "kpis": [
        {
          "id": "KPI-I2R-1",
          "name": "Mean Time to Resolve",
          "target": "4",
          "current": "6.5",
          "unit": "h",
          "trend": "improving"
        },
        {
          "id": "KPI-I2R-2",
          "name": "First Contact Resolution Rate",
          "target": "70",
          "current": "52",
          "unit": "%",
          "trend": "stable"
        }
      ]
    },
    {
      "id": "D2D",
      "name": "Design-to-Deliver",
      "owner": "Entwicklungsleiter",
      "description": "Von der Produktidee √ºber Engineering, Prototyping bis zur Serienfreigabe",
      "domains": [
        6,
        4
      ],
      "status": "active",
      "kpis": [
        {
          "id": "KPI-D2D-1",
          "name": "Time-to-Market",
          "target": "12",
          "current": "18",
          "unit": "months",
          "trend": "stable"
        },
        {
          "id": "KPI-D2D-2",
          "name": "Engineering Change Lead Time",
          "target": "5",
          "current": "12",
          "unit": "days",
          "trend": "improving"
        }
      ]
    },
    {
      "id": "R2F",
      "name": "Request-to-Fulfill (IT)",
      "owner": "CIO",
      "description": "Von der IT-Anforderung √ºber Bewertung, Umsetzung bis zur Bereitstellung",
      "domains": [
        1,
        2,
        9
      ],
      "status": "optimization",
      "kpis": [
        {
          "id": "KPI-R2F-1",
          "name": "IT Demand Fulfillment Time",
          "target": "30",
          "current": "52",
          "unit": "days",
          "trend": "improving"
        },
        {
          "id": "KPI-R2F-2",
          "name": "IT Demand Compliance Rate",
          "target": "90",
          "current": "75",
          "unit": "%",
          "trend": "improving"
        }
      ]
    },
    {
      "id": "S2S",
      "name": "Sense-to-Sustain (Data)",
      "owner": "CDO / CIO",
      "description": "Von der Datenerfassung (IoT/Sensoren) √ºber Integration und Analyse bis zur nachhaltigen Nutzung",
      "domains": [
        10,
        4
      ],
      "status": "transformation",
      "kpis": [
        {
          "id": "KPI-S2S-1",
          "name": "Data Pipeline Reliability",
          "target": "99",
          "current": "85",
          "unit": "%",
          "trend": "improving"
        },
        {
          "id": "KPI-S2S-2",
          "name": "Analytics User Adoption",
          "target": "40",
          "current": "15",
          "unit": "%",
          "trend": "improving"
        }
      ]
    }
  ],
  "vendors": [
    {
      "id": "VND-001",
      "name": "SAP SE",
      "category": "ERP / Business Applications",
      "status": "Active",
      "criticality": "Strategic",
      "serviceLevel": "Premium",
      "contractValue": 550000,
      "contractEnd": "2027-12-31",
      "contactPerson": "Account Manager SAP",
      "vendorManager": "CIO",
      "website": "https://www.sap.com",
      "rating": 8,
      "description": "Strategischer ERP-Partner f√ºr S/4HANA und SuccessFactors. Langfristige Partnerschaft f√ºr das zentrale Gesch√§ftssystem."
    },
    {
      "id": "VND-002",
      "name": "Microsoft",
      "category": "Cloud / Productivity",
      "status": "Active",
      "criticality": "Strategic",
      "serviceLevel": "Enterprise",
      "contractValue": 320000,
      "contractEnd": "2026-06-30",
      "contactPerson": "Microsoft Account Team",
      "vendorManager": "Leiter IT-Infrastruktur",
      "website": "https://www.microsoft.com",
      "rating": 9,
      "description": "Azure Cloud, Microsoft 365, Power Platform und Teams. Strategischer Cloud-Partner f√ºr die digitale Transformation."
    },
    {
      "id": "VND-003",
      "name": "Siemens Digital Industries Software",
      "category": "PLM / Engineering",
      "status": "Active",
      "criticality": "Strategic",
      "serviceLevel": "Premium",
      "contractValue": 180000,
      "contractEnd": "2027-03-31",
      "contactPerson": "Siemens PLM Account Manager",
      "vendorManager": "Leiter Engineering IT",
      "website": "https://www.sw.siemens.com",
      "rating": 7,
      "description": "PLM-L√∂sung Teamcenter f√ºr Produktdatenmanagement und Engineering-Prozesse."
    },
    {
      "id": "VND-004",
      "name": "Salesforce",
      "category": "CRM",
      "status": "Active",
      "criticality": "Important",
      "serviceLevel": "Enterprise",
      "contractValue": 95000,
      "contractEnd": "2026-09-30",
      "contactPerson": "Salesforce Account Executive",
      "vendorManager": "Leiter Vertrieb IT",
      "website": "https://www.salesforce.com",
      "rating": 8,
      "description": "CRM-Plattform f√ºr Vertrieb, Marketing und Kundenservice."
    },
    {
      "id": "VND-005",
      "name": "ServiceNow",
      "category": "ITSM / Service Management",
      "status": "Active",
      "criticality": "Important",
      "serviceLevel": "Standard",
      "contractValue": 85000,
      "contractEnd": "2026-12-31",
      "contactPerson": "ServiceNow Account Manager",
      "vendorManager": "IT Service Manager",
      "website": "https://www.servicenow.com",
      "rating": 7,
      "description": "IT Service Management Plattform f√ºr Incident-, Change- und Problem-Management."
    },
    {
      "id": "VND-006",
      "name": "Atlassian",
      "category": "Collaboration / DevOps",
      "status": "Active",
      "criticality": "Standard",
      "serviceLevel": "Cloud Premium",
      "contractValue": 25000,
      "contractEnd": "2026-03-31",
      "contactPerson": "Atlassian Partner",
      "vendorManager": "Leiter Softwareentwicklung",
      "website": "https://www.atlassian.com",
      "rating": 8,
      "description": "Jira und Confluence f√ºr Projektmanagement und Dokumentation."
    },
    {
      "id": "VND-007",
      "name": "MPDV Mikrolab",
      "category": "MES / Manufacturing",
      "status": "Active",
      "criticality": "Important",
      "serviceLevel": "Standard",
      "contractValue": 75000,
      "contractEnd": "2026-12-31",
      "contactPerson": "MPDV Vertrieb",
      "vendorManager": "Leiter Produktion IT",
      "website": "https://www.mpdv.com",
      "rating": 6,
      "description": "Manufacturing Execution System (MES) f√ºr Fertigungssteuerung und Produktionsdatenerfassung."
    },
    {
      "id": "VND-008",
      "name": "Personio SE",
      "category": "HR / People Management",
      "status": "Active",
      "criticality": "Standard",
      "serviceLevel": "Professional",
      "contractValue": 18000,
      "contractEnd": "2026-06-30",
      "contactPerson": "Personio Customer Success",
      "vendorManager": "Leiter HR",
      "website": "https://www.personio.de",
      "rating": 7,
      "description": "HR-Software f√ºr Personalverwaltung, Recruiting und Zeiterfassung."
    },
    {
      "id": "VND-009",
      "name": "Veeam Software",
      "category": "Backup / Data Protection",
      "status": "Active",
      "criticality": "Standard",
      "serviceLevel": "Standard",
      "contractValue": 22000,
      "contractEnd": "2026-09-30",
      "contactPerson": "Veeam Reseller",
      "vendorManager": "Leiter IT-Infrastruktur",
      "website": "https://www.veeam.com",
      "rating": 8,
      "description": "Backup und Disaster Recovery f√ºr virtuelle und physische Infrastruktur."
    },
    {
      "id": "VND-010",
      "name": "Dassault Syst√®mes",
      "category": "CAD / Simulation",
      "status": "Active",
      "criticality": "Important",
      "serviceLevel": "Premium",
      "contractValue": 120000,
      "contractEnd": "2027-06-30",
      "contactPerson": "Dassault Account Manager",
      "vendorManager": "Leiter Engineering IT",
      "website": "https://www.3ds.com",
      "rating": 7,
      "description": "CATIA und SOLIDWORKS f√ºr CAD-Design und Engineering-Simulation."
    },
    {
      "id": "VND-011",
      "name": "Zabbix LLC",
      "category": "Monitoring",
      "status": "Active",
      "criticality": "Standard",
      "serviceLevel": "Community",
      "contractValue": 5000,
      "contractEnd": "2026-12-31",
      "contactPerson": "Zabbix Support",
      "vendorManager": "Leiter IT-Infrastruktur",
      "website": "https://www.zabbix.com",
      "rating": 7,
      "description": "Open-Source Monitoring-L√∂sung f√ºr Netzwerk- und Server√ºberwachung."
    },
    {
      "id": "VND-012",
      "name": "SAGE",
      "category": "Financial Software",
      "status": "Phase-Out",
      "criticality": "Commodity",
      "serviceLevel": "Standard",
      "contractValue": 12000,
      "contractEnd": "2025-12-31",
      "contactPerson": "SAGE Support",
      "vendorManager": "Leiter Controlling",
      "website": "https://www.sage.com",
      "rating": 4,
      "description": "Legacy-Kostenrechnung, wird durch SAP S/4HANA abgel√∂st."
    },
    {
      "id": "VND-013",
      "name": "Omikron Systemhaus",
      "category": "Data Quality",
      "status": "Under Review",
      "criticality": "Commodity",
      "serviceLevel": "Basic",
      "contractValue": 8000,
      "contractEnd": "2026-03-31",
      "contactPerson": "Omikron Vertrieb",
      "vendorManager": "Leiter Stammdaten",
      "website": "https://www.omikron.net",
      "rating": 5,
      "description": "Datenqualit√§ts-Tool f√ºr Adress- und Stammdatenbereinigung."
    },
    {
      "id": "VND-014",
      "name": "Eigenentwicklung",
      "category": "Custom Development",
      "status": "Active",
      "criticality": "Standard",
      "serviceLevel": "Internal",
      "contractValue": 0,
      "contractEnd": "",
      "contactPerson": "Leiter Softwareentwicklung",
      "vendorManager": "CIO",
      "website": "",
      "rating": 6,
      "description": "Interne Eigenentwicklungen und ma√ügeschneiderte L√∂sungen."
    }
  ],
  "demands": [
    {
      "id": "DEM-001",
      "title": "Einf√ºhrung Power BI Self-Service Analytics",
      "description": "Aufbau einer Self-Service BI-Plattform auf Basis von Power BI f√ºr Fachabteilungen. Ziel: Entlastung der IT von Ad-hoc-Reports und Empowerment der Business User.",
      "category": "Projekt (> 50k)",
      "status": "In Bewertung",
      "priority": "Hoch",
      "requestedBy": "Leiter Controlling",
      "requestDate": "2025-11-15",
      "estimatedBudget": 85000,
      "primaryDomain": 10,
      "relatedDomains": [
        7
      ],
      "relatedApps": [
        "APP-016"
      ],
      "relatedVendors": [
        "VND-002"
      ],
      "businessCase": "Reduktion der Report-Erstellungszeit um 60%, Einsparung von 2 FTE in der IT f√ºr Reporting.",
      "isAIUseCase": false,
      "aiRiskCategory": "Kein AI-Usecase",
      "aiDescription": "",
      "checklistSecurity": {
        "dataClassification": true,
        "accessControl": true,
        "encryptionReview": false,
        "vulnerabilityScan": false,
        "notes": "Kl√§rung Cloud-Speicherort f√ºr personenbezogene Daten erforderlich"
      },
      "checklistLegal": {
        "dataPrivacy": true,
        "gdprCompliance": false,
        "contractReview": false,
        "licenseCheck": true,
        "notes": ""
      },
      "checklistArchitecture": {
        "fitsEAStrategy": true,
        "integrationReview": true,
        "technologyApproved": true,
        "scalabilityCheck": false,
        "notes": "Passt in die Microsoft-Strategie, Datenmodell muss abgestimmt werden"
      }
    },
    {
      "id": "DEM-002",
      "title": "CRM Mobile App f√ºr Au√üendienst",
      "description": "Mobile Salesforce-App f√ºr den Au√üendienst mit Offline-F√§higkeit. Schneller Zugriff auf Kundeninformationen und Besuchsberichte.",
      "category": "Bereichsvorhaben (< 50k)",
      "status": "Genehmigt",
      "priority": "Mittel",
      "requestedBy": "Vertriebsleiter",
      "requestDate": "2025-10-20",
      "estimatedBudget": 35000,
      "primaryDomain": 3,
      "relatedDomains": [],
      "relatedApps": [
        "APP-002"
      ],
      "relatedVendors": [
        "VND-005"
      ],
      "businessCase": "Steigerung der Vertriebsproduktivit√§t um 20%. Reduzierung der Nachbearbeitungszeit nach Kundenbesuchen.",
      "isAIUseCase": false,
      "aiRiskCategory": "Kein AI-Usecase",
      "aiDescription": "",
      "checklistSecurity": {
        "dataClassification": true,
        "accessControl": true,
        "encryptionReview": true,
        "vulnerabilityScan": true,
        "notes": "Mobile Device Management vorhanden"
      },
      "checklistLegal": {
        "dataPrivacy": true,
        "gdprCompliance": true,
        "contractReview": true,
        "licenseCheck": true,
        "notes": "Im bestehenden Salesforce-Vertrag enthalten"
      },
      "checklistArchitecture": {
        "fitsEAStrategy": true,
        "integrationReview": true,
        "technologyApproved": true,
        "scalabilityCheck": true,
        "notes": "Vollst√§ndig gepr√ºft und freigegeben"
      }
    },
    {
      "id": "DEM-003",
      "title": "Automatisierung Rechnungseingang",
      "description": "Einf√ºhrung einer KI-gest√ºtzten L√∂sung zur automatischen Erfassung und Verarbeitung von Eingangsrechnungen.",
      "category": "Projekt (> 50k)",
      "status": "Eingereicht",
      "priority": "Hoch",
      "requestedBy": "Leiter Buchhaltung",
      "requestDate": "2026-01-10",
      "estimatedBudget": 120000,
      "primaryDomain": 7,
      "relatedDomains": [
        5
      ],
      "relatedApps": [
        "APP-001"
      ],
      "relatedVendors": [
        "VND-001"
      ],
      "businessCase": "Einsparung von 3 FTE in der Buchhaltung. Reduzierung der Durchlaufzeit von 5 auf 1 Tag.",
      "isAIUseCase": true,
      "aiRiskCategory": "Begrenztes Risiko",
      "aiDescription": "KI-basierte OCR und NLP zur automatischen Erkennung und Extraktion von Rechnungsdaten. Keine personenbezogene Entscheidung, aber Interaktion mit Finanzdaten.",
      "checklistSecurity": {
        "dataClassification": false,
        "accessControl": false,
        "encryptionReview": false,
        "vulnerabilityScan": false,
        "notes": ""
      },
      "checklistLegal": {
        "dataPrivacy": false,
        "gdprCompliance": false,
        "contractReview": false,
        "licenseCheck": false,
        "notes": ""
      },
      "checklistArchitecture": {
        "fitsEAStrategy": false,
        "integrationReview": false,
        "technologyApproved": false,
        "scalabilityCheck": false,
        "notes": ""
      }
    },
    {
      "id": "DEM-004",
      "title": "Intranet Relaunch",
      "description": "Neugestaltung des Unternehmensintranets basierend auf SharePoint Online mit modernem Design und verbesserter Suche.",
      "category": "Bereichsvorhaben (< 50k)",
      "status": "In Umsetzung",
      "priority": "Niedrig",
      "requestedBy": "HR-Leitung",
      "requestDate": "2025-08-01",
      "estimatedBudget": 40000,
      "primaryDomain": 2,
      "relatedDomains": [
        8,
        9
      ],
      "relatedApps": [
        "APP-005"
      ],
      "relatedVendors": [
        "VND-002"
      ],
      "businessCase": "Verbesserung der internen Kommunikation und Wissensvermittlung. Reduktion von E-Mail-Verkehr um 30%.",
      "isAIUseCase": false,
      "aiRiskCategory": "Kein AI-Usecase",
      "aiDescription": "",
      "checklistSecurity": {
        "dataClassification": true,
        "accessControl": true,
        "encryptionReview": true,
        "vulnerabilityScan": true,
        "notes": ""
      },
      "checklistLegal": {
        "dataPrivacy": true,
        "gdprCompliance": true,
        "contractReview": true,
        "licenseCheck": true,
        "notes": ""
      },
      "checklistArchitecture": {
        "fitsEAStrategy": true,
        "integrationReview": true,
        "technologyApproved": true,
        "scalabilityCheck": true,
        "notes": ""
      }
    },
    {
      "id": "DEM-005",
      "title": "IoT-Dashboard f√ºr Maschinen√ºberwachung",
      "description": "Idee: Echtzeit-Dashboard zur √úberwachung von Maschinenzust√§nden in der Produktion mit Predictive Maintenance Alerts.",
      "category": "Idee",
      "status": "Eingereicht",
      "priority": "Mittel",
      "requestedBy": "Produktionsleiter",
      "requestDate": "2026-02-01",
      "estimatedBudget": 0,
      "primaryDomain": 4,
      "relatedDomains": [
        1,
        10
      ],
      "relatedApps": [
        "APP-003"
      ],
      "relatedVendors": [],
      "businessCase": "Reduktion ungeplanter Stillstandszeiten um 40%. Voraussichtliche Einsparung: 200k/Jahr.",
      "isAIUseCase": true,
      "aiRiskCategory": "Minimales Risiko",
      "aiDescription": "ML-basiertes Predictive Maintenance Modell zur Vorhersage von Maschinenzust√§nden. Keine personenbezogene Bewertung ‚Äì rein technische Sensordatenanalyse.",
      "checklistSecurity": {
        "dataClassification": false,
        "accessControl": false,
        "encryptionReview": false,
        "vulnerabilityScan": false,
        "notes": ""
      },
      "checklistLegal": {
        "dataPrivacy": false,
        "gdprCompliance": false,
        "contractReview": false,
        "licenseCheck": false,
        "notes": ""
      },
      "checklistArchitecture": {
        "fitsEAStrategy": false,
        "integrationReview": false,
        "technologyApproved": false,
        "scalabilityCheck": false,
        "notes": ""
      }
    },
    {
      "id": "DEM-006",
      "title": "KI-basierte Qualit√§tskontrolle in der Fertigung",
      "description": "Einsatz von Computer Vision zur automatischen optischen Qualit√§tspr√ºfung in der Produktion. Erkennung von Oberfl√§chenfehlern in Echtzeit.",
      "category": "Projekt (> 50k)",
      "status": "In Bewertung",
      "priority": "Hoch",
      "requestedBy": "Qualit√§tsleiter",
      "requestDate": "2026-01-25",
      "estimatedBudget": 200000,
      "primaryDomain": 4,
      "relatedDomains": [
        10
      ],
      "relatedApps": [
        "APP-003"
      ],
      "relatedVendors": [
        "VND-003"
      ],
      "businessCase": "Reduktion der Ausschussrate um 35%. Einsparung von 150k/Jahr durch weniger Nacharbeit.",
      "isAIUseCase": true,
      "aiRiskCategory": "Hohes Risiko",
      "aiDescription": "Computer Vision System zur automatischen Qualit√§tsbewertung von Produkten. Hohes Risiko gem√§√ü EU AI Act Anhang III, da das System sicherheitsrelevante Produktkomponenten bewertet und automatische Aussortierung vornimmt.",
      "checklistSecurity": {
        "dataClassification": true,
        "accessControl": false,
        "encryptionReview": false,
        "vulnerabilityScan": false,
        "notes": "Kameradaten und Bilddaten m√ºssen klassifiziert werden"
      },
      "checklistLegal": {
        "dataPrivacy": false,
        "gdprCompliance": false,
        "contractReview": false,
        "licenseCheck": false,
        "notes": "EU AI Act Konformit√§tsbewertung erforderlich"
      },
      "checklistArchitecture": {
        "fitsEAStrategy": true,
        "integrationReview": false,
        "technologyApproved": false,
        "scalabilityCheck": false,
        "notes": "Integration in bestehendes MES zu pr√ºfen"
      }
    },
    {
      "id": "DEM-007",
      "title": "HR Chatbot f√ºr Mitarbeiteranfragen",
      "description": "GenAI-basierter Chatbot zur Beantwortung von HR-Standardfragen (Urlaub, Gehaltsabrechnung, Benefits). Entlastung des HR-Teams.",
      "category": "Bereichsvorhaben (< 50k)",
      "status": "Eingereicht",
      "priority": "Mittel",
      "requestedBy": "HR-Leitung",
      "requestDate": "2026-02-05",
      "estimatedBudget": 45000,
      "primaryDomain": 8,
      "relatedDomains": [
        2
      ],
      "relatedApps": [
        "APP-005"
      ],
      "relatedVendors": [
        "VND-002"
      ],
      "businessCase": "Reduktion der HR-Ticketlast um 50%. 24/7 Verf√ºgbarkeit f√ºr Standardanfragen.",
      "isAIUseCase": true,
      "aiRiskCategory": "Begrenztes Risiko",
      "aiDescription": "GenAI-Chatbot der mit Mitarbeitern interagiert. Begrenztes Risiko gem√§√ü EU AI Act Art. 52 ‚Äì Transparenzpflicht: Nutzer m√ºssen informiert werden, dass sie mit einem KI-System interagieren.",
      "checklistSecurity": {
        "dataClassification": false,
        "accessControl": false,
        "encryptionReview": false,
        "vulnerabilityScan": false,
        "notes": ""
      },
      "checklistLegal": {
        "dataPrivacy": false,
        "gdprCompliance": false,
        "contractReview": false,
        "licenseCheck": false,
        "notes": "Datenschutz f√ºr Mitarbeiterdaten kritisch"
      },
      "checklistArchitecture": {
        "fitsEAStrategy": false,
        "integrationReview": false,
        "technologyApproved": false,
        "scalabilityCheck": false,
        "notes": ""
      }
    }
  ],
  "integrations": [
    {
      "id": "INT-001",
      "sourceAppId": "APP-001",
      "targetAppId": "APP-002",
      "interfaceType": "API",
      "protocol": "REST",
      "description": "Kundenstammdaten-Synchronisation SAP ‚Üí Salesforce",
      "dataObjects": "Kunden, Ansprechpartner, Konditionen",
      "frequency": "Echtzeit",
      "direction": "push",
      "status": "active"
    },
    {
      "id": "INT-002",
      "sourceAppId": "APP-001",
      "targetAppId": "APP-003",
      "interfaceType": "API",
      "protocol": "RFC/BAPI",
      "description": "Fertigungsauftr√§ge und R√ºckmeldungen",
      "dataObjects": "Fertigungsauftr√§ge, Betriebsdaten",
      "frequency": "Echtzeit",
      "direction": "bidirectional",
      "status": "active"
    },
    {
      "id": "INT-003",
      "sourceAppId": "APP-001",
      "targetAppId": "APP-007",
      "interfaceType": "DB-Link",
      "protocol": "DirectQuery",
      "description": "Finanzdaten f√ºr Management-Reporting",
      "dataObjects": "Buchungen, Kostenstellen, Ergebnisrechnung",
      "frequency": "T√§glich",
      "direction": "pull",
      "status": "active"
    },
    {
      "id": "INT-004",
      "sourceAppId": "APP-002",
      "targetAppId": "APP-001",
      "interfaceType": "API",
      "protocol": "REST",
      "description": "Auftr√§ge und Opportunities aus Salesforce",
      "dataObjects": "Auftr√§ge, Angebote",
      "frequency": "Echtzeit",
      "direction": "push",
      "status": "active"
    },
    {
      "id": "INT-005",
      "sourceAppId": "APP-004",
      "targetAppId": "APP-003",
      "interfaceType": "File",
      "protocol": "PLM-XML",
      "description": "St√ºcklisten-Export an MES",
      "dataObjects": "BOMs, Zeichnungen, √Ñnderungsst√§nde",
      "frequency": "Bei Freigabe",
      "direction": "push",
      "status": "active"
    },
    {
      "id": "INT-006",
      "sourceAppId": "APP-009",
      "targetAppId": "APP-001",
      "interfaceType": "File",
      "protocol": "CSV",
      "description": "Lohn- und Gehaltsdaten an SAP FI/CO",
      "dataObjects": "Lohnarten, Kostenstellen, Abwesenheiten",
      "frequency": "Monatlich",
      "direction": "push",
      "status": "active"
    },
    {
      "id": "INT-007",
      "sourceAppId": "APP-001",
      "targetAppId": "APP-018",
      "interfaceType": "File",
      "protocol": "MT940/CAMT",
      "description": "Zahlungsverkehr SAP ‚Üí Multicash",
      "dataObjects": "Zahlungsauftr√§ge, Kontoausz√ºge",
      "frequency": "T√§glich",
      "direction": "bidirectional",
      "status": "active"
    },
    {
      "id": "INT-008",
      "sourceAppId": "APP-008",
      "targetAppId": "APP-011",
      "interfaceType": "API",
      "protocol": "REST",
      "description": "Cloud-Monitoring und Ticket-Erstellung",
      "dataObjects": "Incidents, Change Requests",
      "frequency": "Echtzeit",
      "direction": "bidirectional",
      "status": "active"
    },
    {
      "id": "INT-009",
      "sourceAppId": "APP-012",
      "targetAppId": "APP-008",
      "interfaceType": "Event",
      "protocol": "Webhook",
      "description": "Infrastruktur-Alerts an ITSM",
      "dataObjects": "Alerts, Metriken",
      "frequency": "Echtzeit",
      "direction": "push",
      "status": "active"
    },
    {
      "id": "INT-010",
      "sourceAppId": "APP-014",
      "targetAppId": "APP-001",
      "interfaceType": "Manual",
      "protocol": "Excel-Upload",
      "description": "QM-Pr√ºfergebnisse manuell nach SAP QM",
      "dataObjects": "Pr√ºflose, Messwerte, Sperren",
      "frequency": "W√∂chentlich",
      "direction": "push",
      "status": "active"
    },
    {
      "id": "INT-011",
      "sourceAppId": "APP-001",
      "targetAppId": "APP-013",
      "interfaceType": "ETL",
      "protocol": "Batch-Job",
      "description": "Personaldaten-Abgleich SAP HCM ‚Üí SAGE",
      "dataObjects": "Personalstamm, Organisationseinheiten",
      "frequency": "N√§chtlich",
      "direction": "push",
      "status": "active"
    },
    {
      "id": "INT-012",
      "sourceAppId": "APP-016",
      "targetAppId": "APP-006",
      "interfaceType": "API",
      "protocol": "Graph API",
      "description": "Power Automate Workflows mit SharePoint",
      "dataObjects": "Dokumente, Listen, Genehmigungen",
      "frequency": "Event-basiert",
      "direction": "bidirectional",
      "status": "active"
    }
  ]
};

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê STORE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// store.js ‚Äî Reactive application store (Vue 3 Composition API)

const STORAGE_KEY = 'ea-bebauungsplan-v1'
let debounceTimer = null

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// Default state shape
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function createEmptyState () {
  return {
    meta: { version: '1.0', lastUpdated: '', owner: '', company: '', description: '' },
    domains: [],
    applications: [],
    capabilityMappings: [],
    projects: [],
    projectDependencies: [],
    managementKPIs: [],
    vendors: [],
    e2eProcesses: [],
    demands: [],
    integrations: [],
    enums: {}
  }
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// Reactive store
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const store = reactive({
  data: createEmptyState(),
  loaded: false,
  sidebarOpen: true,

  // ‚îÄ‚îÄ Getters (computed-like but on reactive) ‚îÄ‚îÄ

  get totalApps () { return this.data.applications.length },
  get totalProjects () { return this.data.projects.length },
  get totalVendors () { return (this.data.vendors || []).length },

  get totalCapabilities () {
    return this.data.domains.reduce((n, d) => n + d.capabilities.length, 0)
  },

  get totalSubCapabilities () {
    return this.data.domains.reduce((n, d) =>
      n + d.capabilities.reduce((m, c) => m + (c.subCapabilities ? c.subCapabilities.length : 0), 0), 0)
  },

  get avgMaturity () {
    let sum = 0; let count = 0
    this.data.domains.forEach(d => d.capabilities.forEach(c => { sum += c.maturity; count++ }))
    return count ? +(sum / count).toFixed(1) : 0
  },

  get totalBudget () {
    return this.data.projects.reduce((s, p) => s + (p.budget || 0), 0)
  },

  get timeDistribution () {
    const dist = { Invest: 0, Tolerate: 0, Migrate: 0, Eliminate: 0 }
    this.data.applications.forEach(a => { if (dist[a.timeQuadrant] !== undefined) dist[a.timeQuadrant]++ })
    return dist
  },

  get projectStatusCounts () {
    const c = { green: 0, yellow: 0, red: 0 }
    this.data.projects.forEach(p => { if (c[p.status] !== undefined) c[p.status]++ })
    return c
  },

  get avgTargetMaturity () {
    let sum = 0; let count = 0
    this.data.domains.forEach(d => d.capabilities.forEach(c => {
      if (c.targetMaturity) { sum += c.targetMaturity; count++ }
    }))
    return count ? +(sum / count).toFixed(1) : 0
  },

  get maturityGaps () {
    const gaps = []
    this.data.domains.forEach(d => d.capabilities.forEach(c => {
      const gap = (c.targetMaturity || c.maturity) - c.maturity
      if (gap > 0) gaps.push({ capId: c.id, capName: c.name, domainName: d.name, domainColor: d.color, current: c.maturity, target: c.targetMaturity, gap })
    }))
    return gaps.sort((a, b) => b.gap - a.gap)
  },

  // ‚îÄ‚îÄ Domain helpers ‚îÄ‚îÄ

  domainById (id) {
    return this.data.domains.find(d => d.id === Number(id))
  },

  capabilityById (capId) {
    for (const d of this.data.domains) {
      const c = d.capabilities.find(cap => cap.id === capId)
      if (c) return { ...c, domain: d }
    }
    return null
  },

  domainForCapability (capId) {
    return this.data.domains.find(d => d.capabilities.some(c => c.id === capId))
  },

  // ‚îÄ‚îÄ Application CRUD ‚îÄ‚îÄ

  appById (id) {
    return this.data.applications.find(a => a.id === id)
  },

  addApp (app) {
    app.id = app.id || 'APP-' + String(this.data.applications.length + 1).padStart(3, '0')
    this.data.applications.push(app)
  },

  updateApp (id, patch) {
    const idx = this.data.applications.findIndex(a => a.id === id)
    if (idx !== -1) Object.assign(this.data.applications[idx], patch)
  },

  deleteApp (id) {
    this.data.applications = this.data.applications.filter(a => a.id !== id)
    this.data.capabilityMappings = this.data.capabilityMappings.filter(m => m.applicationId !== id)
    this.data.projects.forEach(p => {
      if (p.affectedApps) p.affectedApps = p.affectedApps.filter(a => a.appId !== id)
    })
  },

  appsForCapability (capId) {
    const mappings = this.data.capabilityMappings.filter(m => m.capabilityId === capId)
    return mappings.map(m => ({
      ...this.appById(m.applicationId),
      role: m.role
    })).filter(a => a.id)
  },

  capabilitiesForApp (appId) {
    const mappings = this.data.capabilityMappings.filter(m => m.applicationId === appId)
    return mappings.map(m => ({
      ...this.capabilityById(m.capabilityId),
      role: m.role
    })).filter(c => c)
  },

  // ‚îÄ‚îÄ Mapping CRUD ‚îÄ‚îÄ

  addMapping (capId, appId, role = 'Primary') {
    const exists = this.data.capabilityMappings.find(m => m.capabilityId === capId && m.applicationId === appId)
    if (!exists) this.data.capabilityMappings.push({ capabilityId: capId, applicationId: appId, role })
  },

  removeMapping (capId, appId) {
    this.data.capabilityMappings = this.data.capabilityMappings.filter(
      m => !(m.capabilityId === capId && m.applicationId === appId)
    )
  },

  // ‚îÄ‚îÄ Project CRUD ‚îÄ‚îÄ

  projectById (id) {
    return this.data.projects.find(p => p.id === id)
  },

  addProject (proj) {
    proj.id = proj.id || 'PRJ-' + String(this.data.projects.length + 1).padStart(3, '0')
    this.data.projects.push(proj)
  },

  updateProject (id, patch) {
    const idx = this.data.projects.findIndex(p => p.id === id)
    if (idx !== -1) Object.assign(this.data.projects[idx], patch)
  },

  deleteProject (id) {
    this.data.projects = this.data.projects.filter(p => p.id !== id)
    this.data.projectDependencies = this.data.projectDependencies.filter(
      d => d.sourceProjectId !== id && d.targetProjectId !== id
    )
  },

  depsForProject (id) {
    return this.data.projectDependencies.filter(d => d.sourceProjectId === id || d.targetProjectId === id)
  },

  projectsForDomain (domainId) {
    return this.data.projects.filter(p =>
      p.primaryDomain === Number(domainId) ||
      (p.secondaryDomains && p.secondaryDomains.includes(Number(domainId)))
    )
  },

  // ‚îÄ‚îÄ Dependency CRUD ‚îÄ‚îÄ

  addDependency (dep) {
    this.data.projectDependencies.push(dep)
  },

  removeDependency (sourceId, targetId) {
    this.data.projectDependencies = this.data.projectDependencies.filter(
      d => !(d.sourceProjectId === sourceId && d.targetProjectId === targetId)
    )
  },

  // ‚îÄ‚îÄ Domain CRUD ‚îÄ‚îÄ

  addDomain (domain) {
    const maxId = this.data.domains.reduce((m, d) => Math.max(m, d.id), 0)
    domain.id = maxId + 1
    if (!domain.capabilities) domain.capabilities = []
    if (!domain.kpis) domain.kpis = []
    this.data.domains.push(domain)
    return domain.id
  },

  updateDomain (id, patch) {
    const d = this.domainById(id)
    if (d) Object.assign(d, patch)
  },

  deleteDomain (id) {
    const d = this.domainById(id)
    if (!d) return
    const capIds = d.capabilities.map(c => c.id)
    this.data.capabilityMappings = this.data.capabilityMappings.filter(m => !capIds.includes(m.capabilityId))
    this.data.projects.forEach(p => {
      if (p.primaryDomain === Number(id)) p.primaryDomain = null
      if (p.secondaryDomains) p.secondaryDomains = p.secondaryDomains.filter(x => x !== Number(id))
      if (p.capabilities) p.capabilities = p.capabilities.filter(c => !capIds.includes(c))
    })
    this.data.e2eProcesses?.forEach(proc => {
      if (proc.domains) proc.domains = proc.domains.filter(x => x !== Number(id))
    })
    this.data.domains = this.data.domains.filter(d => d.id !== Number(id))
  },

  // ‚îÄ‚îÄ Capability CRUD ‚îÄ‚îÄ

  addCapability (domainId, cap) {
    const d = this.domainById(domainId)
    if (!d) return
    const nextIdx = d.capabilities.length + 1
    cap.id = cap.id || `${d.id}.${nextIdx}`
    if (!cap.subCapabilities) cap.subCapabilities = []
    if (cap.targetMaturity === undefined) cap.targetMaturity = cap.maturity || 1
    d.capabilities.push(cap)
  },

  updateCapability (capId, patch) {
    for (const d of this.data.domains) {
      const c = d.capabilities.find(cap => cap.id === capId)
      if (c) { Object.assign(c, patch); return }
    }
  },

  deleteCapability (capId) {
    this.data.capabilityMappings = this.data.capabilityMappings.filter(m => m.capabilityId !== capId)
    this.data.projects.forEach(p => {
      if (p.capabilities) p.capabilities = p.capabilities.filter(c => c !== capId)
    })
    for (const d of this.data.domains) {
      const idx = d.capabilities.findIndex(c => c.id === capId)
      if (idx !== -1) { d.capabilities.splice(idx, 1); return }
    }
  },

  addSubCapability (capId, sub) {
    for (const d of this.data.domains) {
      const c = d.capabilities.find(cap => cap.id === capId)
      if (c) {
        if (!c.subCapabilities) c.subCapabilities = []
        const nextIdx = c.subCapabilities.length + 1
        sub.id = sub.id || `${capId}.${nextIdx}`
        c.subCapabilities.push(sub)
        return
      }
    }
  },

  deleteSubCapability (capId, subId) {
    for (const d of this.data.domains) {
      const c = d.capabilities.find(cap => cap.id === capId)
      if (c && c.subCapabilities) {
        c.subCapabilities = c.subCapabilities.filter(s => s.id !== subId)
        return
      }
    }
  },

  // ‚îÄ‚îÄ E2E Process CRUD ‚îÄ‚îÄ

  processById (id) {
    return (this.data.e2eProcesses || []).find(p => p.id === id)
  },

  addProcess (proc) {
    if (!this.data.e2eProcesses) this.data.e2eProcesses = []
    this.data.e2eProcesses.push(proc)
  },

  updateProcess (id, patch) {
    const p = this.processById(id)
    if (p) Object.assign(p, patch)
  },

  deleteProcess (id) {
    if (!this.data.e2eProcesses) return
    this.data.e2eProcesses = this.data.e2eProcesses.filter(p => p.id !== id)
  },

  processesForDomain (domainId) {
    return (this.data.e2eProcesses || []).filter(p => p.domains && p.domains.includes(Number(domainId)))
  },

  /** Derive applications involved in an E2E process via domain‚Üícapability‚Üímapping chain */
  appsForProcess (processId) {
    const proc = this.processById(processId)
    if (!proc || !proc.domains) return []
    const appMap = new Map()
    proc.domains.forEach(domId => {
      const d = this.domainById(domId)
      if (!d) return
      d.capabilities.forEach(cap => {
        const mappings = this.data.capabilityMappings.filter(m => m.capabilityId === cap.id)
        mappings.forEach(m => {
          const app = this.appById(m.applicationId)
          if (app && !appMap.has(app.id)) {
            appMap.set(app.id, { ...app, roles: new Set(), capCount: 0 })
          }
          if (app && appMap.has(app.id)) {
            appMap.get(app.id).roles.add(m.role)
            appMap.get(app.id).capCount++
          }
        })
      })
    })
    return Array.from(appMap.values()).map(a => ({
      ...a, roles: Array.from(a.roles).join(', ')
    })).sort((a, b) => b.capCount - a.capCount)
  },

  /** Find all E2E processes that touch an application (derived via mapping chain) */
  processesForApp (appId) {
    const capMappings = this.data.capabilityMappings.filter(m => m.applicationId === appId)
    const domainIds = new Set()
    capMappings.forEach(m => {
      const d = this.domainForCapability(m.capabilityId)
      if (d) domainIds.add(d.id)
    })
    return (this.data.e2eProcesses || []).filter(p =>
      p.domains && p.domains.some(did => domainIds.has(did))
    )
  },

  // ‚îÄ‚îÄ Vendor CRUD ‚îÄ‚îÄ

  vendorById (id) {
    return (this.data.vendors || []).find(v => v.id === id)
  },

  addVendor (vendor) {
    if (!this.data.vendors) this.data.vendors = []
    vendor.id = vendor.id || 'VND-' + String(this.data.vendors.length + 1).padStart(3, '0')
    this.data.vendors.push(vendor)
  },

  updateVendor (id, patch) {
    const v = this.vendorById(id)
    if (v) Object.assign(v, patch)
  },

  deleteVendor (id) {
    if (!this.data.vendors) return
    this.data.vendors = this.data.vendors.filter(v => v.id !== id)
  },

  /** Find all applications that reference this vendor (by vendor name match or vendorId) */
  appsForVendor (vendorId) {
    const vendor = this.vendorById(vendorId)
    if (!vendor) return []
    return this.data.applications.filter(a => a.vendor === vendor.name || a.vendorId === vendorId)
  },

  /** Find the vendor record for a given application */
  vendorForApp (appId) {
    const app = this.appById(appId)
    if (!app) return null
    if (app.vendorId) return this.vendorById(app.vendorId)
    return (this.data.vendors || []).find(v => v.name === app.vendor)
  },

  // ‚îÄ‚îÄ Demand CRUD ‚îÄ‚îÄ

  get totalDemands () { return (this.data.demands || []).length },

  demandById (id) {
    return (this.data.demands || []).find(d => d.id === id)
  },

  addDemand (demand) {
    if (!this.data.demands) this.data.demands = []
    if (!demand.id) {
      const maxNum = this.data.demands.reduce((m, d) => {
        const n = parseInt(d.id.replace('DEM-', ''), 10)
        return isNaN(n) ? m : Math.max(m, n)
      }, 0)
      demand.id = 'DEM-' + String(maxNum + 1).padStart(3, '0')
    }
    this.data.demands.push(demand)
  },

  updateDemand (id, patch) {
    const d = this.demandById(id)
    if (d) Object.assign(d, patch)
  },

  deleteDemand (id) {
    if (!this.data.demands) return
    this.data.demands = this.data.demands.filter(d => d.id !== id)
  },

  demandsForDomain (domainId) {
    return (this.data.demands || []).filter(d =>
      d.primaryDomain === Number(domainId) ||
      (d.relatedDomains && d.relatedDomains.includes(Number(domainId)))
    )
  },

  demandsForApp (appId) {
    return (this.data.demands || []).filter(d =>
      d.relatedApps && d.relatedApps.includes(appId)
    )
  },

  demandsForVendor (vendorId) {
    return (this.data.demands || []).filter(d =>
      d.relatedVendors && d.relatedVendors.includes(vendorId)
    )
  },

  // ‚îÄ‚îÄ Integration CRUD ‚îÄ‚îÄ

  integrationById (id) {
    return (this.data.integrations || []).find(i => i.id === id)
  },

  addIntegration (integration) {
    if (!this.data.integrations) this.data.integrations = []
    if (!integration.id) {
      const maxNum = this.data.integrations.reduce((m, i) => {
        const n = parseInt(i.id.replace('INT-', ''), 10)
        return isNaN(n) ? m : Math.max(m, n)
      }, 0)
      integration.id = 'INT-' + String(maxNum + 1).padStart(3, '0')
    }
    this.data.integrations.push(integration)
  },

  updateIntegration (id, patch) {
    const i = this.integrationById(id)
    if (i) Object.assign(i, patch)
  },

  deleteIntegration (id) {
    if (!this.data.integrations) return
    this.data.integrations = this.data.integrations.filter(i => i.id !== id)
  },

  integrationsForApp (appId) {
    return (this.data.integrations || []).filter(i =>
      i.sourceAppId === appId || i.targetAppId === appId
    )
  },

  // ‚îÄ‚îÄ Management KPI CRUD ‚îÄ‚îÄ

  updateManagementKPI (id, patch) {
    const kpi = (this.data.managementKPIs || []).find(k => k.id === id)
    if (kpi) Object.assign(kpi, patch)
  }
})

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// Persistence ‚Äî localStorage with debounce
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function persist () {
  clearTimeout(debounceTimer)
  debounceTimer = setTimeout(() => {
    try {
      const raw = JSON.parse(JSON.stringify(store.data))
      raw.meta.lastUpdated = new Date().toISOString()
      localStorage.setItem(STORAGE_KEY, JSON.stringify(raw))
    } catch (e) {
      console.warn('[store] persist failed', e)
    }
  }, 500)
}

// Watch deeply and auto-persist
function startWatching () {
  watch(() => store.data, persist, { deep: true })
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// Load ‚Äî from localStorage or seed JSON
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function loadData () {
  const saved = localStorage.getItem(STORAGE_KEY)
  if (saved) {
    try {
      store.data = JSON.parse(saved)
      store.loaded = true
      return
    } catch (e) { console.warn('[store] corrupt localStorage, loading seed', e) }
  }
  try {
    store.data  = JSON.parse(JSON.stringify(SEED_DATA))
    store.loaded = true
    persist()
  } catch (e) {
    console.error('[store] failed to load seed data', e)
    store.data  = createEmptyState()
    store.loaded = true
  }
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// Import / Export / Reset
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function exportJSON () {
  const raw = JSON.parse(JSON.stringify(store.data))
  raw.meta.lastUpdated = new Date().toISOString()
  const blob = new Blob([JSON.stringify(raw, null, 2)], { type: 'application/json' })
  const url = URL.createObjectURL(blob)
  const a = document.createElement('a')
  a.href = url
  a.download = `bebauungsplan_${new Date().toISOString().slice(0, 10)}.json`
  a.click()
  URL.revokeObjectURL(url)
}

function importJSON (file) {
  return new Promise((resolve, reject) => {
    const reader = new FileReader()
    reader.onload = () => {
      try {
        const data = JSON.parse(reader.result)
        store.data = data
        persist()
        resolve()
      } catch (e) { reject(e) }
    }
    reader.onerror = reject
    reader.readAsText(file)
  })
}

function resetToSeed () {
  localStorage.removeItem(STORAGE_KEY)
  loadData()
  return Promise.resolve()
}


// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê ROUTER ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// router.js ‚Äî Minimal hash-based SPA router

const router = reactive({
  path: '',
  params: {},
  query: {}
})

// Route definitions: pattern ‚Üí component name
const routes = [
  { pattern: /^\/$/,                        component: 'dashboard-view' },
  { pattern: /^\/domains$/,                 component: 'domain-list' },
  { pattern: /^\/domains\/(\d+)$/,          component: 'domain-detail',   paramNames: ['id'] },
  { pattern: /^\/apps$/,                    component: 'app-list' },
  { pattern: /^\/apps\/(APP-\d+)$/,         component: 'app-detail',      paramNames: ['id'] },
  { pattern: /^\/capability-matrix$/,       component: 'cap-app-matrix' },
  { pattern: /^\/time$/,                    component: 'time-quadrant' },
  { pattern: /^\/integration-map$/,          component: 'integration-map' },
  { pattern: /^\/projects$/,                component: 'project-list' },
  { pattern: /^\/projects\/(PRJ-\d+)$/,     component: 'project-detail',   paramNames: ['id'] },
  { pattern: /^\/project-heatmap$/,         component: 'project-heatmap' },
  { pattern: /^\/dependencies$/,            component: 'dependency-graph' },
  { pattern: /^\/processes$/,               component: 'process-list' },
  { pattern: /^\/processes\/([A-Za-z0-9]+)$/, component: 'process-detail', paramNames: ['id'] },
  { pattern: /^\/vendors$/,                  component: 'vendor-list' },
  { pattern: /^\/vendors\/(VND-\d+)$/,       component: 'vendor-detail',   paramNames: ['id'] },
  { pattern: /^\/demands$/,                   component: 'demand-list' },
  { pattern: /^\/demands\/(DEM-\d+)$/,        component: 'demand-detail',   paramNames: ['id'] },
  { pattern: /^\/ai-usecases$/,                  component: 'ai-usecases-list' },
  { pattern: /^\/demand-pipeline$/,            component: 'demand-pipeline' },
  { pattern: /^\/budget-dashboard$/,            component: 'budget-dashboard' },
  { pattern: /^\/maturity-gap$/,            component: 'maturity-gap' },
  { pattern: /^\/roadmap$/,                component: 'roadmap-view' },
  { pattern: /^\/executive-summary$/,      component: 'executive-summary' },
  { pattern: /^\/settings$/,               component: 'settings-view' }
]

function resolve () {
  const hash = window.location.hash.slice(1) || '/'
  const [pathPart, queryPart] = hash.split('?')
  const path = pathPart || '/'

  // Parse query string
  const query = {}
  if (queryPart) {
    queryPart.split('&').forEach(p => {
      const [k, v] = p.split('=')
      query[decodeURIComponent(k)] = decodeURIComponent(v || '')
    })
  }

  // Match route
  for (const r of routes) {
    const match = path.match(r.pattern)
    if (match) {
      const params = {}
      if (r.paramNames) {
        r.paramNames.forEach((name, i) => { params[name] = match[i + 1] })
      }
      router.path = path
      router.params = params
      router.query = query
      router.component = r.component
      return
    }
  }

  // 404 fallback ‚Üí dashboard
  router.path = '/'
  router.params = {}
  router.query = query
  router.component = 'dashboard-view'
}

function navigateTo (path) {
  window.location.hash = '#' + path
}

function initRouter () {
  window.addEventListener('hashchange', resolve)
  resolve()
}

// Navigation helper for templates
function linkTo (path) {
  return '#' + path
}


// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê COMPONENTS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

// ‚îÄ‚îÄ DomainForm (domain-form.js) ‚îÄ‚îÄ
// domain-form.js ‚Äî Modal form for creating/editing a domain (incl. strategy, KPIs)

const PALETTE = ['#3B82F6','#8B5CF6','#10B981','#F59E0B','#EF4444','#06B6D4','#84CC16','#EC4899','#6366F1','#F97316','#14B8A6','#A855F7']

const DomainForm = {
  name: 'DomainForm',
  props: { editDomain: { type: Object, default: null } },
  emits: ['close', 'saved'],
  template: `
    <div class="fixed inset-0 z-50 flex items-center justify-center bg-black/40" @click.self="$emit('close')">
      <div class="bg-white rounded-2xl shadow-xl w-full max-w-2xl mx-4 max-h-[90vh] overflow-y-auto">
        <div class="px-6 py-4 border-b border-surface-200 flex items-center justify-between sticky top-0 bg-white rounded-t-2xl z-10">
          <h3 class="text-base font-semibold text-gray-900">{{ editDomain ? 'Edit Domain' : 'New Domain' }}</h3>
          <button @click="$emit('close')" class="text-gray-400 hover:text-gray-600 text-xl">&times;</button>
        </div>
        <form @submit.prevent="save" class="px-6 py-4 space-y-5">

          <!-- Basic Info -->
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
            <div class="sm:col-span-2">
              <label class="block text-xs font-medium text-gray-600 mb-1">Domain Name *</label>
              <input v-model="form.name" required class="w-full px-3 py-2 border border-surface-200 rounded-lg text-sm focus:ring-2 focus:ring-primary-300 outline-none" />
            </div>
            <div>
              <label class="block text-xs font-medium text-gray-600 mb-1">Domain Owner</label>
              <input v-model="form.domainOwner" class="w-full px-3 py-2 border border-surface-200 rounded-lg text-sm focus:ring-2 focus:ring-primary-300 outline-none" placeholder="e.g. CIO, CFO, COO" />
            </div>
            <div>
              <label class="block text-xs font-medium text-gray-600 mb-1">Color</label>
              <div class="flex flex-wrap gap-2 mt-1">
                <button v-for="c in palette" :key="c" type="button" @click="form.color = c"
                        class="w-7 h-7 rounded-lg border-2 transition-all"
                        :style="{ backgroundColor: c }"
                        :class="form.color === c ? 'border-gray-800 scale-110' : 'border-transparent'"></button>
              </div>
            </div>
            <div class="sm:col-span-2">
              <label class="block text-xs font-medium text-gray-600 mb-1">Description</label>
              <textarea v-model="form.description" rows="2" class="w-full px-3 py-2 border border-surface-200 rounded-lg text-sm focus:ring-2 focus:ring-primary-300 outline-none resize-vertical"></textarea>
            </div>
          </div>

          <!-- Strategy Section -->
          <div class="border-t border-surface-200 pt-4">
            <h4 class="text-sm font-semibold text-gray-700 mb-3">Strategy & Vision</h4>
            <div class="space-y-3">
              <div>
                <label class="block text-xs font-medium text-gray-600 mb-1">Strategic Focus</label>
                <input v-model="form.strategicFocus" class="w-full px-3 py-2 border border-surface-200 rounded-lg text-sm focus:ring-2 focus:ring-primary-300 outline-none" placeholder="e.g. Cloud-Migration, Integration, Standardisierung" />
              </div>
              <div>
                <label class="block text-xs font-medium text-gray-600 mb-1">Vision</label>
                <textarea v-model="form.vision" rows="2" class="w-full px-3 py-2 border border-surface-200 rounded-lg text-sm focus:ring-2 focus:ring-primary-300 outline-none resize-vertical" placeholder="Target state description for this domain"></textarea>
              </div>
            </div>
          </div>

          <!-- KPIs Section -->
          <div class="border-t border-surface-200 pt-4">
            <div class="flex items-center justify-between mb-3">
              <h4 class="text-sm font-semibold text-gray-700">Domain KPIs</h4>
              <button type="button" @click="addKpi" class="text-xs text-primary-600 hover:text-primary-800 font-medium">+ Add KPI</button>
            </div>
            <div v-if="form.kpis.length === 0" class="text-xs text-gray-400 italic">No KPIs defined yet</div>
            <div v-for="(kpi, i) in form.kpis" :key="i" class="flex items-start gap-2 mb-2 p-3 bg-surface-50 rounded-lg">
              <div class="flex-1 grid grid-cols-2 sm:grid-cols-4 gap-2">
                <div class="sm:col-span-2">
                  <input v-model="kpi.name" placeholder="KPI Name" class="w-full px-2 py-1.5 border border-surface-200 rounded text-xs focus:ring-1 focus:ring-primary-300 outline-none" />
                </div>
                <div>
                  <input v-model="kpi.target" placeholder="Target" class="w-full px-2 py-1.5 border border-surface-200 rounded text-xs focus:ring-1 focus:ring-primary-300 outline-none" />
                </div>
                <div>
                  <input v-model="kpi.current" placeholder="Current" class="w-full px-2 py-1.5 border border-surface-200 rounded text-xs focus:ring-1 focus:ring-primary-300 outline-none" />
                </div>
                <div>
                  <input v-model="kpi.unit" placeholder="Unit (%,#,h)" class="w-full px-2 py-1.5 border border-surface-200 rounded text-xs focus:ring-1 focus:ring-primary-300 outline-none" />
                </div>
                <div>
                  <select v-model="kpi.trend" class="w-full px-2 py-1.5 border border-surface-200 rounded text-xs bg-white focus:ring-1 focus:ring-primary-300 outline-none">
                    <option value="improving">‚Üë Improving</option>
                    <option value="stable">‚Üí Stable</option>
                    <option value="declining">‚Üì Declining</option>
                  </select>
                </div>
              </div>
              <button type="button" @click="form.kpis.splice(i, 1)" class="text-gray-400 hover:text-red-500 text-lg mt-1">&times;</button>
            </div>
          </div>

          <!-- Actions -->
          <div class="flex justify-end gap-3 pt-2 border-t border-surface-200">
            <button type="button" @click="$emit('close')" class="px-4 py-2 border border-gray-300 rounded-lg text-sm text-gray-700 hover:bg-surface-100">Cancel</button>
            <button type="submit" class="px-4 py-2 bg-primary-600 text-white rounded-lg text-sm hover:bg-primary-700">{{ editDomain ? 'Update' : 'Create' }}</button>
          </div>
        </form>
      </div>
    </div>
  `,
  setup (props, { emit }) {
    const { ref, onMounted } = Vue
    const palette = PALETTE

    const defaultForm = () => ({
      name: '', color: '#3B82F6', icon: '', description: '',
      domainOwner: '', strategicFocus: '', vision: '',
      kpis: []
    })

    const form = ref(defaultForm())

    onMounted(() => {
      if (props.editDomain) {
        form.value = {
          ...defaultForm(),
          name: props.editDomain.name,
          color: props.editDomain.color,
          icon: props.editDomain.icon || '',
          description: props.editDomain.description || '',
          domainOwner: props.editDomain.domainOwner || '',
          strategicFocus: props.editDomain.strategicFocus || '',
          vision: props.editDomain.vision || '',
          kpis: (props.editDomain.kpis || []).map(k => ({ ...k }))
        }
      }
    })

    function addKpi () {
      const id = 'KPI-D-' + Date.now()
      form.value.kpis.push({ id, name: '', target: '', current: '', unit: '%', trend: 'stable' })
    }

    function save () {
      const data = { ...form.value }
      // Assign KPI IDs if missing
      data.kpis = data.kpis.filter(k => k.name).map((k, i) => ({
        ...k,
        id: k.id || `KPI-D-${Date.now()}-${i}`
      }))
      if (props.editDomain) {
        store.updateDomain(props.editDomain.id, data)
      } else {
        store.addDomain(data)
      }
      emit('saved')
    }

    return { store, form, palette, addKpi, save }
  }
}


// ‚îÄ‚îÄ CapabilityForm (capability-form.js) ‚îÄ‚îÄ
// capability-form.js ‚Äî Modal form for creating/editing a capability (incl. target maturity, KPIs, sub-capabilities)

const CapabilityForm = {
  name: 'CapabilityForm',
  props: {
    editCapability: { type: Object, default: null },
    domainId: { type: Number, required: true }
  },
  emits: ['close', 'saved'],
  template: `
    <div class="fixed inset-0 z-50 flex items-center justify-center bg-black/40" @click.self="$emit('close')">
      <div class="bg-white rounded-2xl shadow-xl w-full max-w-xl mx-4 max-h-[90vh] overflow-y-auto">
        <div class="px-6 py-4 border-b border-surface-200 flex items-center justify-between sticky top-0 bg-white rounded-t-2xl z-10">
          <h3 class="text-base font-semibold text-gray-900">{{ editCapability ? 'Edit Capability' : 'New Capability' }}</h3>
          <button @click="$emit('close')" class="text-gray-400 hover:text-gray-600 text-xl">&times;</button>
        </div>
        <form @submit.prevent="save" class="px-6 py-4 space-y-4">
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
            <div class="sm:col-span-2">
              <label class="block text-xs font-medium text-gray-600 mb-1">Capability Name *</label>
              <input v-model="form.name" required class="w-full px-3 py-2 border border-surface-200 rounded-lg text-sm focus:ring-2 focus:ring-primary-300 outline-none" />
            </div>
            <div>
              <label class="block text-xs font-medium text-gray-600 mb-1">Criticality</label>
              <select v-model="form.criticality" class="w-full px-3 py-2 border border-surface-200 rounded-lg text-sm bg-white focus:ring-2 focus:ring-primary-300 outline-none">
                <option v-for="c in store.data.enums.capabilityCriticality" :key="c" :value="c">{{ c }}</option>
              </select>
            </div>
            <div></div>

            <!-- Maturity (Ist) -->
            <div>
              <label class="block text-xs font-medium text-gray-600 mb-1">Current Maturity (Ist)</label>
              <div class="flex items-center gap-2">
                <input type="range" v-model.number="form.maturity" min="1" max="5" step="1" class="flex-1 accent-blue-600" />
                <span class="text-sm font-bold w-6 text-center" :style="{ color: matColor(form.maturity) }">{{ form.maturity }}</span>
              </div>
              <div class="flex justify-between text-[9px] text-gray-400 px-0.5"><span>Initial</span><span>Optimized</span></div>
            </div>

            <!-- Target Maturity (Soll) -->
            <div>
              <label class="block text-xs font-medium text-gray-600 mb-1">Target Maturity (Soll)</label>
              <div class="flex items-center gap-2">
                <input type="range" v-model.number="form.targetMaturity" min="1" max="5" step="1" class="flex-1 accent-indigo-600" />
                <span class="text-sm font-bold w-6 text-center" :style="{ color: matColor(form.targetMaturity) }">{{ form.targetMaturity }}</span>
              </div>
              <div class="flex justify-between text-[9px] text-gray-400 px-0.5"><span>Initial</span><span>Optimized</span></div>
            </div>

            <div class="sm:col-span-2">
              <label class="block text-xs font-medium text-gray-600 mb-1">Description</label>
              <textarea v-model="form.description" rows="2" class="w-full px-3 py-2 border border-surface-200 rounded-lg text-sm focus:ring-2 focus:ring-primary-300 outline-none resize-vertical"></textarea>
            </div>
          </div>

          <!-- Sub-Capabilities -->
          <div class="border-t border-surface-200 pt-4">
            <div class="flex items-center justify-between mb-2">
              <h4 class="text-sm font-semibold text-gray-700">Sub-Capabilities</h4>
              <button type="button" @click="addSub" class="text-xs text-primary-600 hover:text-primary-800 font-medium">+ Add</button>
            </div>
            <div class="flex flex-wrap gap-2">
              <div v-for="(sub, i) in form.subCapabilities" :key="i" class="flex items-center gap-1 bg-surface-100 rounded px-2 py-1">
                <input v-model="sub.name" class="bg-transparent text-xs outline-none w-40" placeholder="Sub-capability name" />
                <button type="button" @click="form.subCapabilities.splice(i, 1)" class="text-gray-400 hover:text-red-500 text-sm">&times;</button>
              </div>
            </div>
          </div>

          <!-- KPIs -->
          <div class="border-t border-surface-200 pt-4">
            <div class="flex items-center justify-between mb-2">
              <h4 class="text-sm font-semibold text-gray-700">Capability KPIs</h4>
              <button type="button" @click="addKpi" class="text-xs text-primary-600 hover:text-primary-800 font-medium">+ Add KPI</button>
            </div>
            <div v-for="(kpi, i) in form.kpis" :key="i" class="flex items-start gap-2 mb-2 p-2 bg-surface-50 rounded-lg">
              <div class="flex-1 grid grid-cols-2 sm:grid-cols-4 gap-2">
                <div class="sm:col-span-2">
                  <input v-model="kpi.name" placeholder="KPI Name" class="w-full px-2 py-1 border border-surface-200 rounded text-xs outline-none" />
                </div>
                <input v-model="kpi.target" placeholder="Target" class="px-2 py-1 border border-surface-200 rounded text-xs outline-none" />
                <input v-model="kpi.current" placeholder="Current" class="px-2 py-1 border border-surface-200 rounded text-xs outline-none" />
                <input v-model="kpi.unit" placeholder="Unit" class="px-2 py-1 border border-surface-200 rounded text-xs outline-none" />
                <select v-model="kpi.trend" class="px-2 py-1 border border-surface-200 rounded text-xs bg-white outline-none">
                  <option value="improving">‚Üë Improving</option>
                  <option value="stable">‚Üí Stable</option>
                  <option value="declining">‚Üì Declining</option>
                </select>
              </div>
              <button type="button" @click="form.kpis.splice(i, 1)" class="text-gray-400 hover:text-red-500 text-sm mt-1">&times;</button>
            </div>
          </div>

          <div class="flex justify-end gap-3 pt-2 border-t border-surface-200">
            <button type="button" @click="$emit('close')" class="px-4 py-2 border border-gray-300 rounded-lg text-sm text-gray-700 hover:bg-surface-100">Cancel</button>
            <button type="submit" class="px-4 py-2 bg-primary-600 text-white rounded-lg text-sm hover:bg-primary-700">{{ editCapability ? 'Update' : 'Create' }}</button>
          </div>
        </form>
      </div>
    </div>
  `,
  setup (props, { emit }) {
    const { ref, onMounted } = Vue

    const defaultForm = () => ({
      name: '', criticality: 'Medium', maturity: 1, targetMaturity: 3,
      description: '', subCapabilities: [], kpis: []
    })

    const form = ref(defaultForm())

    onMounted(() => {
      if (props.editCapability) {
        const c = props.editCapability
        form.value = {
          name: c.name,
          criticality: c.criticality || 'Medium',
          maturity: c.maturity || 1,
          targetMaturity: c.targetMaturity || c.maturity || 1,
          description: c.description || '',
          subCapabilities: (c.subCapabilities || []).map(s => ({ ...s })),
          kpis: (c.kpis || []).map(k => ({ ...k }))
        }
      }
    })

    function matColor (m) {
      return { 1: '#f87171', 2: '#fb923c', 3: '#facc15', 4: '#a3e635', 5: '#34d399' }[m] || '#94a3b8'
    }

    function addSub () {
      form.value.subCapabilities.push({ id: '', name: '' })
    }

    function addKpi () {
      form.value.kpis.push({ id: 'KPI-C-' + Date.now(), name: '', target: '', current: '', unit: '%', trend: 'stable' })
    }

    function save () {
      const data = { ...form.value }
      // Clean up sub-capabilities
      data.subCapabilities = data.subCapabilities.filter(s => s.name)
      data.kpis = data.kpis.filter(k => k.name)

      if (props.editCapability) {
        store.updateCapability(props.editCapability.id, data)
      } else {
        store.addCapability(props.domainId, data)
      }
      emit('saved')
    }

    return { store, form, matColor, addSub, addKpi, save }
  }
}


// ‚îÄ‚îÄ AppForm (app-form.js) ‚îÄ‚îÄ
// app-form.js ‚Äî Modal form for creating/editing an application

const AppForm = {
  name: 'AppForm',
  props: { editApp: { type: Object, default: null } },
  emits: ['close', 'saved'],
  template: `
    <div class="fixed inset-0 z-50 flex items-center justify-center bg-black/40" @click.self="$emit('close')">
      <div class="bg-white rounded-2xl shadow-xl w-full max-w-lg mx-4 max-h-[90vh] overflow-y-auto">
        <div class="px-6 py-4 border-b border-surface-200 flex items-center justify-between">
          <h3 class="text-base font-semibold text-gray-900">{{ editApp ? 'Edit Application' : 'New Application' }}</h3>
          <button @click="$emit('close')" class="text-gray-400 hover:text-gray-600 text-xl">&times;</button>
        </div>
        <form @submit.prevent="save" class="px-6 py-4 space-y-4">
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
            <div class="sm:col-span-2">
              <label class="block text-xs font-medium text-gray-600 mb-1">Name *</label>
              <input v-model="form.name" required class="w-full px-3 py-2 border border-surface-200 rounded-lg text-sm focus:ring-2 focus:ring-primary-300 outline-none" />
            </div>
            <div>
              <label class="block text-xs font-medium text-gray-600 mb-1">Vendor</label>
              <input v-model="form.vendor" class="w-full px-3 py-2 border border-surface-200 rounded-lg text-sm focus:ring-2 focus:ring-primary-300 outline-none" />
            </div>
            <div>
              <label class="block text-xs font-medium text-gray-600 mb-1">Category</label>
              <input v-model="form.category" class="w-full px-3 py-2 border border-surface-200 rounded-lg text-sm focus:ring-2 focus:ring-primary-300 outline-none" placeholder="e.g. ERP, CRM, MES" />
            </div>
            <div>
              <label class="block text-xs font-medium text-gray-600 mb-1">Type</label>
              <select v-model="form.type" class="w-full px-3 py-2 border border-surface-200 rounded-lg text-sm bg-white focus:ring-2 focus:ring-primary-300 outline-none">
                <option v-for="t in store.data.enums.appType" :key="t" :value="t">{{ t }}</option>
              </select>
            </div>
            <div>
              <label class="block text-xs font-medium text-gray-600 mb-1">Criticality</label>
              <select v-model="form.criticality" class="w-full px-3 py-2 border border-surface-200 rounded-lg text-sm bg-white focus:ring-2 focus:ring-primary-300 outline-none">
                <option v-for="c in store.data.enums.criticality" :key="c" :value="c">{{ c }}</option>
              </select>
            </div>
            <div>
              <label class="block text-xs font-medium text-gray-600 mb-1">TIME Quadrant</label>
              <select v-model="form.timeQuadrant" class="w-full px-3 py-2 border border-surface-200 rounded-lg text-sm bg-white focus:ring-2 focus:ring-primary-300 outline-none">
                <option v-for="t in store.data.enums.timeQuadrant" :key="t" :value="t">{{ t }}</option>
              </select>
            </div>
            <div>
              <label class="block text-xs font-medium text-gray-600 mb-1">Cost per Year (‚Ç¨)</label>
              <input v-model.number="form.costPerYear" type="number" min="0" class="w-full px-3 py-2 border border-surface-200 rounded-lg text-sm focus:ring-2 focus:ring-primary-300 outline-none" />
            </div>
            <div>
              <label class="block text-xs font-medium text-gray-600 mb-1">User Count</label>
              <input v-model.number="form.userCount" type="number" min="0" class="w-full px-3 py-2 border border-surface-200 rounded-lg text-sm focus:ring-2 focus:ring-primary-300 outline-none" />
            </div>
            <div>
              <label class="block text-xs font-medium text-gray-600 mb-1">Business Owner</label>
              <input v-model="form.businessOwner" class="w-full px-3 py-2 border border-surface-200 rounded-lg text-sm focus:ring-2 focus:ring-primary-300 outline-none" />
            </div>
            <div>
              <label class="block text-xs font-medium text-gray-600 mb-1">IT Owner</label>
              <input v-model="form.itOwner" class="w-full px-3 py-2 border border-surface-200 rounded-lg text-sm focus:ring-2 focus:ring-primary-300 outline-none" />
            </div>
            <div>
              <label class="block text-xs font-medium text-gray-600 mb-1">Go-Live Date</label>
              <input v-model="form.goLiveDate" type="date" class="w-full px-3 py-2 border border-surface-200 rounded-lg text-sm focus:ring-2 focus:ring-primary-300 outline-none" />
            </div>
            <div>
              <label class="block text-xs font-medium text-gray-600 mb-1">Business Value (1-10)</label>
              <input v-model.number="form.businessValue" type="number" min="1" max="10" class="w-full px-3 py-2 border border-surface-200 rounded-lg text-sm focus:ring-2 focus:ring-primary-300 outline-none" />
            </div>
            <div>
              <label class="block text-xs font-medium text-gray-600 mb-1">Technical Health (1-10)</label>
              <input v-model.number="form.technicalHealth" type="number" min="1" max="10" class="w-full px-3 py-2 border border-surface-200 rounded-lg text-sm focus:ring-2 focus:ring-primary-300 outline-none" />
            </div>
            <div class="sm:col-span-2">
              <label class="block text-xs font-medium text-gray-600 mb-1">Description</label>
              <textarea v-model="form.description" rows="3" class="w-full px-3 py-2 border border-surface-200 rounded-lg text-sm focus:ring-2 focus:ring-primary-300 outline-none resize-vertical"></textarea>
            </div>
          </div>
          <div class="flex justify-end gap-3 pt-2">
            <button type="button" @click="$emit('close')" class="px-4 py-2 border border-gray-300 rounded-lg text-sm text-gray-700 hover:bg-surface-100">Cancel</button>
            <button type="submit" class="px-4 py-2 bg-primary-600 text-white rounded-lg text-sm hover:bg-primary-700">{{ editApp ? 'Update' : 'Create' }}</button>
          </div>
        </form>
      </div>
    </div>
  `,
  setup (props, { emit }) {
    const { ref, onMounted } = Vue

    const defaultForm = () => ({
      name: '', vendor: '', category: '', type: 'On-Prem',
      criticality: 'Business-Operational', timeQuadrant: 'Tolerate',
      costPerYear: 0, userCount: 0, businessOwner: '', itOwner: '',
      goLiveDate: '', businessValue: 5, technicalHealth: 5, description: ''
    })

    const form = ref(defaultForm())

    onMounted(() => {
      if (props.editApp) {
        form.value = {
          ...defaultForm(),
          ...props.editApp,
          businessValue: props.editApp.scores?.businessValue || 5,
          technicalHealth: props.editApp.scores?.technicalHealth || 5
        }
      }
    })

    function save () {
      const data = { ...form.value, scores: { businessValue: form.value.businessValue, technicalHealth: form.value.technicalHealth } }
      delete data.businessValue
      delete data.technicalHealth
      if (props.editApp) {
        store.updateApp(props.editApp.id, data)
      } else {
        store.addApp(data)
      }
      emit('saved')
    }

    return { store, form, save }
  }
}


// ‚îÄ‚îÄ ProjectForm (project-form.js) ‚îÄ‚îÄ
// project-form.js ‚Äî Modal for creating/editing a project

const ProjectForm = {
  name: 'ProjectForm',
  props: { editProject: { type: Object, default: null } },
  emits: ['close', 'saved'],
  template: `
    <div class="fixed inset-0 z-50 flex items-center justify-center bg-black/40" @click.self="$emit('close')">
      <div class="bg-white rounded-2xl shadow-xl w-full max-w-lg mx-4 max-h-[90vh] overflow-y-auto">
        <div class="px-6 py-4 border-b border-surface-200 flex items-center justify-between">
          <h3 class="text-base font-semibold text-gray-900">{{ editProject ? 'Edit Project' : 'New Project' }}</h3>
          <button @click="$emit('close')" class="text-gray-400 hover:text-gray-600 text-xl">&times;</button>
        </div>
        <form @submit.prevent="save" class="px-6 py-4 space-y-4">
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
            <div class="sm:col-span-2">
              <label class="block text-xs font-medium text-gray-600 mb-1">Name *</label>
              <input v-model="form.name" required class="w-full px-3 py-2 border border-surface-200 rounded-lg text-sm focus:ring-2 focus:ring-primary-300 outline-none" />
            </div>
            <div>
              <label class="block text-xs font-medium text-gray-600 mb-1">Category</label>
              <select v-model="form.category" class="w-full px-3 py-2 border border-surface-200 rounded-lg text-sm bg-white">
                <option v-for="c in store.data.enums.projectCategory" :key="c" :value="c">{{ c }}</option>
              </select>
            </div>
            <div>
              <label class="block text-xs font-medium text-gray-600 mb-1">Primary Domain</label>
              <select v-model.number="form.primaryDomain" class="w-full px-3 py-2 border border-surface-200 rounded-lg text-sm bg-white">
                <option v-for="d in store.data.domains" :key="d.id" :value="d.id">{{ d.id }}. {{ d.name }}</option>
              </select>
            </div>
            <div>
              <label class="block text-xs font-medium text-gray-600 mb-1">Budget (‚Ç¨)</label>
              <input v-model.number="form.budget" type="number" min="0" class="w-full px-3 py-2 border border-surface-200 rounded-lg text-sm focus:ring-2 focus:ring-primary-300 outline-none" />
            </div>
            <div>
              <label class="block text-xs font-medium text-gray-600 mb-1">Status</label>
              <select v-model="form.status" class="w-full px-3 py-2 border border-surface-200 rounded-lg text-sm bg-white">
                <option value="green">üü¢ Green</option>
                <option value="yellow">üü° Yellow</option>
                <option value="red">üî¥ Red</option>
              </select>
            </div>
            <div>
              <label class="block text-xs font-medium text-gray-600 mb-1">Start (Quarter)</label>
              <input v-model="form.start" placeholder="Q1/2026" class="w-full px-3 py-2 border border-surface-200 rounded-lg text-sm focus:ring-2 focus:ring-primary-300 outline-none" />
            </div>
            <div>
              <label class="block text-xs font-medium text-gray-600 mb-1">End (Quarter)</label>
              <input v-model="form.end" placeholder="Q4/2026" class="w-full px-3 py-2 border border-surface-200 rounded-lg text-sm focus:ring-2 focus:ring-primary-300 outline-none" />
            </div>
            <div>
              <label class="block text-xs font-medium text-gray-600 mb-1">Sponsor</label>
              <input v-model="form.sponsor" class="w-full px-3 py-2 border border-surface-200 rounded-lg text-sm focus:ring-2 focus:ring-primary-300 outline-none" />
            </div>
            <div>
              <label class="block text-xs font-medium text-gray-600 mb-1">Project Lead</label>
              <input v-model="form.projectLead" class="w-full px-3 py-2 border border-surface-200 rounded-lg text-sm focus:ring-2 focus:ring-primary-300 outline-none" />
            </div>
            <div class="sm:col-span-2">
              <label class="block text-xs font-medium text-gray-600 mb-1">Status Text</label>
              <input v-model="form.statusText" class="w-full px-3 py-2 border border-surface-200 rounded-lg text-sm focus:ring-2 focus:ring-primary-300 outline-none" placeholder="e.g. On track / Ressourcenengpass" />
            </div>
            <div class="sm:col-span-2">
              <label class="block text-xs font-medium text-gray-600 mb-1">Strategic Contribution</label>
              <textarea v-model="form.strategicContribution" rows="2" class="w-full px-3 py-2 border border-surface-200 rounded-lg text-sm resize-vertical focus:ring-2 focus:ring-primary-300 outline-none"></textarea>
            </div>
          </div>
          <div class="flex justify-end gap-3 pt-2">
            <button type="button" @click="$emit('close')" class="px-4 py-2 border border-gray-300 rounded-lg text-sm text-gray-700 hover:bg-surface-100">Cancel</button>
            <button type="submit" class="px-4 py-2 bg-primary-600 text-white rounded-lg text-sm hover:bg-primary-700">{{ editProject ? 'Update' : 'Create' }}</button>
          </div>
        </form>
      </div>
    </div>
  `,
  setup (props, { emit }) {
    const { ref, onMounted } = Vue

    const defaultForm = () => ({
      name: '', category: 'Modernisierung', primaryDomain: 1, secondaryDomains: [],
      budget: 0, status: 'green', statusText: '', start: '', end: '',
      sponsor: '', projectLead: '', strategicContribution: '',
      capabilities: [], affectedApps: [], timeReference: 'Invest',
      e2eProcesses: [], conformity: 'Konform'
    })

    const form = ref(defaultForm())

    onMounted(() => {
      if (props.editProject) {
        form.value = { ...defaultForm(), ...props.editProject }
      }
    })

    function save () {
      if (props.editProject) {
        store.updateProject(props.editProject.id, { ...form.value })
      } else {
        store.addProject({ ...form.value })
      }
      emit('saved')
    }

    return { store, form, save }
  }
}


// ‚îÄ‚îÄ ProcessForm (process-form.js) ‚îÄ‚îÄ
// process-form.js ‚Äî Modal for E2E Process CRUD

const ProcessForm = {
  name: 'ProcessForm',
  props: { editProcess: { type: Object, default: null } },
  emits: ['close', 'saved'],
  template: `
    <div class="fixed inset-0 z-50 flex items-center justify-center bg-black/40" @click.self="$emit('close')">
      <div class="bg-white rounded-2xl shadow-xl w-full max-w-lg max-h-[90vh] overflow-y-auto p-6 space-y-4">
        <h3 class="text-lg font-bold text-gray-900">{{ editProcess ? 'Edit Process' : 'New E2E Process' }}</h3>

        <!-- ID -->
        <div>
          <label class="text-xs font-medium text-gray-600">Process ID (e.g. O2C)</label>
          <input v-model="form.id" :disabled="!!editProcess" class="mt-1 w-full border border-surface-200 rounded-lg px-3 py-2 text-sm" placeholder="O2C" />
        </div>

        <!-- Name -->
        <div>
          <label class="text-xs font-medium text-gray-600">Name</label>
          <input v-model="form.name" class="mt-1 w-full border border-surface-200 rounded-lg px-3 py-2 text-sm" />
        </div>

        <!-- Owner -->
        <div>
          <label class="text-xs font-medium text-gray-600">Owner</label>
          <input v-model="form.owner" class="mt-1 w-full border border-surface-200 rounded-lg px-3 py-2 text-sm" />
        </div>

        <!-- Description -->
        <div>
          <label class="text-xs font-medium text-gray-600">Description</label>
          <textarea v-model="form.description" rows="2" class="mt-1 w-full border border-surface-200 rounded-lg px-3 py-2 text-sm"></textarea>
        </div>

        <!-- Status -->
        <div>
          <label class="text-xs font-medium text-gray-600">Status</label>
          <select v-model="form.status" class="mt-1 w-full border border-surface-200 rounded-lg px-3 py-2 text-sm">
            <option v-for="s in statusOptions" :key="s" :value="s">{{ s }}</option>
          </select>
        </div>

        <!-- Domain Multi-Select -->
        <div>
          <label class="text-xs font-medium text-gray-600">Linked Domains</label>
          <div class="mt-1 flex flex-wrap gap-2">
            <label v-for="d in store.data.domains" :key="d.id"
                   class="flex items-center gap-1.5 text-xs px-2 py-1 rounded border cursor-pointer"
                   :class="form.domains.includes(d.id) ? 'border-primary-400 bg-primary-50' : 'border-surface-200'">
              <input type="checkbox" :value="d.id" v-model="form.domains" class="sr-only" />
              <span class="w-4 h-4 rounded flex items-center justify-center text-white text-[8px] font-bold"
                    :style="{ backgroundColor: d.color }">{{ d.id }}</span>
              {{ d.name }}
            </label>
          </div>
        </div>

        <!-- KPIs -->
        <div>
          <div class="flex items-center justify-between">
            <label class="text-xs font-medium text-gray-600">Process KPIs</label>
            <button type="button" @click="addKpi" class="text-xs text-primary-600 hover:text-primary-800">+ Add KPI</button>
          </div>
          <div v-for="(kpi, i) in form.kpis" :key="i" class="mt-2 flex flex-wrap items-center gap-2">
            <input v-model="kpi.name" placeholder="Name" class="flex-1 border border-surface-200 rounded px-2 py-1 text-xs" />
            <input v-model="kpi.current" placeholder="Ist" class="w-14 border border-surface-200 rounded px-2 py-1 text-xs text-right" />
            <input v-model="kpi.target" placeholder="Soll" class="w-14 border border-surface-200 rounded px-2 py-1 text-xs text-right" />
            <input v-model="kpi.unit" placeholder="%" class="w-10 border border-surface-200 rounded px-2 py-1 text-xs" />
            <select v-model="kpi.trend" class="w-16 border border-surface-200 rounded px-1 py-1 text-xs">
              <option v-for="t in trendOptions" :key="t" :value="t">{{ t }}</option>
            </select>
            <button @click="form.kpis.splice(i, 1)" class="text-red-400 hover:text-red-600 text-xs">‚úï</button>
          </div>
        </div>

        <!-- Actions -->
        <div class="flex justify-end gap-3 pt-2">
          <button @click="$emit('close')" class="px-4 py-2 text-sm border border-surface-200 rounded-lg hover:bg-surface-50">Cancel</button>
          <button @click="save" :disabled="!form.id || !form.name" class="px-4 py-2 text-sm bg-primary-600 text-white rounded-lg hover:bg-primary-700 disabled:opacity-40">Save</button>
        </div>
      </div>
    </div>
  `,
  setup (props, { emit }) {
    const { ref, onMounted } = Vue
    const statusOptions = (store.data.enums?.processStatus || ['active', 'optimization', 'transformation'])
    const trendOptions = (store.data.enums?.kpiTrend || ['improving', 'stable', 'declining'])

    const form = ref({
      id: '', name: '', owner: '', description: '', status: 'active', domains: [], kpis: []
    })

    onMounted(() => {
      if (props.editProcess) {
        const p = props.editProcess
        form.value = {
          id: p.id,
          name: p.name,
          owner: p.owner || '',
          description: p.description || '',
          status: p.status || 'active',
          domains: [...(p.domains || [])],
          kpis: (p.kpis || []).map(k => ({ ...k }))
        }
      }
    })

    function addKpi () {
      const idx = form.value.kpis.length + 1
      form.value.kpis.push({ id: 'PKI-' + idx, name: '', current: '', target: '', unit: '%', trend: 'stable' })
    }

    function save () {
      const f = form.value
      const data = {
        id: f.id, name: f.name, owner: f.owner, description: f.description,
        status: f.status, domains: f.domains,
        kpis: f.kpis.map((k, i) => ({ ...k, id: k.id || ('PKI-' + (i + 1)), current: Number(k.current) || k.current, target: Number(k.target) || k.target }))
      }
      if (props.editProcess) {
        store.updateProcess(data.id, data)
      } else {
        store.addProcess(data)
      }
      emit('saved')
    }

    return { store, form, statusOptions, trendOptions, addKpi, save }
  }
}


// ‚îÄ‚îÄ VendorForm (vendor-form.js) ‚îÄ‚îÄ
// vendor-form.js ‚Äî Modal form for creating/editing a vendor

const VendorForm = {
  name: 'VendorForm',
  props: { editVendor: { type: Object, default: null } },
  emits: ['close', 'saved'],
  template: `
    <div class="fixed inset-0 z-50 flex items-center justify-center bg-black/40" @click.self="$emit('close')">
      <div class="bg-white rounded-2xl shadow-xl w-full max-w-lg mx-4 max-h-[90vh] overflow-y-auto">
        <div class="px-6 py-4 border-b border-surface-200 flex items-center justify-between">
          <h3 class="text-base font-semibold text-gray-900">{{ editVendor ? 'Edit Vendor' : 'New Vendor' }}</h3>
          <button @click="$emit('close')" class="text-gray-400 hover:text-gray-600 text-xl">&times;</button>
        </div>
        <form @submit.prevent="save" class="px-6 py-4 space-y-4">
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
            <div class="sm:col-span-2">
              <label class="block text-xs font-medium text-gray-600 mb-1">Vendor Name *</label>
              <input v-model="form.name" required class="w-full px-3 py-2 border border-surface-200 rounded-lg text-sm focus:ring-2 focus:ring-primary-300 outline-none" />
            </div>
            <div>
              <label class="block text-xs font-medium text-gray-600 mb-1">Category</label>
              <input v-model="form.category" class="w-full px-3 py-2 border border-surface-200 rounded-lg text-sm focus:ring-2 focus:ring-primary-300 outline-none" placeholder="e.g. ERP, Cloud, Security" />
            </div>
            <div>
              <label class="block text-xs font-medium text-gray-600 mb-1">Status</label>
              <select v-model="form.status" class="w-full px-3 py-2 border border-surface-200 rounded-lg text-sm bg-white focus:ring-2 focus:ring-primary-300 outline-none">
                <option v-for="s in store.data.enums.vendorStatus" :key="s" :value="s">{{ s }}</option>
              </select>
            </div>
            <div>
              <label class="block text-xs font-medium text-gray-600 mb-1">Criticality</label>
              <select v-model="form.criticality" class="w-full px-3 py-2 border border-surface-200 rounded-lg text-sm bg-white focus:ring-2 focus:ring-primary-300 outline-none">
                <option v-for="c in store.data.enums.vendorCriticality" :key="c" :value="c">{{ c }}</option>
              </select>
            </div>
            <div>
              <label class="block text-xs font-medium text-gray-600 mb-1">Service Level</label>
              <input v-model="form.serviceLevel" class="w-full px-3 py-2 border border-surface-200 rounded-lg text-sm focus:ring-2 focus:ring-primary-300 outline-none" placeholder="e.g. Premium, Standard" />
            </div>
            <div>
              <label class="block text-xs font-medium text-gray-600 mb-1">Contract Value / Year (‚Ç¨)</label>
              <input v-model.number="form.contractValue" type="number" min="0" class="w-full px-3 py-2 border border-surface-200 rounded-lg text-sm focus:ring-2 focus:ring-primary-300 outline-none" />
            </div>
            <div>
              <label class="block text-xs font-medium text-gray-600 mb-1">Contract End</label>
              <input v-model="form.contractEnd" type="date" class="w-full px-3 py-2 border border-surface-200 rounded-lg text-sm focus:ring-2 focus:ring-primary-300 outline-none" />
            </div>
            <div>
              <label class="block text-xs font-medium text-gray-600 mb-1">Contact Person</label>
              <input v-model="form.contactPerson" class="w-full px-3 py-2 border border-surface-200 rounded-lg text-sm focus:ring-2 focus:ring-primary-300 outline-none" />
            </div>
            <div>
              <label class="block text-xs font-medium text-gray-600 mb-1">Vendor Manager</label>
              <input v-model="form.vendorManager" class="w-full px-3 py-2 border border-surface-200 rounded-lg text-sm focus:ring-2 focus:ring-primary-300 outline-none" />
            </div>
            <div>
              <label class="block text-xs font-medium text-gray-600 mb-1">Website</label>
              <input v-model="form.website" class="w-full px-3 py-2 border border-surface-200 rounded-lg text-sm focus:ring-2 focus:ring-primary-300 outline-none" placeholder="https://..." />
            </div>
            <div>
              <label class="block text-xs font-medium text-gray-600 mb-1">Rating (1-10)</label>
              <input v-model.number="form.rating" type="number" min="1" max="10" class="w-full px-3 py-2 border border-surface-200 rounded-lg text-sm focus:ring-2 focus:ring-primary-300 outline-none" />
            </div>
            <div class="sm:col-span-2">
              <label class="block text-xs font-medium text-gray-600 mb-1">Description</label>
              <textarea v-model="form.description" rows="3" class="w-full px-3 py-2 border border-surface-200 rounded-lg text-sm focus:ring-2 focus:ring-primary-300 outline-none resize-vertical"></textarea>
            </div>
          </div>
          <div class="flex justify-end gap-3 pt-2">
            <button type="button" @click="$emit('close')" class="px-4 py-2 border border-gray-300 rounded-lg text-sm text-gray-700 hover:bg-surface-100">Cancel</button>
            <button type="submit" class="px-4 py-2 bg-primary-600 text-white rounded-lg text-sm hover:bg-primary-700">{{ editVendor ? 'Update' : 'Create' }}</button>
          </div>
        </form>
      </div>
    </div>
  `,
  setup (props, { emit }) {
    const { ref, onMounted } = Vue

    const defaultForm = () => ({
      name: '', category: '', status: 'Active',
      criticality: 'Standard', serviceLevel: '',
      contractValue: 0, contractEnd: '',
      contactPerson: '', vendorManager: '',
      website: '', rating: 5, description: ''
    })

    const form = ref(defaultForm())

    onMounted(() => {
      if (props.editVendor) {
        form.value = {
          ...defaultForm(),
          ...props.editVendor
        }
      }
    })

    function save () {
      const data = { ...form.value }
      if (props.editVendor) {
        store.updateVendor(props.editVendor.id, data)
      } else {
        store.addVendor(data)
      }
      emit('saved')
    }

    return { store, form, save }
  }
}


// ‚îÄ‚îÄ DashboardView (dashboard.js) ‚îÄ‚îÄ
// dashboard.js ‚Äî KPI cards, charts, quick stats

const DashboardView = {
  name: 'DashboardView',
  template: `
    <div class="space-y-6">
      <!-- KPI Cards Row -->
      <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4">
        <div v-for="kpi in kpis" :key="kpi.label"
             class="bg-white rounded-xl border border-surface-200 p-4 hover:shadow-md transition-shadow">
          <div class="text-xs font-medium text-gray-500 uppercase tracking-wide">{{ kpi.label }}</div>
          <div class="mt-1 text-2xl font-bold" :style="{ color: kpi.color || '#1e293b' }">{{ kpi.value }}</div>
          <div v-if="kpi.sub" class="text-xs text-gray-400 mt-0.5">{{ kpi.sub }}</div>
        </div>
      </div>

      <!-- Charts Row -->
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <!-- Management KPIs -->
        <div v-if="mgmtKpis.length" class="bg-white rounded-xl border border-surface-200 p-5 lg:col-span-2">
          <h3 class="text-sm font-semibold text-gray-700 mb-4">Management KPIs</h3>
          <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-4">
            <div v-for="kpi in mgmtKpis" :key="kpi.id" class="border border-surface-200 rounded-lg p-4">
              <div class="flex items-center justify-between mb-2">
                <span class="text-xs font-medium text-gray-700 line-clamp-1">{{ kpi.name }}</span>
                <span class="text-[10px] px-1.5 py-0.5 rounded-full"
                      :class="mgmtTrendClass(kpi.trend)">{{ mgmtTrendIcon(kpi.trend) }}</span>
              </div>
              <div class="flex items-baseline gap-1">
                <span class="text-xl font-bold" :style="{ color: mgmtKpiColor(kpi) }">{{ kpi.current }}</span>
                <span class="text-xs text-gray-400">/ {{ kpi.target }} {{ kpi.unit }}</span>
              </div>
              <div class="mt-2 w-full h-1.5 bg-surface-100 rounded-full overflow-hidden">
                <div class="h-full rounded-full" :style="{ width: mgmtKpiPct(kpi) + '%', backgroundColor: mgmtKpiColor(kpi) }"></div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <!-- TIME Distribution Pie -->
        <div class="bg-white rounded-xl border border-surface-200 p-5">
          <h3 class="text-sm font-semibold text-gray-700 mb-4">TIME Distribution</h3>
          <div class="h-64 flex items-center justify-center">
            <canvas ref="timeChartCanvas"></canvas>
          </div>
        </div>

        <!-- Maturity by Domain Bar -->
        <div class="bg-white rounded-xl border border-surface-200 p-5">
          <h3 class="text-sm font-semibold text-gray-700 mb-4">Avg Maturity by Domain</h3>
          <div class="h-64">
            <canvas ref="maturityChartCanvas"></canvas>
          </div>
        </div>
      </div>

      <!-- Second Charts Row -->
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <!-- Project Status -->
        <div class="bg-white rounded-xl border border-surface-200 p-5">
          <h3 class="text-sm font-semibold text-gray-700 mb-4">Project Status Overview</h3>
          <div class="h-48">
            <canvas ref="projectStatusCanvas"></canvas>
          </div>
        </div>

        <!-- Project Budget by Category -->
        <div class="bg-white rounded-xl border border-surface-200 p-5">
          <h3 class="text-sm font-semibold text-gray-700 mb-4">Budget by Category</h3>
          <div class="h-48">
            <canvas ref="budgetChartCanvas"></canvas>
          </div>
        </div>
      </div>

      <!-- Quick Lists -->
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <!-- Eliminate Apps -->
        <div class="bg-white rounded-xl border border-surface-200 p-5">
          <h3 class="text-sm font-semibold text-gray-700 mb-3">
            <span class="inline-block w-2.5 h-2.5 rounded-full bg-red-500 mr-2"></span>
            Applications to Eliminate
          </h3>
          <div v-if="eliminateApps.length === 0" class="text-sm text-gray-400 italic">None</div>
          <div v-for="app in eliminateApps" :key="app.id" class="flex items-center justify-between py-2 border-b border-surface-100 last:border-0">
            <a :href="linkTo('/apps/' + app.id)" class="text-sm text-primary-600 hover:underline">{{ app.name }}</a>
            <span class="text-xs text-gray-400">{{ app.category }}</span>
          </div>
        </div>

        <!-- Yellow/Red Projects -->
        <div class="bg-white rounded-xl border border-surface-200 p-5">
          <h3 class="text-sm font-semibold text-gray-700 mb-3">
            <span class="inline-block w-2.5 h-2.5 rounded-full bg-yellow-500 mr-2"></span>
            Projects Needing Attention
          </h3>
          <div v-if="attentionProjects.length === 0" class="text-sm text-gray-400 italic">All green</div>
          <div v-for="p in attentionProjects" :key="p.id" class="flex items-center justify-between py-2 border-b border-surface-100 last:border-0">
            <a :href="linkTo('/projects/' + p.id)" class="text-sm text-primary-600 hover:underline">{{ p.name }}</a>
            <span class="text-xs px-2 py-0.5 rounded-full"
                  :class="p.status === 'red' ? 'bg-red-100 text-red-700' : 'bg-yellow-100 text-yellow-700'">
              {{ p.statusText }}
            </span>
          </div>
        </div>
      </div>
    </div>
  `,
  setup () {
    const { ref, computed, onMounted, nextTick } = Vue

    const timeChartCanvas = ref(null)
    const maturityChartCanvas = ref(null)
    const projectStatusCanvas = ref(null)
    const budgetChartCanvas = ref(null)

    const kpis = computed(() => [
      { label: 'Domains', value: store.data.domains.length, color: '#3b82f6' },
      { label: 'Capabilities', value: store.totalCapabilities, sub: store.totalSubCapabilities + ' L2' },
      { label: 'Applications', value: store.totalApps },
      { label: 'Vendors', value: store.totalVendors },
      { label: 'Projects', value: store.totalProjects },
      { label: 'Demands', value: store.totalDemands, color: '#8b5cf6' },
      { label: 'Avg Maturity', value: store.avgMaturity + '/5', color: store.avgMaturity >= 3 ? '#10b981' : '#f59e0b' },
      { label: 'Total Budget', value: '‚Ç¨' + (store.totalBudget / 1000).toFixed(0) + 'k', color: '#6366f1' }
    ])

    const eliminateApps = computed(() =>
      store.data.applications.filter(a => a.timeQuadrant === 'Eliminate')
    )

    const mgmtKpis = computed(() => store.data.managementKPIs || [])

    function mgmtTrendClass (t) {
      return { improving: 'bg-green-100 text-green-700', stable: 'bg-gray-100 text-gray-600', declining: 'bg-red-100 text-red-700' }[t] || 'bg-gray-100 text-gray-600'
    }
    function mgmtTrendIcon (t) { return { improving: '‚Üë', stable: '‚Üí', declining: '‚Üì' }[t] || '‚Üí' }
    function mgmtKpiPct (kpi) { const c = parseFloat(kpi.current) || 0; const t = parseFloat(kpi.target) || 1; return Math.min(100, (c / t) * 100) }
    function mgmtKpiColor (kpi) { const p = mgmtKpiPct(kpi); if (p >= 80) return '#10b981'; if (p >= 50) return '#f59e0b'; return '#ef4444' }

    const attentionProjects = computed(() =>
      store.data.projects.filter(p => p.status === 'yellow' || p.status === 'red')
    )

    function renderCharts () {
      // TIME Pie
      if (timeChartCanvas.value) {
        const dist = store.timeDistribution
        new Chart(timeChartCanvas.value, {
          type: 'doughnut',
          data: {
            labels: Object.keys(dist),
            datasets: [{
              data: Object.values(dist),
              backgroundColor: ['#f59e0b', '#10b981', '#3b82f6', '#ef4444']
            }]
          },
          options: {
            responsive: true, maintainAspectRatio: false,
            plugins: { legend: { position: window.innerWidth < 640 ? 'bottom' : 'right', labels: { usePointStyle: true, padding: 16 } } }
          }
        })
      }

      // Maturity Bar
      if (maturityChartCanvas.value) {
        const domains = store.data.domains
        const labels = domains.map(d => d.name.length > 18 ? d.name.slice(0, 18) + '‚Ä¶' : d.name)
        const data = domains.map(d => {
          const caps = d.capabilities
          return caps.length ? +(caps.reduce((s, c) => s + c.maturity, 0) / caps.length).toFixed(1) : 0
        })
        new Chart(maturityChartCanvas.value, {
          type: 'bar',
          data: {
            labels,
            datasets: [{
              data,
              backgroundColor: domains.map(d => d.color + 'CC'),
              borderColor: domains.map(d => d.color),
              borderWidth: 1,
              borderRadius: 4
            }]
          },
          options: {
            responsive: true, maintainAspectRatio: false, indexAxis: 'y',
            scales: { x: { min: 0, max: 5, ticks: { stepSize: 1 } } },
            plugins: { legend: { display: false } }
          }
        })
      }

      // Project Status Doughnut
      if (projectStatusCanvas.value) {
        const sc = store.projectStatusCounts
        new Chart(projectStatusCanvas.value, {
          type: 'doughnut',
          data: {
            labels: ['Green', 'Yellow', 'Red'],
            datasets: [{
              data: [sc.green, sc.yellow, sc.red],
              backgroundColor: ['#22c55e', '#eab308', '#ef4444']
            }]
          },
          options: {
            responsive: true, maintainAspectRatio: false,
            plugins: { legend: { position: window.innerWidth < 640 ? 'bottom' : 'right', labels: { usePointStyle: true, padding: 16 } } }
          }
        })
      }

      // Budget by Category Bar
      if (budgetChartCanvas.value) {
        const cats = {}
        store.data.projects.forEach(p => {
          cats[p.category] = (cats[p.category] || 0) + (p.budget || 0)
        })
        const colors = { 'Run / Pflicht': '#64748b', 'Modernisierung': '#3b82f6', 'Optimierung': '#10b981', 'Innovation / Grow': '#8b5cf6', 'Infrastruktur': '#f97316' }
        new Chart(budgetChartCanvas.value, {
          type: 'bar',
          data: {
            labels: Object.keys(cats),
            datasets: [{
              data: Object.values(cats).map(v => v / 1000),
              backgroundColor: Object.keys(cats).map(k => colors[k] || '#94a3b8'),
              borderRadius: 4
            }]
          },
          options: {
            responsive: true, maintainAspectRatio: false,
            scales: { y: { beginAtZero: true, ticks: { callback: v => '‚Ç¨' + v + 'k' } } },
            plugins: { legend: { display: false } }
          }
        })
      }
    }

    onMounted(() => { nextTick(renderCharts) })

    return { store, linkTo, kpis, eliminateApps, attentionProjects, mgmtKpis, mgmtTrendClass, mgmtTrendIcon, mgmtKpiPct, mgmtKpiColor, timeChartCanvas, maturityChartCanvas, projectStatusCanvas, budgetChartCanvas }
  }
}


// ‚îÄ‚îÄ SettingsView (settings.js) ‚îÄ‚îÄ
// settings.js ‚Äî Import/export JSON, reset to seed data

const SettingsView = {
  name: 'SettingsView',
  template: `
    <div class="max-w-2xl space-y-8">
      <!-- Data Management -->
      <section class="bg-white rounded-xl border border-surface-200 p-6">
        <h2 class="text-base font-semibold text-gray-800 mb-4">Data Management</h2>
        <div class="space-y-4">
          <!-- Export -->
          <div class="flex items-center justify-between">
            <div>
              <div class="text-sm font-medium text-gray-700">Export Data</div>
              <div class="text-xs text-gray-500">Download the entire dataset as a JSON file</div>
            </div>
            <button @click="doExport"
                    class="px-4 py-2 bg-primary-600 text-white rounded-lg text-sm hover:bg-primary-700 transition-colors">
              Export JSON
            </button>
          </div>

          <!-- Import -->
          <div class="flex items-center justify-between border-t border-surface-100 pt-4">
            <div>
              <div class="text-sm font-medium text-gray-700">Import Data</div>
              <div class="text-xs text-gray-500">Replace current data with a JSON file</div>
            </div>
            <label class="px-4 py-2 border border-gray-300 text-gray-700 rounded-lg text-sm hover:bg-surface-100 cursor-pointer transition-colors">
              Import JSON
              <input type="file" accept=".json" @change="doImport" class="hidden" />
            </label>
          </div>

          <!-- Reset -->
          <div class="flex items-center justify-between border-t border-surface-100 pt-4">
            <div>
              <div class="text-sm font-medium text-red-600">Reset to Seed Data</div>
              <div class="text-xs text-gray-500">Discard all changes and reload the original dataset</div>
            </div>
            <button @click="confirmReset"
                    class="px-4 py-2 border border-red-300 text-red-600 rounded-lg text-sm hover:bg-red-50 transition-colors">
              Reset
            </button>
          </div>
        </div>
      </section>

      <!-- Data Statistics -->
      <section class="bg-white rounded-xl border border-surface-200 p-6">
        <h2 class="text-base font-semibold text-gray-800 mb-4">Data Statistics</h2>
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 text-sm">
          <div v-for="stat in stats" :key="stat.label" class="flex justify-between py-1">
            <span class="text-gray-500">{{ stat.label }}</span>
            <span class="font-medium text-gray-800">{{ stat.value }}</span>
          </div>
        </div>
      </section>

      <!-- About -->
      <section class="bg-white rounded-xl border border-surface-200 p-6">
        <h2 class="text-base font-semibold text-gray-800 mb-3">About</h2>
        <div class="text-sm text-gray-600 space-y-1">
          <p><strong>Version:</strong> {{ store.data.meta.version }}</p>
          <p><strong>Company:</strong> {{ store.data.meta.company }}</p>
          <p><strong>Owner:</strong> {{ store.data.meta.owner }}</p>
          <p><strong>Last Updated:</strong> {{ store.data.meta.lastUpdated }}</p>
        </div>
        <div class="mt-4 text-xs text-gray-400">
          Built with Vue 3, Tailwind CSS, Chart.js, D3.js. Data stored in localStorage.
        </div>
      </section>

      <!-- Toast -->
      <div v-if="toast" class="fixed bottom-6 right-6 px-4 py-3 rounded-lg shadow-lg text-sm text-white z-50 transition-opacity"
           :class="toast.type === 'success' ? 'bg-green-600' : 'bg-red-600'">
        {{ toast.message }}
      </div>
    </div>
  `,
  setup () {
    const { ref, computed } = Vue
    const toast = ref(null)

    function showToast (message, type = 'success') {
      toast.value = { message, type }
      setTimeout(() => { toast.value = null }, 3000)
    }

    const stats = computed(() => [
      { label: 'Domains', value: store.data.domains.length },
      { label: 'L1 Capabilities', value: store.totalCapabilities },
      { label: 'L2 Sub-Capabilities', value: store.totalSubCapabilities },
      { label: 'Applications', value: store.totalApps },
      { label: 'Capability Mappings', value: store.data.capabilityMappings.length },
      { label: 'Projects', value: store.totalProjects },
      { label: 'Dependencies', value: store.data.projectDependencies.length },
      { label: 'localStorage Size', value: (() => {
        const s = localStorage.getItem('ea-bebauungsplan-v1')
        return s ? (s.length / 1024).toFixed(1) + ' KB' : '‚Äî'
      })() }
    ])

    function doExport () {
      exportJSON()
      showToast('Data exported successfully')
    }

    async function doImport (e) {
      const file = e.target.files[0]
      if (!file) return
      try {
        await importJSON(file)
        showToast('Data imported successfully')
      } catch (err) {
        showToast('Import failed: ' + err.message, 'error')
      }
      e.target.value = ''
    }

    function confirmReset () {
      if (confirm('Are you sure? This will discard all changes and reload the original seed data.')) {
        resetToSeed().then(() => showToast('Reset to seed data'))
      }
    }

    return { store, stats, toast, doExport, doImport, confirmReset }
  }
}


// ‚îÄ‚îÄ DomainList (domain-list.js) ‚îÄ‚îÄ
// domain-list.js ‚Äî Grid of all capability domains with strategy info

const DomainList = {
  name: 'DomainList',
  template: `
    <div class="space-y-6">
      <!-- Header with Add button -->
      <div class="flex items-center justify-between">
        <div></div>
        <button @click="showDomainForm = true" class="px-4 py-2 bg-primary-600 text-white text-sm rounded-lg hover:bg-primary-700">+ Add Domain</button>
      </div>

      <!-- Domain Grid -->
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-5">
        <a v-for="domain in store.data.domains" :key="domain.id"
           :href="linkTo('/domains/' + domain.id)"
           class="bg-white rounded-xl border border-surface-200 p-5 hover:shadow-lg transition-all group">
          <!-- Domain Header -->
          <div class="flex items-center gap-3 mb-3">
            <div class="w-10 h-10 rounded-lg flex items-center justify-center text-white text-sm font-bold"
                 :style="{ backgroundColor: domain.color }">
              {{ domain.id }}
            </div>
            <div class="flex-1 min-w-0">
              <div class="text-sm font-semibold text-gray-900 truncate group-hover:text-primary-600">{{ domain.name }}</div>
              <div class="text-xs text-gray-400">{{ domain.capabilities.length }} capabilities</div>
            </div>
          </div>

          <!-- Owner badge -->
          <div v-if="domain.domainOwner" class="mb-2">
            <span class="text-[10px] px-2 py-0.5 rounded-full bg-surface-100 text-gray-500">{{ domain.domainOwner }}</span>
          </div>

          <!-- Maturity Overview -->
          <div class="space-y-1.5 mb-3">
            <div v-for="cap in domain.capabilities" :key="cap.id" class="flex items-center gap-2">
              <span class="text-[10px] text-gray-500 w-7 shrink-0">{{ cap.id }}</span>
              <span class="text-xs text-gray-600 flex-1 truncate">{{ cap.name }}</span>
              <div class="w-16 h-1.5 bg-surface-100 rounded-full shrink-0 overflow-hidden relative">
                <div class="maturity-bar" :style="{ width: (cap.maturity / 5 * 100) + '%', backgroundColor: maturityColor(cap.maturity) }"></div>
              </div>
              <span class="text-[10px] text-gray-400 w-3 text-right">{{ cap.maturity }}</span>
            </div>
          </div>

          <!-- Stats Row -->
          <div class="flex items-center justify-between text-xs text-gray-400 pt-2 border-t border-surface-100">
            <span>Ist: {{ avgMaturity(domain) }}/5</span>
            <span v-if="avgGap(domain) > 0" class="text-indigo-500 font-medium">Gap: {{ avgGap(domain) }}</span>
            <span>{{ appCount(domain) }} apps</span>
          </div>
        </a>
      </div>

      <!-- Legend -->
      <div class="flex flex-wrap items-center gap-4 sm:gap-6 text-xs text-gray-500">
        <span class="font-medium">Maturity:</span>
        <span class="flex items-center gap-1"><span class="w-3 h-3 rounded bg-red-400"></span> 1 Initial</span>
        <span class="flex items-center gap-1"><span class="w-3 h-3 rounded bg-orange-400"></span> 2 Managed</span>
        <span class="flex items-center gap-1"><span class="w-3 h-3 rounded bg-yellow-400"></span> 3 Defined</span>
        <span class="flex items-center gap-1"><span class="w-3 h-3 rounded bg-lime-500"></span> 4 Measured</span>
        <span class="flex items-center gap-1"><span class="w-3 h-3 rounded bg-emerald-500"></span> 5 Optimized</span>
      </div>

      <!-- Add Domain Modal -->
      <domain-form v-if="showDomainForm" @close="showDomainForm = false" @saved="showDomainForm = false" />
    </div>
  `,
  setup () {
    const { ref } = Vue
    const showDomainForm = ref(false)

    function maturityColor (m) {
      const colors = { 1: '#f87171', 2: '#fb923c', 3: '#facc15', 4: '#a3e635', 5: '#34d399' }
      return colors[m] || '#94a3b8'
    }

    function avgMaturity (domain) {
      const caps = domain.capabilities
      if (!caps.length) return 0
      return (caps.reduce((s, c) => s + c.maturity, 0) / caps.length).toFixed(1)
    }

    function avgGap (domain) {
      const caps = domain.capabilities
      if (!caps.length) return 0
      const gapSum = caps.reduce((s, c) => s + ((c.targetMaturity || c.maturity) - c.maturity), 0)
      return (gapSum / caps.length).toFixed(1)
    }

    function appCount (domain) {
      const capIds = domain.capabilities.map(c => c.id)
      const appIds = new Set(
        store.data.capabilityMappings
          .filter(m => capIds.includes(m.capabilityId))
          .map(m => m.applicationId)
      )
      return appIds.size
    }

    return { store, linkTo, showDomainForm, maturityColor, avgMaturity, avgGap, appCount }
  }
}


// ‚îÄ‚îÄ DomainDetail (domain-detail.js) ‚îÄ‚îÄ
// domain-detail.js ‚Äî Domain drill-down: strategy, KPIs, capabilities with Ist/Soll, mapped apps, projects

const DomainDetail = {
  name: 'DomainDetail',
  template: `
    <div v-if="domain" class="space-y-6">
      <!-- Back link -->
      <div class="flex items-center gap-4">
        <a :href="linkTo('/domains')" class="text-sm text-gray-500 hover:text-primary-600">‚Üê Domains</a>
      </div>

      <!-- Header -->
      <div class="flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3">
        <div class="flex items-center gap-4">
          <div class="w-14 h-14 rounded-xl flex items-center justify-center text-white text-xl font-bold"
               :style="{ backgroundColor: domain.color }">
            {{ domain.id }}
          </div>
          <div>
            <h2 class="text-xl font-bold text-gray-900">{{ domain.name }}</h2>
            <p class="text-sm text-gray-500">{{ domain.description }}</p>
            <div v-if="domain.domainOwner" class="mt-1 flex items-center gap-2">
              <span class="text-xs px-2 py-0.5 rounded-full bg-surface-100 text-gray-600">Owner: {{ domain.domainOwner }}</span>
            </div>
          </div>
        </div>
        <div class="flex items-center gap-2 shrink-0">
          <button @click="showDomainForm = true" class="px-3 py-1.5 text-xs bg-primary-600 text-white rounded-lg hover:bg-primary-700">Edit Domain</button>
          <button @click="deleteDomain" class="px-3 py-1.5 text-xs border border-red-300 text-red-600 rounded-lg hover:bg-red-50">Delete</button>
        </div>
      </div>

      <!-- Stats Row -->
      <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-5 gap-4">
        <div class="bg-white rounded-xl border border-surface-200 p-4 text-center">
          <div class="text-2xl font-bold" :style="{ color: domain.color }">{{ domain.capabilities.length }}</div>
          <div class="text-xs text-gray-500">Capabilities</div>
        </div>
        <div class="bg-white rounded-xl border border-surface-200 p-4 text-center">
          <div class="text-2xl font-bold text-gray-700">{{ subCapCount }}</div>
          <div class="text-xs text-gray-500">Sub-Capabilities</div>
        </div>
        <div class="bg-white rounded-xl border border-surface-200 p-4 text-center">
          <div class="text-2xl font-bold" :style="{ color: avgMat >= 3 ? '#10b981' : '#f59e0b' }">{{ avgMat }}/5</div>
          <div class="text-xs text-gray-500">Avg Maturity (Ist)</div>
        </div>
        <div class="bg-white rounded-xl border border-surface-200 p-4 text-center">
          <div class="text-2xl font-bold text-indigo-600">{{ avgTarget }}/5</div>
          <div class="text-xs text-gray-500">Avg Target (Soll)</div>
        </div>
        <div class="bg-white rounded-xl border border-surface-200 p-4 text-center">
          <div class="text-2xl font-bold text-primary-600">{{ mappedAppIds.size }}</div>
          <div class="text-xs text-gray-500">Mapped Apps</div>
        </div>
      </div>

      <!-- Strategy & Vision -->
      <div v-if="domain.strategicFocus || domain.vision" class="bg-white rounded-xl border border-surface-200 overflow-hidden">
        <div class="px-5 py-3 border-b border-surface-200 bg-surface-50">
          <h3 class="text-sm font-semibold text-gray-700">Strategy & Vision</h3>
        </div>
        <div class="p-5 grid grid-cols-1 md:grid-cols-2 gap-4">
          <div v-if="domain.strategicFocus">
            <div class="text-xs font-medium text-gray-500 uppercase tracking-wide mb-1">Strategic Focus</div>
            <p class="text-sm text-gray-800">{{ domain.strategicFocus }}</p>
          </div>
          <div v-if="domain.vision">
            <div class="text-xs font-medium text-gray-500 uppercase tracking-wide mb-1">Vision</div>
            <p class="text-sm text-gray-800">{{ domain.vision }}</p>
          </div>
        </div>
      </div>

      <!-- Domain KPIs -->
      <div v-if="domain.kpis && domain.kpis.length" class="bg-white rounded-xl border border-surface-200 overflow-hidden">
        <div class="px-5 py-3 border-b border-surface-200 bg-surface-50">
          <h3 class="text-sm font-semibold text-gray-700">Domain KPIs</h3>
        </div>
        <div class="p-5 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
          <div v-for="kpi in domain.kpis" :key="kpi.id" class="border border-surface-200 rounded-lg p-4">
            <div class="flex items-center justify-between mb-2">
              <span class="text-xs font-medium text-gray-700">{{ kpi.name }}</span>
              <span class="text-[10px] px-1.5 py-0.5 rounded-full"
                    :class="trendClass(kpi.trend)">
                {{ trendIcon(kpi.trend) }}
              </span>
            </div>
            <div class="flex items-baseline gap-2">
              <span class="text-2xl font-bold" :style="{ color: kpiColor(kpi) }">{{ kpi.current }}</span>
              <span class="text-xs text-gray-400">/ {{ kpi.target }} {{ kpi.unit }}</span>
            </div>
            <div class="mt-2 w-full h-1.5 bg-surface-100 rounded-full overflow-hidden">
              <div class="h-full rounded-full transition-all" :style="{ width: kpiProgress(kpi) + '%', backgroundColor: kpiColor(kpi) }"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Capabilities Table with Ist/Soll -->
      <div class="bg-white rounded-xl border border-surface-200 overflow-hidden">
        <div class="px-5 py-3 border-b border-surface-200 bg-surface-50 flex items-center justify-between">
          <h3 class="text-sm font-semibold text-gray-700">Capabilities</h3>
          <button @click="showCapForm = true; editCap = null" class="text-xs text-primary-600 hover:text-primary-800 font-medium">+ Add Capability</button>
        </div>
        <div class="divide-y divide-surface-100">
          <div v-for="cap in domain.capabilities" :key="cap.id" class="p-4">
            <div class="flex items-center justify-between mb-2">
              <div class="flex items-center gap-3">
                <span class="text-xs font-mono text-gray-500 bg-surface-100 px-2 py-0.5 rounded">{{ cap.id }}</span>
                <span class="text-sm font-medium text-gray-800">{{ cap.name }}</span>
                <span class="text-[10px] px-2 py-0.5 rounded-full"
                      :class="criticalityClass(cap.criticality)">{{ cap.criticality }}</span>
              </div>
              <div class="flex items-center gap-2">
                <button @click="editCap = cap; showCapForm = true" class="text-xs text-gray-400 hover:text-primary-600">Edit</button>
                <button @click="deleteCap(cap)" class="text-xs text-gray-400 hover:text-red-500">Delete</button>
              </div>
            </div>

            <!-- Ist/Soll double bar -->
            <div class="flex items-center gap-3 mb-2 ml-12">
              <div class="flex-1 relative">
                <div class="w-full h-2 bg-surface-100 rounded-full overflow-hidden">
                  <div class="maturity-bar h-full rounded-full" :style="{ width: (cap.maturity / 5 * 100) + '%', backgroundColor: maturityColor(cap.maturity) }"></div>
                </div>
                <div v-if="cap.targetMaturity && cap.targetMaturity !== cap.maturity"
                     class="absolute top-0 h-2 border-r-2 border-dashed border-indigo-500"
                     :style="{ left: (cap.targetMaturity / 5 * 100) + '%' }"></div>
              </div>
              <span class="text-xs text-gray-500 w-14 text-right">{{ cap.maturity }}/{{ cap.targetMaturity || cap.maturity }}</span>
              <button @click="adjustMaturity(cap, -1)" class="w-8 h-8 sm:w-5 sm:h-5 rounded text-xs bg-surface-100 hover:bg-surface-200 text-gray-500 flex items-center justify-center" :disabled="cap.maturity <= 1">‚àí</button>
              <button @click="adjustMaturity(cap, 1)" class="w-8 h-8 sm:w-5 sm:h-5 rounded text-xs bg-surface-100 hover:bg-surface-200 text-gray-500 flex items-center justify-center" :disabled="cap.maturity >= 5">+</button>
            </div>

            <!-- Sub-capabilities -->
            <div v-if="cap.subCapabilities && cap.subCapabilities.length" class="ml-12 mt-1 flex flex-wrap gap-1.5">
              <span v-for="sub in cap.subCapabilities" :key="sub.id"
                    class="text-[10px] px-2 py-0.5 bg-surface-100 text-gray-600 rounded">
                {{ sub.id }} {{ sub.name }}
              </span>
            </div>

            <!-- Capability KPIs -->
            <div v-if="cap.kpis && cap.kpis.length" class="ml-12 mt-2 flex flex-wrap gap-3">
              <div v-for="kpi in cap.kpis" :key="kpi.id" class="text-[10px] px-2 py-1 border border-surface-200 rounded bg-white">
                <span class="font-medium">{{ kpi.name }}:</span>
                <span :style="{ color: kpiColor(kpi) }"> {{ kpi.current }}</span> / {{ kpi.target }} {{ kpi.unit }}
              </div>
            </div>

            <!-- Mapped Applications -->
            <div v-if="appsForCap(cap.id).length" class="ml-12 mt-2 flex flex-wrap gap-1.5">
              <a v-for="app in appsForCap(cap.id)" :key="app.id"
                 :href="linkTo('/apps/' + app.id)"
                 class="text-[10px] px-2 py-0.5 rounded border hover:bg-primary-50 transition-colors"
                 :class="app.role === 'Primary' ? 'border-primary-300 text-primary-700 bg-primary-50' : 'border-gray-300 text-gray-600'">
                {{ app.name }} ({{ app.role }})
              </a>
            </div>
          </div>
        </div>
      </div>

      <!-- E2E Processes for this domain -->
      <div v-if="relatedProcesses.length" class="bg-white rounded-xl border border-surface-200 overflow-hidden">
        <div class="px-5 py-3 border-b border-surface-200 bg-surface-50">
          <h3 class="text-sm font-semibold text-gray-700">Related E2E Processes</h3>
        </div>
        <div class="divide-y divide-surface-100">
          <a v-for="proc in relatedProcesses" :key="proc.id" :href="linkTo('/processes/' + proc.id)"
             class="flex items-center justify-between px-5 py-3 hover:bg-surface-50 transition-colors">
            <div class="flex items-center gap-3">
              <span class="text-xs font-mono text-gray-500 bg-surface-100 px-2 py-0.5 rounded">{{ proc.id }}</span>
              <span class="text-sm text-gray-800">{{ proc.name }}</span>
            </div>
            <div class="flex items-center gap-3 text-xs text-gray-400">
              <span class="px-2 py-0.5 rounded-full"
                    :class="procStatusClass(proc.status)">{{ proc.status }}</span>
              <span>{{ proc.kpis ? proc.kpis.length : 0 }} KPIs</span>
            </div>
          </a>
        </div>
      </div>

      <!-- Related Projects -->
      <div v-if="relatedProjects.length" class="bg-white rounded-xl border border-surface-200 overflow-hidden">
        <div class="px-5 py-3 border-b border-surface-200 bg-surface-50">
          <h3 class="text-sm font-semibold text-gray-700">Related Projects</h3>
        </div>
        <div class="divide-y divide-surface-100">
          <a v-for="p in relatedProjects" :key="p.id" :href="linkTo('/projects/' + p.id)"
             class="flex items-center justify-between px-5 py-3 hover:bg-surface-50 transition-colors">
            <div class="flex items-center gap-3">
              <span class="w-2.5 h-2.5 rounded-full" :class="statusDot(p.status)"></span>
              <span class="text-sm text-gray-800">{{ p.name }}</span>
            </div>
            <div class="flex items-center gap-4 text-xs text-gray-400">
              <span>{{ p.category }}</span>
              <span>‚Ç¨{{ (p.budget / 1000).toFixed(0) }}k</span>
            </div>
          </a>
        </div>
      </div>

      <!-- Modals -->
      <domain-form v-if="showDomainForm" :edit-domain="domain" @close="showDomainForm = false" @saved="showDomainForm = false" />
      <capability-form v-if="showCapForm" :edit-capability="editCap" :domain-id="domain.id" @close="showCapForm = false; editCap = null" @saved="showCapForm = false; editCap = null" />
    </div>
    <div v-else class="text-center py-12 text-gray-500">Domain not found.</div>
  `,
  setup () {
    const { ref, computed } = Vue

    const showDomainForm = ref(false)
    const showCapForm = ref(false)
    const editCap = ref(null)

    const domain = computed(() => store.domainById(router.params.id))

    const subCapCount = computed(() => {
      if (!domain.value) return 0
      return domain.value.capabilities.reduce((n, c) => n + (c.subCapabilities ? c.subCapabilities.length : 0), 0)
    })

    const avgMat = computed(() => {
      if (!domain.value) return 0
      const caps = domain.value.capabilities
      return caps.length ? (caps.reduce((s, c) => s + c.maturity, 0) / caps.length).toFixed(1) : 0
    })

    const avgTarget = computed(() => {
      if (!domain.value) return 0
      const caps = domain.value.capabilities
      return caps.length ? (caps.reduce((s, c) => s + (c.targetMaturity || c.maturity), 0) / caps.length).toFixed(1) : 0
    })

    const mappedAppIds = computed(() => {
      if (!domain.value) return new Set()
      const capIds = domain.value.capabilities.map(c => c.id)
      return new Set(store.data.capabilityMappings.filter(m => capIds.includes(m.capabilityId)).map(m => m.applicationId))
    })

    function appsForCap (capId) { return store.appsForCapability(capId) }

    const relatedProjects = computed(() => {
      if (!domain.value) return []
      return store.projectsForDomain(domain.value.id)
    })

    const relatedProcesses = computed(() => {
      if (!domain.value) return []
      return store.processesForDomain(domain.value.id)
    })

    function maturityColor (m) {
      return { 1: '#f87171', 2: '#fb923c', 3: '#facc15', 4: '#a3e635', 5: '#34d399' }[m] || '#94a3b8'
    }

    function criticalityClass (c) {
      return { 'High': 'bg-red-100 text-red-700', 'Medium': 'bg-yellow-100 text-yellow-700', 'Low': 'bg-green-100 text-green-700' }[c] || 'bg-gray-100 text-gray-600'
    }

    function statusDot (s) {
      return { green: 'bg-green-500', yellow: 'bg-yellow-500', red: 'bg-red-500' }[s] || 'bg-gray-400'
    }

    function procStatusClass (s) {
      return { active: 'bg-green-100 text-green-700', optimization: 'bg-blue-100 text-blue-700', transformation: 'bg-purple-100 text-purple-700' }[s] || 'bg-gray-100 text-gray-600'
    }

    function trendClass (t) {
      return { improving: 'bg-green-100 text-green-700', stable: 'bg-gray-100 text-gray-600', declining: 'bg-red-100 text-red-700' }[t] || 'bg-gray-100 text-gray-600'
    }
    function trendIcon (t) {
      return { improving: '‚Üë', stable: '‚Üí', declining: '‚Üì' }[t] || '‚Üí'
    }

    function kpiProgress (kpi) {
      const c = parseFloat(kpi.current) || 0
      const t = parseFloat(kpi.target) || 1
      return Math.min(100, (c / t) * 100)
    }
    function kpiColor (kpi) {
      const pct = kpiProgress(kpi)
      if (pct >= 80) return '#10b981'
      if (pct >= 50) return '#f59e0b'
      return '#ef4444'
    }

    function adjustMaturity (cap, delta) {
      const newVal = cap.maturity + delta
      if (newVal >= 1 && newVal <= 5) cap.maturity = newVal
    }

    function deleteCap (cap) {
      if (confirm('Delete capability "' + cap.name + '"? Removes all mappings.')) {
        store.deleteCapability(cap.id)
      }
    }

    function deleteDomain () {
      if (!domain.value) return
      if (confirm('Delete domain "' + domain.value.name + '"? Removes all capabilities, mappings, and references.')) {
        store.deleteDomain(domain.value.id)
        navigateTo('/domains')
      }
    }

    return {
      store, domain, router, linkTo, showDomainForm, showCapForm, editCap,
      subCapCount, avgMat, avgTarget, mappedAppIds, appsForCap,
      relatedProjects, relatedProcesses,
      maturityColor, criticalityClass, statusDot, procStatusClass,
      trendClass, trendIcon, kpiProgress, kpiColor,
      adjustMaturity, deleteCap, deleteDomain
    }
  }
}


// ‚îÄ‚îÄ AppList (app-list.js) ‚îÄ‚îÄ
// app-list.js ‚Äî Application table with sort/filter

const AppList = {
  name: 'AppList',
  template: `
    <div class="space-y-4">
      <!-- Toolbar -->
      <div class="flex flex-wrap items-center gap-3">
        <input v-model="search" type="text" placeholder="Search applications‚Ä¶"
               class="flex-1 min-w-[200px] px-3 py-2 border border-surface-200 rounded-lg text-sm focus:ring-2 focus:ring-primary-300 focus:border-primary-400 outline-none" />
        <select v-model="filterTime" class="px-3 py-2 border border-surface-200 rounded-lg text-sm bg-white">
          <option value="">All TIME</option>
          <option v-for="t in ['Invest','Tolerate','Migrate','Eliminate']" :key="t" :value="t">{{ t }}</option>
        </select>
        <select v-model="filterCrit" class="px-3 py-2 border border-surface-200 rounded-lg text-sm bg-white">
          <option value="">All Criticality</option>
          <option v-for="c in ['Mission-Critical','Business-Critical','Business-Operational','Administrative']" :key="c" :value="c">{{ c }}</option>
        </select>
        <button @click="showForm = true"
                class="px-4 py-2 bg-primary-600 text-white rounded-lg text-sm hover:bg-primary-700 transition-colors whitespace-nowrap">
          + Add Application
        </button>
      </div>

      <!-- Count -->
      <div class="text-xs text-gray-500">{{ filtered.length }} of {{ store.totalApps }} applications</div>

      <!-- Table -->
      <div class="bg-white rounded-xl border border-surface-200 overflow-x-auto">
        <table class="w-full text-sm">
          <thead>
            <tr class="border-b border-surface-200 bg-surface-50">
              <th class="text-left px-4 py-3 font-medium text-gray-600 cursor-pointer hover:text-gray-900" @click="toggleSort('name')">Name {{ sortIcon('name') }}</th>
              <th class="text-left px-4 py-3 font-medium text-gray-600 hidden md:table-cell">Category</th>
              <th class="text-left px-4 py-3 font-medium text-gray-600 cursor-pointer hover:text-gray-900" @click="toggleSort('criticality')">Criticality {{ sortIcon('criticality') }}</th>
              <th class="text-left px-4 py-3 font-medium text-gray-600 cursor-pointer hover:text-gray-900" @click="toggleSort('timeQuadrant')">TIME {{ sortIcon('timeQuadrant') }}</th>
              <th class="text-left px-4 py-3 font-medium text-gray-600 hidden md:table-cell">Type</th>
              <th class="text-right px-4 py-3 font-medium text-gray-600 cursor-pointer hover:text-gray-900 hidden md:table-cell" @click="toggleSort('costPerYear')">Cost/yr {{ sortIcon('costPerYear') }}</th>
              <th class="text-right px-4 py-3 font-medium text-gray-600 hidden lg:table-cell">Users</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-surface-100">
            <tr v-for="app in filtered" :key="app.id"
                class="hover:bg-surface-50 cursor-pointer transition-colors"
                @click="navigateTo('/apps/' + app.id)">
              <td class="px-4 py-3">
                <div class="font-medium text-gray-900">{{ app.name }}</div>
                <div class="text-xs text-gray-400">{{ app.vendor }}</div>
              </td>
              <td class="px-4 py-3 text-gray-600 hidden md:table-cell">{{ app.category }}</td>
              <td class="px-4 py-3">
                <span class="text-xs px-2 py-0.5 rounded-full" :class="critClass(app.criticality)">{{ app.criticality }}</span>
              </td>
              <td class="px-4 py-3">
                <span class="text-xs px-2 py-0.5 rounded-full" :class="timeClass(app.timeQuadrant)">{{ app.timeQuadrant }}</span>
              </td>
              <td class="px-4 py-3 text-gray-600 hidden md:table-cell">{{ app.type }}</td>
              <td class="px-4 py-3 text-right text-gray-700 font-mono hidden md:table-cell">{{ app.costPerYear > 0 ? '‚Ç¨' + app.costPerYear.toLocaleString() : '‚Äî' }}</td>
              <td class="px-4 py-3 text-right text-gray-600 hidden lg:table-cell">{{ app.userCount }}</td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Total -->
      <div class="flex justify-end text-sm text-gray-500">
        Total annual cost: <strong class="ml-1 text-gray-800">‚Ç¨{{ totalCost.toLocaleString() }}</strong>
      </div>

      <!-- App Form Modal -->
      <app-form v-if="showForm" @close="showForm = false" @saved="onSaved"></app-form>
    </div>
  `,
  setup () {
    const { ref, computed } = Vue
    const search = ref('')
    const filterTime = ref('')
    const filterCrit = ref('')
    const sortBy = ref('name')
    const sortDir = ref(1)
    const showForm = ref(false)

    function toggleSort (field) {
      if (sortBy.value === field) sortDir.value *= -1
      else { sortBy.value = field; sortDir.value = 1 }
    }
    function sortIcon (field) {
      if (sortBy.value !== field) return ''
      return sortDir.value === 1 ? '‚Üë' : '‚Üì'
    }

    const filtered = computed(() => {
      let list = [...store.data.applications]
      const q = search.value.toLowerCase()
      if (q) list = list.filter(a => a.name.toLowerCase().includes(q) || a.vendor.toLowerCase().includes(q) || a.category.toLowerCase().includes(q))
      if (filterTime.value) list = list.filter(a => a.timeQuadrant === filterTime.value)
      if (filterCrit.value) list = list.filter(a => a.criticality === filterCrit.value)
      list.sort((a, b) => {
        const av = a[sortBy.value], bv = b[sortBy.value]
        if (typeof av === 'number') return (av - bv) * sortDir.value
        return String(av).localeCompare(String(bv)) * sortDir.value
      })
      return list
    })

    const totalCost = computed(() => filtered.value.reduce((s, a) => s + (a.costPerYear || 0), 0))

    function critClass (c) {
      return { 'Mission-Critical': 'bg-red-100 text-red-700', 'Business-Critical': 'bg-orange-100 text-orange-700', 'Business-Operational': 'bg-yellow-100 text-yellow-700', 'Administrative': 'bg-gray-100 text-gray-600' }[c] || 'bg-gray-100 text-gray-600'
    }
    function timeClass (t) {
      return { Invest: 'bg-green-100 text-green-700', Tolerate: 'bg-yellow-100 text-yellow-700', Migrate: 'bg-blue-100 text-blue-700', Eliminate: 'bg-red-100 text-red-700' }[t] || 'bg-gray-100 text-gray-600'
    }

    function onSaved () { showForm.value = false }

    return { store, linkTo, navigateTo, search, filterTime, filterCrit, sortBy, sortDir, filtered, totalCost, toggleSort, sortIcon, critClass, timeClass, showForm, onSaved }
  }
}


// ‚îÄ‚îÄ AppDetail (app-detail.js) ‚îÄ‚îÄ
// app-detail.js ‚Äî Application detail view with capabilities, projects, edit/delete

const AppDetail = {
  name: 'AppDetail',
  template: `
    <div v-if="app" class="space-y-6">
      <!-- Back link -->
      <a :href="linkTo('/apps')" class="text-sm text-gray-500 hover:text-primary-600">‚Üê Applications</a>

      <!-- Header -->
      <div class="bg-white rounded-xl border border-surface-200 p-6">
        <div class="flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3">
          <div>
            <div class="flex items-center gap-3 mb-1">
              <h2 class="text-xl font-bold text-gray-900">{{ app.name }}</h2>
              <span class="text-xs px-2 py-0.5 rounded-full" :class="timeClass(app.timeQuadrant)">{{ app.timeQuadrant }}</span>
              <span class="text-xs px-2 py-0.5 rounded-full" :class="critClass(app.criticality)">{{ app.criticality }}</span>
            </div>
            <div class="text-sm text-gray-500">{{ app.vendor }} ¬∑ {{ app.category }} ¬∑ {{ app.type }}</div>
            <p class="text-sm text-gray-600 mt-3 max-w-2xl">{{ app.description }}</p>
          </div>
          <div class="flex gap-2 shrink-0">
            <button @click="showEdit = true" class="px-3 py-1.5 border border-gray-300 rounded-lg text-xs hover:bg-surface-100">Edit</button>
            <button @click="confirmDelete" class="px-3 py-1.5 border border-red-300 text-red-600 rounded-lg text-xs hover:bg-red-50">Delete</button>
          </div>
        </div>

        <!-- Metrics -->
        <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-5 gap-4 mt-6 pt-4 border-t border-surface-100">
          <div>
            <div class="text-xs text-gray-500">Cost / Year</div>
            <div class="text-lg font-bold text-gray-800">{{ app.costPerYear > 0 ? '‚Ç¨' + app.costPerYear.toLocaleString() : '‚Äî' }}</div>
          </div>
          <div>
            <div class="text-xs text-gray-500">Users</div>
            <div class="text-lg font-bold text-gray-800">{{ app.userCount }}</div>
          </div>
          <div>
            <div class="text-xs text-gray-500">Go-Live</div>
            <div class="text-lg font-bold text-gray-800">{{ app.goLiveDate || '‚Äî' }}</div>
          </div>
          <div>
            <div class="text-xs text-gray-500">Business Value</div>
            <div class="text-lg font-bold" :class="app.scores?.businessValue >= 7 ? 'text-green-600' : 'text-gray-800'">{{ app.scores?.businessValue || '‚Äî' }}/10</div>
          </div>
          <div>
            <div class="text-xs text-gray-500">Technical Health</div>
            <div class="text-lg font-bold" :class="app.scores?.technicalHealth >= 7 ? 'text-green-600' : app.scores?.technicalHealth <= 3 ? 'text-red-600' : 'text-gray-800'">{{ app.scores?.technicalHealth || '‚Äî' }}/10</div>
          </div>
        </div>

        <!-- Owners -->
        <div class="grid grid-cols-2 gap-4 mt-4 pt-4 border-t border-surface-100">
          <div>
            <div class="text-xs text-gray-500">Business Owner</div>
            <div class="text-sm text-gray-800">{{ app.businessOwner || '‚Äî' }}</div>
          </div>
          <div>
            <div class="text-xs text-gray-500">IT Owner</div>
            <div class="text-sm text-gray-800">{{ app.itOwner || '‚Äî' }}</div>
          </div>
        </div>
      </div>

      <!-- Capability Mappings -->
      <div class="bg-white rounded-xl border border-surface-200 overflow-hidden">
        <div class="px-5 py-3 border-b border-surface-200 bg-surface-50">
          <h3 class="text-sm font-semibold text-gray-700">Mapped Capabilities ({{ mappedCaps.length }})</h3>
        </div>
        <div v-if="mappedCaps.length === 0" class="px-5 py-4 text-sm text-gray-400 italic">No capability mappings yet.</div>
        <div v-else class="divide-y divide-surface-100">
          <div v-for="cap in mappedCaps" :key="cap.id" class="flex items-center justify-between px-5 py-3">
            <div class="flex items-center gap-3">
              <span class="domain-swatch" :style="{ backgroundColor: cap.domain?.color || '#94a3b8' }"></span>
              <span class="text-xs font-mono text-gray-500">{{ cap.id }}</span>
              <span class="text-sm text-gray-800">{{ cap.name }}</span>
              <span class="text-[10px] text-gray-400">({{ cap.domain?.name }})</span>
            </div>
            <span class="text-xs px-2 py-0.5 rounded-full"
                  :class="cap.role === 'Primary' ? 'bg-primary-100 text-primary-700' : 'bg-gray-100 text-gray-600'">
              {{ cap.role }}
            </span>
          </div>
        </div>
      </div>

      <!-- Related Projects -->
      <div v-if="relatedProjects.length" class="bg-white rounded-xl border border-surface-200 overflow-hidden">
        <div class="px-5 py-3 border-b border-surface-200 bg-surface-50">
          <h3 class="text-sm font-semibold text-gray-700">Related Projects</h3>
        </div>
        <div class="divide-y divide-surface-100">
          <a v-for="p in relatedProjects" :key="p.id" :href="linkTo('/projects/' + p.id)"
             class="flex items-center justify-between px-5 py-3 hover:bg-surface-50 transition-colors">
            <div class="flex items-center gap-3">
              <span class="w-2 h-2 rounded-full" :class="statusDot(p.status)"></span>
              <span class="text-sm text-gray-800">{{ p.name }}</span>
              <span class="text-xs text-gray-400">({{ p.action }})</span>
            </div>
            <span class="text-xs text-gray-400">‚Ç¨{{ (p.budget / 1000).toFixed(0) }}k</span>
          </a>
        </div>
      </div>

      <!-- E2E Processes -->
      <div v-if="relatedProcesses.length" class="bg-white rounded-xl border border-surface-200 overflow-hidden">
        <div class="px-5 py-3 border-b border-surface-200 bg-surface-50">
          <h3 class="text-sm font-semibold text-gray-700">E2E Prozesse ({{ relatedProcesses.length }})</h3>
        </div>
        <div class="divide-y divide-surface-100">
          <a v-for="proc in relatedProcesses" :key="proc.id" :href="linkTo('/processes/' + proc.id)"
             class="flex items-center justify-between px-5 py-3 hover:bg-surface-50 transition-colors">
            <div class="flex items-center gap-3">
              <span class="text-xs font-mono text-gray-400">{{ proc.id }}</span>
              <span class="text-sm text-gray-800">{{ proc.name }}</span>
              <span class="text-[10px] px-2 py-0.5 rounded-full" :class="procStatusClass(proc.status)">{{ proc.status }}</span>
            </div>
            <div class="flex gap-1">
              <span v-for="did in proc.domains" :key="did"
                    class="w-4 h-4 rounded text-[8px] text-white font-bold flex items-center justify-center"
                    :style="{ backgroundColor: domainColor(did) }">{{ did }}</span>
            </div>
          </a>
        </div>
      </div>

      <!-- Edit Modal -->
      <app-form v-if="showEdit" :edit-app="app" @close="showEdit = false" @saved="showEdit = false"></app-form>
    </div>
    <div v-else class="text-center py-12 text-gray-500">Application not found.</div>
  `,
  setup () {
    const { ref, computed } = Vue
    const showEdit = ref(false)

    const app = computed(() => store.appById(router.params.id))

    const mappedCaps = computed(() => {
      if (!app.value) return []
      return store.capabilitiesForApp(app.value.id)
    })

    const relatedProjects = computed(() => {
      if (!app.value) return []
      return store.data.projects
        .filter(p => p.affectedApps && p.affectedApps.some(a => a.appId === app.value.id))
        .map(p => {
          const affected = p.affectedApps.find(a => a.appId === app.value.id)
          return { ...p, action: affected?.action || '' }
        })
    })

    const relatedProcesses = computed(() => {
      if (!app.value) return []
      return store.processesForApp(app.value.id)
    })

    function timeClass (t) {
      return { Invest: 'bg-green-100 text-green-700', Tolerate: 'bg-yellow-100 text-yellow-700', Migrate: 'bg-blue-100 text-blue-700', Eliminate: 'bg-red-100 text-red-700' }[t] || ''
    }
    function critClass (c) {
      return { 'Mission-Critical': 'bg-red-100 text-red-700', 'Business-Critical': 'bg-orange-100 text-orange-700', 'Business-Operational': 'bg-yellow-100 text-yellow-700', 'Administrative': 'bg-gray-100 text-gray-600' }[c] || ''
    }
    function statusDot (s) {
      return { green: 'bg-green-500', yellow: 'bg-yellow-500', red: 'bg-red-500' }[s] || 'bg-gray-400'
    }
    function procStatusClass (s) {
      return { active: 'bg-green-100 text-green-700', optimization: 'bg-blue-100 text-blue-700', transformation: 'bg-purple-100 text-purple-700' }[s] || 'bg-gray-100 text-gray-600'
    }
    function domainColor (id) {
      const d = store.domainById(id)
      return d ? d.color : '#94a3b8'
    }

    function confirmDelete () {
      if (app.value && confirm('Delete "' + app.value.name + '"? This cannot be undone.')) {
        store.deleteApp(app.value.id)
        navigateTo('/apps')
      }
    }

    return { store, router, linkTo, navigateTo, app, mappedCaps, relatedProjects, relatedProcesses, showEdit, timeClass, critClass, statusDot, procStatusClass, domainColor, confirmDelete }
  }
}


// ‚îÄ‚îÄ CapAppMatrix (cap-app-matrix.js) ‚îÄ‚îÄ
// cap-app-matrix.js ‚Äî Capability √ó Application heatmap matrix

const CapAppMatrix = {
  name: 'CapAppMatrix',
  template: `
    <div class="space-y-4">
      <p class="text-sm text-gray-500">Rows = L1 Capabilities ¬∑ Columns = Applications ¬∑ Cell color indicates mapping role.</p>

      <!-- Filter -->
      <div class="flex flex-wrap items-center gap-3">
        <select v-model="filterDomain" class="px-3 py-2 border border-surface-200 rounded-lg text-sm bg-white">
          <option :value="0">All Domains</option>
          <option v-for="d in store.data.domains" :key="d.id" :value="d.id">{{ d.id }}. {{ d.name }}</option>
        </select>
        <label class="flex items-center gap-2 text-sm text-gray-600">
          <input type="checkbox" v-model="hideUnmapped" class="rounded" />
          Hide unmapped apps
        </label>
      </div>

      <!-- Matrix -->
      <div class="relative">
        <p class="text-xs text-gray-400 mb-1 md:hidden">‚Üê Horizontal scrollen ‚Üí</p>
        <div class="bg-white rounded-xl border border-surface-200 overflow-auto max-h-[75vh] -webkit-overflow-scrolling-touch">
        <table class="text-xs border-collapse min-w-max">
          <thead class="sticky top-0 z-20 bg-white">
            <tr>
              <th class="sticky left-0 z-30 bg-surface-50 px-3 py-2 text-left font-medium text-gray-600 border-b border-r border-surface-200 min-w-[200px]">Capability</th>
              <th v-for="app in visibleApps" :key="app.id"
                  class="px-1 py-2 border-b border-surface-200 text-center font-medium text-gray-600 min-w-[60px]"
                  :title="app.name + ' ‚Äî ' + app.vendor">
                <div class="writing-mode-vertical" style="writing-mode: vertical-lr; transform: rotate(180deg); max-height: 100px; overflow: hidden;">
                  {{ app.name }}
                </div>
              </th>
            </tr>
          </thead>
          <tbody>
            <template v-for="domain in filteredDomains" :key="domain.id">
              <!-- Domain separator row -->
              <tr>
                <td :colspan="visibleApps.length + 1" class="px-3 py-1.5 text-[10px] font-bold uppercase tracking-wider sticky left-0 z-10"
                    :style="{ backgroundColor: domain.color + '15', color: domain.color }">
                  {{ domain.id }}. {{ domain.name }}
                </td>
              </tr>
              <!-- Capability rows -->
              <tr v-for="cap in domain.capabilities" :key="cap.id" class="hover:bg-surface-50">
                <td class="sticky left-0 z-10 bg-white px-3 py-1.5 border-b border-r border-surface-100 whitespace-nowrap">
                  <span class="text-gray-400 mr-1">{{ cap.id }}</span>
                  <span class="text-gray-700">{{ cap.name }}</span>
                </td>
                <td v-for="app in visibleApps" :key="app.id"
                    class="border-b border-surface-100 text-center p-0">
                  <div v-if="getMapping(cap.id, app.id)"
                       class="matrix-cell w-full h-full flex items-center justify-center py-1.5 cursor-pointer"
                       :class="getMapping(cap.id, app.id) === 'Primary' ? 'bg-primary-500 text-white' : 'bg-primary-100 text-primary-700'"
                       :title="app.name + ' ‚Üí ' + cap.name + ' (' + getMapping(cap.id, app.id) + ')'"
                       @click="toggleMapping(cap.id, app.id)">
                    {{ getMapping(cap.id, app.id) === 'Primary' ? '‚óè' : '‚óã' }}
                  </div>
                  <div v-else class="w-full h-full py-1.5 cursor-pointer hover:bg-surface-100 text-surface-300"
                       @click="toggleMapping(cap.id, app.id)"
                       :title="'Click to map ' + app.name + ' ‚Üí ' + cap.name">
                  </div>
                </td>
              </tr>
            </template>
          </tbody>
        </table>
      </div>
      </div>

      <!-- Legend -->
      <div class="flex flex-wrap items-center gap-4 sm:gap-6 text-xs text-gray-500">
        <span class="flex items-center gap-1"><span class="w-4 h-4 rounded bg-primary-500 text-white text-center text-[10px] leading-4">‚óè</span> Primary</span>
        <span class="flex items-center gap-1"><span class="w-4 h-4 rounded bg-primary-100 text-primary-700 text-center text-[10px] leading-4">‚óã</span> Secondary</span>
        <span class="flex items-center gap-1"><span class="w-4 h-4 rounded bg-surface-50 border border-surface-200"></span> No mapping (click to add)</span>
      </div>
    </div>
  `,
  setup () {
    const { ref, computed } = Vue
    const filterDomain = ref(0)
    const hideUnmapped = ref(false)

    const filteredDomains = computed(() => {
      if (filterDomain.value === 0) return store.data.domains
      return store.data.domains.filter(d => d.id === filterDomain.value)
    })

    // All app IDs that have at least one mapping
    const mappedAppIds = computed(() => new Set(store.data.capabilityMappings.map(m => m.applicationId)))

    const visibleApps = computed(() => {
      let apps = [...store.data.applications]
      if (hideUnmapped.value) apps = apps.filter(a => mappedAppIds.value.has(a.id))
      return apps
    })

    function getMapping (capId, appId) {
      const m = store.data.capabilityMappings.find(m => m.capabilityId === capId && m.applicationId === appId)
      return m ? m.role : null
    }

    function toggleMapping (capId, appId) {
      const existing = getMapping(capId, appId)
      if (!existing) {
        store.addMapping(capId, appId, 'Primary')
      } else if (existing === 'Primary') {
        store.removeMapping(capId, appId)
        store.addMapping(capId, appId, 'Secondary')
      } else {
        store.removeMapping(capId, appId)
      }
    }

    return { store, linkTo, filterDomain, hideUnmapped, filteredDomains, visibleApps, getMapping, toggleMapping }
  }
}


// ‚îÄ‚îÄ TimeQuadrant (time-quadrant.js) ‚îÄ‚îÄ
// time-quadrant.js ‚Äî TIME (Tolerate / Invest / Migrate / Eliminate) scatter plot

const TimeQuadrant = {
  name: 'TimeQuadrant',
  template: `
    <div class="space-y-4">
      <p class="text-sm text-gray-500">Business Value (Y) vs Technical Health (X). Color & label = TIME classification. Click an application to view details.</p>

      <div class="bg-white rounded-xl border border-surface-200 p-4 sm:p-6">
        <div class="relative h-[360px] md:h-[520px]">
          <canvas ref="chartCanvas"></canvas>
        </div>
      </div>

      <!-- Applications by TIME category -->
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
        <div v-for="q in quadrants" :key="q.name"
             class="rounded-xl border-2 p-4"
             :style="{ borderColor: q.color + '40', backgroundColor: q.color + '08' }">
          <div class="flex items-center gap-2 mb-2">
            <span class="w-3 h-3 rounded-full" :style="{ backgroundColor: q.color }"></span>
            <span class="text-sm font-semibold" :style="{ color: q.color }">{{ q.name }}</span>
            <span class="text-xs text-gray-400 ml-auto">{{ q.apps.length }}</span>
          </div>
          <div class="space-y-1">
            <a v-for="app in q.apps" :key="app.id"
               :href="linkTo('/apps/' + app.id)"
               class="block text-xs text-gray-700 hover:text-primary-600 truncate">
              {{ app.name }}
            </a>
          </div>
        </div>
      </div>
    </div>
  `,
  setup () {
    const { ref, computed, onMounted, nextTick } = Vue
    const chartCanvas = ref(null)

    const timeColors = { Invest: '#10b981', Tolerate: '#f59e0b', Migrate: '#3b82f6', Eliminate: '#ef4444' }

    const quadrants = computed(() => {
      const groups = { Invest: [], Tolerate: [], Migrate: [], Eliminate: [] }
      store.data.applications.forEach(a => {
        if (groups[a.timeQuadrant]) groups[a.timeQuadrant].push(a)
      })
      return Object.entries(groups).map(([name, apps]) => ({ name, apps, color: timeColors[name] }))
    })

    function renderChart () {
      if (!chartCanvas.value) return
      const apps = store.data.applications

      // Group datasets by TIME quadrant
      const datasets = Object.entries(timeColors).map(([quadrant, color]) => {
        const points = apps
          .filter(a => a.timeQuadrant === quadrant && a.scores)
          .map(a => ({
            x: a.scores.technicalHealth,
            y: a.scores.businessValue,
            r: Math.max(6, Math.sqrt(a.costPerYear / 1000) * 1.5),
            label: a.name,
            id: a.id
          }))
        return {
          label: quadrant,
          data: points,
          backgroundColor: color + '99',
          borderColor: color,
          borderWidth: 1.5
        }
      })

      const chart = new Chart(chartCanvas.value, {
        type: 'bubble',
        data: { datasets },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            x: {
              title: { display: true, text: 'Technical Health ‚Üí', font: { size: 12 } },
              min: 0, max: 11, ticks: { stepSize: 1 },
              grid: { color: '#f1f5f9' }
            },
            y: {
              title: { display: true, text: 'Business Value ‚Üí', font: { size: 12 } },
              min: 0, max: 11, ticks: { stepSize: 1 },
              grid: { color: '#f1f5f9' }
            }
          },
          plugins: {
            legend: { position: 'top', labels: { usePointStyle: true, padding: 16 } },
            tooltip: {
              callbacks: {
                label: ctx => {
                  const p = ctx.raw
                  return p.label + ' (BV=' + p.y + ', TH=' + p.x + ')'
                }
              }
            }
          },
          onClick: (evt, elements) => {
            if (elements.length > 0) {
              const el = elements[0]
              const ds = datasets[el.datasetIndex]
              const point = ds.data[el.index]
              if (point && point.id) navigateTo('/apps/' + point.id)
            }
          }
        },
        plugins: [{
          // Draw quadrant background areas
          beforeDraw: (chart) => {
            const { ctx, chartArea: { left, top, right, bottom } } = chart
            const xMid = chart.scales.x.getPixelForValue(5.5)
            const yMid = chart.scales.y.getPixelForValue(5.5)
            const areas = [
              { x1: left, y1: top, x2: xMid, y2: yMid, color: '#3b82f610', label: 'Migrate' },        // low-tech, high-biz
              { x1: xMid, y1: top, x2: right, y2: yMid, color: '#10b98110', label: 'Invest' },         // high-tech, high-biz
              { x1: left, y1: yMid, x2: xMid, y2: bottom, color: '#ef444410', label: 'Eliminate' },     // low-tech, low-biz
              { x1: xMid, y1: yMid, x2: right, y2: bottom, color: '#f59e0b10', label: 'Tolerate' }     // high-tech, low-biz
            ]
            areas.forEach(a => {
              ctx.save()
              ctx.fillStyle = a.color
              ctx.fillRect(a.x1, a.y1, a.x2 - a.x1, a.y2 - a.y1)
              // Label
              ctx.fillStyle = '#94a3b8'
              ctx.font = '11px sans-serif'
              ctx.textAlign = 'center'
              ctx.fillText(a.label, (a.x1 + a.x2) / 2, a.y1 + 16)
              ctx.restore()
            })
          }
        }]
      })
    }

    onMounted(() => { nextTick(renderChart) })

    return { store, linkTo, navigateTo, chartCanvas, quadrants }
  }
}


// ‚îÄ‚îÄ ProjectList (project-list.js) ‚îÄ‚îÄ
// project-list.js ‚Äî Project Portfolio table with filter/sort

const ProjectList = {
  name: 'ProjectList',
  template: `
    <div class="space-y-4">
      <!-- Toolbar -->
      <div class="flex flex-wrap items-center gap-3">
        <input v-model="search" type="text" placeholder="Search projects‚Ä¶"
               class="flex-1 min-w-[200px] px-3 py-2 border border-surface-200 rounded-lg text-sm focus:ring-2 focus:ring-primary-300 outline-none" />
        <select v-model="filterCat" class="px-3 py-2 border border-surface-200 rounded-lg text-sm bg-white">
          <option value="">All Categories</option>
          <option v-for="c in store.data.enums.projectCategory" :key="c" :value="c">{{ c }}</option>
        </select>
        <select v-model="filterStatus" class="px-3 py-2 border border-surface-200 rounded-lg text-sm bg-white">
          <option value="">All Status</option>
          <option value="green">Green</option>
          <option value="yellow">Yellow</option>
          <option value="red">Red</option>
        </select>
        <button @click="showForm = true"
                class="px-4 py-2 bg-primary-600 text-white rounded-lg text-sm hover:bg-primary-700 whitespace-nowrap">
          + Add Project
        </button>
      </div>

      <div class="text-xs text-gray-500">{{ filtered.length }} of {{ store.totalProjects }} projects ¬∑ Total Budget: ‚Ç¨{{ (totalBudget / 1000).toFixed(0) }}k</div>

      <!-- Table -->
      <div class="bg-white rounded-xl border border-surface-200 overflow-x-auto">
        <table class="w-full text-sm">
          <thead>
            <tr class="border-b border-surface-200 bg-surface-50">
              <th class="text-left px-4 py-3 font-medium text-gray-600 w-8"></th>
              <th class="text-left px-4 py-3 font-medium text-gray-600 cursor-pointer hover:text-gray-900" @click="toggleSort('name')">Name {{ sortIcon('name') }}</th>
              <th class="text-left px-4 py-3 font-medium text-gray-600 hidden md:table-cell">Category</th>
              <th class="text-left px-4 py-3 font-medium text-gray-600 hidden md:table-cell">Domain</th>
              <th class="text-right px-4 py-3 font-medium text-gray-600 cursor-pointer hover:text-gray-900 hidden sm:table-cell" @click="toggleSort('budget')">Budget {{ sortIcon('budget') }}</th>
              <th class="text-left px-4 py-3 font-medium text-gray-600 hidden lg:table-cell">Timeline</th>
              <th class="text-left px-4 py-3 font-medium text-gray-600 hidden lg:table-cell">Sponsor</th>
              <th class="text-left px-4 py-3 font-medium text-gray-600 hidden md:table-cell">Dependencies</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-surface-100">
            <tr v-for="p in filtered" :key="p.id"
                class="hover:bg-surface-50 cursor-pointer transition-colors"
                @click="navigateTo('/projects/' + p.id)">
              <td class="px-4 py-3">
                <span class="w-2.5 h-2.5 rounded-full inline-block" :class="statusDot(p.status)"></span>
              </td>
              <td class="px-4 py-3">
                <div class="font-medium text-gray-900">{{ p.name }}</div>
                <div class="text-xs text-gray-400">{{ p.id }}</div>
              </td>
              <td class="px-4 py-3 hidden md:table-cell">
                <span class="text-xs px-2 py-0.5 rounded-full" :class="catClass(p.category)">{{ p.category }}</span>
              </td>
              <td class="px-4 py-3 hidden md:table-cell">
                <div class="flex items-center gap-1.5">
                  <span class="domain-swatch" :style="{ backgroundColor: domainColor(p.primaryDomain) }"></span>
                  <span class="text-xs text-gray-600">{{ domainName(p.primaryDomain) }}</span>
                </div>
              </td>
              <td class="px-4 py-3 text-right font-mono text-gray-700 hidden sm:table-cell">‚Ç¨{{ (p.budget / 1000).toFixed(0) }}k</td>
              <td class="px-4 py-3 text-xs text-gray-600 hidden lg:table-cell">{{ p.start }} ‚Üí {{ p.end }}</td>
              <td class="px-4 py-3 text-xs text-gray-600 hidden lg:table-cell">{{ p.sponsor }}</td>
              <td class="px-4 py-3 text-center hidden md:table-cell">
                <span v-if="depCount(p.id) > 0" class="text-xs px-2 py-0.5 rounded-full bg-surface-100 text-gray-600">{{ depCount(p.id) }}</span>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Project Form Modal -->
      <project-form v-if="showForm" @close="showForm = false" @saved="showForm = false"></project-form>
    </div>
  `,
  setup () {
    const { ref, computed } = Vue
    const search = ref('')
    const filterCat = ref('')
    const filterStatus = ref('')
    const sortBy = ref('name')
    const sortDir = ref(1)
    const showForm = ref(false)

    function toggleSort (f) {
      if (sortBy.value === f) sortDir.value *= -1
      else { sortBy.value = f; sortDir.value = 1 }
    }
    function sortIcon (f) { return sortBy.value === f ? (sortDir.value === 1 ? '‚Üë' : '‚Üì') : '' }

    const filtered = computed(() => {
      let list = [...store.data.projects]
      const q = search.value.toLowerCase()
      if (q) list = list.filter(p => p.name.toLowerCase().includes(q) || p.id.toLowerCase().includes(q))
      if (filterCat.value) list = list.filter(p => p.category === filterCat.value)
      if (filterStatus.value) list = list.filter(p => p.status === filterStatus.value)
      list.sort((a, b) => {
        const av = a[sortBy.value], bv = b[sortBy.value]
        if (typeof av === 'number') return (av - bv) * sortDir.value
        return String(av).localeCompare(String(bv)) * sortDir.value
      })
      return list
    })

    const totalBudget = computed(() => filtered.value.reduce((s, p) => s + (p.budget || 0), 0))

    function statusDot (s) { return { green: 'bg-green-500', yellow: 'bg-yellow-500', red: 'bg-red-500' }[s] || 'bg-gray-400' }
    function catClass (c) {
      return { 'Run / Pflicht': 'bg-gray-100 text-gray-700', 'Modernisierung': 'bg-blue-100 text-blue-700', 'Optimierung': 'bg-green-100 text-green-700', 'Innovation / Grow': 'bg-purple-100 text-purple-700', 'Infrastruktur': 'bg-orange-100 text-orange-700' }[c] || 'bg-gray-100 text-gray-600'
    }
    function domainColor (id) { const d = store.domainById(id); return d ? d.color : '#94a3b8' }
    function domainName (id) { const d = store.domainById(id); return d ? d.name : '‚Äî' }
    function depCount (id) { return store.depsForProject(id).length }

    return { store, linkTo, navigateTo, search, filterCat, filterStatus, filtered, totalBudget, toggleSort, sortIcon, statusDot, catClass, domainColor, domainName, depCount, showForm }
  }
}


// ‚îÄ‚îÄ ProjectDetail (project-detail.js) ‚îÄ‚îÄ
// project-detail.js ‚Äî Project detail view

const ProjectDetail = {
  name: 'ProjectDetail',
  template: `
    <div v-if="project" class="space-y-6">
      <a :href="linkTo('/projects')" class="text-sm text-gray-500 hover:text-primary-600">‚Üê Projects</a>

      <!-- Header -->
      <div class="bg-white rounded-xl border border-surface-200 p-6">
        <div class="flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3">
          <div>
            <div class="flex items-center gap-3 mb-1">
              <span class="w-3 h-3 rounded-full" :class="statusDot(project.status)"></span>
              <h2 class="text-xl font-bold text-gray-900">{{ project.name }}</h2>
              <span class="text-xs px-2 py-0.5 rounded-full" :class="catClass(project.category)">{{ project.category }}</span>
            </div>
            <div class="text-sm text-gray-500">{{ project.id }} ¬∑ {{ project.start }} ‚Üí {{ project.end }}</div>
            <p v-if="project.statusText" class="text-sm mt-2 px-3 py-1.5 rounded-lg"
               :class="project.status === 'red' ? 'bg-red-50 text-red-700' : project.status === 'yellow' ? 'bg-yellow-50 text-yellow-700' : 'bg-green-50 text-green-700'">
              {{ project.statusText }}
            </p>
          </div>
          <div class="flex gap-2 shrink-0">
            <button @click="showEdit = true" class="px-3 py-1.5 border border-gray-300 rounded-lg text-xs hover:bg-surface-100">Edit</button>
            <button @click="confirmDelete" class="px-3 py-1.5 border border-red-300 text-red-600 rounded-lg text-xs hover:bg-red-50">Delete</button>
          </div>
        </div>

        <!-- Metrics -->
        <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-4 mt-6 pt-4 border-t border-surface-100">
          <div>
            <div class="text-xs text-gray-500">Budget</div>
            <div class="text-lg font-bold text-gray-800">‚Ç¨{{ project.budget?.toLocaleString() }}</div>
          </div>
          <div>
            <div class="text-xs text-gray-500">Primary Domain</div>
            <div class="flex items-center gap-1.5 mt-0.5">
              <span class="domain-swatch" :style="{ backgroundColor: domainColor(project.primaryDomain) }"></span>
              <span class="text-sm font-medium text-gray-800">{{ domainName(project.primaryDomain) }}</span>
            </div>
          </div>
          <div>
            <div class="text-xs text-gray-500">Sponsor</div>
            <div class="text-sm font-medium text-gray-800">{{ project.sponsor || '‚Äî' }}</div>
          </div>
          <div>
            <div class="text-xs text-gray-500">Project Lead</div>
            <div class="text-sm font-medium text-gray-800">{{ project.projectLead || '‚Äî' }}</div>
          </div>
        </div>

        <div v-if="project.strategicContribution" class="mt-4 pt-4 border-t border-surface-100">
          <div class="text-xs text-gray-500 mb-1">Strategic Contribution</div>
          <p class="text-sm text-gray-700">{{ project.strategicContribution }}</p>
        </div>
      </div>

      <!-- Affected Applications -->
      <div v-if="project.affectedApps && project.affectedApps.length" class="bg-white rounded-xl border border-surface-200 overflow-hidden">
        <div class="px-5 py-3 border-b border-surface-200 bg-surface-50">
          <h3 class="text-sm font-semibold text-gray-700">Affected Applications</h3>
        </div>
        <div class="divide-y divide-surface-100">
          <a v-for="aa in project.affectedApps" :key="aa.appId"
             :href="linkTo('/apps/' + aa.appId)"
             class="flex items-center justify-between px-5 py-3 hover:bg-surface-50 transition-colors">
            <span class="text-sm text-gray-800">{{ appName(aa.appId) }}</span>
            <span class="text-xs px-2 py-0.5 rounded-full"
                  :class="aa.action === 'abl√∂sen' ? 'bg-red-100 text-red-700' : aa.action === 'einf√ºhren' ? 'bg-green-100 text-green-700' : 'bg-blue-100 text-blue-700'">
              {{ aa.action }}
            </span>
          </a>
        </div>
      </div>

      <!-- Dependencies -->
      <div v-if="deps.length" class="bg-white rounded-xl border border-surface-200 overflow-hidden">
        <div class="px-5 py-3 border-b border-surface-200 bg-surface-50">
          <h3 class="text-sm font-semibold text-gray-700">Dependencies ({{ deps.length }})</h3>
        </div>
        <div class="divide-y divide-surface-100">
          <div v-for="dep in deps" :key="dep.sourceProjectId + dep.targetProjectId" class="flex items-center justify-between px-5 py-3">
            <div class="flex items-center gap-2 text-sm">
              <a :href="linkTo('/projects/' + dep.sourceProjectId)" class="text-primary-600 hover:underline">{{ projName(dep.sourceProjectId) }}</a>
              <span class="text-gray-400">‚Üí{{ depSymbol(dep.type) }}‚Üí</span>
              <a :href="linkTo('/projects/' + dep.targetProjectId)" class="text-primary-600 hover:underline">{{ projName(dep.targetProjectId) }}</a>
            </div>
            <span class="text-xs text-gray-500 max-w-[300px] truncate">{{ dep.description }}</span>
          </div>
        </div>
      </div>

      <!-- Capabilities -->
      <div v-if="project.capabilities && project.capabilities.length" class="bg-white rounded-xl border border-surface-200 p-5">
        <h3 class="text-sm font-semibold text-gray-700 mb-3">Touched Capabilities</h3>
        <div class="flex flex-wrap gap-2">
          <span v-for="capId in project.capabilities" :key="capId"
                class="text-xs px-2 py-1 bg-surface-100 text-gray-700 rounded">
            {{ capId }} {{ capName(capId) }}
          </span>
        </div>
      </div>

      <!-- Edit Modal -->
      <project-form v-if="showEdit" :edit-project="project" @close="showEdit = false" @saved="showEdit = false"></project-form>
    </div>
    <div v-else class="text-center py-12 text-gray-500">Project not found.</div>
  `,
  setup () {
    const { ref, computed } = Vue
    const showEdit = ref(false)

    const project = computed(() => store.projectById(router.params.id))
    const deps = computed(() => project.value ? store.depsForProject(project.value.id) : [])

    function statusDot (s) { return { green: 'bg-green-500', yellow: 'bg-yellow-500', red: 'bg-red-500' }[s] || 'bg-gray-400' }
    function catClass (c) { return { 'Run / Pflicht': 'bg-gray-100 text-gray-700', 'Modernisierung': 'bg-blue-100 text-blue-700', 'Optimierung': 'bg-green-100 text-green-700', 'Innovation / Grow': 'bg-purple-100 text-purple-700', 'Infrastruktur': 'bg-orange-100 text-orange-700' }[c] || 'bg-gray-100' }
    function domainColor (id) { const d = store.domainById(id); return d ? d.color : '#94a3b8' }
    function domainName (id) { const d = store.domainById(id); return d ? d.name : '‚Äî' }
    function appName (id) { const a = store.appById(id); return a ? a.name : id }
    function projName (id) { const p = store.projectById(id); return p ? p.name : id }
    function capName (id) { const c = store.capabilityById(id); return c ? c.name : '' }
    function depSymbol (type) {
      const dt = store.data.enums.dependencyType?.find(d => d.value === type)
      return dt ? dt.symbol.replace('‚Üí', '') : type
    }

    function confirmDelete () {
      if (project.value && confirm('Delete "' + project.value.name + '"?')) {
        store.deleteProject(project.value.id)
        navigateTo('/projects')
      }
    }

    return { store, router, linkTo, navigateTo, project, deps, showEdit, statusDot, catClass, domainColor, domainName, appName, projName, capName, depSymbol, confirmDelete }
  }
}


// ‚îÄ‚îÄ ProjectHeatmap (project-heatmap.js) ‚îÄ‚îÄ
// project-heatmap.js ‚Äî Domain √ó Project mapping heatmap

const ProjectHeatmap = {
  name: 'ProjectHeatmap',
  template: `
    <div class="space-y-4">
      <p class="text-sm text-gray-500">Rows = Domains ¬∑ Columns = Projects. Dark cells = primary domain, light cells = secondary involvement.</p>

      <div class="relative">
        <p class="text-xs text-gray-400 mb-1 md:hidden">‚Üê Horizontal scrollen ‚Üí</p>
        <div class="bg-white rounded-xl border border-surface-200 overflow-auto">
        <table class="text-xs border-collapse min-w-max">
          <thead class="sticky top-0 z-20 bg-white">
            <tr>
              <th class="sticky left-0 z-30 bg-surface-50 px-3 py-2 text-left font-medium text-gray-600 border-b border-r border-surface-200 min-w-[200px]">Domain</th>
              <th v-for="p in store.data.projects" :key="p.id"
                  class="px-1 py-2 border-b border-surface-200 text-center font-medium text-gray-600 min-w-[50px]"
                  :title="p.name">
                <div style="writing-mode: vertical-lr; transform: rotate(180deg); max-height: 120px; overflow: hidden;">
                  {{ p.name.length > 20 ? p.name.slice(0, 18) + '‚Ä¶' : p.name }}
                </div>
              </th>
              <th class="px-3 py-2 border-b border-surface-200 text-center font-medium text-gray-600">Total</th>
            </tr>
          </thead>
          <tbody>
            <tr v-for="domain in store.data.domains" :key="domain.id" class="hover:bg-surface-50">
              <td class="sticky left-0 z-10 bg-white px-3 py-2 border-b border-r border-surface-100 whitespace-nowrap">
                <div class="flex items-center gap-2">
                  <span class="domain-swatch" :style="{ backgroundColor: domain.color }"></span>
                  <a :href="linkTo('/domains/' + domain.id)" class="text-gray-700 hover:text-primary-600">{{ domain.id }}. {{ domain.name }}</a>
                </div>
              </td>
              <td v-for="p in store.data.projects" :key="p.id"
                  class="border-b border-surface-100 text-center p-0">
                <div v-if="p.primaryDomain === domain.id"
                     class="w-full h-full py-2 font-bold text-white"
                     :style="{ backgroundColor: domain.color }"
                     :title="p.name + ' ‚Äî Primary'">
                  P
                </div>
                <div v-else-if="p.secondaryDomains && p.secondaryDomains.includes(domain.id)"
                     class="w-full h-full py-2"
                     :style="{ backgroundColor: domain.color + '30', color: domain.color }"
                     :title="p.name + ' ‚Äî Secondary'">
                  S
                </div>
              </td>
              <td class="px-3 py-2 border-b border-surface-100 text-center text-gray-700 font-medium">
                {{ projectCount(domain.id) }}
              </td>
            </tr>
          </tbody>
          <tfoot>
            <tr class="bg-surface-50">
              <td class="sticky left-0 z-10 bg-surface-50 px-3 py-2 border-t border-r border-surface-200 font-medium text-gray-600">Total</td>
              <td v-for="p in store.data.projects" :key="p.id" class="px-1 py-2 border-t border-surface-200 text-center text-gray-600 font-medium">
                {{ domainCount(p) }}
              </td>
              <td class="px-3 py-2 border-t border-surface-200"></td>
            </tr>
          </tfoot>
        </table>
      </div>
      </div>

      <!-- Summary stats -->
      <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
        <div class="bg-white rounded-xl border border-surface-200 p-4 text-center" v-for="stat in summaryStats" :key="stat.label">
          <div class="text-2xl font-bold" :style="{ color: stat.color }">{{ stat.value }}</div>
          <div class="text-xs text-gray-500">{{ stat.label }}</div>
        </div>
      </div>

      <!-- Legend -->
      <div class="flex items-center gap-6 text-xs text-gray-500">
        <span class="flex items-center gap-1"><span class="w-4 h-4 rounded bg-primary-500 text-white text-center text-[10px] leading-4 font-bold">P</span> Primary Domain</span>
        <span class="flex items-center gap-1"><span class="w-4 h-4 rounded bg-primary-100 text-primary-600 text-center text-[10px] leading-4">S</span> Secondary Involvement</span>
      </div>
    </div>
  `,
  setup () {
    const { computed } = Vue

    function projectCount (domainId) {
      return store.data.projects.filter(p =>
        p.primaryDomain === domainId || (p.secondaryDomains && p.secondaryDomains.includes(domainId))
      ).length
    }

    function domainCount (project) {
      return 1 + (project.secondaryDomains ? project.secondaryDomains.length : 0)
    }

    const summaryStats = computed(() => {
      // Domains with most projects
      const domainCounts = store.data.domains.map(d => ({ name: d.name, count: projectCount(d.id), color: d.color }))
      domainCounts.sort((a, b) => b.count - a.count)
      const topDomain = domainCounts[0]
      const coldDomains = domainCounts.filter(d => d.count === 0)

      return [
        { label: 'Most Active Domain', value: topDomain ? topDomain.name.split(' ')[0] : '‚Äî', color: topDomain?.color || '#94a3b8' },
        { label: 'Projects', value: store.totalProjects, color: '#3b82f6' },
        { label: 'Cross-Domain Projects', value: store.data.projects.filter(p => p.secondaryDomains && p.secondaryDomains.length > 0).length, color: '#8b5cf6' },
        { label: 'Domains w/o Projects', value: coldDomains.length, color: coldDomains.length > 0 ? '#ef4444' : '#10b981' }
      ]
    })

    return { store, linkTo, projectCount, domainCount, summaryStats }
  }
}


// ‚îÄ‚îÄ DependencyGraph (dependency-graph.js) ‚îÄ‚îÄ
// dependency-graph.js ‚Äî D3 force-directed project dependency network

const DependencyGraph = {
  name: 'DependencyGraph',
  template: `
    <div class="space-y-4">
      <p class="text-sm text-gray-500">Force-directed graph of project dependencies. Arrows show direction (source depends on target). Drag nodes to rearrange.</p>

      <!-- Legend -->
      <div class="flex flex-wrap items-center gap-4 text-xs text-gray-500">
        <span class="font-medium">Dependency types:</span>
        <span v-for="dt in depTypes" :key="dt.value" class="flex items-center gap-1">
          <span class="w-3 h-0.5 inline-block rounded" :style="{ backgroundColor: depColor(dt.value) }"></span>
          {{ dt.symbol }} {{ dt.label }}
        </span>
      </div>

      <div class="bg-white rounded-xl border border-surface-200 overflow-hidden">
        <div ref="graphContainer" class="w-full h-[400px] lg:h-[560px]"></div>
      </div>

      <!-- Dependency table -->
      <div class="bg-white rounded-xl border border-surface-200 overflow-x-auto">
        <div class="px-5 py-3 border-b border-surface-200 bg-surface-50">
          <h3 class="text-sm font-semibold text-gray-700">All Dependencies ({{ store.data.projectDependencies.length }})</h3>
        </div>
        <table class="w-full text-sm">
          <thead>
            <tr class="border-b border-surface-200 bg-surface-50">
              <th class="text-left px-4 py-2 font-medium text-gray-600">Source (depends on ‚Üí)</th>
              <th class="text-left px-4 py-2 font-medium text-gray-600">Type</th>
              <th class="text-left px-4 py-2 font-medium text-gray-600">Target (blocking)</th>
              <th class="text-left px-4 py-2 font-medium text-gray-600 hidden sm:table-cell">Description</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-surface-100">
            <tr v-for="dep in store.data.projectDependencies" :key="dep.sourceProjectId + dep.targetProjectId" class="hover:bg-surface-50">
              <td class="px-4 py-2 text-gray-700">{{ projName(dep.sourceProjectId) }}</td>
              <td class="px-4 py-2">
                <span class="text-xs px-2 py-0.5 rounded-full" :style="{ backgroundColor: depColor(dep.type) + '20', color: depColor(dep.type) }">
                  {{ depLabel(dep.type) }}
                </span>
              </td>
              <td class="px-4 py-2 text-gray-700">{{ projName(dep.targetProjectId) }}</td>
              <td class="px-4 py-2 text-xs text-gray-500 hidden sm:table-cell">{{ dep.description }}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  `,
  setup () {
    const { ref, onMounted, nextTick } = Vue
    const graphContainer = ref(null)
    const depTypes = store.data.enums.dependencyType || []

    const depColorMap = { T: '#ef4444', D: '#3b82f6', P: '#8b5cf6', R: '#f59e0b', F: '#10b981', Z: '#64748b' }
    function depColor (type) { return depColorMap[type] || '#94a3b8' }
    function depLabel (type) {
      const dt = depTypes.find(d => d.value === type)
      return dt ? dt.symbol : type
    }
    function projName (id) { const p = store.projectById(id); return p ? p.name : id }

    function renderGraph () {
      if (!graphContainer.value || typeof d3 === 'undefined') return

      const container = graphContainer.value
      const width = container.clientWidth
      const height = container.clientHeight || 560

      // Build nodes & links
      const projectIds = new Set()
      store.data.projectDependencies.forEach(d => { projectIds.add(d.sourceProjectId); projectIds.add(d.targetProjectId) })
      // Include all projects even if no deps
      store.data.projects.forEach(p => projectIds.add(p.id))

      const nodes = [...projectIds].map(id => {
        const p = store.projectById(id)
        return {
          id,
          name: p ? p.name : id,
          status: p ? p.status : 'gray',
          budget: p ? p.budget : 0,
          domainColor: p ? (store.domainById(p.primaryDomain)?.color || '#94a3b8') : '#94a3b8'
        }
      })

      const links = store.data.projectDependencies.map(d => ({
        source: d.sourceProjectId,
        target: d.targetProjectId,
        type: d.type
      }))

      // Clear previous
      d3.select(container).selectAll('*').remove()

      const svg = d3.select(container).append('svg')
        .attr('width', width).attr('height', height)
        .attr('viewBox', [0, 0, width, height])

      // Arrow markers
      const defs = svg.append('defs')
      Object.entries(depColorMap).forEach(([type, color]) => {
        defs.append('marker')
          .attr('id', 'arrow-' + type)
          .attr('viewBox', '0 -5 10 10')
          .attr('refX', 25).attr('refY', 0)
          .attr('markerWidth', 6).attr('markerHeight', 6)
          .attr('orient', 'auto')
          .append('path').attr('d', 'M0,-5L10,0L0,5').attr('fill', color)
      })

      const simulation = d3.forceSimulation(nodes)
        .force('link', d3.forceLink(links).id(d => d.id).distance(120))
        .force('charge', d3.forceManyBody().strength(-400))
        .force('center', d3.forceCenter(width / 2, height / 2))
        .force('collision', d3.forceCollide().radius(40))

      const link = svg.append('g').selectAll('line')
        .data(links).join('line')
        .attr('class', 'dep-link')
        .attr('stroke', d => depColor(d.type))
        .attr('stroke-width', 2)
        .attr('marker-end', d => 'url(#arrow-' + d.type + ')')

      const node = svg.append('g').selectAll('g')
        .data(nodes).join('g')
        .call(d3.drag()
          .on('start', (e, d) => { if (!e.active) simulation.alphaTarget(0.3).restart(); d.fx = d.x; d.fy = d.y })
          .on('drag', (e, d) => { d.fx = e.x; d.fy = e.y })
          .on('end', (e, d) => { if (!e.active) simulation.alphaTarget(0); d.fx = null; d.fy = null })
        )
        .style('cursor', 'pointer')
        .on('click', (e, d) => { navigateTo('/projects/' + d.id) })

      const statusColors = { green: '#22c55e', yellow: '#eab308', red: '#ef4444' }

      node.append('circle')
        .attr('r', d => Math.max(12, Math.sqrt(d.budget / 5000)))
        .attr('fill', d => d.domainColor)
        .attr('stroke', d => statusColors[d.status] || '#94a3b8')
        .attr('stroke-width', 3)
        .attr('opacity', 0.85)

      node.append('text')
        .text(d => d.name.length > 22 ? d.name.slice(0, 20) + '‚Ä¶' : d.name)
        .attr('x', 0).attr('y', d => Math.max(12, Math.sqrt(d.budget / 5000)) + 14)
        .attr('text-anchor', 'middle')
        .attr('fill', '#374151')
        .attr('font-size', width < 600 ? '11px' : '10px')

      simulation.on('tick', () => {
        link
          .attr('x1', d => d.source.x).attr('y1', d => d.source.y)
          .attr('x2', d => d.target.x).attr('y2', d => d.target.y)
        node.attr('transform', d => 'translate(' + d.x + ',' + d.y + ')')
      })
    }

    onMounted(() => {
      nextTick(renderGraph)
      // Re-render on resize
      if (typeof ResizeObserver !== 'undefined' && graphContainer.value) {
        let resizeTimer = null
        const ro = new ResizeObserver(() => {
          clearTimeout(resizeTimer)
          resizeTimer = setTimeout(renderGraph, 200)
        })
        ro.observe(graphContainer.value)
      }
    })

    return { store, graphContainer, depTypes, depColor, depLabel, projName }
  }
}


// ‚îÄ‚îÄ ProcessList (process-list.js) ‚îÄ‚îÄ
// process-list.js ‚Äî E2E Process overview table

const ProcessList = {
  name: 'ProcessList',
  template: `
    <div class="space-y-6">
      <div class="flex items-center justify-between">
        <div></div>
        <button @click="showForm = true" class="px-4 py-2 bg-primary-600 text-white text-sm rounded-lg hover:bg-primary-700">+ Add Process</button>
      </div>

      <div class="bg-white rounded-xl border border-surface-200 overflow-x-auto">
        <table class="w-full text-sm">
          <thead class="bg-surface-50 text-xs text-gray-500 uppercase tracking-wide">
            <tr>
              <th class="px-5 py-3 text-left">ID</th>
              <th class="px-5 py-3 text-left">Process</th>
              <th class="px-5 py-3 text-left hidden md:table-cell">Owner</th>
              <th class="px-5 py-3 text-left">Status</th>
              <th class="px-5 py-3 text-left hidden sm:table-cell">Domains</th>
              <th class="px-5 py-3 text-right hidden sm:table-cell">Apps</th>
              <th class="px-5 py-3 text-right hidden md:table-cell">KPIs</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-surface-100">
            <tr v-for="proc in processes" :key="proc.id" class="hover:bg-surface-50 cursor-pointer"
                @click="go(proc.id)">
              <td class="px-5 py-3 font-mono text-xs text-gray-500">{{ proc.id }}</td>
              <td class="px-5 py-3 font-medium text-gray-800">{{ proc.name }}</td>
              <td class="px-5 py-3 text-gray-500 hidden md:table-cell">{{ proc.owner || '‚Äî' }}</td>
              <td class="px-5 py-3">
                <span class="text-[10px] px-2 py-0.5 rounded-full" :class="statusClass(proc.status)">{{ proc.status }}</span>
              </td>
              <td class="px-5 py-3 hidden sm:table-cell">
                <div class="flex gap-1">
                  <span v-for="did in proc.domains" :key="did"
                        class="w-5 h-5 rounded text-[9px] text-white font-bold flex items-center justify-center"
                        :style="{ backgroundColor: domainColor(did) }">{{ did }}</span>
                </div>
              </td>
              <td class="px-5 py-3 text-right text-gray-500 hidden sm:table-cell">{{ appCount(proc.id) }}</td>
              <td class="px-5 py-3 text-right text-gray-500 hidden md:table-cell">{{ proc.kpis ? proc.kpis.length : 0 }}</td>
            </tr>
          </tbody>
        </table>
        <div v-if="!processes.length" class="text-center py-8 text-gray-400 text-sm">No E2E processes defined yet.</div>
      </div>

      <process-form v-if="showForm" @close="showForm = false" @saved="showForm = false" />
    </div>
  `,
  setup () {
    const { ref, computed } = Vue
    const showForm = ref(false)

    const processes = computed(() => store.data.e2eProcesses || [])

    function domainColor (id) {
      const d = store.domainById(id)
      return d ? d.color : '#94a3b8'
    }

    function statusClass (s) {
      return { active: 'bg-green-100 text-green-700', optimization: 'bg-blue-100 text-blue-700', transformation: 'bg-purple-100 text-purple-700' }[s] || 'bg-gray-100 text-gray-600'
    }

    function appCount (procId) {
      return store.appsForProcess(procId).length
    }

    function go (id) { window.location.hash = '/processes/' + id }

    return { store, linkTo, showForm, processes, domainColor, statusClass, appCount, go }
  }
}


// ‚îÄ‚îÄ ProcessDetail (process-detail.js) ‚îÄ‚îÄ
// process-detail.js ‚Äî E2E Process detail view with KPIs and domain links

const ProcessDetail = {
  name: 'ProcessDetail',
  template: `
    <div v-if="proc" class="space-y-6">
      <div class="flex items-center gap-4">
        <a :href="linkTo('/processes')" class="text-sm text-gray-500 hover:text-primary-600">‚Üê Processes</a>
      </div>

      <!-- Header -->
      <div class="flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3">
        <div>
          <div class="flex items-center gap-3 mb-1">
            <span class="text-xs font-mono bg-surface-100 px-2 py-0.5 rounded text-gray-500">{{ proc.id }}</span>
            <span class="text-[10px] px-2 py-0.5 rounded-full" :class="statusClass(proc.status)">{{ proc.status }}</span>
          </div>
          <h2 class="text-xl font-bold text-gray-900">{{ proc.name }}</h2>
          <p v-if="proc.description" class="text-sm text-gray-500 mt-1">{{ proc.description }}</p>
          <div v-if="proc.owner" class="mt-1">
            <span class="text-xs px-2 py-0.5 rounded-full bg-surface-100 text-gray-600">Owner: {{ proc.owner }}</span>
          </div>
        </div>
        <div class="flex items-center gap-2 shrink-0">
          <button @click="showForm = true" class="px-3 py-1.5 text-xs bg-primary-600 text-white rounded-lg hover:bg-primary-700">Edit</button>
          <button @click="deleteProc" class="px-3 py-1.5 text-xs border border-red-300 text-red-600 rounded-lg hover:bg-red-50">Delete</button>
        </div>
      </div>

      <!-- Linked Domains -->
      <div class="bg-white rounded-xl border border-surface-200 overflow-hidden">
        <div class="px-5 py-3 border-b border-surface-200 bg-surface-50">
          <h3 class="text-sm font-semibold text-gray-700">Linked Domains</h3>
        </div>
        <div class="p-5 flex flex-wrap gap-3">
          <a v-for="d in linkedDomains" :key="d.id" :href="linkTo('/domains/' + d.id)"
             class="flex items-center gap-2 px-3 py-2 rounded-lg border border-surface-200 hover:bg-surface-50 transition-colors">
            <div class="w-6 h-6 rounded flex items-center justify-center text-white text-[10px] font-bold"
                 :style="{ backgroundColor: d.color }">{{ d.id }}</div>
            <span class="text-sm text-gray-700">{{ d.name }}</span>
          </a>
          <div v-if="!linkedDomains.length" class="text-sm text-gray-400">No domains linked.</div>
        </div>
      </div>

      <!-- Involved Applications (derived via Domain ‚Üí Capability ‚Üí Mapping) -->
      <div class="bg-white rounded-xl border border-surface-200 overflow-hidden">
        <div class="px-5 py-3 border-b border-surface-200 bg-surface-50">
          <h3 class="text-sm font-semibold text-gray-700">Involvierte Applikationen ({{ involvedApps.length }})</h3>
          <p class="text-[10px] text-gray-400 mt-0.5">Automatisch abgeleitet √ºber Domain ‚Üí Capability ‚Üí Mapping</p>
        </div>
        <div v-if="involvedApps.length" class="divide-y divide-surface-100">
          <a v-for="app in involvedApps" :key="app.id" :href="linkTo('/apps/' + app.id)"
             class="flex items-center justify-between px-5 py-3 hover:bg-surface-50 transition-colors">
            <div class="flex items-center gap-3">
              <span class="text-xs font-mono text-gray-400">{{ app.id }}</span>
              <span class="text-sm font-medium text-gray-800">{{ app.name }}</span>
              <span class="text-[10px] px-1.5 py-0.5 rounded-full" :class="timeClass(app.timeQuadrant)">{{ app.timeQuadrant }}</span>
            </div>
            <div class="flex items-center gap-3">
              <span class="text-[10px] text-gray-400">{{ app.capCount }} Capabilities</span>
              <span class="text-[10px] px-1.5 py-0.5 rounded bg-surface-100 text-gray-500">{{ app.roles }}</span>
            </div>
          </a>
        </div>
        <div v-else class="px-5 py-4 text-sm text-gray-400 italic">Keine Applikationen √ºber Capability-Mappings verkn√ºpft.</div>
      </div>

      <!-- Process KPIs -->
      <div v-if="proc.kpis && proc.kpis.length" class="bg-white rounded-xl border border-surface-200 overflow-hidden">
        <div class="px-5 py-3 border-b border-surface-200 bg-surface-50">
          <h3 class="text-sm font-semibold text-gray-700">Process KPIs</h3>
        </div>
        <div class="p-5 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
          <div v-for="kpi in proc.kpis" :key="kpi.id" class="border border-surface-200 rounded-lg p-4">
            <div class="flex items-center justify-between mb-2">
              <span class="text-xs font-medium text-gray-700">{{ kpi.name }}</span>
              <span class="text-[10px] px-1.5 py-0.5 rounded-full"
                    :class="trendClass(kpi.trend)">
                {{ trendIcon(kpi.trend) }}
              </span>
            </div>
            <div class="flex items-baseline gap-2">
              <span class="text-2xl font-bold" :style="{ color: kpiColor(kpi) }">{{ kpi.current }}</span>
              <span class="text-xs text-gray-400">/ {{ kpi.target }} {{ kpi.unit }}</span>
            </div>
            <div class="mt-2 w-full h-1.5 bg-surface-100 rounded-full overflow-hidden">
              <div class="h-full rounded-full transition-all" :style="{ width: kpiProgress(kpi) + '%', backgroundColor: kpiColor(kpi) }"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Modal -->
      <process-form v-if="showForm" :edit-process="proc" @close="showForm = false" @saved="showForm = false" />
    </div>
    <div v-else class="text-center py-12 text-gray-500">Process not found.</div>
  `,
  setup () {
    const { ref, computed } = Vue
    const showForm = ref(false)

    const proc = computed(() => store.processById(router.params.id))

    const linkedDomains = computed(() => {
      if (!proc.value || !proc.value.domains) return []
      return proc.value.domains.map(id => store.domainById(id)).filter(Boolean)
    })

    const involvedApps = computed(() => {
      if (!proc.value) return []
      return store.appsForProcess(proc.value.id)
    })

    function statusClass (s) {
      return { active: 'bg-green-100 text-green-700', optimization: 'bg-blue-100 text-blue-700', transformation: 'bg-purple-100 text-purple-700' }[s] || 'bg-gray-100 text-gray-600'
    }
    function timeClass (t) {
      return { Invest: 'bg-green-100 text-green-700', Tolerate: 'bg-yellow-100 text-yellow-700', Migrate: 'bg-blue-100 text-blue-700', Eliminate: 'bg-red-100 text-red-700' }[t] || ''
    }
    function trendClass (t) {
      return { improving: 'bg-green-100 text-green-700', stable: 'bg-gray-100 text-gray-600', declining: 'bg-red-100 text-red-700' }[t] || 'bg-gray-100 text-gray-600'
    }
    function trendIcon (t) { return { improving: '‚Üë', stable: '‚Üí', declining: '‚Üì' }[t] || '‚Üí' }

    function kpiProgress (kpi) {
      const c = parseFloat(kpi.current) || 0; const t = parseFloat(kpi.target) || 1
      return Math.min(100, (c / t) * 100)
    }
    function kpiColor (kpi) {
      const pct = kpiProgress(kpi)
      if (pct >= 80) return '#10b981'; if (pct >= 50) return '#f59e0b'; return '#ef4444'
    }

    function deleteProc () {
      if (!proc.value) return
      if (confirm('Delete process "' + proc.value.name + '"?')) {
        store.deleteProcess(proc.value.id)
        navigateTo('/processes')
      }
    }

    return { store, router, linkTo, proc, linkedDomains, involvedApps, showForm, statusClass, timeClass, trendClass, trendIcon, kpiProgress, kpiColor, deleteProc }
  }
}


// ‚îÄ‚îÄ VendorList (vendor-list.js) ‚îÄ‚îÄ
// vendor-list.js ‚Äî Vendor table with sort/filter

const VendorList = {
  name: 'VendorList',
  template: `
    <div class="space-y-4">
      <!-- Toolbar -->
      <div class="flex flex-wrap items-center gap-3">
        <input v-model="search" type="text" placeholder="Search vendors‚Ä¶"
               class="flex-1 min-w-[200px] px-3 py-2 border border-surface-200 rounded-lg text-sm focus:ring-2 focus:ring-primary-300 focus:border-primary-400 outline-none" />
        <select v-model="filterStatus" class="px-3 py-2 border border-surface-200 rounded-lg text-sm bg-white">
          <option value="">All Status</option>
          <option v-for="s in store.data.enums.vendorStatus" :key="s" :value="s">{{ s }}</option>
        </select>
        <select v-model="filterCrit" class="px-3 py-2 border border-surface-200 rounded-lg text-sm bg-white">
          <option value="">All Criticality</option>
          <option v-for="c in store.data.enums.vendorCriticality" :key="c" :value="c">{{ c }}</option>
        </select>
        <button @click="showForm = true"
                class="px-4 py-2 bg-primary-600 text-white rounded-lg text-sm hover:bg-primary-700 transition-colors whitespace-nowrap">
          + Add Vendor
        </button>
      </div>

      <!-- Count -->
      <div class="text-xs text-gray-500">{{ filtered.length }} of {{ store.totalVendors }} vendors</div>

      <!-- Table -->
      <div class="bg-white rounded-xl border border-surface-200 overflow-x-auto">
        <table class="w-full text-sm">
          <thead>
            <tr class="border-b border-surface-200 bg-surface-50">
              <th class="text-left px-4 py-3 font-medium text-gray-600 cursor-pointer hover:text-gray-900" @click="toggleSort('name')">Vendor {{ sortIcon('name') }}</th>
              <th class="text-left px-4 py-3 font-medium text-gray-600 hidden md:table-cell">Category</th>
              <th class="text-left px-4 py-3 font-medium text-gray-600 cursor-pointer hover:text-gray-900" @click="toggleSort('criticality')">Criticality {{ sortIcon('criticality') }}</th>
              <th class="text-left px-4 py-3 font-medium text-gray-600 cursor-pointer hover:text-gray-900" @click="toggleSort('status')">Status {{ sortIcon('status') }}</th>
              <th class="text-right px-4 py-3 font-medium text-gray-600 cursor-pointer hover:text-gray-900 hidden md:table-cell" @click="toggleSort('contractValue')">Contract Value {{ sortIcon('contractValue') }}</th>
              <th class="text-left px-4 py-3 font-medium text-gray-600 hidden lg:table-cell">Contract End</th>
              <th class="text-right px-4 py-3 font-medium text-gray-600 hidden lg:table-cell">Apps</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-surface-100">
            <tr v-for="v in filtered" :key="v.id"
                class="hover:bg-surface-50 cursor-pointer transition-colors"
                @click="navigateTo('/vendors/' + v.id)">
              <td class="px-4 py-3">
                <div class="font-medium text-gray-900">{{ v.name }}</div>
                <div class="text-xs text-gray-400">{{ v.id }}</div>
              </td>
              <td class="px-4 py-3 text-gray-600 hidden md:table-cell">{{ v.category }}</td>
              <td class="px-4 py-3">
                <span class="text-xs px-2 py-0.5 rounded-full" :class="critClass(v.criticality)">{{ v.criticality }}</span>
              </td>
              <td class="px-4 py-3">
                <span class="text-xs px-2 py-0.5 rounded-full" :class="statusClass(v.status)">{{ v.status }}</span>
              </td>
              <td class="px-4 py-3 text-right text-gray-700 font-mono hidden md:table-cell">{{ v.contractValue > 0 ? '‚Ç¨' + v.contractValue.toLocaleString() : '‚Äî' }}</td>
              <td class="px-4 py-3 text-gray-600 hidden lg:table-cell">{{ v.contractEnd || '‚Äî' }}</td>
              <td class="px-4 py-3 text-right text-gray-600 hidden lg:table-cell">{{ vendorAppCount(v.id) }}</td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Total -->
      <div class="flex justify-end text-sm text-gray-500">
        Total contract value: <strong class="ml-1 text-gray-800">‚Ç¨{{ totalContractValue.toLocaleString() }}</strong>
      </div>

      <!-- Vendor Form Modal -->
      <vendor-form v-if="showForm" @close="showForm = false" @saved="onSaved"></vendor-form>
    </div>
  `,
  setup () {
    const { ref, computed } = Vue
    const search = ref('')
    const filterStatus = ref('')
    const filterCrit = ref('')
    const sortBy = ref('name')
    const sortDir = ref(1)
    const showForm = ref(false)

    function toggleSort (field) {
      if (sortBy.value === field) sortDir.value *= -1
      else { sortBy.value = field; sortDir.value = 1 }
    }
    function sortIcon (field) {
      if (sortBy.value !== field) return ''
      return sortDir.value === 1 ? '‚Üë' : '‚Üì'
    }

    const filtered = computed(() => {
      let list = [...(store.data.vendors || [])]
      const q = search.value.toLowerCase()
      if (q) list = list.filter(v => v.name.toLowerCase().includes(q) || v.category.toLowerCase().includes(q) || (v.contactPerson || '').toLowerCase().includes(q))
      if (filterStatus.value) list = list.filter(v => v.status === filterStatus.value)
      if (filterCrit.value) list = list.filter(v => v.criticality === filterCrit.value)
      list.sort((a, b) => {
        const av = a[sortBy.value], bv = b[sortBy.value]
        if (typeof av === 'number') return (av - bv) * sortDir.value
        return String(av || '').localeCompare(String(bv || '')) * sortDir.value
      })
      return list
    })

    const totalContractValue = computed(() => filtered.value.reduce((s, v) => s + (v.contractValue || 0), 0))

    function vendorAppCount (vendorId) {
      return store.appsForVendor(vendorId).length
    }

    function critClass (c) {
      return { Strategic: 'bg-red-100 text-red-700', Important: 'bg-orange-100 text-orange-700', Standard: 'bg-yellow-100 text-yellow-700', Commodity: 'bg-gray-100 text-gray-600' }[c] || 'bg-gray-100 text-gray-600'
    }
    function statusClass (s) {
      return { Active: 'bg-green-100 text-green-700', 'Under Review': 'bg-yellow-100 text-yellow-700', 'Phase-Out': 'bg-red-100 text-red-700', New: 'bg-blue-100 text-blue-700' }[s] || 'bg-gray-100 text-gray-600'
    }

    function onSaved () { showForm.value = false }

    return { store, linkTo, navigateTo, search, filterStatus, filterCrit, sortBy, sortDir, filtered, totalContractValue, vendorAppCount, toggleSort, sortIcon, critClass, statusClass, showForm, onSaved }
  }
}


// ‚îÄ‚îÄ VendorDetail (vendor-detail.js) ‚îÄ‚îÄ
// vendor-detail.js ‚Äî Vendor detail view with related applications, contracts, edit/delete

const VendorDetail = {
  name: 'VendorDetail',
  template: `
    <div v-if="vendor" class="space-y-6">
      <!-- Back link -->
      <a :href="linkTo('/vendors')" class="text-sm text-gray-500 hover:text-primary-600">‚Üê Vendors</a>

      <!-- Header -->
      <div class="bg-white rounded-xl border border-surface-200 p-6">
        <div class="flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3">
          <div>
            <div class="flex items-center gap-3 mb-1">
              <h2 class="text-xl font-bold text-gray-900">{{ vendor.name }}</h2>
              <span class="text-xs px-2 py-0.5 rounded-full" :class="statusClass(vendor.status)">{{ vendor.status }}</span>
              <span class="text-xs px-2 py-0.5 rounded-full" :class="critClass(vendor.criticality)">{{ vendor.criticality }}</span>
            </div>
            <div class="text-sm text-gray-500">{{ vendor.id }} ¬∑ {{ vendor.category }}</div>
            <p class="text-sm text-gray-600 mt-3 max-w-2xl">{{ vendor.description }}</p>
          </div>
          <div class="flex gap-2 shrink-0">
            <button @click="showEdit = true" class="px-3 py-1.5 border border-gray-300 rounded-lg text-xs hover:bg-surface-100">Edit</button>
            <button @click="confirmDelete" class="px-3 py-1.5 border border-red-300 text-red-600 rounded-lg text-xs hover:bg-red-50">Delete</button>
          </div>
        </div>

        <!-- Metrics -->
        <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-4 mt-6 pt-4 border-t border-surface-100">
          <div>
            <div class="text-xs text-gray-500">Contract Value / Year</div>
            <div class="text-lg font-bold text-gray-800">{{ vendor.contractValue > 0 ? '‚Ç¨' + vendor.contractValue.toLocaleString() : '‚Äî' }}</div>
          </div>
          <div>
            <div class="text-xs text-gray-500">Contract End</div>
            <div class="text-lg font-bold text-gray-800">{{ vendor.contractEnd || '‚Äî' }}</div>
          </div>
          <div>
            <div class="text-xs text-gray-500">Service Level</div>
            <div class="text-lg font-bold text-gray-800">{{ vendor.serviceLevel || '‚Äî' }}</div>
          </div>
          <div>
            <div class="text-xs text-gray-500">Applications</div>
            <div class="text-lg font-bold text-primary-600">{{ relatedApps.length }}</div>
          </div>
        </div>

        <!-- Contact & Manager -->
        <div class="grid grid-cols-2 gap-4 mt-4 pt-4 border-t border-surface-100">
          <div>
            <div class="text-xs text-gray-500">Contact Person</div>
            <div class="text-sm text-gray-800">{{ vendor.contactPerson || '‚Äî' }}</div>
          </div>
          <div>
            <div class="text-xs text-gray-500">Vendor Manager</div>
            <div class="text-sm text-gray-800">{{ vendor.vendorManager || '‚Äî' }}</div>
          </div>
          <div>
            <div class="text-xs text-gray-500">Website</div>
            <div class="text-sm text-gray-800">{{ vendor.website || '‚Äî' }}</div>
          </div>
          <div>
            <div class="text-xs text-gray-500">Rating</div>
            <div class="text-lg font-bold" :class="vendor.rating >= 7 ? 'text-green-600' : vendor.rating <= 3 ? 'text-red-600' : 'text-gray-800'">{{ vendor.rating || '‚Äî' }}/10</div>
          </div>
        </div>
      </div>

      <!-- Related Applications -->
      <div class="bg-white rounded-xl border border-surface-200 overflow-hidden">
        <div class="px-5 py-3 border-b border-surface-200 bg-surface-50">
          <h3 class="text-sm font-semibold text-gray-700">Applications from this Vendor ({{ relatedApps.length }})</h3>
        </div>
        <div v-if="relatedApps.length === 0" class="px-5 py-4 text-sm text-gray-400 italic">No applications linked to this vendor.</div>
        <div v-else class="divide-y divide-surface-100">
          <a v-for="app in relatedApps" :key="app.id" :href="linkTo('/apps/' + app.id)"
             class="flex items-center justify-between px-5 py-3 hover:bg-surface-50 transition-colors">
            <div class="flex items-center gap-3">
              <span class="text-xs font-mono text-gray-400">{{ app.id }}</span>
              <span class="text-sm text-gray-800">{{ app.name }}</span>
              <span class="text-xs px-2 py-0.5 rounded-full" :class="timeClass(app.timeQuadrant)">{{ app.timeQuadrant }}</span>
            </div>
            <span class="text-xs text-gray-400">‚Ç¨{{ (app.costPerYear || 0).toLocaleString() }}/yr</span>
          </a>
        </div>
      </div>

      <!-- Edit Modal -->
      <vendor-form v-if="showEdit" :edit-vendor="vendor" @close="showEdit = false" @saved="showEdit = false"></vendor-form>
    </div>
    <div v-else class="text-center py-12 text-gray-500">Vendor not found.</div>
  `,
  setup () {
    const { ref, computed } = Vue
    const showEdit = ref(false)

    const vendor = computed(() => store.vendorById(router.params.id))

    const relatedApps = computed(() => {
      if (!vendor.value) return []
      return store.appsForVendor(vendor.value.id)
    })

    function statusClass (s) {
      return { Active: 'bg-green-100 text-green-700', 'Under Review': 'bg-yellow-100 text-yellow-700', 'Phase-Out': 'bg-red-100 text-red-700', New: 'bg-blue-100 text-blue-700' }[s] || 'bg-gray-100 text-gray-600'
    }
    function critClass (c) {
      return { Strategic: 'bg-red-100 text-red-700', Important: 'bg-orange-100 text-orange-700', Standard: 'bg-yellow-100 text-yellow-700', Commodity: 'bg-gray-100 text-gray-600' }[c] || 'bg-gray-100 text-gray-600'
    }
    function timeClass (t) {
      return { Invest: 'bg-green-100 text-green-700', Tolerate: 'bg-yellow-100 text-yellow-700', Migrate: 'bg-blue-100 text-blue-700', Eliminate: 'bg-red-100 text-red-700' }[t] || ''
    }

    function confirmDelete () {
      if (vendor.value && confirm('Delete "' + vendor.value.name + '"? This cannot be undone.')) {
        store.deleteVendor(vendor.value.id)
        navigateTo('/vendors')
      }
    }

    return { store, router, linkTo, navigateTo, vendor, relatedApps, showEdit, statusClass, critClass, timeClass, confirmDelete }
  }
}


// ‚îÄ‚îÄ DemandList (demand-list.js) ‚îÄ‚îÄ
// demand-list.js ‚Äî Demand backlog with filters and status overview

const DemandList = {
  name: 'DemandList',
  template: `
    <div class="space-y-4">
      <!-- Toolbar -->
      <div class="flex flex-wrap items-center gap-3">
        <input v-model="search" type="text" placeholder="Demands durchsuchen‚Ä¶"
               class="flex-1 min-w-[200px] px-3 py-2 border border-surface-200 rounded-lg text-sm focus:ring-2 focus:ring-primary-300 focus:border-primary-400 outline-none" />
        <select v-model="filterStatus" class="px-3 py-2 border border-surface-200 rounded-lg text-sm bg-white">
          <option value="">Alle Status</option>
          <option v-for="s in store.data.enums.demandStatus" :key="s" :value="s">{{ s }}</option>
        </select>
        <select v-model="filterCategory" class="px-3 py-2 border border-surface-200 rounded-lg text-sm bg-white">
          <option value="">Alle Kategorien</option>
          <option v-for="c in store.data.enums.demandCategory" :key="c" :value="c">{{ c }}</option>
        </select>
        <select v-model="filterPriority" class="px-3 py-2 border border-surface-200 rounded-lg text-sm bg-white">
          <option value="">Alle Priorit√§ten</option>
          <option v-for="p in store.data.enums.demandPriority" :key="p" :value="p">{{ p }}</option>
        </select>
        <button @click="showForm = true"
                class="px-4 py-2 bg-primary-600 text-white rounded-lg text-sm hover:bg-primary-700 transition-colors whitespace-nowrap">
          + Neuer Demand
        </button>
      </div>

      <!-- Status summary cards -->
      <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-3">
        <div v-for="s in statusSummary" :key="s.status"
             class="bg-white rounded-xl border border-surface-200 p-3 cursor-pointer hover:shadow-md transition-shadow"
             :class="filterStatus === s.status ? 'ring-2 ring-primary-400' : ''"
             @click="filterStatus = filterStatus === s.status ? '' : s.status">
          <div class="text-xs font-medium text-gray-500">{{ s.status }}</div>
          <div class="text-xl font-bold mt-1" :class="s.colorClass">{{ s.count }}</div>
        </div>
      </div>

      <!-- Count -->
      <div class="text-xs text-gray-500">{{ filtered.length }} von {{ store.totalDemands }} Demands</div>

      <!-- Table -->
      <div class="bg-white rounded-xl border border-surface-200 overflow-x-auto">
        <table class="w-full text-sm">
          <thead>
            <tr class="border-b border-surface-200 bg-surface-50">
              <th class="text-left px-4 py-3 font-medium text-gray-600 cursor-pointer hover:text-gray-900" @click="toggleSort('title')">Demand {{ sortIcon('title') }}</th>
              <th class="text-left px-4 py-3 font-medium text-gray-600 cursor-pointer hover:text-gray-900 hidden md:table-cell" @click="toggleSort('category')">Kategorie {{ sortIcon('category') }}</th>
              <th class="text-left px-4 py-3 font-medium text-gray-600 cursor-pointer hover:text-gray-900" @click="toggleSort('status')">Status {{ sortIcon('status') }}</th>
              <th class="text-left px-4 py-3 font-medium text-gray-600 cursor-pointer hover:text-gray-900" @click="toggleSort('priority')">Priorit√§t {{ sortIcon('priority') }}</th>
              <th class="text-right px-4 py-3 font-medium text-gray-600 cursor-pointer hover:text-gray-900 hidden md:table-cell" @click="toggleSort('estimatedBudget')">Budget {{ sortIcon('estimatedBudget') }}</th>
              <th class="text-left px-4 py-3 font-medium text-gray-600 hidden lg:table-cell">Eingereicht</th>
              <th class="text-left px-4 py-3 font-medium text-gray-600 hidden lg:table-cell">Freigabe</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-surface-100">
            <tr v-for="d in filtered" :key="d.id"
                class="hover:bg-surface-50 cursor-pointer transition-colors"
                @click="navigateTo('/demands/' + d.id)">
              <td class="px-4 py-3">
                <div class="font-medium text-gray-900 flex items-center gap-1.5">
                  <span v-if="d.isAIUseCase" class="text-xs" title="AI Use Case">ü§ñ</span>
                  {{ d.title }}
                </div>
                <div class="text-xs text-gray-400">{{ d.id }} ¬∑ {{ d.requestedBy }}</div>
              </td>
              <td class="px-4 py-3 hidden md:table-cell">
                <span class="text-xs px-2 py-0.5 rounded-full" :class="catClass(d.category)">{{ d.category }}</span>
              </td>
              <td class="px-4 py-3">
                <span class="text-xs px-2 py-0.5 rounded-full" :class="statusClass(d.status)">{{ d.status }}</span>
              </td>
              <td class="px-4 py-3">
                <span class="text-xs px-2 py-0.5 rounded-full" :class="prioClass(d.priority)">{{ d.priority }}</span>
              </td>
              <td class="px-4 py-3 text-right text-gray-700 font-mono hidden md:table-cell">{{ d.estimatedBudget > 0 ? '‚Ç¨' + d.estimatedBudget.toLocaleString() : '‚Äî' }}</td>
              <td class="px-4 py-3 text-gray-600 hidden lg:table-cell">{{ d.requestDate || '‚Äî' }}</td>
              <td class="px-4 py-3 hidden lg:table-cell">
                <div class="flex items-center gap-1">
                  <span class="w-2 h-2 rounded-full" :class="checklistDot(d.checklistSecurity)"></span>
                  <span class="w-2 h-2 rounded-full" :class="checklistDot(d.checklistLegal)"></span>
                  <span class="w-2 h-2 rounded-full" :class="checklistDot(d.checklistArchitecture)"></span>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Total budget -->
      <div class="flex justify-end text-sm text-gray-500">
        Gesch√§tztes Gesamtbudget: <strong class="ml-1 text-gray-800">‚Ç¨{{ totalBudget.toLocaleString() }}</strong>
      </div>

      <!-- Demand Form Modal -->
      <demand-form v-if="showForm" @close="showForm = false" @saved="onSaved"></demand-form>
    </div>
  `,
  setup () {
    const { ref, computed } = Vue
    const search = ref('')
    const filterStatus = ref('')
    const filterCategory = ref('')
    const filterPriority = ref('')
    const sortBy = ref('requestDate')
    const sortDir = ref(-1)
    const showForm = ref(false)

    function toggleSort (field) {
      if (sortBy.value === field) sortDir.value *= -1
      else { sortBy.value = field; sortDir.value = 1 }
    }
    function sortIcon (field) {
      if (sortBy.value !== field) return ''
      return sortDir.value === 1 ? '‚Üë' : '‚Üì'
    }

    const filtered = computed(() => {
      let list = [...(store.data.demands || [])]
      const q = search.value.toLowerCase()
      if (q) list = list.filter(d => d.title.toLowerCase().includes(q) || (d.description || '').toLowerCase().includes(q) || (d.requestedBy || '').toLowerCase().includes(q))
      if (filterStatus.value) list = list.filter(d => d.status === filterStatus.value)
      if (filterCategory.value) list = list.filter(d => d.category === filterCategory.value)
      if (filterPriority.value) list = list.filter(d => d.priority === filterPriority.value)
      list.sort((a, b) => {
        const av = a[sortBy.value], bv = b[sortBy.value]
        if (typeof av === 'number') return (av - bv) * sortDir.value
        return String(av || '').localeCompare(String(bv || '')) * sortDir.value
      })
      return list
    })

    const totalBudget = computed(() => filtered.value.reduce((s, d) => s + (d.estimatedBudget || 0), 0))

    const statusSummary = computed(() => {
      const statuses = store.data.enums.demandStatus || []
      const colors = {
        'Eingereicht': 'text-blue-600',
        'In Bewertung': 'text-yellow-600',
        'Genehmigt': 'text-green-600',
        'Abgelehnt': 'text-red-600',
        'In Umsetzung': 'text-purple-600',
        'Abgeschlossen': 'text-gray-600'
      }
      return statuses.map(s => ({
        status: s,
        count: (store.data.demands || []).filter(d => d.status === s).length,
        colorClass: colors[s] || 'text-gray-600'
      }))
    })

    function catClass (c) {
      return {
        'Idee': 'bg-purple-100 text-purple-700',
        'Bereichsvorhaben (< 50k)': 'bg-blue-100 text-blue-700',
        'Projekt (> 50k)': 'bg-orange-100 text-orange-700'
      }[c] || 'bg-gray-100 text-gray-600'
    }
    function statusClass (s) {
      return {
        'Eingereicht': 'bg-blue-100 text-blue-700',
        'In Bewertung': 'bg-yellow-100 text-yellow-700',
        'Genehmigt': 'bg-green-100 text-green-700',
        'Abgelehnt': 'bg-red-100 text-red-700',
        'In Umsetzung': 'bg-purple-100 text-purple-700',
        'Abgeschlossen': 'bg-gray-100 text-gray-600'
      }[s] || 'bg-gray-100 text-gray-600'
    }
    function prioClass (p) {
      return {
        'Hoch': 'bg-red-100 text-red-700',
        'Mittel': 'bg-yellow-100 text-yellow-700',
        'Niedrig': 'bg-green-100 text-green-700'
      }[p] || 'bg-gray-100 text-gray-600'
    }

    function checklistDot (checklist) {
      if (!checklist) return 'bg-gray-300'
      const items = Object.entries(checklist).filter(([k]) => k !== 'notes')
      const done = items.filter(([, v]) => v === true).length
      if (done === items.length) return 'bg-green-500'
      if (done > 0) return 'bg-yellow-500'
      return 'bg-gray-300'
    }

    function onSaved () { showForm.value = false }

    return { store, linkTo, navigateTo, search, filterStatus, filterCategory, filterPriority, sortBy, sortDir, filtered, totalBudget, statusSummary, toggleSort, sortIcon, catClass, statusClass, prioClass, checklistDot, showForm, onSaved }
  }
}


// ‚îÄ‚îÄ DemandDetail (demand-detail.js) ‚îÄ‚îÄ
// demand-detail.js ‚Äî Demand detail view with checklists for Security, Legal, Architecture

const DemandDetail = {
  name: 'DemandDetail',
  template: `
    <div v-if="demand" class="space-y-6">
      <!-- Back link -->
      <a :href="linkTo('/demands')" class="text-sm text-gray-500 hover:text-primary-600">‚Üê Demand Backlog</a>

      <!-- Header -->
      <div class="bg-white rounded-xl border border-surface-200 p-6">
        <div class="flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3">
          <div>
            <div class="flex items-center gap-3 mb-1 flex-wrap">
              <h2 class="text-xl font-bold text-gray-900">{{ demand.title }}</h2>
              <span class="text-xs px-2 py-0.5 rounded-full" :class="statusClass(demand.status)">{{ demand.status }}</span>
              <span class="text-xs px-2 py-0.5 rounded-full" :class="catClass(demand.category)">{{ demand.category }}</span>
              <span class="text-xs px-2 py-0.5 rounded-full" :class="prioClass(demand.priority)">{{ demand.priority }}</span>
            </div>
            <div class="text-sm text-gray-500">{{ demand.id }} ¬∑ Eingereicht von {{ demand.requestedBy }} am {{ demand.requestDate }}</div>
            <p class="text-sm text-gray-600 mt-3 max-w-2xl">{{ demand.description }}</p>
          </div>
          <div class="flex gap-2 shrink-0">
            <button @click="showEdit = true" class="px-3 py-1.5 border border-gray-300 rounded-lg text-xs hover:bg-surface-100">Bearbeiten</button>
            <button @click="confirmDelete" class="px-3 py-1.5 border border-red-300 text-red-600 rounded-lg text-xs hover:bg-red-50">L√∂schen</button>
          </div>
        </div>

        <!-- Metrics -->
        <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-4 mt-6 pt-4 border-t border-surface-100">
          <div>
            <div class="text-xs text-gray-500">Gesch√§tztes Budget</div>
            <div class="text-lg font-bold text-gray-800">{{ demand.estimatedBudget > 0 ? '‚Ç¨' + demand.estimatedBudget.toLocaleString() : '‚Äî' }}</div>
          </div>
          <div>
            <div class="text-xs text-gray-500">Prim√§re Dom√§ne</div>
            <div class="text-lg font-bold text-primary-600">
              <a v-if="primaryDomain" :href="linkTo('/domains/' + primaryDomain.id)" class="hover:underline">{{ primaryDomain.name }}</a>
              <span v-else>‚Äî</span>
            </div>
          </div>
          <div>
            <div class="text-xs text-gray-500">Freigabestatus</div>
            <div class="text-lg font-bold" :class="overallApprovalColor">{{ overallApprovalText }}</div>
          </div>
          <div>
            <div class="text-xs text-gray-500">Business Case</div>
            <div class="text-sm text-gray-700 mt-1">{{ demand.businessCase || '‚Äî' }}</div>
          </div>
        </div>
      </div>

      <!-- AI Use Case / EU AI Act -->
      <div v-if="demand.isAIUseCase" class="bg-white rounded-xl border border-surface-200 p-5">
        <h3 class="text-sm font-semibold text-gray-700 mb-3 flex items-center gap-2">
          <span class="text-lg">ü§ñ</span> AI Use Case ‚Äì EU AI Act Klassifikation
        </h3>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
          <div>
            <div class="text-xs text-gray-500">Risikokategorie</div>
            <span class="inline-block mt-1 text-xs px-2.5 py-1 rounded-full font-medium" :class="aiRiskClass(demand.aiRiskCategory)">{{ demand.aiRiskCategory }}</span>
          </div>
          <div class="md:col-span-2">
            <div class="text-xs text-gray-500">AI-Beschreibung</div>
            <div class="text-sm text-gray-700 mt-1">{{ demand.aiDescription || '‚Äî' }}</div>
          </div>
        </div>
        <div v-if="demand.aiRiskCategory === 'Hohes Risiko'" class="mt-3 bg-orange-50 border border-orange-200 rounded-lg p-3 text-xs text-orange-800">
          ‚ö†Ô∏è <strong>Pflichten gem√§√ü EU AI Act:</strong> Konformit√§tsbewertung, CE-Kennzeichnung, Risikomanagement-System, Daten-Governance, technische Dokumentation, menschliche Aufsicht erforderlich.
        </div>
        <div v-if="demand.aiRiskCategory === 'Unannehmbares Risiko'" class="mt-3 bg-red-50 border border-red-200 rounded-lg p-3 text-xs text-red-800">
          üö´ <strong>Verboten gem√§√ü EU AI Act:</strong> Dieses System f√§llt unter die verbotenen KI-Praktiken und darf nicht eingesetzt werden.
        </div>
      </div>

      <!-- Status Workflow -->
      <div class="bg-white rounded-xl border border-surface-200 p-5">
        <h3 class="text-sm font-semibold text-gray-700 mb-4">Status √§ndern</h3>
        <div class="flex flex-wrap gap-2">
          <button v-for="s in store.data.enums.demandStatus" :key="s"
                  @click="changeStatus(s)"
                  class="px-3 py-1.5 rounded-lg text-xs border transition-colors"
                  :class="demand.status === s ? 'bg-primary-600 text-white border-primary-600' : 'border-gray-300 text-gray-700 hover:bg-surface-100'">
            {{ s }}
          </button>
        </div>
      </div>

      <!-- Checklists -->
      <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <!-- IT Security -->
        <div class="bg-white rounded-xl border border-surface-200 overflow-hidden">
          <div class="px-5 py-3 border-b border-surface-200 flex items-center justify-between" :class="checklistHeaderClass(demand.checklistSecurity)">
            <h3 class="text-sm font-semibold text-gray-700">üîí IT Security</h3>
            <span class="text-xs font-mono" :class="checklistProgressColor(demand.checklistSecurity)">{{ checklistProgress(demand.checklistSecurity) }}</span>
          </div>
          <div class="px-5 py-3 space-y-2">
            <label class="flex items-center gap-2 text-sm cursor-pointer" @click.prevent="toggleCheck('checklistSecurity', 'dataClassification')">
              <input type="checkbox" :checked="demand.checklistSecurity.dataClassification" class="rounded border-gray-300" />
              <span>Datenklassifikation</span>
            </label>
            <label class="flex items-center gap-2 text-sm cursor-pointer" @click.prevent="toggleCheck('checklistSecurity', 'accessControl')">
              <input type="checkbox" :checked="demand.checklistSecurity.accessControl" class="rounded border-gray-300" />
              <span>Zugriffssteuerung</span>
            </label>
            <label class="flex items-center gap-2 text-sm cursor-pointer" @click.prevent="toggleCheck('checklistSecurity', 'encryptionReview')">
              <input type="checkbox" :checked="demand.checklistSecurity.encryptionReview" class="rounded border-gray-300" />
              <span>Verschl√ºsselungs-Review</span>
            </label>
            <label class="flex items-center gap-2 text-sm cursor-pointer" @click.prevent="toggleCheck('checklistSecurity', 'vulnerabilityScan')">
              <input type="checkbox" :checked="demand.checklistSecurity.vulnerabilityScan" class="rounded border-gray-300" />
              <span>Schwachstellen-Scan</span>
            </label>
            <div class="pt-2 border-t border-surface-100">
              <label class="block text-xs font-medium text-gray-500 mb-1">Notizen</label>
              <textarea v-model="demand.checklistSecurity.notes" rows="2" class="w-full px-2 py-1 border border-surface-200 rounded text-xs focus:ring-1 focus:ring-primary-300 outline-none resize-vertical"></textarea>
            </div>
          </div>
        </div>

        <!-- Legal / Compliance -->
        <div class="bg-white rounded-xl border border-surface-200 overflow-hidden">
          <div class="px-5 py-3 border-b border-surface-200 flex items-center justify-between" :class="checklistHeaderClass(demand.checklistLegal)">
            <h3 class="text-sm font-semibold text-gray-700">‚öñÔ∏è Legal & Compliance</h3>
            <span class="text-xs font-mono" :class="checklistProgressColor(demand.checklistLegal)">{{ checklistProgress(demand.checklistLegal) }}</span>
          </div>
          <div class="px-5 py-3 space-y-2">
            <label class="flex items-center gap-2 text-sm cursor-pointer" @click.prevent="toggleCheck('checklistLegal', 'dataPrivacy')">
              <input type="checkbox" :checked="demand.checklistLegal.dataPrivacy" class="rounded border-gray-300" />
              <span>Datenschutz-Pr√ºfung</span>
            </label>
            <label class="flex items-center gap-2 text-sm cursor-pointer" @click.prevent="toggleCheck('checklistLegal', 'gdprCompliance')">
              <input type="checkbox" :checked="demand.checklistLegal.gdprCompliance" class="rounded border-gray-300" />
              <span>DSGVO-Konformit√§t</span>
            </label>
            <label class="flex items-center gap-2 text-sm cursor-pointer" @click.prevent="toggleCheck('checklistLegal', 'contractReview')">
              <input type="checkbox" :checked="demand.checklistLegal.contractReview" class="rounded border-gray-300" />
              <span>Vertragspr√ºfung</span>
            </label>
            <label class="flex items-center gap-2 text-sm cursor-pointer" @click.prevent="toggleCheck('checklistLegal', 'licenseCheck')">
              <input type="checkbox" :checked="demand.checklistLegal.licenseCheck" class="rounded border-gray-300" />
              <span>Lizenz-Pr√ºfung</span>
            </label>
            <div class="pt-2 border-t border-surface-100">
              <label class="block text-xs font-medium text-gray-500 mb-1">Notizen</label>
              <textarea v-model="demand.checklistLegal.notes" rows="2" class="w-full px-2 py-1 border border-surface-200 rounded text-xs focus:ring-1 focus:ring-primary-300 outline-none resize-vertical"></textarea>
            </div>
          </div>
        </div>

        <!-- Architecture -->
        <div class="bg-white rounded-xl border border-surface-200 overflow-hidden">
          <div class="px-5 py-3 border-b border-surface-200 flex items-center justify-between" :class="checklistHeaderClass(demand.checklistArchitecture)">
            <h3 class="text-sm font-semibold text-gray-700">üèõÔ∏è Architektur</h3>
            <span class="text-xs font-mono" :class="checklistProgressColor(demand.checklistArchitecture)">{{ checklistProgress(demand.checklistArchitecture) }}</span>
          </div>
          <div class="px-5 py-3 space-y-2">
            <label class="flex items-center gap-2 text-sm cursor-pointer" @click.prevent="toggleCheck('checklistArchitecture', 'fitsEAStrategy')">
              <input type="checkbox" :checked="demand.checklistArchitecture.fitsEAStrategy" class="rounded border-gray-300" />
              <span>Passt zur EA-Strategie</span>
            </label>
            <label class="flex items-center gap-2 text-sm cursor-pointer" @click.prevent="toggleCheck('checklistArchitecture', 'integrationReview')">
              <input type="checkbox" :checked="demand.checklistArchitecture.integrationReview" class="rounded border-gray-300" />
              <span>Integrations-Review</span>
            </label>
            <label class="flex items-center gap-2 text-sm cursor-pointer" @click.prevent="toggleCheck('checklistArchitecture', 'technologyApproved')">
              <input type="checkbox" :checked="demand.checklistArchitecture.technologyApproved" class="rounded border-gray-300" />
              <span>Technologie freigegeben</span>
            </label>
            <label class="flex items-center gap-2 text-sm cursor-pointer" @click.prevent="toggleCheck('checklistArchitecture', 'scalabilityCheck')">
              <input type="checkbox" :checked="demand.checklistArchitecture.scalabilityCheck" class="rounded border-gray-300" />
              <span>Skalierbarkeits-Check</span>
            </label>
            <div class="pt-2 border-t border-surface-100">
              <label class="block text-xs font-medium text-gray-500 mb-1">Notizen</label>
              <textarea v-model="demand.checklistArchitecture.notes" rows="2" class="w-full px-2 py-1 border border-surface-200 rounded text-xs focus:ring-1 focus:ring-primary-300 outline-none resize-vertical"></textarea>
            </div>
          </div>
        </div>
      </div>

      <!-- Related Applications -->
      <div v-if="relatedApps.length" class="bg-white rounded-xl border border-surface-200 overflow-hidden">
        <div class="px-5 py-3 border-b border-surface-200 bg-surface-50">
          <h3 class="text-sm font-semibold text-gray-700">Betroffene Applikationen ({{ relatedApps.length }})</h3>
        </div>
        <div class="divide-y divide-surface-100">
          <a v-for="app in relatedApps" :key="app.id" :href="linkTo('/apps/' + app.id)"
             class="flex items-center justify-between px-5 py-3 hover:bg-surface-50 transition-colors">
            <div class="flex items-center gap-3">
              <span class="text-xs font-mono text-gray-400">{{ app.id }}</span>
              <span class="text-sm text-gray-800">{{ app.name }}</span>
            </div>
            <span class="text-xs text-gray-400">{{ app.appType }}</span>
          </a>
        </div>
      </div>

      <!-- Related Vendors -->
      <div v-if="relatedVendors.length" class="bg-white rounded-xl border border-surface-200 overflow-hidden">
        <div class="px-5 py-3 border-b border-surface-200 bg-surface-50">
          <h3 class="text-sm font-semibold text-gray-700">Betroffene Vendoren ({{ relatedVendors.length }})</h3>
        </div>
        <div class="divide-y divide-surface-100">
          <a v-for="v in relatedVendors" :key="v.id" :href="linkTo('/vendors/' + v.id)"
             class="flex items-center justify-between px-5 py-3 hover:bg-surface-50 transition-colors">
            <div class="flex items-center gap-3">
              <span class="text-xs font-mono text-gray-400">{{ v.id }}</span>
              <span class="text-sm text-gray-800">{{ v.name }}</span>
            </div>
            <span class="text-xs text-gray-400">{{ v.category }}</span>
          </a>
        </div>
      </div>

      <!-- Edit Modal -->
      <demand-form v-if="showEdit" :edit-demand="demand" @close="showEdit = false" @saved="showEdit = false"></demand-form>
    </div>
    <div v-else class="text-center py-12 text-gray-500">Demand nicht gefunden.</div>
  `,
  setup () {
    const { ref, computed } = Vue
    const showEdit = ref(false)

    const demand = computed(() => store.demandById(router.params.id))

    const primaryDomain = computed(() => {
      if (!demand.value || !demand.value.primaryDomain) return null
      return store.domainById(demand.value.primaryDomain)
    })

    const relatedApps = computed(() => {
      if (!demand.value || !demand.value.relatedApps) return []
      return demand.value.relatedApps.map(id => store.appById(id)).filter(Boolean)
    })

    const relatedVendors = computed(() => {
      if (!demand.value || !demand.value.relatedVendors) return []
      return demand.value.relatedVendors.map(id => store.vendorById(id)).filter(Boolean)
    })

    function checklistItems (checklist) {
      if (!checklist) return { total: 0, done: 0 }
      const items = Object.entries(checklist).filter(([k]) => k !== 'notes')
      const done = items.filter(([, v]) => v === true).length
      return { total: items.length, done }
    }

    function checklistProgress (checklist) {
      const { total, done } = checklistItems(checklist)
      return done + '/' + total
    }

    function checklistProgressColor (checklist) {
      const { total, done } = checklistItems(checklist)
      if (done === total) return 'text-green-600'
      if (done > 0) return 'text-yellow-600'
      return 'text-gray-400'
    }

    function checklistHeaderClass (checklist) {
      const { total, done } = checklistItems(checklist)
      if (done === total) return 'bg-green-50'
      if (done > 0) return 'bg-yellow-50'
      return 'bg-surface-50'
    }

    const overallApprovalText = computed(() => {
      if (!demand.value) return '‚Äî'
      const checklists = [demand.value.checklistSecurity, demand.value.checklistLegal, demand.value.checklistArchitecture]
      const allDone = checklists.every(cl => {
        const { total, done } = checklistItems(cl)
        return done === total
      })
      const anyStarted = checklists.some(cl => {
        const { done } = checklistItems(cl)
        return done > 0
      })
      if (allDone) return 'Vollst√§ndig'
      if (anyStarted) return 'In Arbeit'
      return 'Offen'
    })

    const overallApprovalColor = computed(() => {
      const t = overallApprovalText.value
      if (t === 'Vollst√§ndig') return 'text-green-600'
      if (t === 'In Arbeit') return 'text-yellow-600'
      return 'text-gray-400'
    })

    function toggleCheck (checklistName, field) {
      if (!demand.value) return
      demand.value[checklistName][field] = !demand.value[checklistName][field]
    }

    function changeStatus (newStatus) {
      if (demand.value) {
        store.updateDemand(demand.value.id, { status: newStatus })
      }
    }

    function catClass (c) {
      return { 'Idee': 'bg-purple-100 text-purple-700', 'Bereichsvorhaben (< 50k)': 'bg-blue-100 text-blue-700', 'Projekt (> 50k)': 'bg-orange-100 text-orange-700' }[c] || 'bg-gray-100 text-gray-600'
    }
    function statusClass (s) {
      return { 'Eingereicht': 'bg-blue-100 text-blue-700', 'In Bewertung': 'bg-yellow-100 text-yellow-700', 'Genehmigt': 'bg-green-100 text-green-700', 'Abgelehnt': 'bg-red-100 text-red-700', 'In Umsetzung': 'bg-purple-100 text-purple-700', 'Abgeschlossen': 'bg-gray-100 text-gray-600' }[s] || 'bg-gray-100 text-gray-600'
    }
    function prioClass (p) {
      return { 'Hoch': 'bg-red-100 text-red-700', 'Mittel': 'bg-yellow-100 text-yellow-700', 'Niedrig': 'bg-green-100 text-green-700' }[p] || 'bg-gray-100 text-gray-600'
    }

    function aiRiskClass (r) {
      return {
        'Unannehmbares Risiko': 'bg-red-100 text-red-800',
        'Hohes Risiko': 'bg-orange-100 text-orange-800',
        'Begrenztes Risiko': 'bg-yellow-100 text-yellow-800',
        'Minimales Risiko': 'bg-green-100 text-green-800',
        'Kein AI-Usecase': 'bg-gray-100 text-gray-600'
      }[r] || 'bg-gray-100 text-gray-600'
    }

    function confirmDelete () {
      if (demand.value && confirm('Demand "' + demand.value.title + '" l√∂schen? Dies kann nicht r√ºckg√§ngig gemacht werden.')) {
        store.deleteDemand(demand.value.id)
        navigateTo('/demands')
      }
    }

    return { store, router, linkTo, navigateTo, demand, primaryDomain, relatedApps, relatedVendors, showEdit, checklistProgress, checklistProgressColor, checklistHeaderClass, overallApprovalText, overallApprovalColor, toggleCheck, changeStatus, catClass, statusClass, prioClass, aiRiskClass, confirmDelete }
  }
}


// ‚îÄ‚îÄ DemandForm (demand-form.js) ‚îÄ‚îÄ
// demand-form.js ‚Äî Wizard-style modal form for creating/editing a demand

const DemandForm = {
  name: 'DemandForm',
  props: { editDemand: { type: Object, default: null } },
  emits: ['close', 'saved'],
  template: `
    <div class="fixed inset-0 z-50 flex items-center justify-center bg-black/40" @click.self="$emit('close')">
      <div class="bg-white rounded-2xl shadow-xl w-full max-w-2xl mx-4 max-h-[90vh] overflow-y-auto">
        <div class="px-6 py-4 border-b border-surface-200 flex items-center justify-between">
          <h3 class="text-base font-semibold text-gray-900">{{ editDemand ? 'Demand bearbeiten' : 'Neuer Demand' }}</h3>
          <button @click="$emit('close')" class="text-gray-400 hover:text-gray-600 text-xl">&times;</button>
        </div>

        <!-- Wizard Steps -->
        <div class="px-6 pt-4">
          <div class="flex items-center justify-between mb-6">
            <button v-for="(s, i) in steps" :key="i"
                    @click="step = i"
                    class="flex items-center gap-2 text-xs font-medium px-3 py-1.5 rounded-full transition-colors"
                    :class="step === i ? 'bg-primary-100 text-primary-700' : step > i ? 'bg-green-100 text-green-700' : 'bg-surface-100 text-gray-500'">
              <span class="w-5 h-5 rounded-full flex items-center justify-center text-[10px] font-bold"
                    :class="step === i ? 'bg-primary-600 text-white' : step > i ? 'bg-green-600 text-white' : 'bg-gray-300 text-white'">
                {{ step > i ? '‚úì' : i + 1 }}
              </span>
              <span class="hidden sm:inline">{{ s }}</span>
            </button>
          </div>
        </div>

        <form @submit.prevent="save" class="px-6 pb-4">
          <!-- Step 1: Business Description -->
          <div v-show="step === 0" class="space-y-4">
            <div>
              <label class="block text-xs font-medium text-gray-600 mb-1">Titel *</label>
              <input v-model="form.title" required class="w-full px-3 py-2 border border-surface-200 rounded-lg text-sm focus:ring-2 focus:ring-primary-300 outline-none" placeholder="Kurze Beschreibung des Vorhabens" />
            </div>
            <div>
              <label class="block text-xs font-medium text-gray-600 mb-1">Beschreibung *</label>
              <textarea v-model="form.description" required rows="4" class="w-full px-3 py-2 border border-surface-200 rounded-lg text-sm focus:ring-2 focus:ring-primary-300 outline-none resize-vertical" placeholder="Detaillierte Beschreibung des Business-Bedarfs‚Ä¶"></textarea>
            </div>
            <div>
              <label class="block text-xs font-medium text-gray-600 mb-1">Business Case</label>
              <textarea v-model="form.businessCase" rows="3" class="w-full px-3 py-2 border border-surface-200 rounded-lg text-sm focus:ring-2 focus:ring-primary-300 outline-none resize-vertical" placeholder="Erwarteter Nutzen, ROI, Einsparungen‚Ä¶"></textarea>
            </div>
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
              <div>
                <label class="block text-xs font-medium text-gray-600 mb-1">Eingereicht von *</label>
                <input v-model="form.requestedBy" required class="w-full px-3 py-2 border border-surface-200 rounded-lg text-sm focus:ring-2 focus:ring-primary-300 outline-none" />
              </div>
              <div>
                <label class="block text-xs font-medium text-gray-600 mb-1">Datum</label>
                <input v-model="form.requestDate" type="date" class="w-full px-3 py-2 border border-surface-200 rounded-lg text-sm focus:ring-2 focus:ring-primary-300 outline-none" />
              </div>
            </div>
          </div>

          <!-- Step 2: Classification -->
          <div v-show="step === 1" class="space-y-4">
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
              <div>
                <label class="block text-xs font-medium text-gray-600 mb-1">Kategorie</label>
                <select v-model="form.category" class="w-full px-3 py-2 border border-surface-200 rounded-lg text-sm bg-white focus:ring-2 focus:ring-primary-300 outline-none">
                  <option v-for="c in store.data.enums.demandCategory" :key="c" :value="c">{{ c }}</option>
                </select>
              </div>
              <div>
                <label class="block text-xs font-medium text-gray-600 mb-1">Priorit√§t</label>
                <select v-model="form.priority" class="w-full px-3 py-2 border border-surface-200 rounded-lg text-sm bg-white focus:ring-2 focus:ring-primary-300 outline-none">
                  <option v-for="p in store.data.enums.demandPriority" :key="p" :value="p">{{ p }}</option>
                </select>
              </div>
              <div>
                <label class="block text-xs font-medium text-gray-600 mb-1">Status</label>
                <select v-model="form.status" class="w-full px-3 py-2 border border-surface-200 rounded-lg text-sm bg-white focus:ring-2 focus:ring-primary-300 outline-none">
                  <option v-for="s in store.data.enums.demandStatus" :key="s" :value="s">{{ s }}</option>
                </select>
              </div>
              <div>
                <label class="block text-xs font-medium text-gray-600 mb-1">Gesch√§tztes Budget (‚Ç¨)</label>
                <input v-model.number="form.estimatedBudget" type="number" min="0" class="w-full px-3 py-2 border border-surface-200 rounded-lg text-sm focus:ring-2 focus:ring-primary-300 outline-none" />
              </div>
            </div>
          </div>

          <!-- Step 3: AI & EU AI Act -->
          <div v-show="step === 2" class="space-y-4">
            <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 text-sm text-blue-800 mb-4">
              <strong>ü§ñ EU AI Act Klassifikation:</strong> Pr√ºfen Sie, ob dieses Vorhaben einen KI-Anwendungsfall beinhaltet und ordnen Sie die Risikokategorie gem√§√ü EU AI Act zu.
            </div>
            <div>
              <label class="flex items-center gap-3 cursor-pointer">
                <input type="checkbox" v-model="form.isAIUseCase" class="rounded border-gray-300 h-5 w-5" />
                <span class="text-sm font-medium text-gray-700">Dieses Vorhaben beinhaltet einen AI/KI-Anwendungsfall</span>
              </label>
            </div>
            <div v-if="form.isAIUseCase" class="space-y-4 mt-2">
              <div>
                <label class="block text-xs font-medium text-gray-600 mb-1">EU AI Act Risikokategorie *</label>
                <select v-model="form.aiRiskCategory" class="w-full px-3 py-2 border border-surface-200 rounded-lg text-sm bg-white focus:ring-2 focus:ring-primary-300 outline-none">
                  <option v-for="r in (store.data.enums.aiRiskCategory || []).filter(r => r !== 'Kein AI-Usecase')" :key="r" :value="r">{{ r }}</option>
                </select>
              </div>
              <div v-if="form.aiRiskCategory === 'Unannehmbares Risiko'" class="bg-red-50 border border-red-200 rounded-lg p-3 text-sm text-red-800">
                ‚ö†Ô∏è <strong>Unannehmbares Risiko:</strong> Systeme dieser Kategorie sind gem√§√ü EU AI Act verboten (z.B. Social Scoring, biometrische Echtzeit√ºberwachung). Dieses Vorhaben kann nicht umgesetzt werden.
              </div>
              <div v-if="form.aiRiskCategory === 'Hohes Risiko'" class="bg-orange-50 border border-orange-200 rounded-lg p-3 text-sm text-orange-800">
                ‚ö†Ô∏è <strong>Hohes Risiko:</strong> Erfordert Konformit√§tsbewertung, CE-Kennzeichnung, Risikomanagement-System, Daten-Governance, technische Dokumentation und menschliche Aufsicht gem√§√ü EU AI Act.
              </div>
              <div v-if="form.aiRiskCategory === 'Begrenztes Risiko'" class="bg-yellow-50 border border-yellow-200 rounded-lg p-3 text-sm text-yellow-800">
                ‚ÑπÔ∏è <strong>Begrenztes Risiko:</strong> Transparenzpflichten beachten ‚Äì Nutzer m√ºssen informiert werden, dass sie mit einem KI-System interagieren (Art. 52 EU AI Act).
              </div>
              <div>
                <label class="block text-xs font-medium text-gray-600 mb-1">AI-Beschreibung & Begr√ºndung</label>
                <textarea v-model="form.aiDescription" rows="4" class="w-full px-3 py-2 border border-surface-200 rounded-lg text-sm focus:ring-2 focus:ring-primary-300 outline-none resize-vertical" placeholder="Beschreiben Sie den KI-Anwendungsfall, die verwendete Technologie und die Begr√ºndung f√ºr die Risikokategorie‚Ä¶"></textarea>
              </div>
            </div>
          </div>

          <!-- Step 4: Linking -->
          <div v-show="step === 3" class="space-y-4">
            <div>
              <label class="block text-xs font-medium text-gray-600 mb-1">Prim√§re Dom√§ne</label>
              <select v-model.number="form.primaryDomain" class="w-full px-3 py-2 border border-surface-200 rounded-lg text-sm bg-white focus:ring-2 focus:ring-primary-300 outline-none">
                <option :value="null">‚Äî Keine ‚Äî</option>
                <option v-for="d in store.data.domains" :key="d.id" :value="d.id">{{ d.name }}</option>
              </select>
            </div>
            <div>
              <label class="block text-xs font-medium text-gray-600 mb-1">Weitere Dom√§nen</label>
              <div class="flex flex-wrap gap-2 mt-1">
                <label v-for="d in store.data.domains" :key="d.id" class="flex items-center gap-1 text-xs bg-surface-50 px-2 py-1 rounded cursor-pointer hover:bg-surface-100">
                  <input type="checkbox" :value="d.id" v-model="form.relatedDomains" class="rounded border-gray-300" />
                  {{ d.name }}
                </label>
              </div>
            </div>
            <div>
              <label class="block text-xs font-medium text-gray-600 mb-1">Betroffene Applikationen</label>
              <div class="flex flex-wrap gap-2 mt-1 max-h-32 overflow-y-auto">
                <label v-for="a in store.data.applications" :key="a.id" class="flex items-center gap-1 text-xs bg-surface-50 px-2 py-1 rounded cursor-pointer hover:bg-surface-100">
                  <input type="checkbox" :value="a.id" v-model="form.relatedApps" class="rounded border-gray-300" />
                  {{ a.name }}
                </label>
              </div>
            </div>
            <div>
              <label class="block text-xs font-medium text-gray-600 mb-1">Betroffene Vendoren</label>
              <div class="flex flex-wrap gap-2 mt-1 max-h-32 overflow-y-auto">
                <label v-for="v in (store.data.vendors || [])" :key="v.id" class="flex items-center gap-1 text-xs bg-surface-50 px-2 py-1 rounded cursor-pointer hover:bg-surface-100">
                  <input type="checkbox" :value="v.id" v-model="form.relatedVendors" class="rounded border-gray-300" />
                  {{ v.name }}
                </label>
              </div>
            </div>
          </div>

          <!-- Navigation + Save -->
          <div class="flex justify-between items-center pt-6">
            <button v-if="step > 0" type="button" @click="step--"
                    class="px-4 py-2 border border-gray-300 rounded-lg text-sm text-gray-700 hover:bg-surface-100">‚Üê Zur√ºck</button>
            <div v-else></div>
            <div class="flex gap-3">
              <button type="button" @click="$emit('close')" class="px-4 py-2 border border-gray-300 rounded-lg text-sm text-gray-700 hover:bg-surface-100">Abbrechen</button>
              <button v-if="step < steps.length - 1" type="button" @click="step++"
                      class="px-4 py-2 bg-primary-600 text-white rounded-lg text-sm hover:bg-primary-700">Weiter ‚Üí</button>
              <button v-else type="submit"
                      class="px-4 py-2 bg-primary-600 text-white rounded-lg text-sm hover:bg-primary-700">{{ editDemand ? 'Aktualisieren' : 'Erstellen' }}</button>
            </div>
          </div>
        </form>
      </div>
    </div>
  `,
  setup (props, { emit }) {
    const { ref, onMounted } = Vue

    const steps = ['Business Beschreibung', 'Klassifikation', 'AI & EU AI Act', 'Verkn√ºpfungen']
    const step = ref(0)

    const emptyChecklist = () => ({
      dataClassification: false, accessControl: false,
      encryptionReview: false, vulnerabilityScan: false, notes: ''
    })
    const emptyLegalChecklist = () => ({
      dataPrivacy: false, gdprCompliance: false,
      contractReview: false, licenseCheck: false, notes: ''
    })
    const emptyArchChecklist = () => ({
      fitsEAStrategy: false, integrationReview: false,
      technologyApproved: false, scalabilityCheck: false, notes: ''
    })

    const defaultForm = () => ({
      title: '', description: '', businessCase: '',
      category: 'Idee', status: 'Eingereicht', priority: 'Mittel',
      requestedBy: '', requestDate: new Date().toISOString().slice(0, 10),
      estimatedBudget: 0, primaryDomain: null,
      relatedDomains: [], relatedApps: [], relatedVendors: [],
      isAIUseCase: false, aiRiskCategory: 'Kein AI-Usecase', aiDescription: '',
      checklistSecurity: emptyChecklist(),
      checklistLegal: emptyLegalChecklist(),
      checklistArchitecture: emptyArchChecklist()
    })

    const form = ref(defaultForm())

    onMounted(() => {
      if (props.editDemand) {
        form.value = {
          ...defaultForm(),
          ...JSON.parse(JSON.stringify(props.editDemand))
        }
      }
    })

    function save () {
      const data = { ...form.value }
      if (!data.isAIUseCase) {
        data.aiRiskCategory = 'Kein AI-Usecase'
        data.aiDescription = ''
      }
      if (props.editDemand) {
        store.updateDemand(props.editDemand.id, data)
      } else {
        store.addDemand(data)
      }
      emit('saved')
    }

    return { store, steps, step, form, save }
  }
}


// ‚îÄ‚îÄ DemandPipeline (demand-pipeline.js) ‚îÄ‚îÄ
// demand-pipeline.js ‚Äî Demand-to-Project Pipeline: Kanban board, funnel, conversion, throughput analysis

const DemandPipeline = {
  name: 'DemandPipeline',
  template: `
    <div class="space-y-6">
      <h2 class="text-lg font-bold text-gray-800">Demand Pipeline</h2>

      <!-- KPI Summary Cards -->
      <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4">
        <div class="bg-white rounded-xl border border-surface-200 p-4 hover:shadow-md transition-shadow">
          <div class="text-xs font-medium text-gray-500 uppercase tracking-wide">Demands Gesamt</div>
          <div class="mt-1 text-2xl font-bold text-gray-800">{{ totalDemands }}</div>
        </div>
        <div class="bg-white rounded-xl border border-surface-200 p-4 hover:shadow-md transition-shadow">
          <div class="text-xs font-medium text-gray-500 uppercase tracking-wide">Pipeline-Wert</div>
          <div class="mt-1 text-2xl font-bold text-blue-600">‚Ç¨{{ pipelineValue.toLocaleString() }}</div>
        </div>
        <div class="bg-white rounded-xl border border-surface-200 p-4 hover:shadow-md transition-shadow">
          <div class="text-xs font-medium text-gray-500 uppercase tracking-wide">Genehmigter Wert</div>
          <div class="mt-1 text-2xl font-bold text-green-600">‚Ç¨{{ approvedValue.toLocaleString() }}</div>
        </div>
        <div class="bg-white rounded-xl border border-surface-200 p-4 hover:shadow-md transition-shadow">
          <div class="text-xs font-medium text-gray-500 uppercase tracking-wide">Konversionsrate</div>
          <div class="mt-1 text-2xl font-bold text-purple-600">{{ conversionRate }}%</div>
        </div>
        <div class="bg-white rounded-xl border border-surface-200 p-4 hover:shadow-md transition-shadow">
          <div class="text-xs font-medium text-gray-500 uppercase tracking-wide">KI Use Cases</div>
          <div class="mt-1 text-2xl font-bold text-amber-600">{{ aiUseCaseCount }}</div>
        </div>
      </div>

      <!-- Kanban Board -->
      <div class="bg-white rounded-xl border border-surface-200 p-4">
        <h3 class="text-sm font-semibold text-gray-700 mb-4">Kanban Board</h3>
        <div class="flex gap-4 overflow-x-auto pb-2">
          <div v-for="col in kanbanColumns" :key="col.status"
               class="flex-shrink-0 w-64 rounded-lg border" :class="col.borderClass">
            <!-- Column Header -->
            <div class="px-3 py-2 rounded-t-lg text-sm font-semibold flex items-center justify-between"
                 :class="col.headerClass">
              <span>{{ col.status }}</span>
              <span class="text-xs font-normal px-1.5 py-0.5 rounded-full bg-white/30">{{ col.demands.length }}</span>
            </div>
            <!-- Cards -->
            <div class="p-2 space-y-2 max-h-[500px] overflow-y-auto bg-surface-50/50">
              <div v-if="col.demands.length === 0"
                   class="text-xs text-gray-400 text-center py-6 italic">Keine Demands</div>
              <div v-for="d in col.demands" :key="d.id"
                   class="bg-white rounded-lg border border-surface-200 p-3 hover:shadow-md transition-shadow cursor-pointer"
                   @click="navigateTo('/demands/' + d.id)">
                <div class="flex items-start justify-between gap-1">
                  <div class="font-medium text-sm text-gray-900 line-clamp-2">{{ d.title }}</div>
                  <span class="flex-shrink-0 text-[10px] px-1.5 py-0.5 rounded-full" :class="prioClass(d.priority)">{{ d.priority }}</span>
                </div>
                <div class="mt-1.5 text-xs text-gray-500">{{ d.category }}</div>
                <div class="mt-1 flex items-center justify-between text-xs">
                  <span class="text-gray-400">{{ d.requestedBy }}</span>
                  <span v-if="d.estimatedBudget" class="font-mono text-gray-600">‚Ç¨{{ d.estimatedBudget.toLocaleString() }}</span>
                </div>
                <div v-if="d.isAIUseCase" class="mt-1.5">
                  <span class="text-[10px] px-1.5 py-0.5 rounded-full bg-amber-100 text-amber-700">ü§ñ KI</span>
                </div>
                <!-- Convert to Project button for Genehmigt -->
                <button v-if="col.status === 'Genehmigt'"
                        class="mt-2 w-full text-xs px-2 py-1.5 bg-primary-600 text-white rounded-md hover:bg-primary-700 transition-colors"
                        @click.stop="convertToProject(d)">
                  ‚Üí Projekt erstellen
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Pipeline Funnel & Throughput side by side -->
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <!-- Pipeline Funnel -->
        <div class="bg-white rounded-xl border border-surface-200 p-5">
          <h3 class="text-sm font-semibold text-gray-700 mb-4">Pipeline Funnel</h3>
          <div class="space-y-2">
            <div v-for="(stage, idx) in funnelStages" :key="stage.label" class="flex items-center gap-3">
              <div class="w-28 text-xs text-gray-600 text-right flex-shrink-0">{{ stage.label }}</div>
              <div class="flex-1 relative">
                <div class="h-8 rounded-md flex items-center px-3 text-xs font-medium text-white transition-all"
                     :class="stage.bgClass"
                     :style="{ width: stage.widthPct + '%', minWidth: '48px' }">
                  {{ stage.count }}
                </div>
              </div>
              <div class="w-16 text-xs text-gray-400 flex-shrink-0">
                <span v-if="idx > 0 && funnelStages[idx - 1].count > 0">
                  {{ Math.round(stage.count / funnelStages[idx - 1].count * 100) }}%
                </span>
              </div>
            </div>
          </div>
          <div class="mt-4 text-xs text-gray-400">Konversionsraten zwischen den Phasen</div>
        </div>

        <!-- Throughput Time Analysis -->
        <div class="bg-white rounded-xl border border-surface-200 p-5">
          <h3 class="text-sm font-semibold text-gray-700 mb-4">Durchlaufzeit-Analyse</h3>
          <div class="space-y-4">
            <!-- Aging per status -->
            <div>
              <div class="text-xs font-medium text-gray-600 mb-2">Alter nach Status (Tage seit Einreichung)</div>
              <div class="space-y-2">
                <div v-for="ag in agingByStatus" :key="ag.status" class="flex items-center gap-2">
                  <div class="w-24 text-xs text-gray-600 text-right flex-shrink-0">{{ ag.status }}</div>
                  <div class="flex-1 h-5 bg-surface-100 rounded overflow-hidden">
                    <div class="h-full rounded transition-all"
                         :class="ag.barClass"
                         :style="{ width: ag.widthPct + '%', minWidth: ag.count > 0 ? '24px' : '0' }">
                    </div>
                  </div>
                  <div class="w-20 text-xs text-gray-500 flex-shrink-0">
                    ‚åÄ {{ ag.avgDays }} Tage
                  </div>
                  <div class="w-8 text-xs text-gray-400">({{ ag.count }})</div>
                </div>
              </div>
            </div>
            <!-- Summary stats -->
            <div class="grid grid-cols-2 gap-3 pt-2 border-t border-surface-100">
              <div>
                <div class="text-xs text-gray-500">√ò bis Genehmigung</div>
                <div class="text-lg font-bold text-gray-800">{{ avgToApproval }} Tage</div>
              </div>
              <div>
                <div class="text-xs text-gray-500">√ò Gesamtdurchlauf</div>
                <div class="text-lg font-bold text-gray-800">{{ avgTotalThroughput }} Tage</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  `,
  setup () {
    const { ref, computed } = Vue

    const demands = computed(() => store.data.demands || [])

    // ‚îÄ‚îÄ KPI Summary ‚îÄ‚îÄ

    const totalDemands = computed(() => demands.value.length)

    const pipelineValue = computed(() =>
      demands.value.reduce((s, d) => s + (d.estimatedBudget || 0), 0)
    )

    const approvedValue = computed(() =>
      demands.value
        .filter(d => d.status === 'Genehmigt')
        .reduce((s, d) => s + (d.estimatedBudget || 0), 0)
    )

    const conversionRate = computed(() => {
      if (demands.value.length === 0) return 0
      const converted = demands.value.filter(d =>
        ['Genehmigt', 'In Umsetzung', 'Abgeschlossen'].includes(d.status)
      ).length
      return Math.round(converted / demands.value.length * 100)
    })

    const aiUseCaseCount = computed(() =>
      demands.value.filter(d => d.isAIUseCase === true).length
    )

    // ‚îÄ‚îÄ Kanban Board ‚îÄ‚îÄ

    const statusColors = {
      'Eingereicht':    { headerClass: 'bg-blue-500 text-white',   borderClass: 'border-blue-200' },
      'In Bewertung':   { headerClass: 'bg-yellow-500 text-white', borderClass: 'border-yellow-200' },
      'Genehmigt':      { headerClass: 'bg-green-500 text-white',  borderClass: 'border-green-200' },
      'Abgelehnt':      { headerClass: 'bg-red-500 text-white',    borderClass: 'border-red-200' },
      'In Umsetzung':   { headerClass: 'bg-purple-500 text-white', borderClass: 'border-purple-200' },
      'Abgeschlossen':  { headerClass: 'bg-gray-500 text-white',   borderClass: 'border-gray-200' }
    }

    const kanbanColumns = computed(() => {
      const statuses = store.data.enums.demandStatus || [
        'Eingereicht', 'In Bewertung', 'Genehmigt', 'Abgelehnt', 'In Umsetzung', 'Abgeschlossen'
      ]
      return statuses.map(status => ({
        status,
        demands: demands.value.filter(d => d.status === status),
        headerClass: (statusColors[status] || statusColors['Eingereicht']).headerClass,
        borderClass: (statusColors[status] || statusColors['Eingereicht']).borderClass
      }))
    })

    function prioClass (p) {
      return {
        'Hoch': 'bg-red-100 text-red-700',
        'Mittel': 'bg-yellow-100 text-yellow-700',
        'Niedrig': 'bg-green-100 text-green-700'
      }[p] || 'bg-gray-100 text-gray-600'
    }

    // ‚îÄ‚îÄ Demand ‚Üí Project Conversion ‚îÄ‚îÄ

    function currentQuarter () {
      const now = new Date()
      const q = Math.ceil((now.getMonth() + 1) / 3)
      return 'Q' + q + '/' + now.getFullYear()
    }

    function nextQuarter () {
      const now = new Date()
      let q = Math.ceil((now.getMonth() + 1) / 3) + 1
      let y = now.getFullYear()
      if (q > 4) { q = 1; y++ }
      return 'Q' + q + '/' + y
    }

    function convertToProject (demand) {
      const categoryMap = {
        'Projekt (> 50k)': 'Modernisierung',
        'Bereichsvorhaben (< 50k)': 'Modernisierung',
        'Idee': 'Innovation'
      }

      const proj = {
        name: demand.title,
        primaryDomain: demand.primaryDomain,
        secondaryDomains: demand.relatedDomains || [],
        budget: demand.estimatedBudget || 0,
        category: categoryMap[demand.category] || 'Modernisierung',
        status: 'green',
        start: currentQuarter(),
        end: nextQuarter(),
        sponsor: demand.requestedBy,
        affectedApps: (demand.relatedApps || []).map(appId => ({ appId, action: 'ver√§ndern' })),
        capabilities: [],
        conformity: 'Teilkonform'
      }

      store.addProject(proj)
      store.updateDemand(demand.id, { status: 'In Umsetzung' })
      navigateTo('/projects/' + proj.id)
    }

    // ‚îÄ‚îÄ Pipeline Funnel ‚îÄ‚îÄ

    const funnelLabels = ['Eingereicht', 'In Bewertung', 'Genehmigt', 'In Umsetzung', 'Abgeschlossen']
    const funnelBgClasses = ['bg-blue-500', 'bg-yellow-500', 'bg-green-500', 'bg-purple-500', 'bg-gray-500']

    const funnelStages = computed(() => {
      const counts = funnelLabels.map(label =>
        demands.value.filter(d => d.status === label).length
      )
      const maxCount = Math.max(...counts, 1)
      return funnelLabels.map((label, idx) => ({
        label,
        count: counts[idx],
        widthPct: Math.max(Math.round(counts[idx] / maxCount * 100), counts[idx] > 0 ? 8 : 0),
        bgClass: funnelBgClasses[idx]
      }))
    })

    // ‚îÄ‚îÄ Throughput Time Analysis ‚îÄ‚îÄ

    function daysSince (dateStr) {
      if (!dateStr) return 0
      const d = new Date(dateStr)
      if (isNaN(d.getTime())) return 0
      const now = new Date()
      return Math.max(0, Math.round((now - d) / (1000 * 60 * 60 * 24)))
    }

    const agingBarClasses = {
      'Eingereicht':   'bg-blue-400',
      'In Bewertung':  'bg-yellow-400',
      'Genehmigt':     'bg-green-400',
      'Abgelehnt':     'bg-red-400',
      'In Umsetzung':  'bg-purple-400',
      'Abgeschlossen': 'bg-gray-400'
    }

    const agingByStatus = computed(() => {
      const statuses = store.data.enums.demandStatus || Object.keys(agingBarClasses)
      const results = statuses.map(status => {
        const items = demands.value.filter(d => d.status === status)
        const ages = items.map(d => daysSince(d.requestDate))
        const avg = ages.length > 0 ? Math.round(ages.reduce((a, b) => a + b, 0) / ages.length) : 0
        return { status, count: items.length, avgDays: avg, barClass: agingBarClasses[status] || 'bg-gray-400' }
      })
      const maxAvg = Math.max(...results.map(r => r.avgDays), 1)
      return results.map(r => ({ ...r, widthPct: Math.round(r.avgDays / maxAvg * 100) }))
    })

    const avgToApproval = computed(() => {
      const approved = demands.value.filter(d =>
        ['Genehmigt', 'In Umsetzung', 'Abgeschlossen'].includes(d.status)
      )
      if (approved.length === 0) return '‚Äî'
      const ages = approved.map(d => daysSince(d.requestDate))
      return Math.round(ages.reduce((a, b) => a + b, 0) / ages.length)
    })

    const avgTotalThroughput = computed(() => {
      const done = demands.value.filter(d => d.status === 'Abgeschlossen')
      if (done.length === 0) return '‚Äî'
      const ages = done.map(d => daysSince(d.requestDate))
      return Math.round(ages.reduce((a, b) => a + b, 0) / ages.length)
    })

    return {
      store, linkTo, navigateTo,
      totalDemands, pipelineValue, approvedValue, conversionRate, aiUseCaseCount,
      kanbanColumns, prioClass, convertToProject,
      funnelStages, agingByStatus, avgToApproval, avgTotalThroughput
    }
  }
}


// ‚îÄ‚îÄ AIUsecasesList (ai-usecases-list.js) ‚îÄ‚îÄ
// ai-usecases-list.js ‚Äî AI Use Cases overview with risk categorization

const AIUsecasesList = {
  name: 'AIUsecasesList',
  template: `
    <div class="space-y-4">
      <!-- Toolbar -->
      <div class="flex flex-wrap items-center gap-3">
        <input v-model="search" type="text" placeholder="AI Use Cases durchsuchen‚Ä¶"
               class="flex-1 min-w-[200px] px-3 py-2 border border-surface-200 rounded-lg text-sm focus:ring-2 focus:ring-primary-300 focus:border-primary-400 outline-none" />
        <select v-model="filterRisk" class="px-3 py-2 border border-surface-200 rounded-lg text-sm bg-white">
          <option value="">Alle Risikokategorien</option>
          <option v-for="r in riskCategories" :key="r" :value="r">{{ r }}</option>
        </select>
        <select v-model="filterStatus" class="px-3 py-2 border border-surface-200 rounded-lg text-sm bg-white">
          <option value="">Alle Status</option>
          <option v-for="s in store.data.enums.demandStatus" :key="s" :value="s">{{ s }}</option>
        </select>
      </div>

      <!-- Risk category summary cards -->
      <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
        <div v-for="r in riskSummary" :key="r.category"
             class="bg-white rounded-xl border border-surface-200 p-3 cursor-pointer hover:shadow-md transition-shadow"
             :class="filterRisk === r.category ? 'ring-2 ring-primary-400' : ''"
             @click="filterRisk = filterRisk === r.category ? '' : r.category">
          <div class="text-xs font-medium text-gray-500">{{ r.category }}</div>
          <div class="text-xl font-bold mt-1" :class="r.colorClass">{{ r.count }}</div>
        </div>
      </div>

      <!-- Count -->
      <div class="text-xs text-gray-500">{{ filtered.length }} AI Use Cases</div>

      <!-- Table -->
      <div class="bg-white rounded-xl border border-surface-200 overflow-x-auto">
        <table class="w-full text-sm">
          <thead>
            <tr class="border-b border-surface-200 bg-surface-50">
              <th class="text-left px-4 py-3 font-medium text-gray-600 cursor-pointer hover:text-gray-900" @click="toggleSort('title')">Use Case {{ sortIcon('title') }}</th>
              <th class="text-left px-4 py-3 font-medium text-gray-600 cursor-pointer hover:text-gray-900" @click="toggleSort('aiRiskCategory')">Risikokategorie {{ sortIcon('aiRiskCategory') }}</th>
              <th class="text-left px-4 py-3 font-medium text-gray-600 cursor-pointer hover:text-gray-900" @click="toggleSort('status')">Status {{ sortIcon('status') }}</th>
              <th class="text-left px-4 py-3 font-medium text-gray-600 cursor-pointer hover:text-gray-900 hidden md:table-cell" @click="toggleSort('priority')">Priorit√§t {{ sortIcon('priority') }}</th>
              <th class="text-left px-4 py-3 font-medium text-gray-600 hidden lg:table-cell">AI Beschreibung</th>
              <th class="text-left px-4 py-3 font-medium text-gray-600 hidden lg:table-cell">Eingereicht</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-surface-100">
            <tr v-for="d in filtered" :key="d.id"
                class="hover:bg-surface-50 cursor-pointer transition-colors"
                @click="navigateTo('/demands/' + d.id)">
              <td class="px-4 py-3">
                <div class="font-medium text-gray-900 flex items-center gap-1.5">
                  <span class="text-xs" title="AI Use Case">ü§ñ</span>
                  {{ d.title }}
                </div>
                <div class="text-xs text-gray-400">{{ d.id }} ¬∑ {{ d.requestedBy }}</div>
              </td>
              <td class="px-4 py-3">
                <span class="text-xs px-2 py-0.5 rounded-full" :class="riskClass(d.aiRiskCategory)">{{ d.aiRiskCategory || '‚Äî' }}</span>
              </td>
              <td class="px-4 py-3">
                <span class="text-xs px-2 py-0.5 rounded-full" :class="statusClass(d.status)">{{ d.status }}</span>
              </td>
              <td class="px-4 py-3 hidden md:table-cell">
                <span class="text-xs px-2 py-0.5 rounded-full" :class="prioClass(d.priority)">{{ d.priority }}</span>
              </td>
              <td class="px-4 py-3 hidden lg:table-cell">
                <div class="text-xs text-gray-600 max-w-xs truncate" :title="d.aiDescription">{{ d.aiDescription || '‚Äî' }}</div>
              </td>
              <td class="px-4 py-3 text-gray-600 hidden lg:table-cell">{{ d.requestDate || '‚Äî' }}</td>
            </tr>
            <tr v-if="filtered.length === 0">
              <td colspan="6" class="px-4 py-8 text-center text-gray-400">Keine AI Use Cases gefunden</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  `,
  setup () {
    const { ref, computed } = Vue
    const search = ref('')
    const filterRisk = ref('')
    const filterStatus = ref('')
    const sortBy = ref('title')
    const sortDir = ref(1)

    function toggleSort (field) {
      if (sortBy.value === field) sortDir.value *= -1
      else { sortBy.value = field; sortDir.value = 1 }
    }
    function sortIcon (field) {
      if (sortBy.value !== field) return ''
      return sortDir.value === 1 ? '‚Üë' : '‚Üì'
    }

    const riskCategories = computed(() => {
      return (store.data.enums.aiRiskCategory || []).filter(c => c !== 'Kein AI-Usecase')
    })

    const aiUseCases = computed(() => {
      return (store.data.demands || []).filter(d => d.isAIUseCase === true)
    })

    const filtered = computed(() => {
      let list = [...aiUseCases.value]
      const q = search.value.toLowerCase()
      if (q) list = list.filter(d => d.title.toLowerCase().includes(q) || (d.aiDescription || '').toLowerCase().includes(q) || (d.requestedBy || '').toLowerCase().includes(q))
      if (filterRisk.value) list = list.filter(d => d.aiRiskCategory === filterRisk.value)
      if (filterStatus.value) list = list.filter(d => d.status === filterStatus.value)
      list.sort((a, b) => {
        const av = a[sortBy.value], bv = b[sortBy.value]
        if (typeof av === 'number') return (av - bv) * sortDir.value
        return String(av || '').localeCompare(String(bv || '')) * sortDir.value
      })
      return list
    })

    const riskSummary = computed(() => {
      const categories = riskCategories.value
      const colors = {
        'Minimales Risiko': 'text-green-600',
        'Begrenztes Risiko': 'text-yellow-600',
        'Hohes Risiko': 'text-orange-600',
        'Unannehmbares Risiko': 'text-red-600'
      }
      return categories.map(c => ({
        category: c,
        count: aiUseCases.value.filter(d => d.aiRiskCategory === c).length,
        colorClass: colors[c] || 'text-gray-600'
      }))
    })

    function riskClass (r) {
      return {
        'Minimales Risiko': 'bg-green-100 text-green-700',
        'Begrenztes Risiko': 'bg-yellow-100 text-yellow-700',
        'Hohes Risiko': 'bg-orange-100 text-orange-700',
        'Unannehmbares Risiko': 'bg-red-100 text-red-700'
      }[r] || 'bg-gray-100 text-gray-600'
    }
    function statusClass (s) {
      return {
        'Eingereicht': 'bg-blue-100 text-blue-700',
        'In Bewertung': 'bg-yellow-100 text-yellow-700',
        'Genehmigt': 'bg-green-100 text-green-700',
        'Abgelehnt': 'bg-red-100 text-red-700',
        'In Umsetzung': 'bg-purple-100 text-purple-700',
        'Abgeschlossen': 'bg-gray-100 text-gray-600'
      }[s] || 'bg-gray-100 text-gray-600'
    }
    function prioClass (p) {
      return {
        'Hoch': 'bg-red-100 text-red-700',
        'Mittel': 'bg-yellow-100 text-yellow-700',
        'Niedrig': 'bg-green-100 text-green-700'
      }[p] || 'bg-gray-100 text-gray-600'
    }

    return { store, linkTo, navigateTo, search, filterRisk, filterStatus, sortBy, sortDir, filtered, riskSummary, riskCategories, toggleSort, sortIcon, riskClass, statusClass, prioClass }
  }
}


// ‚îÄ‚îÄ BudgetDashboard (budget-dashboard.js) ‚îÄ‚îÄ
// budget-dashboard.js ‚Äî Budget & Kosten-Dashboard (Feature #3)

const BudgetDashboard = {
  name: 'BudgetDashboard',
  template: `
    <div class="space-y-6">
      <!-- KPI Cards -->
      <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4">
        <div v-for="kpi in kpis" :key="kpi.label"
             class="bg-white rounded-xl border border-surface-200 p-4 hover:shadow-md transition-shadow">
          <div class="text-xs font-medium text-gray-500 uppercase tracking-wide">{{ kpi.label }}</div>
          <div class="mt-1 text-2xl font-bold" :style="{ color: kpi.color || '#1e293b' }">{{ kpi.value }}</div>
          <div v-if="kpi.sub" class="text-xs text-gray-400 mt-0.5">{{ kpi.sub }}</div>
        </div>
      </div>

      <!-- Run vs Change + Costs by Domain -->
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <div class="bg-white rounded-xl border border-surface-200 p-5">
          <h3 class="text-sm font-semibold text-gray-700 mb-4">Run vs. Change Budget</h3>
          <div class="h-64 flex items-center justify-center">
            <canvas ref="runChangeCanvas"></canvas>
          </div>
        </div>

        <div class="bg-white rounded-xl border border-surface-200 p-5">
          <h3 class="text-sm font-semibold text-gray-700 mb-4">Kosten nach Dom√§ne</h3>
          <div class="h-64">
            <canvas ref="domainCostCanvas"></canvas>
          </div>
        </div>
      </div>

      <!-- Costs by Vendor + Costs by App Type -->
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <div class="bg-white rounded-xl border border-surface-200 p-5">
          <h3 class="text-sm font-semibold text-gray-700 mb-4">Kosten nach Anbieter</h3>
          <div class="h-64">
            <canvas ref="vendorCostCanvas"></canvas>
          </div>
        </div>

        <div class="bg-white rounded-xl border border-surface-200 p-5">
          <h3 class="text-sm font-semibold text-gray-700 mb-4">Kosten nach Anwendungstyp</h3>
          <div class="h-64 flex items-center justify-center">
            <canvas ref="appTypeCostCanvas"></canvas>
          </div>
        </div>
      </div>
    </div>
  `,
  setup () {
    const { ref, computed, onMounted, nextTick } = Vue

    const runChangeCanvas = ref(null)
    const domainCostCanvas = ref(null)
    const vendorCostCanvas = ref(null)
    const appTypeCostCanvas = ref(null)

    // ‚îÄ‚îÄ Computed data ‚îÄ‚îÄ

    const runBudget = computed(() =>
      store.data.projects
        .filter(p => p.category === 'Run / Pflicht')
        .reduce((s, p) => s + (p.budget || 0), 0)
    )

    const changeBudget = computed(() =>
      store.data.projects
        .filter(p => p.category !== 'Run / Pflicht')
        .reduce((s, p) => s + (p.budget || 0), 0)
    )

    const totalBudget = computed(() => store.totalBudget)

    const projectCount = computed(() => store.data.projects.length)

    const avgBudget = computed(() =>
      projectCount.value ? Math.round(totalBudget.value / projectCount.value) : 0
    )

    const runRatio = computed(() =>
      totalBudget.value ? Math.round((runBudget.value / totalBudget.value) * 100) : 0
    )

    function fmtEuro (v) {
      if (v >= 1_000_000) return '‚Ç¨' + (v / 1_000_000).toFixed(1) + 'M'
      if (v >= 1_000) return '‚Ç¨' + (v / 1_000).toFixed(0) + 'k'
      return '‚Ç¨' + v
    }

    const kpis = computed(() => [
      { label: 'Gesamtbudget', value: fmtEuro(totalBudget.value), color: '#6366f1' },
      { label: 'Run Budget', value: fmtEuro(runBudget.value), color: '#64748b' },
      { label: 'Change Budget', value: fmtEuro(changeBudget.value), color: '#3b82f6' },
      { label: 'Run / Change', value: runRatio.value + '%', sub: 'Run-Anteil', color: runRatio.value > 70 ? '#ef4444' : '#10b981' },
      { label: 'Projekte', value: projectCount.value },
      { label: '√ò Budget', value: fmtEuro(avgBudget.value), sub: 'pro Projekt' }
    ])

    // ‚îÄ‚îÄ Chart rendering ‚îÄ‚îÄ

    function renderCharts () {
      renderRunChangeChart()
      renderDomainCostChart()
      renderVendorCostChart()
      renderAppTypeCostChart()
    }

    function renderRunChangeChart () {
      if (!runChangeCanvas.value) return
      new Chart(runChangeCanvas.value, {
        type: 'doughnut',
        data: {
          labels: ['Run / Pflicht', 'Change / Grow'],
          datasets: [{
            data: [runBudget.value / 1000, changeBudget.value / 1000],
            backgroundColor: ['#64748b', '#3b82f6']
          }]
        },
        options: {
          responsive: true, maintainAspectRatio: false,
          plugins: {
            legend: { position: window.innerWidth < 640 ? 'bottom' : 'right', labels: { usePointStyle: true, padding: 16 } },
            tooltip: { callbacks: { label: ctx => ctx.label + ': ' + fmtEuro(ctx.raw * 1000) } }
          }
        }
      })
    }

    function renderDomainCostChart () {
      if (!domainCostCanvas.value) return
      const domainBudgets = {}
      store.data.projects.forEach(p => {
        if (p.primaryDomain) {
          const key = p.primaryDomain
          domainBudgets[key] = (domainBudgets[key] || 0) + (p.budget || 0)
        }
      })
      const entries = Object.entries(domainBudgets)
        .map(([id, budget]) => {
          const d = store.domainById(id)
          return { name: d ? d.name : 'Unbekannt', color: d ? d.color : '#94a3b8', budget }
        })
        .sort((a, b) => b.budget - a.budget)

      new Chart(domainCostCanvas.value, {
        type: 'bar',
        data: {
          labels: entries.map(e => e.name.length > 20 ? e.name.slice(0, 20) + '‚Ä¶' : e.name),
          datasets: [{
            data: entries.map(e => e.budget / 1000),
            backgroundColor: entries.map(e => e.color + 'CC'),
            borderColor: entries.map(e => e.color),
            borderWidth: 1,
            borderRadius: 4
          }]
        },
        options: {
          responsive: true, maintainAspectRatio: false, indexAxis: 'y',
          scales: { x: { beginAtZero: true, ticks: { callback: v => '‚Ç¨' + v + 'k' } } },
          plugins: { legend: { display: false } }
        }
      })
    }

    function renderVendorCostChart () {
      if (!vendorCostCanvas.value) return
      const vendorBudgets = {}
      store.data.projects.forEach(p => {
        const apps = p.affectedApps || []
        apps.forEach(ref => {
          const app = store.appById(ref.appId)
          if (!app) return
          const vendor = store.vendorForApp(app.id)
          const vendorName = vendor ? vendor.name : (app.vendor || 'Unbekannt')
          const share = apps.length ? (p.budget || 0) / apps.length : 0
          vendorBudgets[vendorName] = (vendorBudgets[vendorName] || 0) + share
        })
      })
      const entries = Object.entries(vendorBudgets)
        .map(([name, budget]) => ({ name, budget: Math.round(budget) }))
        .sort((a, b) => b.budget - a.budget)
        .slice(0, 10)

      const colors = ['#6366f1', '#3b82f6', '#10b981', '#f59e0b', '#ef4444', '#8b5cf6', '#ec4899', '#14b8a6', '#f97316', '#64748b']
      new Chart(vendorCostCanvas.value, {
        type: 'bar',
        data: {
          labels: entries.map(e => e.name.length > 18 ? e.name.slice(0, 18) + '‚Ä¶' : e.name),
          datasets: [{
            data: entries.map(e => e.budget / 1000),
            backgroundColor: entries.map((_, i) => colors[i % colors.length] + 'CC'),
            borderColor: entries.map((_, i) => colors[i % colors.length]),
            borderWidth: 1,
            borderRadius: 4
          }]
        },
        options: {
          responsive: true, maintainAspectRatio: false, indexAxis: 'y',
          scales: { x: { beginAtZero: true, ticks: { callback: v => '‚Ç¨' + v + 'k' } } },
          plugins: { legend: { display: false } }
        }
      })
    }

    function renderAppTypeCostChart () {
      if (!appTypeCostCanvas.value) return
      const typeBudgets = {}
      store.data.projects.forEach(p => {
        const apps = p.affectedApps || []
        apps.forEach(ref => {
          const app = store.appById(ref.appId)
          if (!app) return
          const appType = app.appType || 'Unbekannt'
          const share = apps.length ? (p.budget || 0) / apps.length : 0
          typeBudgets[appType] = (typeBudgets[appType] || 0) + share
        })
      })
      const typeColors = { 'SaaS': '#3b82f6', 'On-Prem': '#64748b', 'Custom': '#8b5cf6', 'PaaS': '#10b981', 'Unbekannt': '#d1d5db' }
      const entries = Object.entries(typeBudgets).sort((a, b) => b[1] - a[1])

      new Chart(appTypeCostCanvas.value, {
        type: 'doughnut',
        data: {
          labels: entries.map(([t]) => t),
          datasets: [{
            data: entries.map(([, v]) => Math.round(v / 1000)),
            backgroundColor: entries.map(([t]) => typeColors[t] || '#94a3b8')
          }]
        },
        options: {
          responsive: true, maintainAspectRatio: false,
          plugins: {
            legend: { position: window.innerWidth < 640 ? 'bottom' : 'right', labels: { usePointStyle: true, padding: 16 } },
            tooltip: { callbacks: { label: ctx => ctx.label + ': ' + fmtEuro(ctx.raw * 1000) } }
          }
        }
      })
    }

    onMounted(() => { nextTick(renderCharts) })

    return {
      store, linkTo, kpis,
      runChangeCanvas, domainCostCanvas, vendorCostCanvas, appTypeCostCanvas
    }
  }
}


// ‚îÄ‚îÄ RoadmapView (roadmap.js) ‚îÄ‚îÄ
// roadmap.js ‚Äî Strategy Roadmap / Gantt Timeline

const RoadmapView = {
  name: 'RoadmapView',
  template: `
    <div class="space-y-4">
      <!-- Toolbar -->
      <div class="flex flex-wrap items-center gap-3 no-print">
        <select v-model="filterStatus" class="px-3 py-2 border border-surface-200 rounded-lg text-sm bg-white">
          <option value="">All Status</option>
          <option value="green">Green</option>
          <option value="yellow">Yellow</option>
          <option value="red">Red</option>
        </select>
        <select v-model="filterConformity" class="px-3 py-2 border border-surface-200 rounded-lg text-sm bg-white">
          <option value="">All Conformity</option>
          <option v-for="c in store.data.enums.conformity" :key="c" :value="c">{{ c }}</option>
        </select>
        <select v-model="groupBy" class="px-3 py-2 border border-surface-200 rounded-lg text-sm bg-white">
          <option value="domain">Group by Domain</option>
          <option value="category">Group by Category</option>
          <option value="status">Group by Status</option>
        </select>
        <button @click="printView()" class="ml-auto px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg text-sm flex items-center gap-2">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"/></svg>
          Print / PDF
        </button>
      </div>

      <div class="text-xs text-gray-500 no-print">{{ filteredProjects.length }} projects ¬∑ Showing {{ timelineQuarters.length }} quarters</div>

      <!-- Legend -->
      <div class="flex flex-wrap gap-4 text-xs text-gray-600 no-print">
        <span class="flex items-center gap-1"><span class="w-3 h-3 rounded-full bg-green-500 inline-block"></span> Green</span>
        <span class="flex items-center gap-1"><span class="w-3 h-3 rounded-full bg-yellow-500 inline-block"></span> Yellow</span>
        <span class="flex items-center gap-1"><span class="w-3 h-3 rounded-full bg-red-500 inline-block"></span> Red</span>
        <span class="flex items-center gap-1"><span class="w-3 h-1 bg-blue-400 inline-block rounded"></span> Konform</span>
        <span class="flex items-center gap-1"><span class="w-3 h-1 bg-orange-400 inline-block rounded"></span> Teilkonform</span>
        <span class="flex items-center gap-1"><span class="w-3 h-1 bg-red-400 inline-block rounded"></span> Widerspricht</span>
        <span class="flex items-center gap-1"><span class="w-0.5 h-4 bg-red-600 inline-block"></span> Today</span>
        <span class="flex items-center gap-1">‚óÜ Milestone</span>
      </div>

      <!-- Gantt Chart -->
      <div class="bg-white rounded-xl border border-surface-200 overflow-x-auto">
        <div class="min-w-[800px]">
          <!-- Quarter Header -->
          <div class="flex border-b border-surface-200 bg-surface-50 sticky top-0 z-10">
            <div class="w-56 shrink-0 px-4 py-2 text-xs font-semibold text-gray-600 border-r border-surface-200">Project</div>
            <div class="flex-1 flex">
              <div v-for="q in timelineQuarters" :key="q.key"
                   class="flex-1 text-center py-2 text-xs font-medium border-r border-surface-100 last:border-r-0"
                   :class="q.isCurrent ? 'bg-blue-50 text-blue-700 font-bold' : 'text-gray-500'">
                {{ q.label }}
              </div>
            </div>
          </div>

          <!-- Swim lanes grouped -->
          <div v-for="group in groupedProjects" :key="group.label">
            <!-- Group header -->
            <div class="flex items-center px-4 py-2 bg-surface-50 border-b border-surface-200">
              <span v-if="group.color" class="domain-swatch mr-2" :style="{ backgroundColor: group.color }"></span>
              <span class="text-xs font-semibold text-gray-700">{{ group.label }}</span>
              <span class="ml-2 text-xs text-gray-400">({{ group.projects.length }})</span>
            </div>

            <!-- Project rows -->
            <div v-for="p in group.projects" :key="p.id"
                 class="flex border-b border-surface-100 hover:bg-surface-50 transition-colors group/row">
              <!-- Project name column -->
              <div class="w-56 shrink-0 px-4 py-2 border-r border-surface-200 cursor-pointer"
                   @click="navigateTo('/projects/' + p.id)">
                <div class="flex items-center gap-2">
                  <span class="w-2 h-2 rounded-full shrink-0" :class="statusDotClass(p.status)"></span>
                  <span class="text-sm text-gray-900 font-medium truncate group-hover/row:text-primary-600">{{ p.name }}</span>
                </div>
                <div class="text-[10px] text-gray-400 ml-4">{{ p.id }} ¬∑ ‚Ç¨{{ (p.budget / 1000).toFixed(0) }}k</div>
              </div>

              <!-- Timeline area -->
              <div class="flex-1 flex relative py-1.5">
                <!-- Today line -->
                <div v-if="todayPosition >= 0 && todayPosition <= 100"
                     class="absolute top-0 bottom-0 w-0.5 bg-red-500 z-20"
                     :style="{ left: todayPosition + '%' }"></div>

                <!-- Quarter grid lines -->
                <div v-for="(q, qi) in timelineQuarters" :key="q.key"
                     class="flex-1 border-r border-surface-100 last:border-r-0"></div>

                <!-- Bar -->
                <div class="absolute top-1/2 -translate-y-1/2 h-5 rounded flex items-center cursor-pointer z-10"
                     :style="barStyle(p)"
                     :title="p.name + ' (' + p.start + ' ‚Üí ' + p.end + ')'"
                     @click="navigateTo('/projects/' + p.id)">
                  <!-- Conformity indicator (bottom border) -->
                  <div class="absolute bottom-0 left-0 right-0 h-1 rounded-b"
                       :class="conformityBarClass(p.conformity)"></div>
                  <!-- Label inside bar -->
                  <span class="text-[9px] text-white font-medium px-1.5 truncate drop-shadow-sm">{{ p.name }}</span>
                </div>

                <!-- Milestone markers (start & end) -->
                <div v-if="milestoneStartPos(p) !== null"
                     class="absolute top-1/2 -translate-y-1/2 z-10 text-xs"
                     :style="{ left: milestoneStartPos(p) + '%' }"
                     :title="'Start: ' + p.start">
                  <span class="text-gray-500">‚óÜ</span>
                </div>
                <div v-if="milestoneEndPos(p) !== null"
                     class="absolute top-1/2 -translate-y-1/2 z-10 text-xs"
                     :style="{ left: milestoneEndPos(p) + '%' }"
                     :title="'End: ' + p.end">
                  <span class="text-gray-500">‚óÜ</span>
                </div>

                <!-- Dependency arrows (simplified: lines to dependent projects) -->
                <template v-for="dep in depsFrom(p.id)" :key="dep.targetProjectId">
                  <div v-if="depArrowStyle(p, dep)"
                       class="absolute z-5 border-t-2 border-dashed"
                       :class="depTypeColor(dep.type)"
                       :style="depArrowStyle(p, dep)"
                       :title="dep.description || (dep.type + ' dependency')">
                  </div>
                </template>
              </div>
            </div>
          </div>

          <!-- Empty state -->
          <div v-if="filteredProjects.length === 0" class="text-center py-12 text-gray-400 text-sm">
            No projects match the current filters
          </div>
        </div>
      </div>
    </div>
  `,
  setup () {
    const { ref, computed } = Vue

    const filterStatus = ref('')
    const filterConformity = ref('')
    const groupBy = ref('domain')

    // ‚îÄ‚îÄ Quarter parsing ‚îÄ‚îÄ

    function parseQuarter (qStr) {
      if (!qStr) return null
      const match = qStr.match(/Q(\d)\/(\d{4})/)
      if (!match) return null
      return { q: parseInt(match[1]), y: parseInt(match[2]) }
    }

    function quarterToIndex (q) {
      if (!q) return null
      return q.y * 4 + q.q
    }

    function indexToQuarter (idx) {
      const y = Math.floor((idx - 1) / 4)
      const q = ((idx - 1) % 4) + 1
      return { q, y, label: 'Q' + q + '/' + y, key: 'Q' + q + '-' + y }
    }

    // ‚îÄ‚îÄ Timeline range ‚îÄ‚îÄ

    const timelineQuarters = computed(() => {
      const projects = store.data.projects
      if (!projects.length) return []

      let minIdx = Infinity, maxIdx = -Infinity
      projects.forEach(p => {
        const si = quarterToIndex(parseQuarter(p.start))
        const ei = quarterToIndex(parseQuarter(p.end))
        if (si !== null && si < minIdx) minIdx = si
        if (ei !== null && ei > maxIdx) maxIdx = ei
      })

      if (minIdx === Infinity) return []

      // Add one quarter padding on each side
      minIdx = Math.max(1, minIdx - 1)
      maxIdx = maxIdx + 1

      const quarters = []
      for (let i = minIdx; i <= maxIdx; i++) {
        const qObj = indexToQuarter(i)
        const now = new Date()
        const currentQ = Math.ceil((now.getMonth() + 1) / 3)
        const currentY = now.getFullYear()
        qObj.isCurrent = qObj.q === currentQ && qObj.y === currentY
        quarters.push(qObj)
      }
      return quarters
    })

    const timelineMinIdx = computed(() => {
      return timelineQuarters.value.length > 0
        ? quarterToIndex(timelineQuarters.value[0])
        : 0
    })

    const timelineMaxIdx = computed(() => {
      return timelineQuarters.value.length > 0
        ? quarterToIndex(timelineQuarters.value[timelineQuarters.value.length - 1])
        : 1
    })

    const timelineRange = computed(() => timelineMaxIdx.value - timelineMinIdx.value + 1)

    // ‚îÄ‚îÄ Today position ‚îÄ‚îÄ
    const todayPosition = computed(() => {
      const now = new Date()
      const currentQ = Math.ceil((now.getMonth() + 1) / 3)
      const currentY = now.getFullYear()
      const currentMonth = now.getMonth() + 1
      // Calculate sub-quarter position
      const qStartMonth = (currentQ - 1) * 3 + 1
      const monthInQ = currentMonth - qStartMonth
      const dayFrac = (now.getDate() - 1) / 30
      const subQ = (monthInQ + dayFrac) / 3

      const idx = currentY * 4 + currentQ
      const pos = ((idx - timelineMinIdx.value + subQ) / timelineRange.value) * 100
      return pos
    })

    // ‚îÄ‚îÄ Filtered projects ‚îÄ‚îÄ

    const filteredProjects = computed(() => {
      let list = [...store.data.projects]
      if (filterStatus.value) list = list.filter(p => p.status === filterStatus.value)
      if (filterConformity.value) list = list.filter(p => p.conformity === filterConformity.value)
      return list
    })

    // ‚îÄ‚îÄ Grouped projects ‚îÄ‚îÄ

    const groupedProjects = computed(() => {
      const projects = filteredProjects.value
      const groups = []

      if (groupBy.value === 'domain') {
        const domainMap = new Map()
        projects.forEach(p => {
          const d = store.domainById(p.primaryDomain)
          const key = d ? d.id : 'none'
          if (!domainMap.has(key)) {
            domainMap.set(key, {
              label: d ? d.name : 'No Domain',
              color: d ? d.color : '#94a3b8',
              projects: []
            })
          }
          domainMap.get(key).projects.push(p)
        })
        domainMap.forEach(g => groups.push(g))
      } else if (groupBy.value === 'category') {
        const catMap = new Map()
        projects.forEach(p => {
          const key = p.category || 'Uncategorized'
          if (!catMap.has(key)) {
            catMap.set(key, { label: key, color: null, projects: [] })
          }
          catMap.get(key).projects.push(p)
        })
        catMap.forEach(g => groups.push(g))
      } else if (groupBy.value === 'status') {
        const statusMap = new Map([
          ['green', { label: 'Green', color: '#22c55e', projects: [] }],
          ['yellow', { label: 'Yellow', color: '#eab308', projects: [] }],
          ['red', { label: 'Red', color: '#ef4444', projects: [] }]
        ])
        projects.forEach(p => {
          const key = p.status || 'green'
          if (statusMap.has(key)) statusMap.get(key).projects.push(p)
        })
        statusMap.forEach((g, k) => { if (g.projects.length > 0) groups.push(g) })
      }

      return groups
    })

    // ‚îÄ‚îÄ Bar positioning ‚îÄ‚îÄ

    function barStyle (p) {
      const si = quarterToIndex(parseQuarter(p.start))
      const ei = quarterToIndex(parseQuarter(p.end))
      if (si === null || ei === null) return { display: 'none' }

      const left = ((si - timelineMinIdx.value) / timelineRange.value) * 100
      const width = ((ei - si + 1) / timelineRange.value) * 100

      const bgColor = { green: '#22c55e', yellow: '#eab308', red: '#ef4444' }[p.status] || '#94a3b8'

      return {
        left: left + '%',
        width: Math.max(width, 2) + '%',
        backgroundColor: bgColor + 'DD'
      }
    }

    function milestoneStartPos (p) {
      const si = quarterToIndex(parseQuarter(p.start))
      if (si === null) return null
      return ((si - timelineMinIdx.value) / timelineRange.value) * 100 - 0.5
    }

    function milestoneEndPos (p) {
      const ei = quarterToIndex(parseQuarter(p.end))
      if (ei === null) return null
      return ((ei - timelineMinIdx.value + 1) / timelineRange.value) * 100 - 0.5
    }

    // ‚îÄ‚îÄ Status / conformity helpers ‚îÄ‚îÄ

    function statusDotClass (s) {
      return { green: 'bg-green-500', yellow: 'bg-yellow-500', red: 'bg-red-500' }[s] || 'bg-gray-400'
    }

    function conformityBarClass (c) {
      return {
        'Konform': 'bg-blue-400',
        'Teilkonform': 'bg-orange-400',
        'Widerspricht': 'bg-red-400'
      }[c] || 'bg-gray-300'
    }

    // ‚îÄ‚îÄ Dependencies ‚îÄ‚îÄ

    function depsFrom (projectId) {
      return store.data.projectDependencies.filter(d => d.sourceProjectId === projectId)
    }

    function depTypeColor (type) {
      return {
        T: 'border-blue-400',
        D: 'border-purple-400',
        P: 'border-orange-400',
        R: 'border-red-400',
        F: 'border-green-400',
        Z: 'border-gray-400'
      }[type] || 'border-gray-400'
    }

    function depArrowStyle (sourceProject, dep) {
      const sp = sourceProject
      const tp = store.projectById(dep.targetProjectId)
      if (!tp) return null

      const sei = quarterToIndex(parseQuarter(sp.end))
      const tsi = quarterToIndex(parseQuarter(tp.start))
      if (sei === null || tsi === null) return null

      const startPct = ((sei - timelineMinIdx.value + 1) / timelineRange.value) * 100
      const endPct = ((tsi - timelineMinIdx.value) / timelineRange.value) * 100

      if (endPct <= startPct) return null

      return {
        left: startPct + '%',
        width: (endPct - startPct) + '%',
        top: '50%'
      }
    }

    function printView () {
      window.print()
    }

    return {
      store, linkTo, navigateTo,
      filterStatus, filterConformity, groupBy,
      timelineQuarters, filteredProjects, groupedProjects,
      todayPosition,
      barStyle, milestoneStartPos, milestoneEndPos,
      statusDotClass, conformityBarClass,
      depsFrom, depTypeColor, depArrowStyle,
      printView
    }
  }
}


// ‚îÄ‚îÄ ExecutiveSummary (executive-summary.js) ‚îÄ‚îÄ
// executive-summary.js ‚Äî Executive Summary / Management Report (print/PDF-ready)

const ExecutiveSummary = {
  name: 'ExecutiveSummary',
  template: `
    <div class="space-y-6">
      <!-- Toolbar (no-print) -->
      <div class="flex flex-wrap items-center gap-3 no-print">
        <h2 class="text-sm font-semibold text-gray-700">Executive Summary ‚Äî {{ reportDate }}</h2>
        <div class="flex-1"></div>
        <button @click="printReport()" class="px-4 py-2 bg-primary-600 text-white rounded-lg text-sm hover:bg-primary-700 flex items-center gap-2">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"/></svg>
          Export PDF / Print
        </button>
      </div>

      <!-- Print-optimized Report -->
      <div class="print-report space-y-5">
        <!-- Report Header -->
        <div class="bg-white rounded-xl border border-surface-200 p-6">
          <div class="flex items-start justify-between">
            <div>
              <h1 class="text-xl font-bold text-gray-900">{{ store.data.meta.company }}</h1>
              <h2 class="text-lg font-semibold text-primary-600 mt-1">IT Strategy ‚Äî Executive Summary</h2>
              <p class="text-sm text-gray-500 mt-1">Report Date: {{ reportDate }} ¬∑ Version {{ store.data.meta.version }}</p>
            </div>
            <div class="text-right text-xs text-gray-400">
              <div>Owner: {{ store.data.meta.owner }}</div>
              <div>Generated: {{ generatedAt }}</div>
            </div>
          </div>
        </div>

        <!-- KPI Overview Cards -->
        <div class="bg-white rounded-xl border border-surface-200 p-5">
          <h3 class="text-sm font-bold text-gray-800 mb-4 uppercase tracking-wide flex items-center gap-2">
            <svg class="w-4 h-4 text-primary-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/></svg>
            Key Performance Indicators
          </h3>
          <div class="grid grid-cols-2 sm:grid-cols-4 gap-4">
            <div v-for="kpi in summaryKpis" :key="kpi.label" class="border border-surface-200 rounded-lg p-3 text-center">
              <div class="text-[10px] font-semibold text-gray-500 uppercase tracking-wide">{{ kpi.label }}</div>
              <div class="text-2xl font-bold mt-1" :style="{ color: kpi.color }">{{ kpi.value }}</div>
              <div v-if="kpi.sub" class="text-[10px] text-gray-400 mt-0.5">{{ kpi.sub }}</div>
            </div>
          </div>
        </div>

        <!-- Ampelstatus (Traffic Light) Overview -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-5">
          <!-- Project Status Ampel -->
          <div class="bg-white rounded-xl border border-surface-200 p-5">
            <h3 class="text-sm font-bold text-gray-800 mb-4 uppercase tracking-wide flex items-center gap-2">
              <svg class="w-4 h-4 text-primary-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
              Project Status Overview
            </h3>
            <div class="flex items-center gap-6 mb-4">
              <div class="flex items-center gap-2">
                <span class="w-5 h-5 rounded-full bg-green-500 flex items-center justify-center text-white text-xs font-bold">{{ statusCounts.green }}</span>
                <span class="text-sm text-gray-600">On Track</span>
              </div>
              <div class="flex items-center gap-2">
                <span class="w-5 h-5 rounded-full bg-yellow-500 flex items-center justify-center text-white text-xs font-bold">{{ statusCounts.yellow }}</span>
                <span class="text-sm text-gray-600">At Risk</span>
              </div>
              <div class="flex items-center gap-2">
                <span class="w-5 h-5 rounded-full bg-red-500 flex items-center justify-center text-white text-xs font-bold">{{ statusCounts.red }}</span>
                <span class="text-sm text-gray-600">Critical</span>
              </div>
            </div>
            <!-- Status bar -->
            <div class="w-full h-3 rounded-full flex overflow-hidden bg-surface-100">
              <div class="bg-green-500 h-full" :style="{ width: statusPct('green') + '%' }"></div>
              <div class="bg-yellow-500 h-full" :style="{ width: statusPct('yellow') + '%' }"></div>
              <div class="bg-red-500 h-full" :style="{ width: statusPct('red') + '%' }"></div>
            </div>
          </div>

          <!-- Budget Overview -->
          <div class="bg-white rounded-xl border border-surface-200 p-5">
            <h3 class="text-sm font-bold text-gray-800 mb-4 uppercase tracking-wide flex items-center gap-2">
              <svg class="w-4 h-4 text-primary-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
              Budget Overview
            </h3>
            <div class="space-y-2">
              <div class="flex justify-between items-baseline">
                <span class="text-sm text-gray-600">Total Portfolio Budget</span>
                <span class="text-xl font-bold text-gray-900">‚Ç¨{{ (store.totalBudget / 1000).toFixed(0) }}k</span>
              </div>
              <div v-for="cat in budgetByCategory" :key="cat.name" class="flex items-center gap-3">
                <span class="text-xs text-gray-600 w-36 truncate">{{ cat.name }}</span>
                <div class="flex-1 h-2 bg-surface-100 rounded-full overflow-hidden">
                  <div class="h-full rounded-full" :style="{ width: cat.pct + '%', backgroundColor: cat.color }"></div>
                </div>
                <span class="text-xs font-mono text-gray-700 w-16 text-right">‚Ç¨{{ (cat.amount / 1000).toFixed(0) }}k</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Management KPIs -->
        <div v-if="mgmtKpis.length" class="bg-white rounded-xl border border-surface-200 p-5">
          <h3 class="text-sm font-bold text-gray-800 mb-4 uppercase tracking-wide flex items-center gap-2">
            <svg class="w-4 h-4 text-primary-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"/></svg>
            Management KPIs ‚Äî Target vs Actual
          </h3>
          <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-3">
            <div v-for="kpi in mgmtKpis" :key="kpi.id" class="border rounded-lg p-3"
                 :class="kpiStatusBorder(kpi)">
              <div class="flex items-center justify-between mb-1">
                <span class="text-xs font-semibold text-gray-700 truncate">{{ kpi.name }}</span>
                <span class="text-[10px] px-1.5 py-0.5 rounded-full" :class="trendClass(kpi.trend)">
                  {{ trendIcon(kpi.trend) }} {{ kpi.trend }}
                </span>
              </div>
              <div class="flex items-baseline gap-1">
                <span class="text-lg font-bold" :style="{ color: kpiColor(kpi) }">{{ kpi.current }}</span>
                <span class="text-xs text-gray-400">/ {{ kpi.target }} {{ kpi.unit }}</span>
              </div>
              <div class="mt-1.5 w-full h-1.5 bg-surface-100 rounded-full overflow-hidden">
                <div class="h-full rounded-full" :style="{ width: kpiPct(kpi) + '%', backgroundColor: kpiColor(kpi) }"></div>
              </div>
              <div class="text-[10px] text-gray-400 mt-1">{{ kpiDeltaText(kpi) }}</div>
            </div>
          </div>
        </div>

        <!-- Two columns: Top 5 Projects + Top 5 Risks -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-5">
          <!-- Top 5 Projects -->
          <div class="bg-white rounded-xl border border-surface-200 p-5">
            <h3 class="text-sm font-bold text-gray-800 mb-3 uppercase tracking-wide flex items-center gap-2">
              <svg class="w-4 h-4 text-primary-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"/></svg>
              Top 5 Projects (by Budget)
            </h3>
            <div class="space-y-2">
              <div v-for="(p, i) in topProjects" :key="p.id"
                   class="flex items-center gap-3 py-1.5 border-b border-surface-100 last:border-0">
                <span class="text-xs font-bold text-gray-400 w-5">{{ i + 1 }}.</span>
                <span class="w-2 h-2 rounded-full shrink-0" :class="statusDot(p.status)"></span>
                <div class="flex-1 min-w-0">
                  <a :href="linkTo('/projects/' + p.id)" class="text-sm text-primary-600 hover:underline truncate block">{{ p.name }}</a>
                  <div class="text-[10px] text-gray-400">{{ p.category }} ¬∑ {{ p.start }}‚Üí{{ p.end }}</div>
                </div>
                <span class="text-xs font-mono text-gray-700">‚Ç¨{{ (p.budget / 1000).toFixed(0) }}k</span>
                <span class="text-xs px-1.5 py-0.5 rounded-full" :class="conformityClass(p.conformity)">{{ p.conformity || '‚Äî' }}</span>
              </div>
            </div>
          </div>

          <!-- Top 5 Risk Items -->
          <div class="bg-white rounded-xl border border-surface-200 p-5">
            <h3 class="text-sm font-bold text-gray-800 mb-3 uppercase tracking-wide flex items-center gap-2">
              <svg class="w-4 h-4 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z"/></svg>
              Top 5 Risks / Action Items
            </h3>
            <div class="space-y-2">
              <div v-for="(risk, i) in topRisks" :key="i"
                   class="flex items-start gap-3 py-1.5 border-b border-surface-100 last:border-0">
                <span class="text-xs font-bold w-5 shrink-0" :class="risk.severityColor">{{ i + 1 }}.</span>
                <div class="flex-1 min-w-0">
                  <div class="text-sm text-gray-900">{{ risk.title }}</div>
                  <div class="text-[10px] text-gray-400">{{ risk.detail }}</div>
                </div>
                <span class="text-[10px] px-1.5 py-0.5 rounded-full shrink-0" :class="risk.badgeClass">{{ risk.type }}</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Handlungsbedarf (Action Required) -->
        <div class="bg-white rounded-xl border border-surface-200 p-5">
          <h3 class="text-sm font-bold text-gray-800 mb-3 uppercase tracking-wide flex items-center gap-2">
            <svg class="w-4 h-4 text-orange-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/></svg>
            Handlungsbedarf / Required Actions
          </h3>
          <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3">
            <div v-for="action in actionItems" :key="action.title"
                 class="border rounded-lg p-3" :class="action.borderClass">
              <div class="flex items-center gap-2 mb-1">
                <span class="w-2 h-2 rounded-full" :class="action.dotClass"></span>
                <span class="text-xs font-semibold text-gray-800">{{ action.title }}</span>
              </div>
              <p class="text-[11px] text-gray-600">{{ action.description }}</p>
            </div>
          </div>
        </div>

        <!-- Landscape Summary -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-5">
          <!-- TIME Distribution -->
          <div class="bg-white rounded-xl border border-surface-200 p-5">
            <h3 class="text-sm font-bold text-gray-800 mb-3 uppercase tracking-wide">Application Landscape (TIME)</h3>
            <div class="space-y-2">
              <div v-for="(count, quadrant) in store.timeDistribution" :key="quadrant" class="flex items-center gap-3">
                <span class="text-xs w-20 text-gray-600">{{ quadrant }}</span>
                <div class="flex-1 h-3 bg-surface-100 rounded-full overflow-hidden">
                  <div class="h-full rounded-full" :style="{ width: timePct(count) + '%', backgroundColor: timeColor(quadrant) }"></div>
                </div>
                <span class="text-xs font-mono text-gray-700 w-8 text-right">{{ count }}</span>
              </div>
            </div>
          </div>

          <!-- Maturity Overview -->
          <div class="bg-white rounded-xl border border-surface-200 p-5">
            <h3 class="text-sm font-bold text-gray-800 mb-3 uppercase tracking-wide">Maturity Overview</h3>
            <div class="space-y-2">
              <div class="flex justify-between text-sm mb-2">
                <span class="text-gray-600">Average Maturity</span>
                <span class="font-bold" :style="{ color: store.avgMaturity >= 3 ? '#10b981' : '#f59e0b' }">{{ store.avgMaturity }} / 5</span>
              </div>
              <div class="flex justify-between text-sm mb-2">
                <span class="text-gray-600">Target Maturity</span>
                <span class="font-bold text-blue-600">{{ store.avgTargetMaturity }} / 5</span>
              </div>
              <div class="flex justify-between text-sm mb-2">
                <span class="text-gray-600">Capabilities with Gap</span>
                <span class="font-bold text-orange-600">{{ store.maturityGaps.length }}</span>
              </div>
              <div v-for="gap in topGaps" :key="gap.capId" class="flex items-center gap-2 text-xs py-0.5">
                <span class="domain-swatch" :style="{ backgroundColor: gap.domainColor }"></span>
                <span class="text-gray-700 flex-1 truncate">{{ gap.capName }}</span>
                <span class="text-orange-600 font-mono">{{ gap.current }}‚Üí{{ gap.target }} (Œî{{ gap.gap.toFixed(1) }})</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Footer -->
        <div class="text-center text-[10px] text-gray-400 py-4 border-t border-surface-200">
          {{ store.data.meta.company }} ¬∑ EA Bebauungsplan ¬∑ {{ reportDate }} ¬∑ Confidential
        </div>
      </div>
    </div>
  `,
  setup () {
    const { computed } = Vue

    const reportDate = computed(() => {
      return new Date().toLocaleDateString('de-AT', { year: 'numeric', month: 'long', day: 'numeric' })
    })

    const generatedAt = computed(() => {
      return new Date().toLocaleString('de-AT')
    })

    // ‚îÄ‚îÄ Summary KPIs ‚îÄ‚îÄ
    const summaryKpis = computed(() => [
      { label: 'Applications', value: store.totalApps, color: '#3b82f6' },
      { label: 'Projects', value: store.totalProjects, color: '#6366f1', sub: statusCounts.value.green + ' green ¬∑ ' + statusCounts.value.yellow + ' yellow ¬∑ ' + statusCounts.value.red + ' red' },
      { label: 'Total Budget', value: '‚Ç¨' + (store.totalBudget / 1000).toFixed(0) + 'k', color: '#8b5cf6' },
      { label: 'Avg Maturity', value: store.avgMaturity + '/5', color: store.avgMaturity >= 3 ? '#10b981' : '#f59e0b', sub: 'Target: ' + store.avgTargetMaturity + '/5' },
      { label: 'Domains', value: store.data.domains.length, color: '#3b82f6' },
      { label: 'Capabilities', value: store.totalCapabilities, color: '#64748b', sub: store.totalSubCapabilities + ' sub-capabilities' },
      { label: 'Vendors', value: store.totalVendors, color: '#f97316' },
      { label: 'Demands', value: store.totalDemands, color: '#8b5cf6' }
    ])

    // ‚îÄ‚îÄ Status ‚îÄ‚îÄ
    const statusCounts = computed(() => store.projectStatusCounts)

    function statusPct (status) {
      const total = store.totalProjects
      if (!total) return 0
      return (statusCounts.value[status] / total) * 100
    }

    function statusDot (s) {
      return { green: 'bg-green-500', yellow: 'bg-yellow-500', red: 'bg-red-500' }[s] || 'bg-gray-400'
    }

    // ‚îÄ‚îÄ Budget by Category ‚îÄ‚îÄ
    const budgetByCategory = computed(() => {
      const cats = {}
      store.data.projects.forEach(p => {
        const key = p.category || 'Other'
        cats[key] = (cats[key] || 0) + (p.budget || 0)
      })
      const total = store.totalBudget || 1
      const colors = {
        'Run / Pflicht': '#64748b',
        'Modernisierung': '#3b82f6',
        'Optimierung': '#10b981',
        'Innovation / Grow': '#8b5cf6',
        'Infrastruktur': '#f97316'
      }
      return Object.entries(cats).map(([name, amount]) => ({
        name,
        amount,
        pct: (amount / total) * 100,
        color: colors[name] || '#94a3b8'
      })).sort((a, b) => b.amount - a.amount)
    })

    // ‚îÄ‚îÄ Management KPIs ‚îÄ‚îÄ
    const mgmtKpis = computed(() => store.data.managementKPIs || [])

    function kpiPct (kpi) {
      const c = parseFloat(kpi.current) || 0
      const t = parseFloat(kpi.target) || 1
      return Math.min(100, (c / t) * 100)
    }

    function kpiColor (kpi) {
      const p = kpiPct(kpi)
      if (p >= 80) return '#10b981'
      if (p >= 50) return '#f59e0b'
      return '#ef4444'
    }

    function kpiStatusBorder (kpi) {
      const p = kpiPct(kpi)
      if (p >= 80) return 'border-green-200'
      if (p >= 50) return 'border-yellow-200'
      return 'border-red-200'
    }

    function kpiDeltaText (kpi) {
      const c = parseFloat(kpi.current) || 0
      const t = parseFloat(kpi.target) || 0
      const delta = c - t
      if (delta >= 0) return '‚úì Target reached'
      return 'Œî ' + delta.toFixed(0) + ' ' + (kpi.unit || '') + ' to target'
    }

    function trendClass (t) {
      return {
        improving: 'bg-green-100 text-green-700',
        stable: 'bg-gray-100 text-gray-600',
        declining: 'bg-red-100 text-red-700'
      }[t] || 'bg-gray-100 text-gray-600'
    }

    function trendIcon (t) {
      return { improving: '‚Üë', stable: '‚Üí', declining: '‚Üì' }[t] || '‚Üí'
    }

    // ‚îÄ‚îÄ Top Projects ‚îÄ‚îÄ
    const topProjects = computed(() => {
      return [...store.data.projects]
        .sort((a, b) => (b.budget || 0) - (a.budget || 0))
        .slice(0, 5)
    })

    function conformityClass (c) {
      return {
        'Konform': 'bg-blue-100 text-blue-700',
        'Teilkonform': 'bg-orange-100 text-orange-700',
        'Widerspricht': 'bg-red-100 text-red-700'
      }[c] || 'bg-gray-100 text-gray-600'
    }

    // ‚îÄ‚îÄ Top Risks (auto-generated from data) ‚îÄ‚îÄ
    const topRisks = computed(() => {
      const risks = []

      // Red projects = risks
      store.data.projects
        .filter(p => p.status === 'red')
        .forEach(p => {
          risks.push({
            title: p.name + ' ‚Äî Critical Status',
            detail: p.statusText || 'Project is in red status',
            type: 'Project',
            severityColor: 'text-red-600',
            badgeClass: 'bg-red-100 text-red-700',
            priority: 1
          })
        })

      // Yellow projects = risks
      store.data.projects
        .filter(p => p.status === 'yellow')
        .forEach(p => {
          risks.push({
            title: p.name + ' ‚Äî At Risk',
            detail: p.statusText || 'Project needs attention',
            type: 'Project',
            severityColor: 'text-yellow-600',
            badgeClass: 'bg-yellow-100 text-yellow-700',
            priority: 2
          })
        })

      // Non-conform projects
      store.data.projects
        .filter(p => p.conformity === 'Widerspricht')
        .forEach(p => {
          risks.push({
            title: p.name + ' ‚Äî Non-Conformant',
            detail: 'Project contradicts architecture principles',
            type: 'Conformity',
            severityColor: 'text-red-600',
            badgeClass: 'bg-red-100 text-red-700',
            priority: 1
          })
        })

      // Apps to eliminate
      const eliminateApps = store.data.applications.filter(a => a.timeQuadrant === 'Eliminate')
      if (eliminateApps.length > 0) {
        risks.push({
          title: eliminateApps.length + ' Applications marked for Elimination',
          detail: eliminateApps.map(a => a.name).join(', '),
          type: 'Landscape',
          severityColor: 'text-orange-600',
          badgeClass: 'bg-orange-100 text-orange-700',
          priority: 2
        })
      }

      // Maturity gaps
      const bigGaps = store.maturityGaps.filter(g => g.gap >= 2)
      if (bigGaps.length > 0) {
        risks.push({
          title: bigGaps.length + ' Capabilities with critical maturity gap (‚â•2)',
          detail: bigGaps.slice(0, 3).map(g => g.capName + ' (Œî' + g.gap.toFixed(1) + ')').join(', '),
          type: 'Maturity',
          severityColor: 'text-orange-600',
          badgeClass: 'bg-orange-100 text-orange-700',
          priority: 2
        })
      }

      return risks.sort((a, b) => a.priority - b.priority).slice(0, 5)
    })

    // ‚îÄ‚îÄ Action Items (auto-derived) ‚îÄ‚îÄ
    const actionItems = computed(() => {
      const items = []

      const redProjects = store.data.projects.filter(p => p.status === 'red')
      if (redProjects.length > 0) {
        items.push({
          title: 'Critical Projects',
          description: redProjects.length + ' project(s) in red status require immediate management attention: ' + redProjects.map(p => p.name).join(', '),
          dotClass: 'bg-red-500',
          borderClass: 'border-red-200'
        })
      }

      const yellowProjects = store.data.projects.filter(p => p.status === 'yellow')
      if (yellowProjects.length > 0) {
        items.push({
          title: 'Projects at Risk',
          description: yellowProjects.length + ' project(s) need attention: ' + yellowProjects.map(p => p.name).join(', '),
          dotClass: 'bg-yellow-500',
          borderClass: 'border-yellow-200'
        })
      }

      const eliminateApps = store.data.applications.filter(a => a.timeQuadrant === 'Eliminate')
      if (eliminateApps.length > 0) {
        items.push({
          title: 'App Decommissioning',
          description: eliminateApps.length + ' application(s) planned for elimination: ' + eliminateApps.map(a => a.name).join(', '),
          dotClass: 'bg-orange-500',
          borderClass: 'border-orange-200'
        })
      }

      const bigGaps = store.maturityGaps.filter(g => g.gap >= 2)
      if (bigGaps.length > 0) {
        items.push({
          title: 'Maturity Investment',
          description: bigGaps.length + ' capability gap(s) ‚â•2 require targeted investment',
          dotClass: 'bg-blue-500',
          borderClass: 'border-blue-200'
        })
      }

      const nonConform = store.data.projects.filter(p => p.conformity === 'Widerspricht')
      if (nonConform.length > 0) {
        items.push({
          title: 'Architecture Compliance',
          description: nonConform.length + ' project(s) contradict architecture principles and need review',
          dotClass: 'bg-red-500',
          borderClass: 'border-red-200'
        })
      }

      return items
    })

    // ‚îÄ‚îÄ TIME Distribution ‚îÄ‚îÄ
    function timePct (count) {
      const total = store.totalApps
      return total ? (count / total) * 100 : 0
    }

    function timeColor (quadrant) {
      return { Invest: '#f59e0b', Tolerate: '#10b981', Migrate: '#3b82f6', Eliminate: '#ef4444' }[quadrant] || '#94a3b8'
    }

    // ‚îÄ‚îÄ Top maturity gaps ‚îÄ‚îÄ
    const topGaps = computed(() => store.maturityGaps.slice(0, 5))

    // ‚îÄ‚îÄ Print / PDF ‚îÄ‚îÄ
    function printReport () {
      window.print()
    }

    return {
      store, linkTo, reportDate, generatedAt,
      summaryKpis, statusCounts, statusPct, statusDot,
      budgetByCategory,
      mgmtKpis, kpiPct, kpiColor, kpiStatusBorder, kpiDeltaText, trendClass, trendIcon,
      topProjects, conformityClass,
      topRisks, actionItems,
      timePct, timeColor, topGaps,
      printReport
    }
  }
}


// ‚îÄ‚îÄ IntegrationMap (integration-map.js) ‚îÄ‚îÄ
// integration-map.js ‚Äî D3 force-directed application integration / interface diagram

const IntegrationMap = {
  name: 'IntegrationMap',
  template: `
    <div class="space-y-4">
      <p class="text-sm text-gray-500">Schnittstellen-Diagramm der Applikations-Kommunikation. Pfeile zeigen Datenfl√ºsse zwischen Anwendungen. Drag & Drop zum Anordnen.</p>

      <!-- Legend -->
      <div class="flex flex-wrap items-center gap-4 text-xs text-gray-500">
        <span class="font-medium">Schnittstellen-Typ:</span>
        <span v-for="it in ifTypes" :key="it.value" class="flex items-center gap-1">
          <span class="w-3 h-0.5 inline-block rounded" :style="{ backgroundColor: ifColor(it.value) }"></span>
          {{ it.symbol }} {{ it.label }}
        </span>
      </div>

      <!-- Filter -->
      <div class="flex flex-wrap items-center gap-3">
        <select v-model="filterType" class="text-sm border border-surface-200 rounded-lg px-3 py-1.5 bg-white">
          <option value="">Alle Typen</option>
          <option v-for="it in ifTypes" :key="it.value" :value="it.value">{{ it.label }}</option>
        </select>
        <select v-model="filterApp" class="text-sm border border-surface-200 rounded-lg px-3 py-1.5 bg-white">
          <option value="">Alle Applikationen</option>
          <option v-for="app in sortedApps" :key="app.id" :value="app.id">{{ app.name }}</option>
        </select>
        <button @click="showForm = true"
                class="ml-auto bg-primary-600 hover:bg-primary-700 text-white text-sm px-4 py-1.5 rounded-lg flex items-center gap-1.5">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/></svg>
          Integration hinzuf√ºgen
        </button>
      </div>

      <!-- Graph -->
      <div class="bg-white rounded-xl border border-surface-200 overflow-hidden">
        <div ref="graphContainer" class="w-full h-[400px] lg:h-[560px]"></div>
      </div>

      <!-- Integration table -->
      <div class="bg-white rounded-xl border border-surface-200 overflow-x-auto">
        <div class="px-5 py-3 border-b border-surface-200 bg-surface-50">
          <h3 class="text-sm font-semibold text-gray-700">Alle Integrationen ({{ filtered.length }})</h3>
        </div>
        <table class="w-full text-sm">
          <thead>
            <tr class="border-b border-surface-200 bg-surface-50">
              <th class="text-left px-4 py-2 font-medium text-gray-600">Quell-App</th>
              <th class="text-left px-4 py-2 font-medium text-gray-600">Typ</th>
              <th class="text-left px-4 py-2 font-medium text-gray-600">Ziel-App</th>
              <th class="text-left px-4 py-2 font-medium text-gray-600 hidden md:table-cell">Protokoll</th>
              <th class="text-left px-4 py-2 font-medium text-gray-600 hidden lg:table-cell">Beschreibung</th>
              <th class="text-left px-4 py-2 font-medium text-gray-600 hidden sm:table-cell">Frequenz</th>
              <th class="text-right px-4 py-2 font-medium text-gray-600">Aktion</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-surface-100">
            <tr v-for="integ in filtered" :key="integ.id" class="hover:bg-surface-50">
              <td class="px-4 py-2 text-gray-700 cursor-pointer hover:text-primary-600" @click="navigateTo('/apps/' + integ.sourceAppId)">{{ appName(integ.sourceAppId) }}</td>
              <td class="px-4 py-2">
                <span class="text-xs px-2 py-0.5 rounded-full" :style="{ backgroundColor: ifColor(integ.interfaceType) + '20', color: ifColor(integ.interfaceType) }">
                  {{ ifLabel(integ.interfaceType) }}
                </span>
              </td>
              <td class="px-4 py-2 text-gray-700 cursor-pointer hover:text-primary-600" @click="navigateTo('/apps/' + integ.targetAppId)">{{ appName(integ.targetAppId) }}</td>
              <td class="px-4 py-2 text-xs text-gray-500 hidden md:table-cell">{{ integ.protocol }}</td>
              <td class="px-4 py-2 text-xs text-gray-500 hidden lg:table-cell max-w-xs truncate">{{ integ.description }}</td>
              <td class="px-4 py-2 text-xs text-gray-500 hidden sm:table-cell">{{ integ.frequency }}</td>
              <td class="px-4 py-2 text-right">
                <button @click="editIntegration(integ)" class="text-gray-400 hover:text-primary-600 mr-2" title="Bearbeiten">
                  <svg class="w-4 h-4 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/></svg>
                </button>
                <button @click="removeIntegration(integ.id)" class="text-gray-400 hover:text-red-600" title="L√∂schen">
                  <svg class="w-4 h-4 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/></svg>
                </button>
              </td>
            </tr>
            <tr v-if="!filtered.length">
              <td colspan="7" class="px-4 py-6 text-center text-gray-400">Keine Integrationen vorhanden</td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Add / Edit Modal -->
      <div v-if="showForm" class="fixed inset-0 bg-black/40 z-50 flex items-center justify-center p-4" @click.self="showForm = false">
        <div class="bg-white rounded-xl shadow-xl w-full max-w-lg max-h-[90vh] overflow-y-auto">
          <div class="px-6 py-4 border-b border-surface-200">
            <h3 class="text-lg font-semibold text-gray-900">{{ editing ? 'Integration bearbeiten' : 'Neue Integration' }}</h3>
          </div>
          <div class="px-6 py-4 space-y-4">
            <div class="grid grid-cols-2 gap-4">
              <div>
                <label class="block text-xs font-medium text-gray-600 mb-1">Quell-Applikation</label>
                <select v-model="form.sourceAppId" class="w-full text-sm border border-surface-200 rounded-lg px-3 py-2">
                  <option value="">‚Äî W√§hlen ‚Äî</option>
                  <option v-for="app in sortedApps" :key="app.id" :value="app.id">{{ app.name }}</option>
                </select>
              </div>
              <div>
                <label class="block text-xs font-medium text-gray-600 mb-1">Ziel-Applikation</label>
                <select v-model="form.targetAppId" class="w-full text-sm border border-surface-200 rounded-lg px-3 py-2">
                  <option value="">‚Äî W√§hlen ‚Äî</option>
                  <option v-for="app in sortedApps" :key="app.id" :value="app.id">{{ app.name }}</option>
                </select>
              </div>
            </div>
            <div class="grid grid-cols-2 gap-4">
              <div>
                <label class="block text-xs font-medium text-gray-600 mb-1">Schnittstellen-Typ</label>
                <select v-model="form.interfaceType" class="w-full text-sm border border-surface-200 rounded-lg px-3 py-2">
                  <option v-for="it in ifTypes" :key="it.value" :value="it.value">{{ it.label }}</option>
                </select>
              </div>
              <div>
                <label class="block text-xs font-medium text-gray-600 mb-1">Protokoll / Format</label>
                <input v-model="form.protocol" class="w-full text-sm border border-surface-200 rounded-lg px-3 py-2" placeholder="z.B. REST, CSV, JDBC" />
              </div>
            </div>
            <div class="grid grid-cols-2 gap-4">
              <div>
                <label class="block text-xs font-medium text-gray-600 mb-1">Frequenz</label>
                <input v-model="form.frequency" class="w-full text-sm border border-surface-200 rounded-lg px-3 py-2" placeholder="z.B. Echtzeit, T√§glich" />
              </div>
              <div>
                <label class="block text-xs font-medium text-gray-600 mb-1">Richtung</label>
                <select v-model="form.direction" class="w-full text-sm border border-surface-200 rounded-lg px-3 py-2">
                  <option value="push">Push (Quelle ‚Üí Ziel)</option>
                  <option value="pull">Pull (Ziel ‚Üê Quelle)</option>
                  <option value="bidirectional">Bidirektional</option>
                </select>
              </div>
            </div>
            <div>
              <label class="block text-xs font-medium text-gray-600 mb-1">Datenobjekte</label>
              <input v-model="form.dataObjects" class="w-full text-sm border border-surface-200 rounded-lg px-3 py-2" placeholder="z.B. Kunden, Auftr√§ge, Rechnungen" />
            </div>
            <div>
              <label class="block text-xs font-medium text-gray-600 mb-1">Beschreibung</label>
              <textarea v-model="form.description" rows="2" class="w-full text-sm border border-surface-200 rounded-lg px-3 py-2" placeholder="Kurze Beschreibung der Integration"></textarea>
            </div>
            <div>
              <label class="block text-xs font-medium text-gray-600 mb-1">Status</label>
              <select v-model="form.status" class="w-full text-sm border border-surface-200 rounded-lg px-3 py-2">
                <option value="active">Aktiv</option>
                <option value="planned">Geplant</option>
                <option value="deprecated">Veraltet</option>
              </select>
            </div>
          </div>
          <div class="px-6 py-4 border-t border-surface-200 flex justify-end gap-3">
            <button @click="showForm = false" class="text-sm px-4 py-2 rounded-lg border border-surface-200 hover:bg-surface-50">Abbrechen</button>
            <button @click="saveIntegration" :disabled="!form.sourceAppId || !form.targetAppId || form.sourceAppId === form.targetAppId"
                    class="text-sm px-4 py-2 rounded-lg bg-primary-600 text-white hover:bg-primary-700 disabled:opacity-40">
              {{ editing ? 'Speichern' : 'Hinzuf√ºgen' }}
            </button>
          </div>
        </div>
      </div>
    </div>
  `,
  setup () {
    const { ref, computed, onMounted, nextTick, watch } = Vue
    const graphContainer = ref(null)
    const ifTypes = computed(() => store.data.enums.interfaceType || [])
    const filterType = ref('')
    const filterApp = ref('')
    const showForm = ref(false)
    const editing = ref(null)

    const emptyForm = () => ({
      sourceAppId: '', targetAppId: '', interfaceType: 'API',
      protocol: '', description: '', dataObjects: '',
      frequency: '', direction: 'push', status: 'active'
    })
    const form = ref(emptyForm())

    const sortedApps = computed(() =>
      [...store.data.applications].sort((a, b) => a.name.localeCompare(b.name))
    )

    const ifColorMap = { API: '#3b82f6', File: '#f59e0b', 'DB-Link': '#8b5cf6', Event: '#ef4444', ETL: '#10b981', Manual: '#64748b' }
    function ifColor (type) { return ifColorMap[type] || '#94a3b8' }
    function ifLabel (type) {
      const it = (store.data.enums.interfaceType || []).find(i => i.value === type)
      return it ? it.symbol + ' ' + it.label : type
    }
    function appName (id) { const a = store.appById(id); return a ? a.name : id }

    const filtered = computed(() => {
      let list = store.data.integrations || []
      if (filterType.value) list = list.filter(i => i.interfaceType === filterType.value)
      if (filterApp.value) list = list.filter(i => i.sourceAppId === filterApp.value || i.targetAppId === filterApp.value)
      return list
    })

    function editIntegration (integ) {
      editing.value = integ.id
      form.value = { ...integ }
      showForm.value = true
    }

    function saveIntegration () {
      if (editing.value) {
        store.updateIntegration(editing.value, { ...form.value })
      } else {
        store.addIntegration({ ...form.value })
      }
      showForm.value = false
      editing.value = null
      form.value = emptyForm()
      nextTick(renderGraph)
    }

    function removeIntegration (id) {
      store.deleteIntegration(id)
      nextTick(renderGraph)
    }

    function renderGraph () {
      if (!graphContainer.value || typeof d3 === 'undefined') return

      const container = graphContainer.value
      const width = container.clientWidth
      const height = container.clientHeight || 560

      const integrations = filtered.value
      if (!integrations.length) {
        d3.select(container).selectAll('*').remove()
        d3.select(container).append('div')
          .attr('style', 'display:flex;align-items:center;justify-content:center;height:100%;color:#9ca3af;font-size:14px;')
          .text('Keine Integrationen f√ºr die aktuelle Filterauswahl')
        return
      }

      // Build nodes from apps involved in integrations
      const appIds = new Set()
      integrations.forEach(i => { appIds.add(i.sourceAppId); appIds.add(i.targetAppId) })

      const nodes = [...appIds].map(id => {
        const a = store.appById(id)
        return {
          id,
          name: a ? a.name : id,
          type: a ? a.type : '',
          criticality: a ? a.criticality : '',
          timeQuadrant: a ? a.timeQuadrant : ''
        }
      })

      const links = integrations.map(i => ({
        source: i.sourceAppId,
        target: i.targetAppId,
        type: i.interfaceType,
        direction: i.direction,
        label: i.protocol || i.interfaceType,
        description: i.description
      }))

      // Clear previous
      d3.select(container).selectAll('*').remove()

      const svg = d3.select(container).append('svg')
        .attr('width', width).attr('height', height)
        .attr('viewBox', [0, 0, width, height])

      // Arrow markers per interface type
      const defs = svg.append('defs')
      Object.entries(ifColorMap).forEach(([type, color]) => {
        defs.append('marker')
          .attr('id', 'if-arrow-' + type)
          .attr('viewBox', '0 -5 10 10')
          .attr('refX', 32).attr('refY', 0)
          .attr('markerWidth', 6).attr('markerHeight', 6)
          .attr('orient', 'auto')
          .append('path').attr('d', 'M0,-5L10,0L0,5').attr('fill', color)
        // Reverse arrow for bidirectional
        defs.append('marker')
          .attr('id', 'if-arrow-rev-' + type)
          .attr('viewBox', '0 -5 10 10')
          .attr('refX', -22).attr('refY', 0)
          .attr('markerWidth', 6).attr('markerHeight', 6)
          .attr('orient', 'auto')
          .append('path').attr('d', 'M10,-5L0,0L10,5').attr('fill', color)
      })

      const simulation = d3.forceSimulation(nodes)
        .force('link', d3.forceLink(links).id(d => d.id).distance(160))
        .force('charge', d3.forceManyBody().strength(-500))
        .force('center', d3.forceCenter(width / 2, height / 2))
        .force('collision', d3.forceCollide().radius(50))

      // Links
      const link = svg.append('g').selectAll('line')
        .data(links).join('line')
        .attr('class', 'dep-link')
        .attr('stroke', d => ifColor(d.type))
        .attr('stroke-width', 2)
        .attr('marker-end', d => 'url(#if-arrow-' + d.type + ')')
        .attr('marker-start', d => d.direction === 'bidirectional' ? 'url(#if-arrow-rev-' + d.type + ')' : null)

      // Link labels (protocol)
      const linkLabel = svg.append('g').selectAll('text')
        .data(links).join('text')
        .text(d => d.label)
        .attr('text-anchor', 'middle')
        .attr('fill', d => ifColor(d.type))
        .attr('font-size', '9px')
        .attr('font-weight', '600')
        .attr('dy', -6)

      // Nodes
      const timeColors = { Invest: '#22c55e', Tolerate: '#eab308', Migrate: '#f97316', Eliminate: '#ef4444' }
      const node = svg.append('g').selectAll('g')
        .data(nodes).join('g')
        .call(d3.drag()
          .on('start', (e, d) => { if (!e.active) simulation.alphaTarget(0.3).restart(); d.fx = d.x; d.fy = d.y })
          .on('drag', (e, d) => { d.fx = e.x; d.fy = e.y })
          .on('end', (e, d) => { if (!e.active) simulation.alphaTarget(0); d.fx = null; d.fy = null })
        )
        .style('cursor', 'pointer')
        .on('click', (e, d) => { navigateTo('/apps/' + d.id) })

      // Node rectangles (rounded)
      node.append('rect')
        .attr('x', -28).attr('y', -18)
        .attr('width', 56).attr('height', 36)
        .attr('rx', 8)
        .attr('fill', '#f8fafc')
        .attr('stroke', d => timeColors[d.timeQuadrant] || '#94a3b8')
        .attr('stroke-width', 2.5)

      // Node labels
      node.append('text')
        .text(d => d.name.length > 18 ? d.name.slice(0, 16) + '‚Ä¶' : d.name)
        .attr('x', 0).attr('y', 30)
        .attr('text-anchor', 'middle')
        .attr('fill', '#374151')
        .attr('font-size', '10px')

      // Small type badge inside rect
      node.append('text')
        .text(d => d.type || '')
        .attr('x', 0).attr('y', 3)
        .attr('text-anchor', 'middle')
        .attr('fill', '#64748b')
        .attr('font-size', '9px')

      simulation.on('tick', () => {
        link
          .attr('x1', d => d.source.x).attr('y1', d => d.source.y)
          .attr('x2', d => d.target.x).attr('y2', d => d.target.y)
        linkLabel
          .attr('x', d => (d.source.x + d.target.x) / 2)
          .attr('y', d => (d.source.y + d.target.y) / 2)
        node.attr('transform', d => 'translate(' + d.x + ',' + d.y + ')')
      })
    }

    // Watch filters and re-render
    watch([filterType, filterApp], () => nextTick(renderGraph))

    onMounted(() => {
      nextTick(renderGraph)
      if (typeof ResizeObserver !== 'undefined' && graphContainer.value) {
        let resizeTimer = null
        const ro = new ResizeObserver(() => {
          clearTimeout(resizeTimer)
          resizeTimer = setTimeout(renderGraph, 200)
        })
        ro.observe(graphContainer.value)
      }
    })

    return {
      store, navigateTo, graphContainer, ifTypes, ifColor, ifLabel, appName,
      filterType, filterApp, sortedApps, filtered,
      showForm, editing, form, editIntegration, saveIntegration, removeIntegration
    }
  }
}


// ‚îÄ‚îÄ MaturityGap (maturity-gap.js) ‚îÄ‚îÄ
// maturity-gap.js ‚Äî Maturity Gap Analysis: Ist vs Soll with Chart.js

const MaturityGap = {
  name: 'MaturityGap',
  template: `
    <div class="space-y-6">
      <!-- Domain Filter -->
      <div class="flex items-center gap-3 flex-wrap">
        <button @click="selectedDomain = null"
                class="px-3 py-1.5 text-xs rounded-lg border transition-colors"
                :class="!selectedDomain ? 'bg-primary-600 text-white border-primary-600' : 'border-surface-200 text-gray-600 hover:bg-surface-50'">All Domains</button>
        <button v-for="d in store.data.domains" :key="d.id"
                @click="selectedDomain = d.id"
                class="px-3 py-1.5 text-xs rounded-lg border transition-colors"
                :class="selectedDomain === d.id ? 'text-white border-transparent' : 'border-surface-200 text-gray-600 hover:bg-surface-50'"
                :style="selectedDomain === d.id ? { backgroundColor: d.color } : {}">
          {{ d.name }}
        </button>
      </div>

      <!-- Summary Cards -->
      <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
        <div class="bg-white rounded-xl border border-surface-200 p-4 text-center">
          <div class="text-2xl font-bold text-gray-700">{{ filteredGaps.length }}</div>
          <div class="text-xs text-gray-500">Capabilities</div>
        </div>
        <div class="bg-white rounded-xl border border-surface-200 p-4 text-center">
          <div class="text-2xl font-bold text-amber-500">{{ avgIst }}/5</div>
          <div class="text-xs text-gray-500">Avg Ist</div>
        </div>
        <div class="bg-white rounded-xl border border-surface-200 p-4 text-center">
          <div class="text-2xl font-bold text-indigo-600">{{ avgSoll }}/5</div>
          <div class="text-xs text-gray-500">Avg Soll</div>
        </div>
        <div class="bg-white rounded-xl border border-surface-200 p-4 text-center">
          <div class="text-2xl font-bold" :style="{ color: avgGapVal > 1 ? '#ef4444' : '#f59e0b' }">{{ avgGapVal }}</div>
          <div class="text-xs text-gray-500">Avg Gap</div>
        </div>
      </div>

      <!-- Chart -->
      <div class="bg-white rounded-xl border border-surface-200 p-5">
        <h3 class="text-sm font-semibold text-gray-700 mb-4">Ist vs Soll Maturity</h3>
        <div :style="{ height: chartHeight + 'px' }">
          <canvas ref="gapCanvas"></canvas>
        </div>
        <div class="flex items-center gap-6 mt-3 text-xs text-gray-500">
          <span class="flex items-center gap-1"><span class="w-3 h-3 rounded" style="background:#3b82f6"></span> Ist</span>
          <span class="flex items-center gap-1"><span class="w-3 h-3 rounded" style="background:#818cf8"></span> Soll</span>
        </div>
      </div>

      <!-- Top Gaps Table -->
      <div class="bg-white rounded-xl border border-surface-200 overflow-hidden">
        <div class="px-5 py-3 border-b border-surface-200 bg-surface-50">
          <h3 class="text-sm font-semibold text-gray-700">Top Gaps (Soll ‚àí Ist)</h3>
        </div>
        <table class="w-full text-sm">
          <thead class="text-xs text-gray-500 uppercase tracking-wide">
            <tr>
              <th class="px-5 py-2 text-left">Capability</th>
              <th class="px-5 py-2 text-left">Domain</th>
              <th class="px-5 py-2 text-right">Ist</th>
              <th class="px-5 py-2 text-right">Soll</th>
              <th class="px-5 py-2 text-right">Gap</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-surface-100">
            <tr v-for="row in topGaps" :key="row.capId" class="hover:bg-surface-50">
              <td class="px-5 py-2 font-medium">
                <span class="text-[10px] font-mono text-gray-400 mr-1">{{ row.capId }}</span>
                {{ row.capName }}
              </td>
              <td class="px-5 py-2">
                <span class="inline-block w-3 h-3 rounded mr-1 align-middle" :style="{ backgroundColor: row.domainColor }"></span>
                {{ row.domainName }}
              </td>
              <td class="px-5 py-2 text-right font-mono">{{ row.current }}</td>
              <td class="px-5 py-2 text-right font-mono">{{ row.target }}</td>
              <td class="px-5 py-2 text-right font-bold" :style="{ color: row.gap >= 2 ? '#ef4444' : '#f59e0b' }">{{ row.gap }}</td>
            </tr>
          </tbody>
        </table>
        <div v-if="!topGaps.length" class="text-center py-6 text-sm text-gray-400">No gaps detected.</div>
      </div>
    </div>
  `,
  setup () {
    const { ref, computed, watch, onMounted, nextTick } = Vue
    const selectedDomain = ref(null)
    const gapCanvas = ref(null)
    let chartInstance = null

    const filteredGaps = computed(() => {
      const all = store.maturityGaps || []
      if (!selectedDomain.value) return all
      return all.filter(g => {
        const d = store.data.domains.find(d => d.name === g.domainName)
        return d && d.id === selectedDomain.value
      })
    })

    const avgIst = computed(() => {
      const gs = filteredGaps.value
      return gs.length ? (gs.reduce((s, g) => s + g.current, 0) / gs.length).toFixed(1) : '0'
    })
    const avgSoll = computed(() => {
      const gs = filteredGaps.value
      return gs.length ? (gs.reduce((s, g) => s + g.target, 0) / gs.length).toFixed(1) : '0'
    })
    const avgGapVal = computed(() => {
      const gs = filteredGaps.value
      return gs.length ? (gs.reduce((s, g) => s + g.gap, 0) / gs.length).toFixed(1) : '0'
    })

    const topGaps = computed(() => [...filteredGaps.value].filter(g => g.gap > 0).sort((a, b) => b.gap - a.gap).slice(0, 15))

    const chartHeight = computed(() => Math.max(300, filteredGaps.value.length * 28))

    function renderChart () {
      if (!gapCanvas.value) return
      if (chartInstance) chartInstance.destroy()
      const gs = filteredGaps.value
      const labels = gs.map(g => g.capId + ' ' + g.capName)
      chartInstance = new Chart(gapCanvas.value, {
        type: 'bar',
        data: {
          labels,
          datasets: [
            { label: 'Ist', data: gs.map(g => g.current), backgroundColor: '#3b82f6', borderRadius: 3, barPercentage: 0.6 },
            { label: 'Soll', data: gs.map(g => g.target), backgroundColor: '#818cf8', borderRadius: 3, barPercentage: 0.6 }
          ]
        },
        options: {
          responsive: true, maintainAspectRatio: false, indexAxis: 'y',
          scales: { x: { min: 0, max: 5, ticks: { stepSize: 1 } } },
          plugins: { legend: { position: 'top', labels: { usePointStyle: true, padding: 12 } } }
        }
      })
    }

    onMounted(() => nextTick(renderChart))
    watch(selectedDomain, () => nextTick(renderChart))

    return { store, selectedDomain, filteredGaps, avgIst, avgSoll, avgGapVal, topGaps, chartHeight, gapCanvas }
  }
}


// ‚îÄ‚îÄ AppLayout (layout.js) ‚îÄ‚îÄ
// layout.js ‚Äî App shell with sidebar navigation and header

const AppLayout = {
  name: 'AppLayout',
  template: `
    <div class="flex h-screen overflow-hidden">
      <!-- Mobile Backdrop -->
      <div v-if="store.sidebarOpen" class="fixed inset-0 bg-black/40 z-30 lg:hidden" @click="store.sidebarOpen = false"></div>

      <!-- Sidebar -->
      <aside class="sidebar no-print bg-white border-r border-surface-200 flex flex-col transition-all duration-300
                    fixed inset-y-0 left-0 z-40 w-64 lg:static lg:z-auto"
             :class="store.sidebarOpen ? 'translate-x-0' : '-translate-x-full lg:translate-x-0 lg:w-0 lg:overflow-hidden'">
        <!-- Logo / Brand -->
        <div class="h-16 flex items-center px-4 border-b border-surface-200 shrink-0">
          <div class="w-8 h-8 rounded-lg bg-primary-600 flex items-center justify-center mr-3">
            <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/>
            </svg>
          </div>
          <div>
            <div class="font-bold text-sm text-gray-900 leading-tight">EA Bebauungsplan</div>
            <div class="text-xs text-gray-500 truncate">{{ store.data.meta.company || 'Enterprise Architecture' }}</div>
          </div>
        </div>

        <!-- Navigation -->
        <nav class="flex-1 overflow-y-auto py-3 px-2 space-y-0.5">
          <div class="text-[10px] font-semibold uppercase tracking-wider text-gray-400 px-3 pt-2 pb-1">Overview</div>
          <a v-for="item in navOverview" :key="item.path"
             :href="linkTo(item.path)" @click="closeMobile()"
             class="nav-item flex items-center gap-3 px-3 py-2 rounded-lg text-sm text-gray-700"
             :class="{ active: isActive(item.path) }">
            <span v-html="item.icon" class="w-5 h-5 shrink-0"></span>
            <span>{{ item.label }}</span>
          </a>

          <div class="text-[10px] font-semibold uppercase tracking-wider text-gray-400 px-3 pt-4 pb-1">Capabilities & Apps</div>
          <a v-for="item in navCapApps" :key="item.path"
             :href="linkTo(item.path)" @click="closeMobile()"
             class="nav-item flex items-center gap-3 px-3 py-2 rounded-lg text-sm text-gray-700"
             :class="{ active: isActive(item.path) }">
            <span v-html="item.icon" class="w-5 h-5 shrink-0"></span>
            <span>{{ item.label }}</span>
          </a>

          <div class="text-[10px] font-semibold uppercase tracking-wider text-gray-400 px-3 pt-4 pb-1">Projects</div>
          <a v-for="item in navProjects" :key="item.path"
             :href="linkTo(item.path)" @click="closeMobile()"
             class="nav-item flex items-center gap-3 px-3 py-2 rounded-lg text-sm text-gray-700"
             :class="{ active: isActive(item.path) }">
            <span v-html="item.icon" class="w-5 h-5 shrink-0"></span>
            <span>{{ item.label }}</span>
          </a>

          <div class="text-[10px] font-semibold uppercase tracking-wider text-gray-400 px-3 pt-4 pb-1">Strategy & KPIs</div>
          <a v-for="item in navStrategy" :key="item.path"
             :href="linkTo(item.path)" @click="closeMobile()"
             class="nav-item flex items-center gap-3 px-3 py-2 rounded-lg text-sm text-gray-700"
             :class="{ active: isActive(item.path) }">
            <span v-html="item.icon" class="w-5 h-5 shrink-0"></span>
            <span>{{ item.label }}</span>
          </a>

          <div class="text-[10px] font-semibold uppercase tracking-wider text-gray-400 px-3 pt-4 pb-1">System</div>
          <a :href="linkTo('/settings')" @click="closeMobile()"
             class="nav-item flex items-center gap-3 px-3 py-2 rounded-lg text-sm text-gray-700"
             :class="{ active: isActive('/settings') }">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.066 2.573c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.573 1.066c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.066-2.573c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/></svg>
            <span>Settings</span>
          </a>
        </nav>

        <!-- Version info -->
        <div class="border-t border-surface-200 px-4 py-3 text-[10px] text-gray-400 shrink-0">
          v{{ store.data.meta.version }} ¬∑ Last saved {{ lastSaved }}
        </div>
      </aside>

      <!-- Main content area -->
      <div class="flex-1 flex flex-col overflow-hidden">
        <!-- Header -->
        <header class="h-16 bg-white border-b border-surface-200 flex items-center px-4 gap-4 shrink-0 no-print">
          <button @click="store.sidebarOpen = !store.sidebarOpen"
                  class="p-2 rounded-lg hover:bg-surface-100 text-gray-500">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
            </svg>
          </button>
          <h1 class="text-lg font-semibold text-gray-900">{{ pageTitle }}</h1>
          <div class="flex-1"></div>
          <span class="text-xs text-gray-400 hidden sm:block">{{ store.data.meta.company }}</span>
        </header>

        <!-- Page content -->
        <main class="flex-1 overflow-y-auto p-3 sm:p-4 lg:p-6 bg-surface-50">
          <div v-if="!store.loaded" class="flex items-center justify-center h-full">
            <div class="text-center">
              <div class="animate-spin rounded-full h-10 w-10 border-b-2 border-primary-600 mx-auto mb-4"></div>
              <p class="text-gray-500">Loading data‚Ä¶</p>
            </div>
          </div>
          <component v-else :is="currentComponent" :key="router.path"></component>
        </main>
      </div>
    </div>
  `,
  setup () {
    const navOverview = [
      { path: '/', label: 'Dashboard', icon: '<svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 5a1 1 0 011-1h14a1 1 0 011 1v2a1 1 0 01-1 1H5a1 1 0 01-1-1V5zM4 13a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H5a1 1 0 01-1-1v-6zM16 13a1 1 0 011-1h2a1 1 0 011 1v6a1 1 0 01-1 1h-2a1 1 0 01-1-1v-6z"/></svg>' }
    ]
    const navCapApps = [
      { path: '/domains', label: 'Domains', icon: '<svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"/></svg>' },
      { path: '/apps', label: 'Applications', icon: '<svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/></svg>' },
      { path: '/vendors', label: 'Vendors', icon: '<svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/></svg>' },
      { path: '/capability-matrix', label: 'Cap-App Matrix', icon: '<svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"/></svg>' },
      { path: '/time', label: 'TIME Quadrant', icon: '<svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 3.055A9.001 9.001 0 1020.945 13H11V3.055z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.488 9H15V3.512A9.025 9.025 0 0120.488 9z"/></svg>' },
      { path: '/integration-map', label: 'Integration Map', icon: '<svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"/></svg>' }
    ]
    const navProjects = [
      { path: '/projects', label: 'Portfolio', icon: '<svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"/></svg>' },
      { path: '/demands', label: 'Demand Backlog', icon: '<svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>' },
      { path: '/demand-pipeline', label: 'Demand Pipeline', icon: '<svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4h18v4H3V4zm2 6h14v4H5v-4zm4 6h6v4H9v-4z"/></svg>' },
      { path: '/ai-usecases', label: 'AI Use Cases', icon: '<svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 3.104v5.714a2.25 2.25 0 01-.659 1.591L5 14.5M9.75 3.104c-.251.023-.501.05-.75.082m.75-.082a24.301 24.301 0 014.5 0m0 0v5.714a2.25 2.25 0 00.659 1.591L19 14.5M14.25 3.104c.251.023.501.05.75.082M19 14.5l-1.482 4.446A2.25 2.25 0 0115.378 21H8.622a2.25 2.25 0 01-2.14-1.554L5 14.5m14 0H5"/></svg>' },
      { path: '/project-heatmap', label: 'Project Heatmap', icon: '<svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 18.657A8 8 0 016.343 7.343S7 9 9 10c0-2 .5-5 2.986-7C14 5 16.09 5.777 17.656 7.343A7.975 7.975 0 0120 13a7.975 7.975 0 01-2.343 5.657z"/></svg>' },
      { path: '/dependencies', label: 'Dependencies', icon: '<svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"/></svg>' }
    ]
    const navStrategy = [
      { path: '/budget-dashboard', label: 'Budget Dashboard', icon: '<svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>' },
      { path: '/roadmap', label: 'Strategy Roadmap', icon: '<svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg>' },
      { path: '/executive-summary', label: 'Executive Summary', icon: '<svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>' },
      { path: '/processes', label: 'E2E Processes', icon: '<svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/></svg>' },
      { path: '/maturity-gap', label: 'Maturity Gap', icon: '<svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/></svg>' }
    ]

    const pageTitles = {
      'dashboard-view': 'Dashboard',
      'domain-list': 'Domains & Capabilities',
      'domain-detail': 'Domain Detail',
      'app-list': 'Applications',
      'app-detail': 'Application Detail',
      'cap-app-matrix': 'Capability‚ÄìApplication Matrix',
      'time-quadrant': 'TIME Quadrant',
      'integration-map': 'Integration Map',
      'project-list': 'Project Portfolio',
      'project-detail': 'Project Detail',
      'project-heatmap': 'Project‚ÄìDomain Heatmap',
      'dependency-graph': 'Project Dependencies',
      'process-list': 'E2E Processes',
      'process-detail': 'Process Detail',
      'vendor-list': 'Vendor Management',
      'vendor-detail': 'Vendor Detail',
      'demand-list': 'Demand Backlog',
      'demand-detail': 'Demand Detail',
      'demand-pipeline': 'Demand Pipeline',
      'ai-usecases-list': 'AI Use Cases',
      'budget-dashboard': 'Budget Dashboard',
      'maturity-gap': 'Maturity Gap Analysis',
      'roadmap-view': 'Strategy Roadmap',
      'executive-summary': 'Executive Summary',
      'settings-view': 'Settings'
    }

    const { computed } = Vue
    const currentComponent = computed(() => router.component || 'dashboard-view')
    const pageTitle = computed(() => pageTitles[currentComponent.value] || 'EA Bebauungsplan')
    const lastSaved = computed(() => {
      const d = store.data.meta.lastUpdated
      if (!d) return '‚Äî'
      try { return new Date(d).toLocaleDateString('de-AT') } catch { return d }
    })

    function isActive (path) {
      if (path === '/') return router.path === '/'
      return router.path.startsWith(path)
    }

    function closeMobile () {
      if (window.innerWidth < 1024) store.sidebarOpen = false
    }

    // Start with sidebar closed on mobile
    if (window.innerWidth < 1024) store.sidebarOpen = false

    return {
      store, router, linkTo, navigateTo,
      navOverview, navCapApps, navProjects, navStrategy,
      currentComponent, pageTitle, lastSaved, isActive, closeMobile
    }
  }
}


// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê APP INIT ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const app = Vue.createApp(AppLayout);

app.component('app-layout', AppLayout);
app.component('dashboard-view', DashboardView);
app.component('settings-view', SettingsView);
app.component('domain-list', DomainList);
app.component('domain-detail', DomainDetail);
app.component('domain-form', DomainForm);
app.component('capability-form', CapabilityForm);
app.component('app-list', AppList);
app.component('app-form', AppForm);
app.component('app-detail', AppDetail);
app.component('cap-app-matrix', CapAppMatrix);
app.component('time-quadrant', TimeQuadrant);
app.component('project-list', ProjectList);
app.component('project-form', ProjectForm);
app.component('project-detail', ProjectDetail);
app.component('project-heatmap', ProjectHeatmap);
app.component('dependency-graph', DependencyGraph);
app.component('process-list', ProcessList);
app.component('process-detail', ProcessDetail);
app.component('process-form', ProcessForm);
app.component('maturity-gap', MaturityGap);
app.component('vendor-list', VendorList);
app.component('vendor-detail', VendorDetail);
app.component('vendor-form', VendorForm);

app.component('demand-list', DemandList);
app.component('demand-detail', DemandDetail);
app.component('demand-form', DemandForm);
app.component('demand-pipeline', DemandPipeline);
app.component('ai-usecases-list', AIUsecasesList);
app.component('budget-dashboard', BudgetDashboard);
app.component('roadmap-view', RoadmapView);
app.component('executive-summary', ExecutiveSummary);
app.component('integration-map', IntegrationMap);

initRouter();
loadData();
startWatching();
app.mount('#app');

console.log('[EA Bebauungsplan] App mounted - ' + store.data.meta.company);
  </script>
</body>
</html>
